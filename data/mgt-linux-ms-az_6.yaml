- en: 6\. Troubleshooting and problem solving
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 6.故障排除和问题解决
- en: Our migration journey started in *Chapter 3*, *Assessment and migration planning*,
    where we saw the importance of assessment and its contribution to the overall
    migration journey.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的迁移之旅始于*第3章*，*评估和迁移规划*，在那里我们看到了评估的重要性及其对整个迁移之旅的贡献。
- en: In *Chapter 4*, *Performing migration to Azure*, we witnessed the actual migration
    of Linux workloads to Microsoft Azure Virtual Machines as well as to managed services.
    *Chapter 5*, *Operating Linux on Azure*, was more about the post-migration strategies
    and tools for optimizing and securing workloads in Azure.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在*第4章*中，*执行迁移到Azure*，我们见证了将Linux工作负载实际迁移到Microsoft Azure虚拟机以及托管服务。*第5章*，*在Azure上操作Linux*，更多地关于迁移后的策略和工具，用于优化和保护Azure中的工作负载。
- en: At this point, we have our **virtual machine** (**VM**) successfully migrated
    to Azure. Time to pack your bags and consider the job well done. However, sometimes
    things don't work the way they should. You might be getting strange errors in
    your log files or your client might be complaining that the migrated application
    is behaving incorrectly. You could even find out that your VM doesn't boot at
    all.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 此时，我们已成功将**虚拟机**（**VM**）迁移到Azure。是时候收拾行李，考虑工作完成得很好了。然而，有时事情并不像应该的那样运行。您可能会在日志文件中收到奇怪的错误，或者您的客户可能会抱怨迁移的应用程序行为不正确。您甚至可能发现您的VM根本无法启动。
- en: Being able to analyze the problem and debug the affected system yourself is
    quite important. You don't want to get stuck in the middle of your migration project
    just because you don't know how to figure out why something doesn't work.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 能够分析问题并自行调试受影响的系统非常重要。您不希望因为不知道为什么某些事情不起作用而在迁移项目的中途陷入困境。
- en: This chapter will help you to learn and understand how to assess, debug, and
    fix the most common issues in Linux to Azure migration projects. These topics
    are also useful for newly created Linux VMs on Azure.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将帮助您学习和了解如何评估、调试和修复Linux到Azure迁移项目中最常见的问题。这些主题对于在Azure上新创建的Linux VM也很有用。
- en: 'In this chapter, you will learn about the following:'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，您将了解以下内容：
- en: Remote connectivity and VM start issues
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 远程连接和VM启动问题
- en: Common Linux runtime challenges
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 常见的Linux运行时挑战
- en: Azure diagnostics tooling – a summary
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure诊断工具-摘要
- en: Opening support requests
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 开放支持请求
- en: To get the most from this chapter, you should be familiar with the typical debugging
    methods for on-premises or hosted Linux servers. On Azure, some aspects of debugging
    work a bit differently compared to on-premises.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 要充分利用本章，您应该熟悉本地或托管Linux服务器的典型调试方法。在Azure上，与本地环境相比，一些调试方面的工作有些不同。
- en: Let's start by discussing the most unwanted problem—a VM you can't connect to.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们首先讨论最不希望出现的问题——无法连接的VM。
- en: Remote connectivity and VM start issues
  id: totrans-13
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 远程连接和VM启动问题
- en: In this section, we'll look at some common problems that can cause your VM to
    be unreachable via the network, and we'll provide a couple of ways to fix those
    issues.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将讨论一些常见问题，这些问题可能导致您无法通过网络访问VM，并提供一些解决这些问题的方法。
- en: 'The most common problem we have seen is that you can''t reach the VM using
    `ssh`, as shown in *Figure 6.1*:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 我们见过的最常见问题是无法使用`ssh`连接到VM，如*图6.1*所示：
- en: '![SSH connection fails in Azure CLI](img/B17160_06_01.jpg)'
  id: totrans-16
  prefs: []
  type: TYPE_IMG
  zh: '![Azure CLI中的SSH连接失败](img/B17160_06_01.jpg)'
- en: 'Figure 6.1: SSH connection fails'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.1：SSH连接失败
- en: In this case, the user tried to connect to an Azure VM's private IP address,
    `10.0.0.1`, directly from their laptop. This fails as the private IP addresses
    on Azure are always in the private IP range and cannot be directly accessed via
    the public internet. This is a change from your typical on-premises environment
    where you might have had the ability to directly connect to any VM in your datacenter.
    The actual error message may differ depending on your operating system and the
    actual cause of the connection failure.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，用户尝试直接从其笔记本电脑连接到Azure VM的私有IP地址`10.0.0.1`。这会失败，因为Azure上的私有IP地址始终在私有IP范围内，不能通过公共互联网直接访问。这与您典型的本地环境不同，在本地环境中，您可能有能力直接连接到数据中心中的任何VM。实际的错误消息可能会因操作系统和连接失败的实际原因而有所不同。
- en: 'Azure VMs typically have two IP addresses: the private internal IP and a public
    external IP. You can get a list of all the IP addresses of a VM from the Azure
    portal or the command line. With the Azure CLI you can use the `az vm list-ip-addresses`
    command, as shown in *Figure 6.2*:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: Azure VM通常具有两个IP地址：私有内部IP和公共外部IP。您可以从Azure门户或命令行获取VM的所有IP地址列表。使用Azure CLI，您可以使用`az
    vm list-ip-addresses`命令，如*图6.2*所示：
- en: '![List of IP addresses of VM in Azure CLI](img/B17160_06_02.jpg)'
  id: totrans-20
  prefs: []
  type: TYPE_IMG
  zh: '![Azure CLI中VM的IP地址列表](img/B17160_06_02.jpg)'
- en: 'Figure 6.2: A list of VM IP addresses'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.2：VM IP地址列表
- en: 'If the connection still doesn''t work when using the public IP address, the
    cause is probably one of the following:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 如果使用公共IP地址仍然无法连接，则原因可能是以下之一：
- en: An Azure network security group is blocking the connection.
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure网络安全组正在阻止连接。
- en: The SSH service is not running on the VM.
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: VM上未运行SSH服务。
- en: The Linux firewall is blocking the connection.
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Linux防火墙正在阻止连接。
- en: These are the most common issues we have seen. If your issue is not one of these,
    you will find more analysis guidance later in this chapter in the *Azure diagnostics
    tooling – a summary* section.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 这些是我们见过的最常见问题。如果您的问题不是这些问题之一，您将在本章后面的*Azure诊断工具-摘要*部分找到更多分析指导。
- en: 'Network connectivity issues can be analyzed using the Azure Connection Troubleshoot
    tool found on the Azure portal, as shown in *Figure 6.3*:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 可以使用Azure门户上找到的Azure连接故障排除工具来分析网络连接问题，如*图6.3*所示：
- en: '![Analyzing network connectivity issues using Azure Connection troubleshooting
    tool](img/B17160_06_03.jpg)'
  id: totrans-28
  prefs: []
  type: TYPE_IMG
  zh: '![使用Azure连接故障排除工具分析网络连接问题](img/B17160_06_03.jpg)'
- en: 'Figure 6.3: The Connection Troubleshoot utility'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.3：连接故障排除实用程序
- en: In this example, we can see that the Azure network connection is working correctly
    and the problem is not in the network security group settings.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，我们可以看到Azure网络连接正常工作，问题不在网络安全组设置中。
- en: Run commands without a network connection
  id: totrans-31
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 无网络连接时运行命令
- en: 'To tackle problems inside the Linux VM you can use Azure extensions. To start
    `sshd` this way you first need to create a local `custom.json` file with the following
    content:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 为了解决Linux虚拟机内部的问题，你可以使用Azure扩展。要以这种方式启动`sshd`，你首先需要创建一个名为`custom.json`的本地文件，内容如下：
- en: '[PRE0]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Then invoke a custom extension by using the following command:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 然后使用以下命令调用自定义扩展：
- en: '[PRE1]'
  id: totrans-35
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'The result should be successful, as shown in *Figure 6.4*:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 结果应该是成功的，如*图6.4*所示：
- en: '![Running custom extension command in Azure CLI](img/B17160_06_04.jpg)'
  id: totrans-37
  prefs: []
  type: TYPE_IMG
  zh: '![在Azure CLI中运行自定义扩展命令](img/B17160_06_04.jpg)'
- en: 'Figure 6.4: Running a custom extension'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.4：运行自定义扩展
- en: You can use the same method to run any commands remotely, for example, to turn
    off the Linux firewall if you suspect it might be blocking your SSH connection.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用相同的方法远程运行任何命令，例如，如果怀疑Linux防火墙可能会阻止SSH连接，可以使用这种方法关闭它。
- en: 'The Azure portal also offers a simple user interface to run commands and simple
    scripts remotely, as shown in *Figure 6.5*:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: Azure门户还提供了一个简单的用户界面，可以远程运行命令和简单脚本，如*图6.5*所示：
- en: '![Run command functionality in the Azure portal](img/B17160_06_05.jpg)'
  id: totrans-41
  prefs: []
  type: TYPE_IMG
  zh: '![Azure门户中的运行命令功能](img/B17160_06_05.jpg)'
- en: 'Figure 6.5: Run command functionality in the Azure portal'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.5：Azure门户中的运行命令功能
- en: For the extensions to work, you need to have the Azure Linux Agent installed
    and running on the VM, as Azure extensions use it to execute commands on the VM.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 要使扩展工作，你需要在虚拟机上安装并运行Azure Linux代理，因为Azure扩展使用它在虚拟机上执行命令。
- en: 'If the remote SSH connection still doesn''t work, the reason could be a bit
    more serious: your VM might not actually boot properly, and it is not possible
    to fix this using scripted tools.'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 如果远程SSH连接仍然无法工作，原因可能更严重：你的虚拟机实际上可能无法正确启动，无法使用脚本工具修复。
- en: Boot diagnostics and serial console access
  id: totrans-45
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 启动诊断和串行控制台访问
- en: 'If you suspect the VM is failing to boot properly, you can easily confirm it
    by looking at the boot logs using the Boot diagnostics tool in the Azure portal,
    as shown in *Figure 6.6*:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你怀疑虚拟机无法正确启动，你可以通过在Azure门户中使用启动诊断工具查看启动日志来轻松确认，如*图6.6*所示：
- en: '![Checking the boot logs using the Boot diagnostics tool in the Azure portal](img/B17160_06_06.jpg)'
  id: totrans-47
  prefs: []
  type: TYPE_IMG
  zh: '![使用Azure门户中的启动诊断工具检查启动日志](img/B17160_06_06.jpg)'
- en: 'Figure 6.6: Boot diagnostics utility'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.6：启动诊断实用程序
- en: The system logs are captured from the virtual serial terminal and are read-only.
    You can use the boot logs to find out about and diagnose problems.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 系统日志是从虚拟串行终端捕获的，是只读的。你可以使用启动日志来了解和诊断问题。
- en: 'If you need to log in to the system to fix the problem, you can use the Azure
    Serial console functionality, which can be also found in the VM Support + troubleshooting
    section of the Azure portal, as shown in *Figure 6.7*:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你需要登录系统来解决问题，你可以使用Azure串行控制台功能，也可以在Azure门户的VM支持+故障排除部分找到，如*图6.7*所示：
- en: '![Log in to the system using Azure Serial Console functionality](img/B17160_06_07.jpg)'
  id: totrans-51
  prefs: []
  type: TYPE_IMG
  zh: '![使用Azure串行控制台功能登录系统](img/B17160_06_07.jpg)'
- en: 'Figure 6.7: Using serial console access'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.7：使用串行控制台访问
- en: In this example, we can see that the Ubuntu server is stuck at the GRUB bootloader
    screen waiting for interaction from the user. At this point, you can proceed to
    fix the problem as you would do on any on-premises physical or virtual Linux server.
    We won't go into the details of fixing this particular problem since it could
    be caused by a number of issues, ranging from a failed kernel upgrade to a misconfigured
    partitioning configuration. Instead, let's look at an overview of typical boot
    failure causes.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，我们可以看到Ubuntu服务器卡在GRUB引导加载程序屏幕上，等待用户交互。在这一点上，你可以像在本地物理或虚拟Linux服务器上一样解决问题。我们不会详细讨论解决这个特定问题，因为它可能由多种问题引起，从内核升级失败到错误的分区配置。相反，让我们来看一下典型启动失败原因的概述。
- en: Common boot problems
  id: totrans-54
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 常见的启动问题
- en: Sometimes your Linux VM doesn't boot at all on Azure. This is quite a rare problem
    for VMs created from Azure Linux images, but can be quite common if you migrated
    the VM from on-premises to Azure.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 有时你的Linux虚拟机在Azure上根本无法启动。这对于从Azure Linux映像创建的虚拟机来说是相当罕见的问题，但如果你将虚拟机从本地迁移到Azure，则可能会很常见。
- en: 'There could be various reasons for a VM not booting. Microsoft has published
    the following notes regarding Linux on Azure:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟机无法启动可能有各种原因。微软已经发布了关于Azure上Linux的以下注意事项：
- en: Hyper-V **virtual hard disk** (**VHDX**) format is not supported. Use fixed
    VHD instead.
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 不支持Hyper-V虚拟硬盘（VHDX）格式。请改用固定VHD。
- en: VirtualBox dynamically allocated disks are not supported. Use fixed size instead.
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 不支持动态分配的VirtualBox磁盘。请改用固定大小。
- en: The maximum VHD size is 1,023 GB.
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最大VHD大小为1,023 GB。
- en: Using **Logical Volume Manager** **(LVM**) on system disk may cause name collisions.
    It is recommended to use the standard partition for the system disk and LVM only
    on data disks.
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在系统磁盘上使用逻辑卷管理器（LVM）可能会导致名称冲突。建议在系统磁盘上使用标准分区，只在数据磁盘上使用LVM。
- en: UDF file system support is mandatory, so do not disable it. It is used by the
    Azure Linux Agent.
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: UDF文件系统支持是强制性的，所以不要禁用它。它被Azure Linux代理使用。
- en: Kernel versions before 2.6.37 and Red Hat kernel versions before 2.6.32-504
    don't support `numa=off` parameter in `grub.conf`.
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 内核版本在2.6.37之前和Red Hat内核版本在2.6.32-504之前不支持`grub.conf`中的`numa=off`参数。
- en: Do not use the system disk for the swap file. Let the Azure Linux Agent set
    up the swap on the temporary resource disk.
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 不要使用系统磁盘作为交换文件。让Azure Linux代理在临时资源磁盘上设置交换文件。
- en: There are some very common issues with booting Linux on Azure that happen when
    migrating from `hv_vmbus` and `hv_storvsc` kernel modules are necessary for Linux
    to boot on Azure.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 在Azure上启动Linux时，有一些非常常见的问题，当从`hv_vmbus`和`hv_storvsc`内核模块迁移时，Linux需要这些模块才能在Azure上启动。
- en: 'If you encounter this problem, the proper fix is to run these commands on Linux
    before migrating the VM into Azure:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 如果遇到此问题，正确的修复方法是在将VM迁移到Azure之前在Linux上运行这些命令：
- en: '[PRE2]'
  id: totrans-66
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Please note that it is not possible to fix this problem on Azure by using this
    VM directly. Typically, it is better to fix the source image and move it to Azure
    again. However, the method for fixing this situation on the Azure side would be
    to mount the disk on a working VM and apply the fixes that way.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，在Azure上无法直接使用此VM来解决此问题。通常，最好修复源映像并将其再次移至Azure。但是，在Azure端修复此情况的方法是在工作VM上挂载磁盘并应用修复方法。
- en: 'Sometimes you may encounter boot issues due the virtual disk size, especially
    if you have created the disk manually on your source system and have converted
    a raw disk to VHD. All virtual drives on Azure must use 1 MB size alignment. This
    can be fixed before uploading the image to Azure, for example by using `qemu-img`
    to convert the image:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 有时，您可能会因虚拟磁盘大小而遇到引导问题，特别是如果您在源系统上手动创建了磁盘并将原始磁盘转换为VHD。Azure上的所有虚拟驱动器都必须使用1MB大小的对齐。例如，可以在上传映像到Azure之前通过使用`qemu-img`来转换映像来修复此问题：
- en: '[PRE3]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: After your image is converted correctly, you may upload it to Azure again and
    start it. Once your server boots properly we can focus on possible runtime issues.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 在正确转换映像后，您可以再次将其上传到Azure并启动。一旦服务器正确启动，我们可以专注于可能的运行时问题。
- en: Common Linux runtime challenges
  id: totrans-71
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 常见的Linux运行时挑战
- en: In this section, we will demonstrate how to analyze and fix some common runtime
    problems. One of the most common issues with applications on Linux is incompatibility
    with SELinux settings, especially if you migrate your application from one VM
    to another.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将演示如何分析和修复一些常见的运行时问题。Linux上应用程序的最常见问题之一是与SELinux设置的不兼容性，特别是如果您将应用程序从一个VM迁移到另一个VM。
- en: Also, issues with disk space running out or other storage issues such as storage
    encryption in conjunction with migration may be troublesome. Lastly, some unexpected
    performance issues may arise when you move workloads from on-premises to Azure.
    Let's start by looking at how SELinux works in Azure.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，磁盘空间耗尽或与迁移相关的其他存储问题，如存储加密，可能会带来麻烦。最后，将工作负载从本地迁移到Azure时可能会出现一些意外的性能问题。让我们首先看看在Azure中如何使用SELinux。
- en: SELinux
  id: totrans-74
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: SELinux
- en: Security-Enhanced Linux—more commonly known as SELinux—is a security module
    for the Linux kernel, which provides a mechanism for supporting various access
    control policies to the operating system. There are some alternatives to SELinux,
    such as AppArmor, but they are not commonly used currently. SELinux can be considered
    the standard way of securing Linux installations.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 安全增强型Linux——更常被称为SELinux——是Linux内核的安全模块，为操作系统提供了支持各种访问控制策略的机制。有一些替代方案，如AppArmor，但目前并不常用。SELinux可以被认为是保护Linux安装的标准方式。
- en: 'To check the status of SELinux on your Linux VM you can run the `sestatus`
    command. It prints out many variables, as shown in *Figure 6.8*:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 要检查Linux VM上SELinux的状态，可以运行`sestatus`命令。它会打印出许多变量，如*图6.8*所示：
- en: '![Displaying the current status of SELinux on Linux VM by running the sestatus
    command](img/B17160_06_08.jpg)'
  id: totrans-77
  prefs: []
  type: TYPE_IMG
  zh: '![通过运行sestatus命令在Linux VM上显示当前SELinux状态](img/B17160_06_08.jpg)'
- en: 'Figure 6.8: Output of the sestatus command'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.8：sestatus命令的输出
- en: In this example, you can see the SELinux status is `enabled` and the operating
    mode is `enforcing`. *Figure 6.8* is taken from a CentOS 8.2.2004 VM installed
    from Azure Marketplace.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 在此示例中，您可以看到SELinux状态为`启用`，操作模式为`强制执行`。*图6.8*取自从Azure Marketplace安装的CentOS 8.2.2004
    VM。
- en: 'SELinux is available for all the common Linux distributions. However, it may
    not be `enabled` by default, or it may be configured in permissive mode by default.
    The three operating modes for SELinux are:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: SELinux适用于所有常见的Linux发行版。但是，它可能不会默认`启用`，或者可能默认配置为宽松模式。SELinux的三种操作模式是：
- en: '`enforcing`: SELinux security policy is enforced.'
  id: totrans-81
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`强制执行`：SELinux安全策略已经生效。'
- en: '`permissive`: SELinux prints warnings instead of enforcing the policy.'
  id: totrans-82
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`宽松`：SELinux会打印警告而不是强制执行策略。'
- en: '`disabled`: No SELinux policy is loaded.'
  id: totrans-83
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`禁用`：没有加载任何SELinux策略。'
- en: 'One of the most common SELinux-related questions is: *How do I disable SELinux?*
    The correct answer should always be: *You don''t*. The recommended operation mode
    is, for practical reasons, `permissive`. In the enforcing mode, there is a high
    probability that many applications from `enforcing` mode, then naturally the recommendation
    is to use `enforcing` mode.'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 与SELinux相关的最常见问题之一是：*如何禁用SELinux？*正确答案应该始终是：*不要禁用*。出于实际原因，推荐的操作模式是`宽松`。在强制执行模式下，许多应用程序可能会出现问题，因此自然的建议是使用`强制执行`模式。
- en: By running SELinux in `permissive` mode, you can be sure your applications will
    run and that you can catch possible security problems by auditing the security
    logs. When developing new applications, it is recommended to use `enforcing` mode.
    This way you can be sure your application will run in any production system.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 通过在`宽松`模式下运行SELinux，您可以确保您的应用程序可以运行，并且可以通过审核安全日志来发现可能的安全问题。在开发新应用程序时，建议使用`强制执行`模式。这样您可以确保您的应用程序可以在任何生产系统中运行。
- en: 'You can learn more about SELinux and the reasons why it should be not disabled
    in this amazing SELinux coloring book authored by *Dan Walsh* and illustrated
    by *Máirín Duffy*: [https://github.com/mairin/selinux-coloring-book](https://github.com/mairin/selinux-coloring-book).'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过阅读*Dan Walsh*撰写、*Máirín Duffy*绘制的精彩SELinux着色书来了解更多关于SELinux以及为什么不应该禁用它的原因：[https://github.com/mairin/selinux-coloring-book](https://github.com/mairin/selinux-coloring-book)。
- en: On Azure, you can use SELinux in `enforcing` or `permissive` mode without problems
    in most cases. The only time when you need to turn off SELinux completely is when
    you want to start encrypting a Linux OS disk on Azure. After the encryption is
    complete, you can enable SELinux again.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 在Azure上，您可以在`强制执行`或`宽松`模式下使用SELinux而大多数情况下不会出现问题。唯一需要完全关闭SELinux的时候是当您想要在Azure上启动加密Linux
    OS磁盘时。加密完成后，可以再次启用SELinux。
- en: 'If you have SELinux completely `disabled` or running in `permissive` mode first,
    and later decide to switch on `enforcing` mode, you will probably need to fix
    the file security labels. The easiest way to do this is by telling SELinux to
    relabel the filesystem on the next reboot, and then to reboot the server as follows:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您首先完全`禁用`或以`宽容`模式运行SELinux，然后决定切换到`强制`模式，您可能需要修复文件安全标签。最简单的方法是告诉SELinux在下次重启时重新标记文件系统，然后按以下方式重新启动服务器：
- en: '[PRE4]'
  id: totrans-89
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: After the server is up again, SELinux will have the whole filesystem labeled
    and the security contexts of the files should be up to date again.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 服务器再次启动后，SELinux将对整个文件系统进行标记，并且文件的安全上下文应该再次是最新的。
- en: Note
  id: totrans-91
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 注意
- en: If the system was installed without the `selinux-policy` package, you will need
    to make sure SELinux is initialized during system startup. The dracut utility
    must be run to set SELinux awareness for the `initramfs` filesystem.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 如果系统安装时没有安装`selinux-policy`软件包，则需要确保在系统启动时初始化SELinux。必须运行dracut实用程序来为`initramfs`文件系统设置SELinux意识。
- en: Not doing so will cause SELinux to not start during system boot.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 不这样做将导致SELinux在系统启动时无法启动。
- en: 'A useful reference for SELinux-related issues can be found via Red Hat: [https://access.redhat.com/documentation/red_hat_enterprise_linux/6/html/security-enhanced_linux/sect-security-enhanced_linux-working_with_selinux-changing_selinux_modes](https://access.redhat.com/documentation/red_hat_enterprise_linux/6/html/security-enhanced_linux/sect-security-enhanced_linux-working_with_selinux-changing_selinux_modes).'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 有关与SELinux相关的问题的有用参考资料可以在Red Hat的网站上找到：[https://access.redhat.com/documentation/red_hat_enterprise_linux/6/html/security-enhanced_linux/sect-security-enhanced_linux-working_with_selinux-changing_selinux_modes](https://access.redhat.com/documentation/red_hat_enterprise_linux/6/html/security-enhanced_linux/sect-security-enhanced_linux-working_with_selinux-changing_selinux_modes)。
- en: Next, let's take a look at typical storage issues and how to work around them.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，让我们看一下典型的存储问题以及如何解决它们。
- en: Storage configuration issues
  id: totrans-96
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 存储配置问题
- en: In this section, we are going to cover a few things that could go wrong when
    adding disks. Storage issues are sensitive as they can lead to no-boot scenarios—these
    errors are mainly due to configuration issues in the `/etc/fstab` file. Linux
    administrators know the importance of this file and rectifying misconfigurations
    of this file can resolve no-boot scenarios related to disk and storage.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将涵盖添加磁盘时可能出现的一些问题。存储问题很敏感，因为它们可能导致无法启动的情况——这些错误主要是由`/etc/fstab`文件中的配置问题引起的。Linux管理员知道这个文件的重要性，纠正这个文件的配置错误可以解决与磁盘和存储相关的无法启动的情况。
- en: 'The following are some of the common scenarios and the corresponding logs that
    you would see in the serial console related to `fstab`. If you see any of these
    logs in the console, you can determine the root cause easily:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是一些常见情况以及与`fstab`相关的串行控制台中可能看到的相应日志。如果您在控制台中看到这些日志中的任何一个，您可以轻松确定根本原因：
- en: '**A disk mounted using SCSI ID in lieu of UUID**'
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**使用SCSI ID而不是UUID挂载的磁盘**'
- en: '[PRE5]'
  id: totrans-100
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '**An unattached device is missing**'
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**未附加的设备丢失**'
- en: '[PRE6]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '**Fstab misconfiguration or the disk is no longer attached**'
  id: totrans-103
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Fstab配置错误或磁盘不再附加**'
- en: '[PRE7]'
  id: totrans-104
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '**A serial log entry shows an incorrect UUID**'
  id: totrans-105
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**串行日志条目显示不正确的UUID**'
- en: '[PRE8]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Other common causes include:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 其他常见原因包括：
- en: System crashes
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 系统崩溃
- en: Hardware or software malfunction
  id: totrans-109
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 硬件或软件故障
- en: Buggy drivers
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 错误的驱动程序
- en: NFS write errors
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: NFS写入错误
- en: The filesystem not being properly shut down
  id: totrans-112
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 文件系统未正确关闭
- en: These other common causes can be sometimes fixed by restarting or often by manually
    fixing the filesystem. For this, you can use either the serial console access
    as described earlier in this chapter, or alternatively attach the broken virtual
    OS disk to another VM as you would do in any on-premises system.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: '这些其他常见原因有时可以通过重新启动来修复，或者经常可以通过手动修复文件系统来修复。为此，您可以使用本章前面描述的串行控制台访问，或者将损坏的虚拟OS磁盘附加到另一个VM，就像在任何本地系统中一样。 '
- en: 'The Azure CLI provides an extension called **vm-repair** that makes it easy
    to create a repair VM and attach the broken VM disk to it. You can find more information
    about this extension from here: [https://docs.microsoft.com/cli/azure/ext/vm-repair/vm/repair](https://docs.microsoft.com/cli/azure/ext/vm-repair/vm/repair).
    Note that this extension requires Azure CLI version 2.0.67 or higher.'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: Azure CLI提供了一个名为**vm-repair**的扩展，可以轻松创建一个修复VM并将损坏的VM磁盘附加到它上。您可以从这里找到有关此扩展的更多信息：[https://docs.microsoft.com/cli/azure/ext/vm-repair/vm/repair](https://docs.microsoft.com/cli/azure/ext/vm-repair/vm/repair)。请注意，此扩展需要Azure
    CLI版本2.0.67或更高版本。
- en: Disk encryption problems
  id: totrans-115
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 磁盘加密问题
- en: 'It is not uncommon to encounter issues with disk encryption on Linux. These
    problems may arise also on Azure. Here are some typical issues you may face if
    you are using a customized VM image:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 在Linux上遇到磁盘加密问题并不罕见。这些问题也可能在Azure上出现。以下是一些您可能会遇到的典型问题，如果您使用自定义的VM映像：
- en: The filesystem or partitioning doesn't match a customized VM image.
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 文件系统或分区与自定义VM映像不匹配。
- en: Some third-party software, such as SAP, MongoDB, Apache Cassandra, and Docker,
    may be unsupported or not work properly if they are installed before encrypting
    the disk. Check the setup instructions carefully before installing!
  id: totrans-118
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 某些第三方软件，如SAP、MongoDB、Apache Cassandra和Docker，如果在加密磁盘之前安装，可能不受支持或无法正常工作。在安装之前，请仔细检查设置说明！
- en: While a disk is in the middle of encryption initialization, some scripts started
    by Azure Resource Manager may not work correctly. Serializing encryption and disk
    encryption will help with these issues.
  id: totrans-119
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在磁盘进行加密初始化的过程中，Azure资源管理器启动的一些脚本可能无法正常工作。对加密和磁盘加密进行串行化将有助于解决这些问题。
- en: SELinux needs to be disabled before starting to encrypt a disk, otherwise the
    filesystem unmount may fail. Remember to enable it again afterward!
  id: totrans-120
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在开始加密磁盘之前，需要禁用SELinux，否则文件系统卸载可能会失败。记得之后再次启用它！
- en: System disks using LVM cannot be encrypted. Always use normal partitions for
    system disks, and LVM only for data disks.
  id: totrans-121
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用LVM的系统磁盘无法加密。始终使用普通分区进行系统磁盘，并且仅对数据磁盘使用LVM。
- en: Disk encryption consumes lots of memory. You should have more than 7 GB RAM
    if you enable encryption.
  id: totrans-122
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 磁盘加密会消耗大量内存。如果启用加密，您应该有超过7GB的RAM。
- en: Note
  id: totrans-123
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 注意
- en: The Linux system disk encryption process tries to unmount the system drive before
    running it through the disk encryption process. If it can't unmount the drive,
    an error message of `failed to unmount after …` is very likely to appear.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: Linux系统磁盘加密过程会尝试在运行磁盘加密过程之前卸载系统驱动器。如果无法卸载驱动器，则很可能会出现“无法在...后卸载”的错误消息。
- en: Resizing disks
  id: totrans-125
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 调整磁盘大小
- en: In case you happen to run out of storage space on your VM's system or data disks,
    Azure allows you to scale the VMs up and down quite easily, but there are some
    tasks in the Linux OS to be done to ensure the VM survives the changes.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您的VM系统或数据磁盘的存储空间不足，Azure允许您轻松地扩展和缩小VM，但是在Linux操作系统中还有一些任务需要完成，以确保VM能够适应这些变化。
- en: Note
  id: totrans-127
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 注意
- en: To test these commands, we recommend you create a new Linux VM on Azure. In
    the following screenshots we used a CentOS 7.9-based VM image.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 为了测试这些命令，我们建议您在Azure上创建一个新的Linux VM。在以下截图中，我们使用了基于CentOS 7.9的VM镜像。
- en: 'First, we need to find out the current VM disk size. The `az` command is a
    very powerful tool to query various aspects of a VM:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们需要找出当前的VM磁盘大小。`az`命令是一个非常强大的工具，可以查询VM的各个方面：
- en: '[PRE9]'
  id: totrans-130
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'This command lists the operating system disk size, unique name, and the VM
    size parameters, as shown in *Figure 6.9*:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 该命令列出了操作系统磁盘大小、唯一名称和VM大小参数，如*图6.9*所示：
- en: '![Output of the az vm show command listing the OS disk size, unique name, and
    the VM size parameters](img/B17160_06_09.jpg)'
  id: totrans-132
  prefs: []
  type: TYPE_IMG
  zh: '![az vm show命令的输出，列出操作系统磁盘大小、唯一名称和VM大小参数](img/B17160_06_09.jpg)'
- en: 'Figure 6.9: Output of the az vm show command'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.9：az vm show命令的输出
- en: If you get an error, it is quite possible that the VM is not running. Start
    it and try again.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 如果出现错误，很可能是VM未运行。启动它并重试。
- en: In our example the disk size was 30 GB and the VM is of the `Standard_A1` type.
    The disk name is `vm3_OsDisk_1_b728efd7b94e41d6beefe4a1e8a35f15`.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的示例中，磁盘大小为30GB，VM类型为`Standard_A1`。磁盘名称为`vm3_OsDisk_1_b728efd7b94e41d6beefe4a1e8a35f15`。
- en: To modify the disk the VM needs to be deallocated—just stopping it is not enough.
    After the VM has been deallocated we can proceed to increasing the system disk
    size.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 要修改磁盘，需要将VM取消分配-仅仅停止不足够。在VM取消分配后，我们可以继续增加系统磁盘大小。
- en: Note
  id: totrans-137
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 注意
- en: Currently, you cannot shrink disks in Azure. When increasing disk size, only
    add the space you will need.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 目前，您无法在Azure中缩小磁盘。增加磁盘大小时，只需添加所需的空间。
- en: 'To set the new size to 50 GB, do the following:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 要将新大小设置为50GB，请执行以下操作：
- en: '[PRE10]'
  id: totrans-140
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'This should output the new parameters for the disk after successful modification,
    as shown in *Figure 6.10*:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 这应该在成功修改后输出磁盘的新参数，如*图6.10*所示：
- en: '![The new parameters for the disk after successful modification](img/B17160_06_10.jpg)'
  id: totrans-142
  prefs: []
  type: TYPE_IMG
  zh: '![成功修改后磁盘的新参数](img/B17160_06_10.jpg)'
- en: 'Figure 6.10: Successful disk resize'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.10：磁盘调整大小成功
- en: 'If you would like to verify that the change was implemented, you can show the
    actual disk size as follows, even when the VM is not running:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您想要验证更改是否已实施，可以按以下方式显示实际磁盘大小，即使VM未运行：
- en: '[PRE11]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: This will print out the size in gigabytes and should show `50` in this case.
    Now we have successfully resized the disk on the storage system side, but at this
    point Linux thinks the disk size is `30` gigabytes.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 这将以千兆字节为单位打印出大小，并且在这种情况下应该显示`50`。现在我们已成功调整了存储系统端的磁盘大小，但此时Linux认为磁盘大小为`30`千兆字节。
- en: Next, you will need to start the VM and log in to Linux with SSH. Now, in the
    Linux terminal, you can proceed to check whether you need to manually increase
    the volume size and filesystem size as you would do on any other Linux server.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，您需要启动VM并使用SSH登录Linux。现在，在Linux终端中，您可以继续检查是否需要手动增加卷大小和文件系统大小，就像在任何其他Linux服务器上一样。
- en: Since there are numerous different ways to do these tasks, we will not be addressing
    them all. Azure doesn't set any limitations on how you manage the disks from within
    the Linux operating system.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 由于有许多不同的方法来执行这些任务，我们将不会涵盖所有方法。Azure不会对您在Linux操作系统中管理磁盘的方式设置任何限制。
- en: In our test system, CentOS 7.9, it seems that the virtual disk size change on
    the `sda2` device was automatically recognized by the operating system at boot
    time, as you can see in *Figure 6.11*.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的测试系统CentOS 7.9中，似乎在引导时操作系统会自动识别`sda2`设备上的虚拟磁盘大小更改，如*图6.11*所示。
- en: 'You can run the `lsblk` command to see the block device sizes on your VM:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以运行`lsblk`命令来查看VM上的块设备大小：
- en: '![The list of the block device sizes on the virtual machine](img/B17160_06_11.jpg)'
  id: totrans-151
  prefs: []
  type: TYPE_IMG
  zh: '![虚拟机上块设备大小的列表](img/B17160_06_11.jpg)'
- en: 'Figure 6.11: Block devices list'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.11：块设备列表
- en: 'To see if the filesystem has also noticed the increase in the block device
    size, you can run the `df -hT` command. Our system demonstrated that the XFS filesystem
    on the `sda2` disk was automatically resized:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看文件系统是否也注意到了块设备大小的增加，您可以运行`df -hT`命令。我们的系统表明`sda2`磁盘上的XFS文件系统已自动调整大小：
- en: '![The list of filesystems](img/B17160_06_12.jpg)'
  id: totrans-154
  prefs: []
  type: TYPE_IMG
  zh: '![文件系统列表](img/B17160_06_12.jpg)'
- en: 'Figure 6.12: List of filesystems'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.12：文件系统列表
- en: For many years, Linux administrators had to manually resize block devices and
    filesystems after the physical or virtual storage size was changed. Nowadays,
    some Linux distributions can resize the system disk automatically for you at boot
    time or even at runtime. Data disks still require you to manually grow the partition
    or volume size and to grow the filesystem size as well.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 多年来，Linux管理员必须在物理或虚拟存储大小更改后手动调整块设备和文件系统的大小。如今，一些Linux发行版可以在引导时或甚至在运行时自动为您调整系统磁盘的大小。数据磁盘仍然需要您手动扩展分区或卷大小，以及扩展文件系统大小。
- en: For data disks, the process is very similar. The biggest difference is that
    you can do it while the VM is running. To do this you practically need to unmount
    the disk and detach it from the VM before you modify the virtual disk size. Consider
    taking backups before modifying partitions, volumes, or filesystems manually—there
    is a risk of data loss if you make even a small error in the process.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 对于数据磁盘，该过程非常类似。最大的区别是您可以在VM运行时执行。要做到这一点，您实际上需要卸载磁盘并在修改虚拟磁盘大小之前将其从VM中分离。在手动修改分区、卷或文件系统之前，请考虑备份——如果在过程中出现即使是小错误，可能会导致数据丢失。
- en: Performance issues and analysis
  id: totrans-158
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 性能问题和分析
- en: Performance counters in Linux are useful for providing insights into the performance
    of hardware components, operating systems, and applications. With Azure Monitor,
    you can collect performance counters from Log Analytics agents at frequent intervals
    for **Near Real-Time** (**NRT**) analysis. You also get aggregated performance
    data for longer-term analysis and reporting.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: Linux中的性能计数器对于提供有关硬件组件、操作系统和应用程序性能的见解非常有用。使用Azure Monitor，您可以从Log Analytics代理定期收集性能计数器，进行**准实时**（**NRT**）分析。您还可以获得聚合的性能数据，用于长期分析和报告。
- en: To set up performance counters, you can use the Azure Log Analytics workspace
    user interface or the command line.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 要设置性能计数器，您可以使用Azure Log Analytics工作区用户界面或命令行。
- en: 'As there are massive numbers of metrics we could collect from a Linux VM, we
    are not going into detail at this point. However, it is worth mentioning that
    the typical data sources are:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们可以从Linux VM收集大量指标，所以我们在这一点上不会详细介绍。然而，值得一提的是典型的数据来源是：
- en: '`Syslog`'
  id: totrans-162
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Syslog`'
- en: '`CollectD`'
  id: totrans-163
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`CollectD`'
- en: Performance counters
  id: totrans-164
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 性能计数器
- en: Custom logs
  id: totrans-165
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 自定义日志
- en: 'You can find details about data collections supported by the Log Analytics
    agent here: [https://docs.microsoft.com/azure/azure-monitor/agents/agent-data-sources](https://docs.microsoft.com/azure/azure-monitor/agents/agent-data-sources).'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在这里找到Log Analytics代理支持的数据收集的详细信息：[https://docs.microsoft.com/azure/azure-monitor/agents/agent-data-sources](https://docs.microsoft.com/azure/azure-monitor/agents/agent-data-sources)。
- en: This documentation will give you a good set of tools you can use to analyze
    the performance of your VM.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 本文档将为您提供一组很好的工具，可用于分析VM的性能。
- en: In on-premises environments, it is a common practice to use tools such as `dd`
    to see how the storage is performing. In Azure however you should not rely on
    the results of this command. Instead, you should use a tool called **fio**, available
    from most Linux distribution repositories. It gives reliable results when analyzing
    the actual disk performance, measured as **input/output operations per second**
    (**IOPS**).
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 在本地环境中，使用`dd`等工具来查看存储性能是一种常见做法。然而，在Azure中，您不应依赖于此命令的结果。相反，您应该使用一个名为**fio**的工具，它可以从大多数Linux发行版的存储库中获得。在分析实际磁盘性能时，它提供可靠的结果，以**每秒输入/输出操作**（**IOPS**）来衡量。
- en: 'To use fio, you will first need to create a new file called `fiowrite.ini`
    with the following content:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用fio，您首先需要创建一个名为`fiowrite.ini`的新文件，其中包含以下内容：
- en: '[PRE12]'
  id: totrans-170
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: The last parameter tells us which directory or mount point we want to use for
    testing. In this case, we are using the system disk, which is mounted on the root
    directory.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 最后一个参数告诉我们我们想要用于测试的目录或挂载点。在这种情况下，我们使用的是系统磁盘，它挂载在根目录上。
- en: 'To start the test, run the following command, which starts a test that runs
    for 30 seconds:'
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始测试，请运行以下命令，该命令启动一个持续30秒的测试：
- en: '[PRE13]'
  id: totrans-173
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'You should get an output like the one in *Figure 6.13*:'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 您应该得到类似*图6.13*中的输出：
- en: '![Testing the disk performance output by executing sudo fio --runtime 30 fiowrite.ini
    command on Azure CLI](img/B17160_06_13.jpg)'
  id: totrans-175
  prefs: []
  type: TYPE_IMG
  zh: '![通过在Azure CLI上执行sudo fio --runtime 30 fiowrite.ini命令来测试磁盘性能输出](img/B17160_06_13.jpg)'
- en: 'Figure 6.13: Disk performance output'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.13：磁盘性能输出
- en: We have highlighted the IOPS line in yellow. In this case, the average IOPS
    number was 741.21\. We used a standard SSD disk and the `Standard A1` VM type
    with 1 vCPU and 1.72 GiB memory. The system disk was 30 GB with the nominal maximum
    IOPS being 500.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经用黄色突出显示了IOPS行。在这种情况下，平均IOPS数字为741.21。我们使用了标准SSD磁盘和带有1个vCPU和1.72 GiB内存的`Standard
    A1` VM类型。系统磁盘为30 GB，名义最大IOPS为500。
- en: The storage encryption on this server used server-side encryption with a platform-managed
    key.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 该服务器上的存储加密使用平台管理密钥的服务器端加密。
- en: 'There are various guides available for optimizing the storage performance for
    Linux on Azure users. One very good (although slightly old) guide is this blog
    post: [https://docs.microsoft.com/archive/blogs/igorpag/azure-storage-secrets-and-linux-io-optimizations](https://docs.microsoft.com/archive/blogs/igorpag/azure-storage-secrets-and-linux-io-optimizations).'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 对于Azure用户优化Linux存储性能，有各种指南可用。一个非常好的（尽管有点老旧）指南是这篇博客文章：[https://docs.microsoft.com/archive/blogs/igorpag/azure-storage-secrets-and-linux-io-optimizations](https://docs.microsoft.com/archive/blogs/igorpag/azure-storage-secrets-and-linux-io-optimizations)。
- en: The blog post covers many details about performance tuning and is worth reading
    even if you don't have performance problems currently. It is always worth optimizing
    performance.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 该博客文章涵盖了许多关于性能调优的细节，即使您目前没有性能问题，也值得一读。优化性能总是值得的。
- en: Next, let's take a look at what tools Azure provides to analyze and debug VM
    problems.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，让我们看看Azure提供了哪些工具来分析和调试VM问题。
- en: Azure diagnostics tooling – a summary
  id: totrans-182
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Azure诊断工具-摘要
- en: 'In the Azure portal, on the VM''s Diagnose and solve problems screen, you can
    find all the official guides and tools to learn more about troubleshooting various
    VM-related problems. *Figure 6.14* shows a partial list of common scenarios documented:'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 在Azure门户中，在VM的诊断和解决问题屏幕上，您可以找到所有官方指南和工具，以了解更多有关解决各种VM相关问题的信息。*图6.14*显示了部分常见场景的列表：
- en: '![A partial list of common scenarios documented in the Diagnose and solve problems
    window](img/B17160_06_14.jpg)'
  id: totrans-184
  prefs: []
  type: TYPE_IMG
  zh: '![在诊断和解决问题窗口中记录的常见场景的部分列表](img/B17160_06_14.jpg)'
- en: 'Figure 6.14: Common scenarios list'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.14：常见场景列表
- en: These guides should give you decent tools to analyze and fix most of the problematic
    situations you might encounter after you have migrated a Linux VM into Azure.
    These are also applicable for all VMs created directly on Azure.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 这些指南应该为您提供足够的工具来分析和解决您在将Linux VM迁移到Azure后可能遇到的大多数问题情况。这些也适用于直接在Azure上创建的所有VM。
- en: Let's not forget there are also various ways to ask for help from Microsoft
    if you have problems with Azure.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们不要忘记，如果您在Azure上遇到问题，还有各种向Microsoft寻求帮助的方式。
- en: Opening support requests
  id: totrans-188
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 打开支持请求
- en: Just like any other issue with Azure, you can open support requests for Linux
    on Azure as well. It only makes sense up to a certain point to try to analyze
    or fix the problem yourself. The best part is both Red Hat and SUSE offer integrated
    co-located support. This benefits customers as they don't have to open multiple
    cases—opening a single case with support would suffice. In fact, the Red Hat and
    SUSE Support Engineers sit in the same office as the Microsoft Support Team, which
    ensures faster resolution.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 与Azure的任何其他问题一样，您也可以为Azure上的Linux打开支持请求。尝试自行分析或解决问题只有到一定程度才有意义。最好的部分是Red Hat和SUSE都提供集成的共同支持。这使客户受益，因为他们不必打开多个案例
    - 只需打开一个支持案例即可。事实上，Red Hat和SUSE的支持工程师坐在与Microsoft支持团队相同的办公室，这确保了更快的解决方案。
- en: The New support request feature (shown in *Figure 6.15*) on the Azure portal
    is easy to use and can guide you through opening the request with all the relevant
    information. This helps the support staff to get a clear picture of the problem
    from the beginning.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: Azure门户上的新支持请求功能（如*图6.15*所示）易于使用，并且可以指导您通过提供所有相关信息来打开请求。这有助于支持人员从一开始就清楚地了解问题。
- en: 'You can find the request tool in the left-hand menu for the VM that you are
    having an issue with, shown as follows:'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在左侧菜单中找到请求工具，用于您遇到问题的VM，如下所示：
- en: '![Adding various details in the Basics tab of the New support request window](img/B17160_06_15.jpg)'
  id: totrans-192
  prefs: []
  type: TYPE_IMG
  zh: '![在新支持请求窗口的基本选项卡中添加各种详细信息](img/B17160_06_15.jpg)'
- en: 'Figure 6.15: New support request'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.15：新支持请求
- en: In this example, our problem is described as I can not SSH to this VM, and the
    New support request tool was able to suggest a couple of possible problem types.
    We selected Cannot connect to my VM for the Problem type option, and My configuration
    change impacted connectivity for the Problem subtype option.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 在本例中，我们的问题描述为无法SSH到此VM，并且新的支持请求工具能够建议一些可能的问题类型。我们选择了“无法连接到我的VM”作为问题类型选项，以及“我的配置更改影响了连接性”作为问题子类型选项。
- en: 'In the Solutions tab, we will find a possible solution to the problem:'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 在解决方案选项卡中，我们将找到问题的可能解决方案：
- en: '![The list of possible solutions in the Solutions tab](img/B17160_06_16.jpg)'
  id: totrans-196
  prefs: []
  type: TYPE_IMG
  zh: '![在解决方案选项卡中列出的可能解决方案](img/B17160_06_16.jpg)'
- en: 'Figure 6.16: List of possible solutions'
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.16：可能解决方案列表
- en: In many cases, these automatic suggestions can guide you through fixing the
    issue. As you can see in this example, it appears the VM is not running—probably
    because the Azure Linux Agent is not reachable. The system recommends you use
    the previously mentioned serial console method to connect to the server.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 在许多情况下，这些自动建议可以指导您解决问题。正如您在本例中所看到的，似乎VM没有运行 - 可能是因为Azure Linux代理无法访问。系统建议您使用先前提到的串行控制台方法连接到服务器。
- en: Sometimes you may need assistance from Microsoft Technical Support, or you may
    have found an actual bug in Azure or one of the supported Linux distributions.
    In that case, you will be presented with the option to open a support ticket or
    ask for help from the Azure Community.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 有时您可能需要来自Microsoft技术支持的帮助，或者您可能已经发现了Azure或受支持的Linux发行版中的实际错误。在这种情况下，您将有选择打开支持票或从Azure社区寻求帮助的选项。
- en: 'The availability of Microsoft Technical Support depends on your contract with
    Microsoft:'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: Microsoft技术支持的可用性取决于您与Microsoft的合同：
- en: '![Viewing plans and support options](img/B17160_06_17.jpg)'
  id: totrans-201
  prefs: []
  type: TYPE_IMG
  zh: '![查看计划和支持选项](img/B17160_06_17.jpg)'
- en: 'Figure 6.17: Support options'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.17：支持选项
- en: 'In our example, we used a subscription that does not include technical support.
    By clicking View plans (shown in *Figure 6.17*), we can see the various technical
    support plans:'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的示例中，我们使用的订阅不包括技术支持。通过单击“查看计划”（如*图6.17*所示），我们可以看到各种技术支持计划：
- en: '![In the Azure tab, you can see various Microsoft Technical Support plans](img/B17160_06_18.jpg)'
  id: totrans-204
  prefs: []
  type: TYPE_IMG
  zh: '![在Azure选项卡中，您可以看到各种Microsoft技术支持计划](img/B17160_06_18.jpg)'
- en: 'Figure 6.18: Microsoft Technical Support plans'
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.18：Microsoft技术支持计划
- en: Which plan is best for you depends on many factors. A Microsoft sales representative
    can provide you with further guidance if you are unsure about choosing a plan.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 哪种计划最适合您取决于许多因素。如果您对选择计划感到不确定，Microsoft的销售代表可以为您提供进一步的指导。
- en: 'Additionally, there is support available from Linux vendors via Azure Marketplace.
    As shown in *Figure 6.19*, by clicking on the Marketplace tab, you can see all
    available Linux support plans that are valid for this specific VM:'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，还可以通过Azure Marketplace获得来自Linux供应商的支持。如*图6.19*所示，通过单击市场选项卡，您可以看到适用于此特定VM的所有可用Linux支持计划：
- en: '![In the Marketplace tab, you can see all available Linux support plans that
    are valid for this specific VM](img/B17160_06_19.jpg)'
  id: totrans-208
  prefs: []
  type: TYPE_IMG
  zh: '![在市场选项卡中，您可以看到适用于此特定VM的所有可用Linux支持计划](img/B17160_06_19.jpg)'
- en: 'Figure 6.19: Marketplace support plans'
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.19：市场支持计划
- en: In this example, the Linux distribution installed on this VM was Ubuntu. Canonical,
    the company publishing Ubuntu, offers a support plan called **Ubuntu Advantage
    Infrastructure Support**, as shown in *Figure 6.19*. As you can see in this case,
    we have not purchased the plan.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 在本例中，安装在此VM上的Linux发行版是Ubuntu。发布Ubuntu的公司Canonical提供了一个名为**Ubuntu Advantage Infrastructure
    Support**的支持计划，如*图6.19*所示。正如您在本例中所看到的，我们并没有购买该计划。
- en: All commercial Linux vendors have their own support packages available for purchase
    or offered already bundled in the enterprise subscription.
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 所有商业Linux供应商都有自己的支持包可供购买，或者已经捆绑在企业订阅中提供。
- en: Summary
  id: totrans-212
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 总结
- en: Having completed this chapter, you should be able to debug and fix some of the
    most common issues with Linux on Azure. In this chapter, we talked about remote
    connectivity issues and how to solve these problems if your VM does not let you
    log in. We also discussed the typical boot problems and discovered the Azure tools
    that can help in resolving these situations. SELinux- and storage-related issues
    are quite common runtime problems, which were also covered in this chapter. We
    also addressed Linux on Azure performance analysis. Finally, we explained how
    to find support for Linux on Azure from Microsoft Technical Support and Azure
    Marketplace partners.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 完成本章后，您应该能够调试和解决Linux在Azure上的一些最常见问题。在本章中，我们讨论了远程连接问题以及如何解决这些问题，如果您的虚拟机不让您登录。我们还讨论了典型的启动问题，并发现了可以帮助解决这些情况的Azure工具。与SELinux和存储相关的问题是相当常见的运行时问题，在本章中也有涵盖。我们还讨论了Linux在Azure的性能分析。最后，我们解释了如何从微软技术支持和Azure市场合作伙伴处找到Linux在Azure的支持。
- en: This book took a holistic approach to migrating Linux workloads from on-premises
    infrastructure to Azure. Starting from the planning, assessment, service dependency
    building, replication, and testing migration, to a complete cutover from on-premises
    to Azure, the hands-on labs we developed for you should have provided a quick
    start to your first real migration project. We have shared some of the best practices
    and vital points that need to be incorporated while migrating Linux workloads
    to Azure. Consider these recommendations and adopt them in your migration projects.
    It will accelerate them and contribute to the success of the migration, along
    with saving a lot of time.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 这本书采用了一种全面的方法，将Linux工作负载从本地基础架构迁移到Azure。从规划、评估、服务依赖构建、复制和测试迁移，到从本地到Azure的完全切换，我们为您开发的实践实验室应该为您的第一个真正的迁移项目提供了一个快速启动。我们分享了一些迁移Linux工作负载到Azure时需要纳入的最佳实践和重要要点。考虑这些建议，并在您的迁移项目中采纳它们。这将加速项目并有助于迁移的成功，同时节省大量时间。
- en: At this point, we would like to congratulate you on learning many new useful
    skills. We have spent quite a long period of our lives working with Azure, Linux,
    and many other open-source technologies, many of which have been discussed on
    the pages of this book. We hope you have enjoyed reading the book as much as we
    enjoyed writing it. Certain things you cannot learn by reading books or documentation
    or even by following official training courses. Those things can be only learned
    by trying and doing things yourself.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一点上，我们想要祝贺你学到了许多新的有用技能。我们花了很长一段时间与Azure、Linux和许多其他开源技术一起工作，其中许多已经在本书的页面上讨论过。我们希望你享受阅读这本书的过程，就像我们写作时一样。有些东西你无法通过阅读书籍或文档，甚至通过跟随官方培训课程来学习。这些东西只能通过尝试和亲自做事情来学习。
- en: 'For further reading we recommend reading about the Microsoft **Cloud Adoption
    Framework** (**CAF**) for Azure: [https://docs.microsoft.com/azure/cloud-adoption-framework/](https://docs.microsoft.com/azure/cloud-adoption-framework/).
    It is a collection of best practices, tools, documentation, and other useful proven
    guidance from Microsoft designed to accelerate your cloud adoption journey.'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 我们建议进一步阅读关于微软**Azure的云采用框架**（**CAF**）：[https://docs.microsoft.com/azure/cloud-adoption-framework/](https://docs.microsoft.com/azure/cloud-adoption-framework/)。这是微软设计的一套最佳实践、工具、文档和其他有用的指导，旨在加速您的云采用之旅。
- en: Now it is your turn to do good—teach others about what you have learned. Take
    the information from this book, be successful in your Linux to Azure migration
    projects, and do not forget to share your knowledge with others!
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 现在轮到你做好事了——教别人你所学到的东西。从这本书中获取信息，在你的Linux到Azure迁移项目中取得成功，并不要忘记与他人分享你的知识！
- en: New horizons for Linux in Azure
  id: totrans-218
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Linux在Azure中的新视野
- en: In this book, we started with the tagline "Microsoft ♡ Linux", announced by
    Microsoft CEO Satya Nadella. That was indeed a milestone in Microsoft's history.
    In the earlier days, Microsoft Azure was known as Windows Azure, which created
    the impression that Azure was meant for Windows workloads and was not optimized
    for running Linux workloads. Under Satya Nadella's leadership, Microsoft started
    to embrace Linux and contribute to other open-source projects, and in 2016, they
    joined the Linux Foundation.
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 在这本书中，我们从微软CEO Satya Nadella宣布的标语“Microsoft ♡ Linux”开始。这确实是微软历史上的一个里程碑。在早期，微软Azure被称为Windows
    Azure，这给人留下了Azure是为Windows工作负载而不是为运行Linux工作负载而优化的印象。在Satya Nadella的领导下，微软开始拥抱Linux并为其他开源项目做出贡献，2016年，他们加入了Linux基金会。
- en: The change was not only about Linux. Microsoft also released the Edge browser,
    Visual Studio Code, and Microsoft Teams for Linux, actions that indicated their
    readiness to welcome and fully embrace Linux. In 2018, Microsoft developed their
    own Linux flavor called **Azure Sphere**, which is used in IoT devices. With the
    recent update of Windows 10, Microsoft shipped a full Linux kernel, which opened
    the doors for developers who are working on Linux development as well as cross-platform.
    Very soon, the usage of Linux increased and outshone Windows usage in Microsoft
    Azure. The anti-Microsoft ideology that was present among Linux users is long
    gone. Looking at all the progress, it is obvious that Microsoft truly loves Linux.
    All of Microsoft's open-source contributions to the community can be found at
    [https://opensource.microsoft.com/](https://opensource.microsoft.com/).
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 这一变化不仅仅是关于Linux。微软还发布了Edge浏览器、Visual Studio Code和Microsoft Teams for Linux，这些行动表明他们愿意欢迎并完全拥抱Linux。2018年，微软开发了他们自己的Linux版本**Azure
    Sphere**，用于物联网设备。随着Windows 10的最新更新，微软发布了一个完整的Linux内核，为在Linux开发以及跨平台工作的开发人员打开了大门。很快，Linux的使用量增加，并在微软Azure中超过了Windows的使用量。在Linux用户中存在的反微软意识早已消失。从所有的进展来看，很明显微软真的热爱Linux。微软对社区的所有开源贡献都可以在[https://opensource.microsoft.com/](https://opensource.microsoft.com/)找到。
- en: Many organizations now use Linux for running a variety of workloads, varying
    from workstations to SAP clusters, and the features and support offered by Linux
    on Azure welcomed them to the benefits of the cloud. Administrators can administer
    their Linux workloads as they normally manage on-premises Linux computers. Azure
    now provides tools like Azure Migrate, Azure Site Recovery, and Azure Database
    Migration Service, which accelerate the migration of workloads to Azure.
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 许多组织现在使用Linux来运行各种工作负载，从工作站到SAP集群各种不同，Linux在Azure上提供的功能和支持使他们受益于云计算。管理员可以像管理自有Linux计算机一样管理他们的Linux工作负载。Azure现在提供了诸如Azure
    Migrate、Azure Site Recovery和Azure Database Migration Service之类的工具，加速了工作负载向Azure的迁移。
- en: Organizations that initially believed that cloud computing is expensive have
    now started to explore the benefits, savings, and features of the Azure cloud.
    Since these organizations have license subscriptions from popular vendors like
    RedHat and SUSE, it is easy for them to reuse the same license subscription in
    Azure as well, without the need to spend extra for licensing in the cloud. Apart
    from the cost perspective, scaling and high availability are far better than what
    organizations could achieve in their on-premises infrastructure. Also, it's worth
    mentioning the security and governance features that Azure provides for running
    Linux workloads. If you have workloads that are hosted on-premises, outside Azure,
    due to compliance reasons, then Azure Arc-enabled servers provide you with the
    ability to manage them natively from the Azure portal.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 最初认为云计算昂贵的组织现在已经开始探索Azure云的好处、节省和功能。由于这些组织拥有来自RedHat和SUSE等知名供应商的许可订阅，因此他们可以在Azure中重复使用相同的许可订阅，而无需额外花费用于云端许可。除了成本方面，扩展和高可用性要比组织在自己的基础设施上能够实现的要好得多。此外，值得一提的是Azure为运行Linux工作负载提供的安全性和治理功能。如果您由于合规原因而将工作负载托管在Azure之外的自有基础设施上，那么Azure
    Arc启用的服务器将使您能够在Azure门户中本地管理这些工作负载。
- en: As we speak, Microsoft is developing new Azure features, pushing updates to
    preview, and promoting updates to general availability. If you look at the Azure
    Updates page ([https://azure.microsoft.com/updates/?query=Linux](https://azure.microsoft.com/updates/?query=Linux)),
    you will be able to see all the new Linux-related updates coming to Azure. The
    updates are in chronological order, and looking at the number of updates coming
    in, you will realize the dominance of Linux on Microsoft Azure. It is 2021 and
    today, even if it may sound a little absurd to some people, the fact is that Microsoft
    is really an open-source organization.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 就在我们说话的时候，微软正在开发新的Azure功能，推送更新到预览版，并将更新推广到普遍可用性。如果您查看Azure更新页面（[https://azure.microsoft.com/updates/?query=Linux](https://azure.microsoft.com/updates/?query=Linux)），您将能够看到所有即将推出的与Linux相关的新更新。更新按时间顺序排列，看到即将推出的更新数量，您将意识到Linux在Microsoft
    Azure上的主导地位。现在是2021年，即使对一些人来说可能听起来有点荒谬，事实是微软确实是一个开源组织。
