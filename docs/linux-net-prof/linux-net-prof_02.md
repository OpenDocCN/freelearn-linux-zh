# 第一章：*第一章*：欢迎来到 Linux 大家庭

本书探讨了 Linux 平台和各种基于 Linux 的操作系统-特别是 Linux 如何在网络服务方面发挥作用。我们将首先讨论操作系统的一些历史，然后再看其基本配置和故障排除。从那里开始，我们将通过在 Linux 上构建各种网络相关服务来工作，这些服务在大多数组织中可能经常看到。随着我们的进展，我们将在真实的主机上构建真实的服务，并着重于在进行每项服务时保护和故障排除。到我们完成时，您应该对这些服务中的每一个都足够熟悉，以便在您自己的组织中开始实施其中一些或全部服务。正如他们所说，“每个旅程都始于一步”，所以让我们迈出这一步，从对 Linux 平台的一般讨论开始。

在本章中，我们将通过探索 Linux 作为一系列操作系统来开始我们的旅程。它们都有关联，但每个都有自己独特的方式，具有不同的优势和特点。

我们将涵盖以下主题：

+   为什么 Linux 非常适合网络团队

+   主流数据中心 Linux

+   特殊的 Linux 发行版

+   虚拟化

+   为您的组织选择 Linux 发行版

# 为什么 Linux 非常适合网络团队

在本书中，我们将探讨如何使用 Linux 和基于 Linux 的工具来支持和故障排除您的网络，以及如何在 Linux 平台上安全部署常见的网络基础设施。

为什么要为这些目的使用 Linux？首先，Linux 的架构、历史和文化*引导*管理员进行脚本编写和自动化流程。虽然将这种情况推向极端可能会让人陷入有趣的境地，但编写例行任务的脚本可以真正节省时间。

事实上，编写非例行任务的脚本，比如每年需要做一次的事情，也可能是救命的-这意味着管理员不需要重新学习如何做 12 个月前做的那件事。

编写例行任务的脚本是一个更大的胜利。多年来，Windows 管理员已经了解到，在**图形用户界面**（**GUI**）中执行一项任务数百次会导致我们至少出错几次。另一方面，像这样编写脚本任务可以保证一致的结果。不仅如此，在网络上，管理员通常为数百或数千个站点执行操作，编写脚本通常是完成更大规模任务的唯一方法。

网络管理员更喜欢 Linux 平台的另一个原因是，Linux（以及之前的 Unix）自有网络以来就一直存在。在服务器端，Linux（或 Unix）服务是定义这些服务的东西，而匹配的 Windows 服务则是随着时间的推移基本上增长到特性平衡。

在工作站方面，如果您需要一个工具来管理或诊断网络上的某些东西，它可能已经安装好了。如果您寻找的工具尚未安装，只需一行命令即可安装和运行它，以及所需的任何其他工具、库或依赖项。而且添加该工具不需要许可费-在 Linux 上安装的 Linux 和任何工具（几乎没有例外）都是免费和开源的。

最后，在服务器和桌面方面，历史上，Linux 一直是免费的。即使现在，有利润的公司也为一些主要支持的发行版收取许可费（例如 Red Hat 和 SUSE），这些公司也提供这些发行版的免费版本。Red Hat 提供 Fedora Linux 和 CentOS，这两者都是免费的，并且在某种程度上充当了 Red Hat Enterprise Linux 中新功能的测试版本。openSUSE（免费）和 SUSE Linux（收费）也非常相似，SUSE 发行版经过了更严格的测试，并且版本升级的节奏更加规律。企业版本通常是按期限许可的，该许可证授予客户访问技术支持和在许多情况下的操作系统更新的权限。

许多公司选择操作系统的经过许可的企业版本，但许多其他公司选择在 OpenSUSE、CentOS 或 Ubuntu 的免费版本上构建其基础设施。免费 Linux 版本的可用性意味着许多组织可以以大大降低的 IT 成本运作，这在很大程度上影响了我们作为一个行业的发展方向。

## 为什么 Linux 很重要？

多年来，信息技术界的一个笑话是，明年总是会成为“Linux 桌面的一年”-在那一年，我们将停止为桌面和商业应用程序支付许可费，一切都将是免费和开源的。

相反，发生的是 Linux 一直在稳步地进入许多环境的服务器和基础设施方面。

Linux 已经成为大多数数据中心的支柱，即使这些组织认为它们是“仅限 Windows”的环境。许多基础设施组件在内部运行 Linux，并具有一个良好的 Web 前端，将其转变为供应商解决方案。如果您有存储区域网络（SAN），它很可能运行 Linux，您的负载均衡器，接入点和无线控制器也是如此。许多路由器和交换机运行 Linux，几乎所有新的软件定义的网络解决方案也是如此。

几乎所有信息安全产品都基于 Linux。传统防火墙和下一代防火墙，入侵检测和防范系统（IDS/IPS），安全信息和事件管理（SIEM）系统以及日志服务器-都是 Linux！

为什么 Linux 如此普遍？有很多原因：

+   这是一个成熟的操作系统。

+   它有一个集成的修补和更新系统。

+   基本功能很容易配置。操作系统上的更复杂功能可能比 Windows 上更难配置。请查看我们关于 DNS 或 DHCP 的章节以获取更多信息。

+   另一方面，在 Windows 环境中可能是出售产品的许多功能在 Linux 上是免费安装的。

+   由于 Linux 几乎完全基于文件，如果您是一个以 Linux 为基础的产品的供应商，很容易将其保持在已知基线。

+   只要有合适的（免费和开源）软件包、一些脚本和可能一些定制编码，您就可以在 Linux 上构建几乎任何东西。

+   如果选择正确的发行版，操作系统本身是免费的，这对于试图最大化利润的供应商或试图降低成本的客户来说是一个很好的动力。

如果新的基础设施即代码运动是吸引您的原因，那么您会发现几乎每种编程语言都在 Linux 中得到了代表，并且正在积极开发-从新语言如 Go 和 Rust，一直到 Fortran 和 Cobol。甚至源自 Windows 的 PowerShell 和.NET 也完全支持 Linux。大多数基础设施编排引擎（例如 Ansible、Puppet 和 Terraform）首先在 Linux 上开始并得到支持。

在今天的 IT 基础设施的云端，Linux 是免费的事实使得云服务提供商几乎从一开始就推动他们的客户朝着这一端发展。如果您订阅了任何被描述为“无服务器”或“作为服务”的云服务，背后很可能几乎全部是 Linux 的解决方案。

最后，现在我们已经看到 IT 的服务器和基础设施一面向 Linux 发展，我们应该注意到今天的手机正逐渐成为当今计算现实中最大的“桌面”平台。在今天的世界中，手机通常是基于 iOS 或 Android 的，这两者都是（你猜对了）基于 Unix/Linux 的！因此，“Linux 桌面年”已经通过改变桌面的定义悄悄地到来。

所有这些都使 Linux 对今天的网络或 IT 专业人员非常重要。本书侧重于将 Linux 用作网络专业人员的桌面工具箱，以及在 Linux 平台上安全配置和提供各种网络服务。

## Linux 的历史

要了解 Linux 的起源，我们必须讨论 Unix 的起源。Unix 是在 20 世纪 60 年代末和 70 年代初在贝尔实验室开发的。丹尼斯·里奇和肯·汤普森是 Unix 的主要开发人员。实际上，Unix 这个名字是基于早期操作系统 Multics 的一个双关语，它启发了 Unix 的许多特性。

1983 年，理查德·斯托曼和自由软件基金会启动了 GNU（递归缩写-GNU 的不是 Unix）项目，旨在创建一个类 Unix 的操作系统，供所有人免费使用。在这一努力中产生了 GNU Hurd 内核，大多数人认为这是今天 Linux 版本的前身（SFS 希望我们称它们为 GNU/Linux）。

1992 年，Linus Torvalds 发布了 Linux，这是第一个完全实现的 GNU 内核。重要的是要注意，主流 Linux 通常被认为是可以用来创建操作系统的内核，而不是独立的操作系统。Linux 仍然由 Linus Torvalds 担任首席开发人员，但今天，有一个更大的个人和公司团队作为贡献者。因此，尽管从技术上讲，Linux 只指内核，在行业中，“Linux”通常指的是基于该内核构建的任何操作系统。

自 20 世纪 70 年代以来，已经发布了数百种不同的 Linux 版本。每个版本通常被称为发行版（或简称为 distro）。它们都基于当天的 Linux 内核，以及用于 OS 和更新的安装基础设施和存储库系统。大多数都有某种独特之处，无论是在基本软件包的混合还是发行版的重点-有些可能体积小，适合较小的硬件平台，有些可能专注于安全性，有些可能被设计为通用企业工作马操作系统，等等。

一些发行版在一段时间内一直是“主流”，而一些随着时间的推移而逐渐失去了流行。它们共享的是 Linux 内核，它们每个都建立在此基础上，以创建自己的发行版。许多发行版都是基于另一个发行版的操作系统，对其进行了足够的定制，以证明他们的实施是一个新的发行版。这一趋势使我们产生了“Linux 家族树”的概念-数十个发行版可以从一个共同的“根”发展出来。这在 DistroWatch 网站上得到了探讨。

作为 Linux 的替代品，特别是在 Intel/AMD/ARM 硬件领域，是伯克利软件发行版（BSD）Unix。BSD Unix 是原始贝尔实验室 Unix 的后代；它根本不是基于 Linux。然而，BSD 及其许多衍生版本仍然是免费的，并且与 Linux 共享许多特征（以及相当多的代码）。

直到今天，Linux 和 BSD Unix 的重点都是它们都是免费的操作系统。虽然商业版本和衍生版本当然是可用的，但几乎所有这些商业版本都有相应的免费版本。

在本节中，我们看了 Linux 在计算领域的历史和重要性。我们了解了 Linux 是如何出现的，以及它是如何在计算领域的某些部分中变得流行的。现在，我们将开始研究我们可以使用的不同 Linux 版本。这将帮助我们建立我们在本章后面做出选择使用哪个发行版的信息。

# 主流数据中心 Linux

正如我们讨论过的，Linux 不是一个单一的"东西"，而是一个多样化甚至分裂的不同发行版的生态系统。每个 Linux 发行版都基于相同的 GNU/Linux 内核，但它们被打包成具有不同目标和理念的组，这使得组织在开始标准化其服务器和工作站平台时有多种选择。

我们在现代数据中心中常见的主要发行版是 Red Hat、SUSE 和 Ubuntu，另外还有 FreeBSD Unix 作为另一种选择（尽管现在比过去不那么受欢迎）。这并不是说其他发行版不会出现在桌面或数据中心，但这些是你经常看到的。它们都有桌面和服务器版本，服务器版本通常更加"精简"，去掉了办公生产力、媒体工具，通常也去掉了图形用户界面。

## Red Hat

Red Hat 最近被 IBM 收购（2019 年），但仍将 Fedora 作为其主要项目之一。Fedora 既有服务器版本，也有桌面版本，并且仍然可以免费获取。Fedora 的商业版本是 Red Hat Enterprise Linux（RHEL）。RHEL 是商业许可的，并且有正式的支持渠道。

CentOS 最初是一个免费的、社区支持的 Linux 版本，与 Red Hat Enterprise 版本在功能上兼容。这使得它在许多组织中的服务器实施中非常受欢迎。在 2014 年 1 月，Red Hat 将 CentOS 纳入其旗下，成为该发行版的正式赞助商。2020 年底，宣布 CentOS 将不再作为 RHEL 兼容的发行版进行维护，而是会在 Fedora 和 RHEL 之间"适应"，既不会像"前沿"那样新，也不会像 RHEL 那样稳定。作为这一变化的一部分，CentOS 更名为 CentOS Stream。

最后，Fedora 是具有最新功能和代码的发行版，新功能在其中得到尝试和测试。CentOS Stream 发行版更加稳定，但仍处于 RHEL 的"上游"。RHEL 是一个稳定的、经过充分测试的操作系统，具有正式的支持服务。

## Oracle/Scientific Linux

Oracle/Scientific Linux 也出现在许多数据中心（以及在 Oracle 的云服务中）。Oracle Linux 基于 Red Hat，并宣传他们的产品与 RHEL 完全兼容。Oracle Linux 可以免费下载和使用，但来自 Oracle 的支持是基于订阅的。

## SUSE

OpenSUSE 是 SUSE Linux 基于的社区发行版，类似于 RedHat Enterprise Linux 基于 Fedora 的方式。

SUSE Linux Enterprise Server（通常称为 SLES）在 Linux 早期是美国 Red Hat 发行版的主要欧洲竞争对手。然而，那些日子已经过去，现代数据中心中德 SUSE Linux（几乎）和在意大利一样常见。

与 RedHat 和 CentOS 之间的关系类似，SUSE 维护着桌面和服务器版本。此外，他们还维护着一个“高性能”版本的操作系统，该版本具有针对并行计算进行了优化并预先安装了工具。OpenSUSE 占据了 SLES 的“上游”位置，可以在这个发行版中引入一些可能不总是第一次就成功的更改。OpenSUSE Tumbleweed 发行版具有最新的功能和版本，而 OpenSUSE Leap 在版本和稳定性上更接近操作系统的 SLE 版本。这种模式与 RedHat 系列发行版相似并非偶然。

## Ubuntu

Ubuntu Linux 由 Canonical 维护，可以免费下载，没有单独的商业或“上游”选项。它基于 Debian，并且有独特的发布周期。服务器和桌面版本的新版本每 6 个月发布一次。每 2 年发布一个**长期支持**（**LTS**）版本，对服务器和桌面的 LTS 版本的支持从发布日期开始为期 5 年。与其他大型参与者一样，支持是基于订阅的，尽管来自社区的免费支持也是一个可行的选择。

正如你所期望的，Ubuntu 的服务器版本更专注于核心操作系统、网络和数据中心服务。在安装服务器版本时，通常会取消选择 GUI。然而，桌面版本安装了一些用于办公生产力、媒体创作和转换以及一些简单游戏的软件包。

## BSD/FreeBSD/OpenBSD

正如我们之前提到的，BSD 家族的“树”是从 Unix 而不是 Linux 内核派生的，但有很多共享的代码，特别是当你看那些不是内核的包时。

FreeBSD 和 OpenBSD 在历史上被视为比早期版本的 Linux“更安全”。因此，许多防火墙和网络设备都是基于 BSD 操作系统家族构建的，并且至今仍在使用这个操作系统。更“显眼”的 BSD 变体之一是苹果的商业操作系统**OS X**（现在是**macOS**）。这是基于 Darwin，而 Darwin 又是 BSD 的一个分支。

然而，随着时间的推移，Linux 已经发展到具有与 BSD 大部分相同的安全功能，直到 BSD 可能比大多数 Linux 替代品具有更安全的默认设置。

现在 Linux 有安全模块可用，可以显著提高其安全性。**SELinux**和**AppArmor**是两个主要的可用选项。SELinux 起源于 Red Hat 发行版，并且在 SUSE、Debian 和 Ubuntu 上完全实现。AppArmor 通常被视为一个更简单的实现选项，具有许多（但不是全部）相同的功能。AppArmor 在 Ubuntu、SUSE 和大多数其他发行版上都可用（但不包括 RHEL）。这两个选项都采用基于策略的方法，显著提高了安装它们的操作系统的整体安全性。

随着 Linux 向更注重安全性的发展，特别是现代 Linux 发行版可用（并建议）的 SELinux 或 AppArmor，BSD 与 Linux 之间的“更安全”论点现在主要是历史上的看法，而不是事实。

# 专业 Linux 发行版

除了主流的 Linux 发行版外，还有几个发行版是专门为特定需求而构建的。它们都是基于更主流的发行版构建的，但是专门定制以满足特定的需求。我们将在这里描述一些你最有可能看到或用作网络专业人士的发行版。

大多数商业**网络附加存储**（**NAS**）和 SAN 提供商都基于 Linux 或 BSD。在撰写本文时，开源 NAS/SAN 服务的领先者似乎是**TrueNAS**（以前是**FreeNAS**）和**XigmaNAS**（以前是**NAS4Free**）。两者都有免费和商业版本。

## 开源防火墙

网络和安全公司提供各种防火墙设备，其中大多数基于 Linux 或 BSD。许多公司提供免费防火墙，一些较受欢迎的包括 pfSense（提供免费版本和预构建硬件解决方案）、OPNsense（免费提供，可捐赠）和 Untangle（也有商业版本）。Smoothwall 是另一种选择，提供免费和商业版本。

在本书中，我们将探讨在 Linux 中使用板载防火墙来保护单个服务器，或者保护网络边界。

## Kali Linux

从`apt`工具集演变而来）。

## SIFT

SIFT 是由 SANS 研究所的取证团队编写的一个发行版，专注于数字取证和事件响应工具和调查。与 Kali 类似，SIFT 的目标是成为一个在一个领域中的“一站式”免费/开源工具 - 数字取证和事件响应（DFIR）。在历史上，这是一个基于 Ubuntu 的发行版，但近年来情况已经改变 - SIFT 现在也作为一个脚本分发，可以在 Ubuntu 桌面或基于 Ubuntu 的 Windows 服务上安装这些工具。

## Security Onion

Security Onion 与 Kali Linux 类似，它包含了几种信息安全工具，但其重点更多地是从防御者的角度来看。这个发行版侧重于威胁猎杀、网络安全监控和日志管理。这个发行版中的一些工具包括 Suricata、Zeek 和 Wazuh 等。

# 虚拟化

虚拟化在 Linux 的采用和能够同时使用多个发行版的能力中发挥了重要作用。通过本地虚拟化程序，网络专业人员可以在他们的笔记本电脑或台式电脑上运行数十个不同的“机器”。虽然 VMware 是这个领域的先驱（桌面和专用虚拟化），但它们已经被 Xen、KVM、VirtualBox 和 QEMU 等虚拟化程序所取代，仅举几例。在撰写本文时，VMware 的产品都是商业产品（除了 VMware Player），而其他列出的解决方案在当时仍然是免费的。VMware 的旗舰虚拟化程序 ESXi 也可以作为独立产品免费获得。

## Linux 和云计算

Linux 的不断稳定以及虚拟化现在已经成为主流，从许多方面来看，这使得我们现代云生态系统成为可能。再加上部署和维护后端基础设施的自动化能力的不断增强，以及开发 Web 应用程序和应用程序编程接口（API）开发人员可用的复杂性，我们得到的就是今天的云基础设施。其中一些关键特性如下：

+   多租户基础设施，每个客户在云中维护自己的实例（虚拟服务器和虚拟数据中心）。

+   通过月份或更常见的资源使用时间的细粒度成本。

+   可靠性与许多现代数据中心一样好甚至更好（尽管最近的故障表明当我们把太多的鸡蛋放在同一个篮子里时会发生什么）。

+   使得自动化基础设施相对容易的 API，以至于对于许多公司来说，配置和维护他们的基础设施已经成为一种编码活动（通常称为基础设施即代码）。

+   这些 API 使得根据需要扩展（或缩减）容量成为可能，无论是存储、计算、内存、会话计数还是所有这四种。

云服务是为了盈利，尽管 - 任何决定将他们的数据中心原样转移到云服务的公司很可能会发现，所有这些小费用随着时间的推移会累积起来，最终达到或超过他们本地数据中心的成本。从美元的角度来看，这仍然往往是有吸引力的，因为这些美元是花在可以更容易地直接归因于操作性支出的地方，而不是本地资本支出模型（通常称为 Cap-Ex 与 Op-Ex 模型）。

正如你所看到的，将数据中心迁移到云服务确实为一个组织带来了许多好处，这在本地模型中可能不会有这个选项。随着更多的仅云功能被利用，这一点变得更加明显。

# 为你的组织选择 Linux 发行版

在许多方面，你选择数据中心的发行版并不重要 - 主要的发行版都有类似的功能，通常具有相同的组件，并且通常具有类似的供应商或社区支持选项。然而，由于这些发行版之间的差异，重要的是选择一个发行版（或一组类似的发行版）。

期望的结果是你的组织标准化一个发行版，你的团队可以在其中发展他们的专业知识。这也意味着你可以与更高级的支持和故障排除团队合作，无论是咨询组织、付费供应商支持团队，还是各种互联网论坛上的一群志同道合的人。许多组织与“三大巨头”之一（红帽、SUSE 或 Canonical，取决于他们的发行版）购买支持合同。

你不想出现的情况是我见过一些客户陷入的境地。他们雇佣了一个渴望学习的人，一年后，他们发现他们在那一年建造的每台服务器都运行在不同的 Linux 发行版上，每台服务器都略有不同。这是你的基础设施成为永无止境的“科学实验”的捷径！

与另一位客户形成鲜明对比 - 他们的第一台服务器是**SUSE Linux for SAP**，正如其名称所示，这是一台打包了客户购买的 SAP 应用程序（SAP HANA）的 SUSE Linux 服务器。随着更多服务的增加，他们坚持使用 SUSE 平台，但选择了“真正的”SLES 发行版。这使他们保持了单一的操作系统，同样对他们来说，与 SUSE 保持了单一的支持许可证。他们能够将培训和专业知识集中在 SUSE 上。对他们来说，另一个关键的好处是，随着他们添加更多的服务器，他们能够应用单一的更新和补丁“流”，并采用分阶段的方法。在每个补丁周期中，不太关键的服务器首先被打补丁，然后在他们的测试完成后几天后，核心业务应用服务器才被打补丁。

选择发行版的主要建议是坚持选择较大的发行版之一。如果你团队中的人对其中一个发行版有强烈的感觉，那么一定要考虑这一点。你可能希望选择离主流发行版较近，这样你就可以在你的组织内使用它，这是一个经常维护并且有付费订阅模式支持的发行版 - 即使你今天觉得你不需要付费支持，也许将来情况就不同了。

# 总结

现在我们已经讨论了 Linux 的历史，以及几个主要的发行版，我希望你现在能更好地理解操作系统在我们社会中的历史和核心重要性。特别是，我希望你有一些好的标准来帮助你为你的基础设施选择一个发行版。

在本书中，我们将选择 Ubuntu 作为我们的发行版。它是一个免费的发行版，在其 LTS 版本中，我们可以依赖的操作系统，当你在讨论的各种场景、构建和示例中工作时，它会得到支持。它也是 Windows 的本地发行版（在 Windows 服务中用于 Linux）。这使得它成为一个容易熟悉的发行版，即使你没有服务器或工作站硬件可以使用，甚至没有虚拟化平台可以测试。

在下一章中，我们将讨论如何将您的 Linux 服务器或工作站连接到网络。我们将演示如何使用本地接口，并添加 IP 地址、子网掩码以及任何必要的路由，以使您的 Linux 主机在新的或现有网络中正常工作。

# 进一步阅读

+   Red Hat Linux: [`www.redhat.com/en`](https://https://www.redhat.com/en%0D)

+   Fedora: [`getfedora.org/`](https://getfedora.org/)

+   CentOS: [`www.centos.org/`](https://www.centos.org/)

+   SUSE Linux: [`www.suse.com/`](https://https://www.suse.com/%0D)

+   OpenSUSE: [`www.opensuse.org/`](https://https://www.opensuse.org/%20%0D)

+   Ubuntu Linux: [`ubuntu.com/`](https://https://ubuntu.com/%0D)

+   Windows Subsystem for Linux: [`docs.microsoft.com/en-us/`](https://docs.microsoft.com/en-us/)

[`docs.microsoft.com/en-us/windows/wsl/about`](https://docs.microsoft.com/en-us/windows/wsl/about)

+   FreeBSD Unix: [`www.freebsd.org/`](https://https://www.freebsd.org/%0D)

+   OpenBSD Unix: [`www.openbsd.org/`](https://https://www.openbsd.org/)

+   Linux/BSD differences: [`www.howtogeek.com/190773/htg-explains-whats-the-difference-between-linux-and-bsd/`](https://https://www.howtogeek.com/190773/htg-explains-whats-the-difference-between-linux-and-bsd/%0D)

+   TrueNAS: [`www.truenas.com/`](https://https://www.truenas.com/%0D)

+   XigmaNAS: [`www.xigmanas.com/`](https://https://www.xigmanas.com/%20%0D)

+   pfSense: [`www.pfsense.org/`](https://https://www.pfsense.org/%0D)

+   OPNsense: [`opnsense.org/`](https://https://opnsense.org/%0D)

+   Untangle: [`www.untangle.com/untangle`](https://https://www.untangle.com/untangle%0D)

+   Kali Linux: [`www.kali.org/`](https://https://www.kali.org/%0D)

+   SIFT: [`digital-forensics.sans.org/community/downloads`](https://https://digital-forensics.sans.org/community/downloads); [`www.sans.org/webcasts/started-sift-workstation-106375`](https://https://www.sans.org/webcasts/started-sift-workstation-106375%0D)

+   Security Onion: [`securityonionsolutions.com/software`](https://https://securityonionsolutions.com/software%0D)

+   Kali Linux: [`www.kali.org/`](https://https://www.kali.org/)
