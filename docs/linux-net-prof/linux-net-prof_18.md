# 第十五章：评估

在接下来的页面中，我们将回顾本书各章节的所有练习问题，并提供正确答案。

# 第二章 - 基本 Linux 网络配置和操作 - 使用本地接口

1.  默认网关是一个特殊路由，通常表示为`0.0.0.0/0`（在其他二进制中，这表示“所有网络”）。主机始终具有本地路由表，具有优先顺序。

直接连接到接口的任何网络都首先进行处理。这些被称为`route`命令的`ip`命令。

最后，引用了默认路由。如果发送的流量与连接的路由或路由表中的路由不匹配，则将其发送到默认网关中定义的 IP。通常，此设备将是一个特殊的路由器或防火墙设备，该设备通常具有本地表、静态定义的路由和默认网关（以及本书范围之外的其他几种路由机制）。

1.  对于这个网络，子网掩码是`255.255.255.0`（24 位二进制）。广播地址是`192.158.25.255`。

1.  发送到广播地址的流量将发送到整个子网，并由该子网中的所有主机处理。其中一个例子是标准 ARP 请求（我们将在下一章中更深入地讨论）。

1.  主机地址可以从`192.168.25.1`到`192.168.25.254`范围。`0`地址是网络地址，因此不能用于主机。`255`地址是广播地址。

1.  `nmcli`命令是推荐的更改方法。例如，要将接口连接有线以太网 1 设置为 100 Mbps/全双工，请使用以下命令：

```
$ sudo nmcli connection modify 'Wired connection 1' 802-3-ethernet.speed 100
$ sudo nmcli connection modify 'Wired connection 1' 802-3-ethernet.duplex full
```

# 第三章 - 使用 Linux 和 Linux 工具进行网络诊断

1.  您永远不会看到这一点。从网络的角度来看，会话、连接和对话只存在于 TCP 协议（在 OSI 第 5 层）。UDP 对话是无状态的 - 网络无法将 UDP 请求与 UDP 响应关联起来 - 所有这些都必须在应用程序内部发生。通常，应用程序将在数据包中包含会话号或序列号（或两者，取决于应用程序）来完成这一点。但请记住，如果应用程序以某种方式在 UDP 上维护会话，那么应用程序有责任保持其正确 - 在 OSI 第 5 层的主机或网络上没有任何东西会像我们在 TCP 中看到的那样跟踪这一点。

1.  如果您正在解决网络或应用程序问题，这是关键信息。例如，如果您遇到可能与网络有关的应用程序问题，了解主机监听的端口可以是关键 - 例如，这些端口可能需要在主机防火墙上配置或在某些其他路径防火墙上配置。

从另一个角度来看，如果您在特定端口上看到防火墙错误，例如长时间运行的会话被终止，那么您需要将端口与应用程序联系起来。

第三个例子，当调查恶意软件时，您可能会看到与发送或监听端口相关联的恶意软件活动。能够快速诊断这一点可以使查找可能受到该恶意软件影响的其他站点变得更加简单。例如，可以使用 Nmap 找到在特定端口上监听的恶意软件，或者可以使用防火墙日志快速找到在特定端口上传输的恶意软件。这种情况的一个很好的例子是恶意软件在 DNS 端口上外泄数据 - 在这种情况下，您将寻找`tcp/53`或`udp/53`的防火墙日志条目，要么来自不是 DNS 服务器的内部主机，要么发送到不是 DNS 服务器的外部主机。在大多数公司环境中，只有 DNS 服务器应该向特定的互联网 DNS 转发主机发出 DNS 查询（有关此内容的更多详细信息，请参见*第六章*，*Linux 上的 DNS 服务*）。

1.  在一个良好运行的网络中，互联网防火墙通常会有双向规则。入站规则（从互联网到内部网络）将描述您可能希望允许互联网客户端连接的监听端口。这通常被称为“拒绝所有”作为最后一个条目，并且适当的警报通常会提醒管理员有恶意软件，不需要的软件安装在桌面或服务器上，配置错误的主机或设备，或者不属于组织网络的硬件。

1.  证书用于保护许多服务，HTTPS（在`tcp/443`上）只是最受欢迎的。证书也用于认证或保护许多其他服务。最常见的一些服务如下表所示（还有**很多**）：![](img/B16336_Assesment_Table_01.jpg)

如果证书过期，在最好的情况下，连接到该服务的用户将收到错误。根据其浏览器设置，他们可能无法继续。如果连接是从程序到服务的（即不是浏览器），则连接可能会出错，这取决于应用程序错误处理和日志记录代码的编写方式。

1.  所有`1024`以下的端口都是服务器端口，因此需要管理权限才能在其中任何一个上打开监听器。

1.  假设 20 GHz 的通道宽度，通道 1、6 和 11 不会重叠。

1.  通道宽度通常会提高性能，这取决于客户端站点在媒体上尝试执行的操作。然而，在 2.4 GHz 频段，只有 11 个可用频道（并且只有 3 个选择不会产生干扰），增加通道宽度几乎肯定会增加大多数环境的干扰。在 5 GHz 频段中，有更多的频道可用，因此更有机会使用更宽的频道。

# 第四章- Linux 防火墙

1.  希望您考虑使用 nftables。虽然 iptables 在未来几年仍将得到支持，但 nftables 更高效（在 CPU 方面），并支持 IPv6。它在“匹配”流量方面也更灵活，允许更容易地匹配数据包中的各个字段以进行进一步处理。

1.  支持中央防火墙标准的简单方法（而不需要添加编排或配置管理工具）是使用`nft` `include`文件。这些文件可以在单个位置进行管理，赋予有意义的名称，然后复制到符合每个`include`文件用例的目标服务器上。例如，通常会看到为 Web 服务器，DNS 主机或 DHCP 服务器创建一个`include`文件。另一个非常常见的用例是创建一个单独的`include`文件，以允许仅从一小组管理“跳转主机”，地址范围或子网进行主机管理。

即使没有`include`文件，编排工具如 Terraform，Ansible，Puppet，Chef 或 Salt 也可以用于集中管理 Linux 主机和服务的许多方面，包括防火墙。在这种情况下，至少明智地硬编码编排工具所需的访问权限-发现编排工具中的简单配置错误刚刚删除了对服务器群的所有管理访问权限是不愉快的。

# 第五章-具有现实生活示例的 Linux 安全标准

1.  可悲的是，此时美国没有任何联邦隐私立法。希望这在不久的将来会改变！

1.  不，关键控件并不是作为审计框架。但是，您当然可以根据它们进行评估。

例如，在关键控制 1 中，建议为网络访问部署 802.1x 认证。这意味着您的工作站和/或用户帐户需要向网络“认证”，认证过程决定了该站点和用户 ID 组合可以访问什么。虽然这不是一个审计项目（它不讨论具体的设置或特定的服务或访问权限），但您是否在您的基础设施中实施了 802.1x 可以在更大的安全程序或一系列项目中进行评估。

1.  对此的第一个答案是，第一个检查可能不准确，视差视图可以帮助确定这一点。例如，如果进行了更改，但操作系统或应用程序错误意味着配置更改没有正确实施，那么第二个工具来评估设置就可以识别出这一点。

更重要的是，配置更改和检查通常是在主机上本地进行的，并且需要逐个主机重复。通过“通过网络”评估设置，例如使用 Nmap 扫描，可以让您在几分钟内评估数百台主机。这不仅节省时间，而且也是审计员、渗透测试人员和恶意软件使用的节省时间的方法。

# 第六章 – Linux 上的 DNS 服务

1.  DNSSEC 实现了允许“签名”以验证 DNS 响应数据的记录。它既不加密请求也不加密响应，因此可以使用标准的 DNS 端口 `udp/53` 和 `tcp/53` 运行。DoT 完全使用 TLS 加密 DNS 请求和响应。因为 DoT 是一个完全不同的协议，它使用端口 `tcp/853`。

1.  DoH 作为一个 API 运行——请求和响应都在特定的 HTTP 头部的 HTTPS 流量中传输。DoT `/dns-query`，由于使用了 HTTPS 传输，该协议只使用 `tcp/443`。

1.  内部 DNS 服务器肯定会实现递归和转发器，以允许解析互联网主机。通常情况下，自动注册是启用的，并且请求通常仅限于组织内的“已知”子网。

组织区域的外部 DNS 服务器通常不会实现递归或转发器，几乎永远不会实现自动注册。几乎总是实现某种形式的速率限制。

# 第七章 – Linux 上的 DHCP 服务

1.  首先，这可能只是打电话给帮助台的人的问题。确保这是一个分公司范围的问题。确保打电话的人已经插入网络（或者如果他们是无线的，确保他们已经正确关联）。确保他们不是在家工作；如果他们甚至不在办公室，那么这很可能不是您服务器的问题。

完成了“我们有问题吗”的问题后，看看你是否能在远程办公室找到任何东西。如果 WAN 链路、VPN 链路、路由器或办公室的交换机都没有工作，那么 DHCP 也不会工作。在深入研究 DHCP 方面之前，请确保您可以 ping 或以其他方式测试这些设备中的每一个。

接下来，首先确保 DHCP 服务器实际上正在工作。检查服务是否正在运行——请注意，以下 `systemctl` 命令为您提供了一些最近的 DHCP 数据包信息：

```
ss command, to see whether the server is listening on the correct UDP port. Note that this doesn't verify that it's actually the DHCP server that is listening on port 67/udp (bootups), but it would truly be an odd day if it was something else:

```

使用 tail 命令只提取最后几个日志条目。如果日期不是今天的，请注意日期，以查看 DHCP 上次分配地址的时间。您可能已经从 systemctl 输出中得到了这个信息，但您也可以从 syslog 中获取：

```
67/udp (bootups).At this point, you have checked pretty much everything. It is now time to check again that the routers and switches in the office are powered on, and that people haven't re-cabled anything in that office over the weekend. It's also worth checking again that the person who's reporting the problem is actually in the office. It may seem odd, but also ask if the lights are on – you'd be surprised how often people call in a network outage when what they really have is an extended power outage.If all that fails, proceed with *Question 2*. You may have a rogue DHCP server in that office and the Helpdesk may not have identified this problem yet.
```

```

```

1.  在任何 Linux 客户端上，获取 DHCP 服务器的 IP。有几种方法可以做到这一点。您可以检查 `syslog` 文件：

```
$ sudo cat /var/log/syslog | grep DHCPACK
Mar 19 12:40:32 ubuntu dhclient[14125]: DHCPACK of 192.168.1.157 from 192.168.1.1 (xid=0xad460843)
```

或者只需从工作站上的 DHCP 客户端租约文件中转储服务器信息（这会在各种客户端接口更新时更新）：

```
$ cat /var/lib/dhcp/dhclient.leases | grep dhcp-server
  option dhcp-server-identifier 192.168.1.1;
  option dhcp-server-identifier 192.168.1.1;
```

最后，你可以在前台更新租约并从那里获取信息。请注意，如果你通过 SSH 连接到客户端，你的地址可能会因为这种方法而改变。客户端也会在这里显示的最后一行上“挂起”。请记住，这是在前台运行的后台 DHCP 客户端进程，所以不是“挂起”，而是“等待”。按下*Ctrl + C*退出：

```
$ sudo dhclient –d 
Internet Systems Consortium DHCP Client 4.4.1
Copyright 2004-2018 Internet Systems Consortium.
All rights reserved.
For info, please visit https://www.isc.org/software/dhcp/
Listening on LPF/ens33/00:0c:29:33:2d:05
Sending on   LPF/ens33/00:0c:29:33:2d:05
Sending on   Socket/fallback
DHCPREQUEST for 192.168.1.157 on ens33 to 255.255.255.255 port 67 (xid=0x7b4191e2)
DHCPACK of 192.168.1.157 from 192.168.1.1 (xid=0xe291417b)
RTNETLINK answers: File exists
bound to 192.168.1.157 -- renewal in 2843 seconds.
```

或者，如果远程客户端是基于 Windows 的，有一个简单的命令可以获取 DHCP 服务器地址：

```
> ipconfig /all | find /i "DHCP Server"
   DHCP Server . . . . . . . . . . : 192.168.1.1
```

无论你如何获取 DHCP 服务器 IP 地址，如果你从你的故障排除中得到的 IP 地址不是你的服务器，那么你就有一个流氓 DHCP 问题。

由于我们现在有了 DHCP IP 地址，从受影响的主机快速 ping 它，然后收集流氓服务器的 MAC 地址：

```
$ arp –a | grep "192.168.1.1"
_gateway (192.168.1.1) at 00:1d:7e:3b:73:cb [ether] on ens33
```

从 OUI 中获取有问题设备的制造商。在这种情况下，这是一个 Linksys 家用路由器。你可以很容易地从 Wireshark OUI 查找站点([`www.wireshark.org/tools/oui-lookup.html`](https://www.wireshark.org/tools/oui-lookup.html))获取这个信息，或者如*第二章*中所述，*基本 Linux 网络配置和操作-使用本地接口*，我在 GitHub 上托管了一个脚本([`github.com/robvandenbrink/ouilookup`](https://github.com/robvandenbrink/ouilookup))。

现在去你的交换机（或者让你的网络人员参与进来），找出那个主机连接的交换机端口。注意，我们只是在寻找 MAC 地址的最后一部分：

```
# show mac address-table | i 73cb
* 1        001d.7e3b.73cb    dynamic   20         F    F   Gi1/0/7
```

在这一点上，你可能想要开始关闭那个端口并开始打电话。一定要确保你在这样做时不要关闭连接整个交换机的端口。首先检查该端口上的其他 MAC 地址，特别是查找 MAC 地址的计数：

```
# show mac address-table int Gi1/0/7
```

还要检查该端口的 LLDP 邻居列表-它应该告诉你那里是否有一个交换机：

```
# show lldp neighbors int g1/0/7 detailed
```

此外，查找该端口上的 CDP 邻居，同时查找交换机：

```
# show cdp neighbors int g1/0/7
```

如果该端口上有一个交换机，连接到相邻的交换机并重复这个过程，直到找到你的有问题的 DHCP 服务器的端口。

关闭有问题的端口后，你的用户应该能够重新开始获取 DHCP 地址。由于你有服务器的 OUI，你的下一步是要求办公室的一个值得信任的人去寻找一个上面贴有<插入品牌名称>标签的新盒子。

# 第八章- Linux 上的证书服务

1.  第一个功能是最重要的，也是最容易被忽视的。证书提供了信任和身份验证。主机名与证书中的 CN 或 SAN 字段匹配提供了启动会话所需的身份验证。证书由受信任的 CA 签名意味着客户端可以信任身份验证。这将在本书的下一章*第九章*中再次讨论，*Linux 的 RADIUS 服务*。

第二个功能是证书材料用于提供用于对后续会话进行对称加密的密钥的一些材料。但需要注意的是，随着我们进展到其他用例，许多使用证书的情况根本不进行会话加密——证书纯粹用于身份验证。

1.  `PKCS#12`格式，通常以`.pfx`或有时`.p12`为后缀，将服务的公共证书与其私钥结合在一起。这种组合通常在正常安装过程可能会得到通常有一个*让我们从 CSR 开始*的起点，但证书是一个预先存在的，比如通配符的情况下是必需的。

1.  CT 在公共 CA 所需的信任模型中至关重要。由于所有证书都是公开发布的，这意味着 CT 日志可以进行欺诈证书的审计。

作为一个附带好处，这意味着组织可以审计发放给他们的证书，以防止未经授权购买的证书，以及以前未知的服务。这有助于遏制非 IT 部门直接购买 IT 服务的*影子 IT*的蔓延，超出了正常渠道。

1.  虽然 CA 在发放证书后从未被咨询，但保留已发放证书的详细信息有几个原因，如下所述：

+   最重要的原因是*信任*。保留已发放证书的注册表意味着可以对此列表进行审计。

+   第二个原因也是*信任*。保留已发放证书的日志意味着当您需要撤销一个或多个证书时，您可以通过`index.txt`文件中的名称识别它们，然后使用它们的序列号（与它们的文件名匹配）来撤销这些证书。

+   最后，当操作内部 CA 和服务器基础设施时，通常会达到一个疑难解答的时刻，您会说*几乎就像那个证书来自其他地方*——例如，它可能是自签名的，或者可能是由另一个 CA 发放的。虽然您可以从证书本身获取这些信息，但私人 CA 上的索引为您提供了检查哪些证书是通过其他方法何时发放的所需工具。

例如，如果攻击者建立了一个与您相同名称的恶意 CA，这样您可以快速检查而无需使用`openssl`命令验证密钥和签名。

更糟糕的是，如果攻击者使用从您实际服务器中窃取的（有效的）密钥材料构建了恶意 CA，那么真实 CA 上的索引文件将是您指向最终诊断的唯一线索。

# 第九章-用于 Linux 的 RADIUS 服务

1.  使用同时引用身份验证请求和后端组成员资格的`unlang`规则是解决此问题的经典方法。规则应指定以下内容：

1.  如果您正在提出 VPN 请求，则需要加入“VPN 用户”组进行身份验证。

1.  如果您正在提出管理访问请求，则需要加入“网络管理员”组。

1.  这种方法可以扩展到包括任意数量的身份验证类型、设备类型、RADIUS 属性值和组成员资格。

提供所请求功能的一个示例`unlang`规则可能如下所示：

```
if(&NAS-IP-Address == "192.168.122.20") {
    if(Service-Type == Administrative && LDAP-Group == "Network Admins") {
            update reply {
                Cisco-AVPair = "shell:priv-lvl=15"
} 
            accept
} 
    elsif (Service-Type == "Authenticate-Only" && LDAP-Group == "VPN Users" ) {
        accept
    }
    elsif {
        reject
    }
}
```

1.  有几个原因，这些在这里概述：

1.  由于它使用证书，并且通常使用本地证书存储，整个信任模型

1.  因为它使用 TLS-如果实施正确，那么对身份验证交换的加密的攻击是一个重大挑战。

1.  每个无线用户都有自己的会话密钥，这些密钥经常轮换。

1.  攻击者无法捕获或利用密码。所有其他无线身份验证和加密机制都使用用户 ID/密码（例如 PEAP）或预共享密钥。

1.  部署 EAP-TLS 的障碍在于准备工作，特别是在 RADIUS 服务器和端点客户端上发布和安装证书。在典型的组织中，这是完全可行的，其中工作站由公司拥有，或者您可以指导员工在其拥有的任何授权设备上安装证书。此外，移动设备管理（MDM）平台可用于在手机和平板电脑上发布和安装证书。

然而，如果设备不是公司所有，例如，如果设备是顾问或供应商的笔记本电脑或员工拥有的家用电脑，那么在该设备上安全地发放和安装公司证书可能是一个真正的挑战。特别是，常见的情况是看到**证书签名请求**（**CSR**）和证书通过电子邮件来回发送，这不建议用于传输此类敏感数据。

MFA 解决方案保留了用户 ID 密码界面，用于诸如 VPN 服务之类的事物，但消除了这些界面的密码填充或暴力攻击的风险。此外，将远程站点注册到 Google Authenticator 等系统中非常简单——只需扫描您获得的 QR 码即可完成！

# 第十章–Linux 负载均衡器服务

1.  如果您的总负载可能达到负载均衡器的容量，DSR 解决方案意味着只有客户端到服务器的流量需要通过负载均衡器路由。这对大多数工作负载来说影响很大，因为大多数工作负载的返回流量（服务器到客户端）要比发送流量（从客户端到服务器）多得多。这意味着改用 DSR 解决方案可以很容易地将通过负载均衡器的流量减少 90%。

如果较小的负载均衡器与需要平衡的每个离散工作负载匹配 1:1，那么性能就不太重要了。特别是在虚拟化环境中，向基于 VM 的负载均衡器添加 CPU 和内存资源也比在传统的基于硬件的设备情况下进行硬件升级要简单得多。

DSR 负载均衡器还需要相当多的服务器和网络“调整”才能使所有部件正常工作。一旦它工作，当需要排除故障时，再次弄清楚所有这些可能会成为一个真正的问题。

DSR 解决方案在客户端和服务器之间的流量中也会失去一些智能，因为只能看到对话的一半。

1.  您会使用基于代理的负载均衡器的主要原因是允许在 HTTPS 设置中进行会话持久性。这通过在前端虚拟 IP（VIP）上终止客户端会话，然后在后端接口上启动新的 HTTPS 会话来实现。这种方法允许负载均衡器在此方程式的客户端部分插入一个 cookie。当客户端发送下一个请求（其中将包括此 cookie）时，负载均衡器将会将会话引导到分配给此客户端 HTTPS 会话的服务器。

# 第十一章–Linux 中的数据包捕获和分析

1.  您会从中间设备捕获出于几个原因：

+   您无法访问任一端的主机，也没有权限在它们上捕获数据包。

+   您无法访问允许您使用主机和 Wireshark 的交换机端口，要么是因为您不在现场，要么是因为没有交换机访问权限。

+   如果中间设备是防火墙，从那里进行捕获将允许您考虑 NAT（在翻译之前和之后进行捕获），以及防火墙上的任何 ACL。

+   如果您正在解决主机服务问题并且可以访问任一主机并且有权限在一个或两个主机上安装数据包捕获工具，那么您可以从任一端捕获。此外，从任一端捕获可能允许您在解密之前或之后捕获加密流量。

+   使用 SPAN 端口进行捕获几乎是所有情况下的首选解决方案。这允许您捕获任一方向的流量，但不需要访问或权限更改任一端点主机。

1.  tcpdump 是 Linux 上的底层数据包捕获机制。几乎所有工具，包括 Wireshark 都使用 tcpdump。Wireshark 的优势在于它为操作员提供了一个 GUI 界面，这对那些不擅长“CLI 人员”来说非常有吸引力。此外，Wireshark 将完全解码数据包，并允许您使用显示过滤器交互式地深入到目标流量中。

另一方面，TCPdump 的优势在于它可以在任何地方运行，这在捕获会话通过 SSH 会话运行时非常有吸引力，或者如果进行捕获的主机没有运行 GUI。 TCPdump 还可以让您更好地控制会影响捕获性能或容量的低级功能。例如，环形缓冲区的大小可以很容易地从`tcpdump`命令行进行修改。

1.  RTP 协议的端口将在每次呼叫中都不同。它们始终是 UDP，但会在呼叫设置期间通过 SIP/SDP（特别是通过`INVITE`数据包）进行协商。 

# 第十二章-使用 Linux 进行网络监控

1.  SNMP 的写访问权限允许您监视（读取）设备或主机参数，并设置（写入）相同的参数。因此，通过读写访问权限，您可以更改接口速度或双工，重新启动或关闭设备，或下载配置。有一个 nmap 脚本可以使这样的配置下载变得简单：`snmp-ios-config.nse`。

1.  Syslog 通常以明文形式通过`514/udp`发送。有一个选项可以使用 IPSEC 加密这些流量，但它并没有被广泛实现。风险在于敏感信息是通过 syslog 发送的，因为它是明文，所以任何有能力阅读它的人都可以收集这些信息以备后用，或者在发送时对其进行修改。

例如，管理员通常会将他们的密码放在`userid`字段中，这意味着密码在那一点上可能已经泄露。这个人通常会采取的下一步是再次尝试，这意味着攻击者现在既有 userid 又有密码。然而，您希望记录这些信息，以帮助检测恶意登录尝试。

一种选择是启用 SNMPv3 并使用 SNMPv3 陷阱来记录日志，而不是使用 Syslog。然而，这将把您的日志平台转移到通常不太灵活且更难使用的平台。

要在 Cisco IOS 设备上启用 SNMPv3 陷阱，请使用以下代码：

```
snmp-server enable traps
!
! … this can also be done in a more granular fashion:
! snmp-server enable traps envmon fan shutdown supply temperature status ospf cpu
!
! EngineID is automatically generated by the router, use "show snmp engineID" to check
snmp-server engineID remote <server ip address> 800005E510763D0FFC1245N1A4
snmp-server group TrapGroup v3 priv
snmp-server user TrapUser TrapGroup remote <server ip address> v3 auth sha AuthPass priv 3des PSKPass
snmp-server host <server ip address>  informs version 3 priv TrapUser
```

您的 SNMP 陷阱服务器必须具有匹配的帐户信息和加密选项。如果您走到这一步，您还必须为发送陷阱的每个设备硬编码主机信息。

1.  NetFlow 收集和汇总网络流量的摘要信息。至少包括源 IP、目的 IP、协议、源端口号和目的端口号的“元组”。通常由收集服务器添加时间以进行分析，以便可以组合和相关多个服务器的流量，而无需担心各种网络设备之间的时钟漂移。

尽管如此，发送的信息通常不是敏感的-基本上，它是源和目的地 IP 地址以及所使用应用程序的猜测（通常是从目的地端口推导出来的）。大多数组织不会认为这是敏感信息。

然而，如果您的组织认为这是一个风险，那么将这些数据通过 IPSEC 隧道传回到收集服务器就足够简单了。这个架构可能有些棘手，因为您可能需要维护两个路由**虚拟路由框架**（**VRFs**）来实现这一点，但这当然是可行的。也许更简单的方法是加密所有 WAN 流量，然后在核心路由器和 NetFlow 收集服务器之间应用第 2 层保护（假设它们在同一子网上）。

# 第十三章- Linux 上的入侵防范系统

1.  Zeek 将是您的首选工具。正如我们在 Zeek 示例中看到的，通过特定时间窗口内的所有流量快速钻取到特定的 TLS 版本。在搜索过程中添加地理位置信息只需要几次鼠标点击。源和目的地 IP 地址在您缩小搜索范围时为您总结，因此不需要采取额外的行动来收集它们。

1.  SSH 客户端在使用时会生成流量。诸如 P0F（或商业工具如 Teneble PVS）之类的工具可以被动地收集所有流量，然后将这些流量与客户端工作站关联起来。通过使用诸如 JA3 或 HASSH 之类的算法，被动收集的数据通常可以告诉您有关客户端应用程序的信息，甚至可以精确到其版本。这使您可以针对过时的客户端进行软件升级。

PuTTY 就是一个很好的例子，因为这个应用程序通常不是使用完整的基于 MSI 的 Windows 安装程序安装的。这意味着通常不容易使用 PowerShell 或商业清单工具进行清点。

这种方法的缺点是只能在应用程序使用时对目标应用程序进行清点。识别硬件客户端-例如，未经授权的**物联网**（**IoT**）设备-特别有效，因为这些设备倾向于非常频繁地与各种云服务联系。

1.  首先，故意将 IPS 放置在防火墙的公共互联网侧在当今并不是很有效，考虑到该网络的敌对性-它将不断发出警报，这将导致太多的“噪音”需要过滤。

将 IPS 放置在主要捕获出站流量或绕过防火墙的入站流量的位置，可以大大减少评估的流量，将其缩小到潜在的攻击流量（入站）和可能指示内部主机受到威胁的流量（出站）。这种放置通常是在 SPAN 端口上，监视防火墙的内部和 DMZ 接口。这可能扩展到其他端口或整个 VLAN（参考*第十一章*，*Linux 中的数据包捕获和分析*中的 SPAN 端口部分）。

将 IPS 放置在可以检查解密流量的位置，可以评估否则“不可见”的有效载荷；例如，在 RDP、SSH 或 HTTPS 流量中。在现代架构中，这通常意味着 IPS 实际上位于防火墙本身上，通常被称为**统一威胁管理**（**UTM**）防火墙或**下一代防火墙**（**NGFW**）。

# 第十四章- Linux 上的蜜罐服务

1.  蜜罐被部署来“拍摄”攻击者的流量。特别是在内部网络上，它们的主要目标是让攻击者在蜜罐主机上忙碌足够长的时间，以便你可以采取一些防御措施。

点亮一个主机上意想不到的端口组合会立即暴露你的攻击者，目标是一个蜜罐。他们不仅会跳过那个主机，而且会更加谨慎地继续，知道你部署了蜜罐。

1.  AD 域控制器通常启用了许多这些端口：

![](img/B16336_Assesment_Table_02.jpg)

这个列表并不完整，重点是 TCP 端口。攻击者通常会完全跳过扫描 UDP 端口，特别是如果开放的 TCP 端口的配置足以识别目标主机。

在互联网上，例外情况将是对`500/udp`和`4500/udp`的扫描，这通常表示开放的 VPN 端点。
