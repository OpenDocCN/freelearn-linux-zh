# 第三章：Linux 文件系统

在上一章中，我们通过浏览文件系统向您介绍了 Linux 文件和文件夹。在本章中，我们将学习如何处理、查找和更改文件的权限和访问权限以及读取和编辑文件。我们将扩展我们对这个主题的知识，定义文件系统是什么，并向您展示处理文件的重要命令，如复制和移动。

我们将为您介绍以下概念：

+   了解文件系统

+   使用文件链接

+   搜索文件

+   与用户和组一起工作

+   使用文件权限

+   处理文本文件

+   使用 VIM 文本编辑器

# 了解文件系统

文件系统不仅是向 Linux 用户公开的文件和文件夹树，还是访问和保存数据以及保持一切一致的结构和管理。如前所述，您经常听到 Linux 中的一切都是文件，这是真的。这意味着 Linux 中的许多不同事物都被抽象为文件。例如，目录是一个文件，硬件设备由特殊的系统文件表示，或者，有用的东西，如随机数生成器，也是一个文件。

让我们快速回顾和总结我们在过去两章中已经了解的有关处理文件的知识。`ls`列出并显示文件，`touch`创建文件，文件区分大小写，`.`文件是隐藏文件，并且被排除在正常命令执行之外，例如`ls`命令，也被排除在使用文件通配符进行 shell 扩展时。接下来，您还应该知道`mkdir`创建目录，`rmdir`删除空目录，`rm`删除文件，`mkdir -p`创建完整的子目录结构。`rmdir`不能应用于非空目录；在我们的示例中，它包含子文件夹。`rm -rf`删除带有所有子目录的目录，但要小心处理。当您使用`rm -rf`选项删除整个目录结构时，`r`选项代表递归，`f`代表强制。递归选项是您在处理对整个子目录树执行某些操作的命令时经常遇到的重要选项。

现在，让我们学习一些其他重要的基于文件的命令。如果您需要复制文件，可以使用`cp`命令。我们已经在上一章中看到了`cp`的一般用法。如果您查看`cp`命令的手册页，有三种不同的用法格式：`cp [option]... [-T] SOURCE DEST`，`cp [option]... SOURCE... DIRECTORY`和`cp [option]... -t DIRECTORY SOURCE...`。重要的是要记住，可以有多个源目录，但只能有一个目标目录。您必须记住这一点。要将单个文件复制到一个目标文件，可以使用第一种用法形式。要将多个文件复制到一个目标文件夹，可以使用第二种用法形式。第三种用法形式类似于第二种用法形式，但混合了源和目录参数。

例如，要创建具有不同文件名的文件副本，请使用`cp firstfile secondfile`；您也可以使用本地路径名执行相同操作。正如我们从手册中学到的，您还可以将文件复制到目录，保留原始文件名。如手册中所示，您还可以对多个源文件执行此操作。请注意，您不能直接使用`cp`命令复制完整的目录。为了这样做，您需要提供`-R`选项：

![](img/bebc3942-7fa4-42e9-bcec-02a1bcc83191.png)

如您所见，完整的`olip`主目录已被复制到`/tmp`目录中，包括所有子目录和文件。请记住，`cp -R`选项再次代表递归。要在命令行上移动文件和文件夹，可以使用移动命令，它隐式地复制并删除源文件。移动命令`mv`通常用于重命名文件和文件夹。请注意，您不仅可以移动或重命名文件，还可以移动或重命名文件夹。

现在，再次看看`ls -l`选项，例如，在`/etc`目录中，你会注意到一些东西。你将看到很多有用的信息。在`-l`列表中的第一个字符是`d`，`-`或`l`，这代表文件的类型。`d`代表目录，`-`是普通文件，`l`是链接。`ls -l`输出中的第一个字符也被称为文件类型标志。除了显示的`d`，`-`和`l`标志外，还有许多其他可用的文件类型。要获取所有可用文件类型标志的完整列表，请使用`man find`，搜索`type`，然后搜索`type c`。你将得到 Linux 中所有可用文件类型标志的完整列表：

![](img/d307e470-cc66-4be1-8e8f-87c8e340b3a9.png)

此外，在权限列的相邻位置还提供了另一个非常有用的信息。所呈现的数字是文件包含的链接数：

![](img/9d56b799-e748-443f-99d6-ed806ae1302a.png)

文件链接告诉我们任何给定文件或目录上存在多少引用。每个普通文件默认有一个链接，每个目录有两个链接。有硬链接和软链接，我们将很快讨论。

# 处理文件链接

在本节中，我们将看看 Linux 文件链接是什么，以及如何使用它们。正如你可能已经知道的那样，文件存储在硬盘上。在 Linux 文件系统中，文件的文件名和数据是两个分开的概念，它们不存储在一起。下图显示了一个一般的结构：

![](img/b8ee3da0-feea-4027-be6b-0d3a9cba07f9.png)

将文件名连接到实际数据是由文件系统使用表或数据库数据结构来管理的，这被称为标题分配表。在 Linux 文件系统中，Inode 是实际的入口点或特定文件数据在硬盘上的起始点。简单来说，我们可以说 Inode 代表文件的实际数据。文件系统管理现在负责确保每个普通文件在创建时在其分配表中有一个链接条目，以连接实际文件名到 Inode 或硬盘上的数据。这样的链接也被称为**硬链接**。原始文件名到 Inode 的关系也使用硬链接进行连接，这就是为什么在上一节中`ls -l`命令在权限列的相邻位置给我们大多数文件的数字`1`。现在，Linux 文件系统的很酷的一点是你可以创建额外的硬链接到现有的 Inode，这就像为一个文件创建替代名称一样。

硬链接的一个缺点是你无法区分硬链接和原始文件名或 Inode。这可能会导致问题和副作用，因为如果你更改原始文件的内容，硬链接的内容也会被更改。硬链接的另一个限制是你只能为应该在同一分区上的 Inode 定义它们。此外，你不能在目录上创建硬链接。你只能在普通文件上创建它们。为了解决这些硬链接的限制，你可以使用**软链接**，也称为符号链接。这是你作为 Linux 系统管理员在日常工作中几乎总是会使用的链接类型。硬链接也有它们特殊的用例，例如用于创建文件的备份，但在 Linux 用户中很少使用。

符号链接是对文件名而不是 Inode 的链接。符号链接也没有必须在同一分区或硬盘上的原始文件的限制。您还可以在目录上创建符号链接。主要缺点是，如果删除或移动原始文件，您将得到一个中断的符号链接，而不会有进一步的警告，这也可能会产生一些不良副作用。符号链接的主要用途和功能是引用 Linux 文件系统中的配置文件或动态库版本。使用链接可以节省大量磁盘空间，因为不必复制实际数据，并且对于快速测试诸如服务的备用配置文件等内容非常有效。

文件链接由`ln`命令管理。基本语法是`ln [OPTION]`，然后是要在其上创建链接的文件名，最后是链接名。要在您的`home`目录中创建一个名为`fileX`的文件的硬链接，请使用以下代码：

![](img/b405a283-2d42-4d1b-bcb5-60d5074e96d0.png)

如您所见，无法区分附加的硬链接和原始链接。您还可以在同一文件上创建多个链接。要删除硬链接，请使用`rm`命令。每个文件系统或者我们可以简单地说文件都有最大数量的 Inodes，您可以使用`df -i`来显示。如果使用`mount`命令，您将看到用户的`tmp`文件系统位于与`home`目录不同的分区上，而`home`目录又位于根分区上，如下面的屏幕截图所示：

![](img/c09ea1e8-16e4-4157-823d-9592ea0ddb58.png)

因此，下一个命令`ln ~/folderABC ~/folderABC_link`将失败，因为不允许在分区之间创建硬链接。此外，您不能在目录上创建硬链接，更改文件内容的原始位置也将更改硬链接的文件内容。这可能会产生一些不良副作用。要创建符号链接，请使用`ln -s`选项：

![](img/efebda5f-f05f-4675-8195-fe6bf16637cf.png)

如您所见，很容易显示文件是否为符号链接，标有箭头。要在另一个目录中创建文件的符号链接，保留原始文件的名称，您可以使用`ln -s /etc/passwd`。这在当前目录下创建了`/etc/passwd`文件的符号链接，名称相同为`passwd`。要删除符号链接，请使用`rm`命令；原始文件不会被触及。您还可以在目录上创建符号链接。如果删除符号链接指向的原始文件，即`fileX`，这里符号链接将中断。这可能会变得棘手，这在这里用蓝色表示：

![](img/35bdba9a-a00c-4743-b09f-2ddac711b66e.png)

# 搜索文件

在本节中，我们将学习如何在 Linux 中搜索文件。`man find`命令可以根据多种条件查找文件，正如其名称所示。但更重要的是，您甚至可以在程序执行期间对每个搜索结果应用操作，这是一个非常有用的功能。Find 可以采用一些选项来更改其默认行为，例如如何在程序执行期间处理符号链接。前几个参数是要在其中开始搜索的目录或起始点的列表，所有其他参数都是搜索表达式或条件，用于在搜索中查找。讨论搜索表达式的内容很重要。搜索表达式通常是一个测试和一个操作。测试通常由逻辑运算符分隔。如果没有给出运算符，则假定为结束运算符。如果表达式中没有用户指定的操作，则将对搜索结果中的所有文件执行`print`操作。

在开始使用`man find`命令之前，了解`man find`命令如何处理搜索结果非常重要。对于搜索路径列表中的每个文件，所有表达式都会从左到右进行评估。默认情况下，只有当所有表达式都正确时，`man find`命令才会将文件标记为命中。如果需要，您还可以更改此逻辑结束行为，使用`OR`表达式，我们将在其中一个示例中稍后看到。`man find`命令允许您使用广泛的非常有用的文件测试表达式创建非常复杂的搜索查询。如果在`man find`命令的手册页中搜索`tests`，您将获得所有可用测试运算符的完整列表。例如，您可以搜索在过去的特定时间修改或访问的文件，或者具有特定大小的文件。如前所述，默认操作是对每个文件匹配执行`print`操作。另一个非常有用的操作是`exec`表达式，它允许您对每个文件匹配执行特定命令。`man find`命令是一个非常复杂的命令，我们无法在这里展示所有内容。因此，在本节的其余部分中，我们将展示一些非常有用的用例。您可以使用`find`命令而不带任何选项或参数。这与编写相同，因为没有任何选项和参数，搜索路径是当前目录，而默认操作是`print`操作。此命令遍历您当前的目录，并打印出所有文件和目录，包括所有子目录和子目录下的文件，进行递归处理。这是因为您没有提供任何测试表达式，因此它将匹配当前目录中的任何文件或目录，并对其应用`print`操作。如前所述，`find`命令如此强大的原因在于其巨大的不同测试表达式列表，可以根据各种有用的条件定位文件。这样的文件搜索测试可以是任何想象得到的，例如时间戳、用户权限、用户、组、文件类型、日期、大小或任何其他可能的搜索条件。

在以下示例中，我们将使用安装过程中设置的根用户帐户，因为在此示例中，我们需要在系统目录中进行大量搜索，这需要特殊权限。要仅在`/etc`目录中搜索文件而不是目录，以查找文件名为`logrotate.conf`，请使用以下命令：

```
find /etc -type f -name logrotate.conf  
```

如果找到文件，您将不会遇到任何错误。此命令在后台执行的操作是遍历`/etc`目录，并选择其中包含的所有文件和子目录，并逐个递归处理它们。然后，对于每个文件，它都会检查文件是否为实际文件，以及名称是否等于文件名。您还可以使用多个目录作为搜索起点，以及使用`-type d`仅搜索目录，这将打印以`/etc`和`/var`目录开头并以字母`y`开头的所有子目录名称：

![](img/1be45990-ff19-4f1e-b07a-8571163036bc.png)

在这里，名称表达式采用正常的 POSIX 5 通配符，而不是正则表达式。如果您想要使用正则表达式进行文件搜索，请改用`-regex`表达式。请注意，如果您使用`-iname`表达式，它将进行不区分大小写的搜索。您还可以按文件大小作为条件搜索文件：

![](img/94378bbd-41cb-4999-8117-71cebab507ac.png)

`find / -type f -size +4M -name 'l*'`搜索以名称`l`开头的大小等于或大于 4 MB 的所有文件，只有文件而不是以`root`目录开头的目录，这意味着它将递归搜索整个文件系统树。正如您所看到的，只有两个文件符合所有这些条件。顺便说一句，`+`表示大于或等于，如果使用`-`符号，则表示小于。您还可以搜索特定的文件权限。文件权限通常在后面的部分中讨论。要获取具有读、写、执行权限的所有非常危险目录的列表，以便在整个文件系统中搜索，我们使用以下命令：

```
find / -type d -perm 777  
```

请注意，如果用户没有为`find`命令本身提供任何操作，则假定默认的`print`操作，因此该命令将将每个匹配的文件打印到`stdout`命令行。我们可以使用`-exec`操作表达式进行更改，该表达式将在`-exec`表达式之后为每个匹配的文件应用一个命令：

```
find / -type d -perm 777 chmod 755 {} ;  
```

在我们的示例中，`chmod 755`命令将应用于每个匹配的文件，使用占位符`{}`，表示匹配。此处的`find`命令将搜索所有具有非常危险的文件权限`777`的文件，并将其更改回更适度的权限`755`。因此，如果我们再次搜索危险的权限，结果将为空。为什么我们必须转义分号？这是因为在 Bash shell 中，分号通常用于分隔命令，因此我们必须在这里禁用其特殊含义。到目前为止所示的所有示例中，单个`find`命令的所有测试和表达式都必须为 true，文件才能被视为匹配。

例如，命令`find / -type f -size +4M -name 'l*'`只有文件匹配并打印出来，如果它们是文件类型并且大小为`4` MB 或更大，并且名称以`l`开头。所有这三个测试表达式都必须为`true`，并通过逻辑与连接。默认情况下，逻辑 AND 运算符连接所有测试表达式，这意味着只有当所有测试表达式都为 true 时，文件才能匹配为命中。您可以轻松地将逻辑 AND 更改为逻辑 OR，使用`-or`表达式，例如：

```
find / -type f -name p*.conf -or -name 'p*.d'  
```

这将匹配所有以`p`开头并在`/etc`目录中具有`conf`或`.d`扩展名的文件，并且类型为文件。还有一些基于文件时间的非常有用的测试表达式。例如，`find /var -mtime 10`| head 将输出所有在最近三天内修改的文件，仅在最后三天或更长时间之前输出前`10`个命中。使用基于时间的测试表达式非常有用，并且通常在您作为系统管理员的日常工作中需要。例如，如果您需要删除服务器上运行的 Web 应用程序的用户上传的所有文件，这些文件的年龄超过`30`天，可以执行以下操作：

```
find /var/www/webapp-uploads -mtime +30 -exec rm {} ;  
```

此命令也可以轻松地放入每天运行的脚本中，例如在`Cron`作业中，以自动删除所有早于`30`天的文件，因此您不必再手动处理此问题。要搜索整个文件系统中以`l`和`r`开头且大小在 1 到 4 MB 之间的所有文件，请使用：

```
find / -type f -size +1M -size -4M -name 'l*'  
```

您还可以使用`locate`命令快速搜索文件，而不是使用 find。您首先需要使用`package`和`locate`进行安装。`locate`命令不会在文件系统中进行实时搜索，而是使用特定时间点的文件系统快照。该数据库每天在特定时间点进行更新，但您也可以使用以下方法自行重新生成快照数据库：

```
updatedb  
```

现在，如果您使用`locate`命令，它将搜索您刚刚生成的数据库，查找所有与名称`logrotate`匹配的文件。这只会搜索文字。如果要使用正则表达式，可以使用`--regex`选项。

由于我们正在搜索一个数据库，这通常比使用`find`命令进行实时搜索更快，但请记住这不是当前文件系统的实时状态。因此，当搜索比搜索数据库更新的文件时，可能会遇到问题。

# 与用户和组一起工作

在这一部分，我们将学习如何创建和删除用户和组，以及如何将组添加到用户中。此外，我们将了解 Linux 如何在内部存储用户信息和密码，以及如何以编程方式检索用户信息。最后，我们将学习如何在登录的同时替代用户账户。Linux 是一个多用户系统，这意味着多个用户可以同时使用系统。因此，需要一个系统来保证对 Linux 对象（如文件）的共同访问，使用过度保护的措施。例如，一个用户创建的所有文件不应该被另一个用户删除。每个 Linux 用户都由唯一的用户 ID 定义和识别，因为人类更容易使用名称而不是数字。每个用户 ID 还有一个文字用户名，但在 Linux 内部处理 Linux 对象（如文件）的控制时，使用的是用户 ID（UID）号码。有两种类型的用户账户，需要密码进行身份验证的登录用户和非登录用户，后者对于将用户 ID 附加到正在运行的程序或进程非常有用，我们稍后会看到。此外，每个 Linux 系统都有一个特殊的账户，即根用户账户或管理员账户，在安装过程中我们会为其设置密码。每个系统上的这个账户都可以访问并拥有所有对象，如 Linux 系统中的文件，并且可以对系统进行任何操作。如果在 Linux 中我们使用用户名来控制访问文件，那将非常限制和耗时来授予或撤销权限。因此，Linux 还有组的概念来进行访问控制。使用组可以通过将权限分配给一个组来大大简化权限管理，而不是分配给单个用户。将权限分配给一个组会将对资源的相同访问权限分配给该组的所有成员。Linux 组也由一个组 ID 表示，这是一个数字，但也可以通过其名称（组名）来引用。Linux 中的每个用户都有一个 UID，但可以属于多个组或组 ID。一个组是主要组，在该用户创建新文件时将使用该组。

让我们从为我们的测试创建一些新用户帐户开始。只有`root`可以做到这一点。所以首先，让我们以 root 身份登录。`useradd`命令添加一个以参数给定的用户名的新用户。此命令在系统中创建一个新用户，并创建相应的主目录。为了使我们的新登录帐户可用，我们还需要设置密码；我们可以使用`passwd`命令来做到这一点。您也可以使用此命令来更改自己的密码。要为其他用户设置或更改密码，我们输入`passwd` `用户名`-这只能使用 root 用户帐户来完成。要删除用户，请使用`userdel`命令。默认情况下，`userdel`命令不会删除用户的`home`目录，因此您必须自己执行此操作。要删除用户，最好使用`userdel -r`标志，它不仅会删除用户，还会删除相关的`home`目录和邮箱。让我们重新创建用户。让我们退出 root 用户。您可以使用`su`命令或替代用户命令在登录时切换用户。当您调用`su`命令而没有任何参数时，假定已切换到 root 用户。要将替代用户切换到不同的用户，您使用用户名作为第一个参数。您可以使用`whoami`命令重新检查谁已登录。使用`su`命令将保留执行`su`命令的用户的原始环境，并且不会切换到替代用户帐户的 home 用户。

现在，让我们退出替代用户，并切换到另一个用户。使用`su`命令并带有破折号作为参数，我们创建一个更类似登录 shell 的环境，这意味着它的行为更像一个真正登录到 shell 的用户。通过执行`pwd`命令，您可以看到`home`目录已经更改为替代用户的`home`目录。现在再次退出替代用户。您还可以使用`su -c`标志直接使用另一个用户帐户执行单个命令；`su`用户名`-c`。如果您想要快速使用不同的用户帐户启动脚本或命令，而不完全切换用户，这将非常有用。

只有 root 用户被允许使用`su`命令在不提供密码的情况下替代用户。任何其他想要使用`su`命令的用户都需要知道替代用户的密码。

`useradd`和`passwd`命令正在对`etc/passwd`和`etc/shadow`文件进行更改，这些文件是整个 Linux 系统中存储身份验证和用户信息的最重要的文件。`passwd`文件存储了系统中所有已知的用户帐户列表，所有登录用户和所有系统用户。登录用户通常是可以使用密码进行身份验证登录到 shell（如 Bash shell）的典型物理人员。系统用户通常无法登录到 shell，并且通常与系统服务和进程相关联。

例如，要获取 Linux 系统中所有可用用户名的列表，请使用：

```
awk -F: '{print $1}' /etc/passwd  
```

`passwd`文件存储了许多有用的信息，例如用户的`home`目录、默认 shell 或用户 ID 号。请参阅`passwd`命令的手册页以获取更多信息。`/etc/shadow`文件以加密格式包含所有用户的密码信息。您需要 root 用户帐户才能查看此文件。要创建新组，请使用`groupadd`命令，要删除组，请使用`groupdel`命令。`groupadd`和`groupdel`命令在内部使用`/etc/group`文件。此文件显示系统中所有可用的组以及与这些组关联的所有用户 ID。除了读取`/etc/group`或`/etc/passwd`文件以获取有关用户的信息外，还可以使用`id`命令。这将告诉您用户 ID、组 ID 以及用户拥有的所有关联组。要将现有组添加到用户，可以使用`usermod -G`命令。`-G`会覆盖用户拥有的所有次要组，保留主要组不变。您还可以定义要添加到用户名的逗号分隔的组名称列表。重要的是要记住，`-G`始终会覆盖用户拥有的现有组名称。

现在，让我们检查`权限字符串`，它指定了文件所有者、组所有者或任何其他用户根据其身份允许或不允许做什么：

![](img/d1323c58-f325-4612-b11a-40cd1103020b.png)

`-l`在第三列中输出文件所有者。在这里，它是`root`，对于这个文件是`olip`。在第四列中，`ls -l`输出文件的组所有者。同样，在这里是`root`，在这里是`olip`。您已经知道`ls -l`输出中的第一个字符是文件类型。现在，`l`和`d`之后的九位定义了文件的权限字符串。权限字符串的前三个字符定义了文件所有者的权限。权限字符串的第二个三位定义了组所有者的权限。权限字符串中的最后三位定义了所有其他用户的权限。在这个例子中，`folderABC`的文件所有者是`olip`，组所有者是`olip`。此外，文件所有者`olip`对目录有完全权限，组所有者`olip`对目录有完全权限，所有其他用户对此目录有读取和执行权限。

执行以下步骤：

1.  首先，让我们创建一个目录。我们将放入一些文件以便处理，然后切换到该目录：

![](img/322825a2-110b-4558-a1a9-bd7df470bf33.png)

1.  现在，让我们创建一些文件来玩耍。

1.  让我们看看我们刚刚创建的文件的文件权限。

1.  如前面的屏幕截图所示，root 用户已创建了所有这些文件。因此，所有文件的文件所有权和组所有权都是`root`。

1.  现在，要更改文件所有权和组所有权信息，您可以使用`chown`或`chgrp`命令。

1.  您还可以使用不同的表示法使用`chown`命令，而不是使用`chgrp`命令。

1.  例如，要更改文件的组，您可以修改文件所有者和组所有权。

1.  让我们也创建一些子文件夹来测试目录权限。

1.  也将一些文件放入这些文件夹中。

1.  接下来，让我们使用一些非常危险的`test`目录，以便在我们的测试期间每个人都能正确地使用文件。这不是为了生产。

1.  接下来，为我们的文件创建一些常见权限。

1.  创建一些不寻常的权限，还为目录测试创建一些权限。

1.  更改一些文件的所有权权限和目录的组所有权权限。

现在，让我们使用我们的新文件并更改权限。让我们首先查看`ls -l`命令的输出：

![](img/89a45fbe-4360-4d1a-9546-ae79655018b2.png)

文件一是一个对任何人都有完全读、写和执行权限的文件。例如，系统中已知的任何用户都可以修改这个文件。下一个文件是在 CentOS 7 机器上创建时每个文件都会得到的标准权限。文件所有者有读和写权限，而组和所有其他用户只有读权限。让我们看看如果不同的用户想要修改文件会发生什么：

![](img/15ca13bd-6901-464a-a826-322091874ed1.png)

在这里我们可以看到一些有趣的事情。`root`用户对任何文件都有读、写和执行权限，尽管在`root`用户的权限字符串中已经设置了。`Peter`是文件所有者，所以他可以写入这个文件。`Paul`既不是文件所有者也不是组所有者，所以他根本没有写权限。下一个文件有一个经常用于机密文件（如密码文件）的权限。通常这是为了运行文件系统用户帐户的服务来保护其他人不读取凭据：

![](img/54105fbf-0f46-41c6-84cd-95a6cf81d6d8.png)

在这个例子中，只有`root`用户有能力读取文件，其他人都没有。下一个文件有一个常见的权限设置，如果不仅文件所有者，而且文件所属组的成员也应该对文件拥有完全控制权。正如你所看到的，`Peter`和`Paul`无法写入这个文件，因为他们既不是文件所有者也不是组所有者。为了改变这一点，让我们把`Peter`添加到拥有这个文件的组中，然后再次测试：

![](img/f5e58430-c579-4a7b-a32b-38791ef28882.png)

现在，`file5`有一些不寻常的权限，这是有效的。`file5`是一个脚本文件，打印一些东西。正如你所看到的，只有`root`用户可以执行该文件。要让`Peter`执行该脚本，将与之关联的组之一添加到文件中。这仍然不起作用，因为现在`Peter`可以执行这个文件，但不能读取它。为了改变这一点，还要为文件的组所有权添加读权限。现在，`Peter`终于能够运行脚本了：

![](img/c12d9566-17a9-45a4-ad6b-c546448c45c0.png)

最后，一个常见的误解是，要删除一个文件，你需要正确设置用户的文件写权限标志，但这是不正确的，正如我们所看到的。为什么`Peter`不能删除这个文件，即使我们已经给了每个人完全的权限？这是因为文件的删除完全取决于要删除的文件所在目录的写权限，而不是任何文件权限。以下截图显示了用户`Peter`被拒绝删除文件的权限：

![](img/3f4d9349-d4fb-4101-8566-171c1c673dc0.png)

最后，让我们讨论目录权限。以下截图是一个例子：

![](img/57e6ce49-71ac-46a5-bc88-fbccfed423b3.png)

`folderA`对文件所有者有读权限，所以只有他能够看到文件夹里面的东西，但不能进入该目录。`folderB`只对组所有者有读权限，这意味着只有`projectA`组的成员才能进入这个目录，但`Peter`除了使用`cd`命令进入这个文件夹之外什么都不能做：

![](img/1f32ce42-c0f1-4e3a-848e-f2fca00ca2f4.png)

为了列出这个目录中的文件，让我们将读权限授予组所有者：

![](img/51269d51-81b5-48f1-aab1-31f17633966b.png)

正如我们之前学到的，我们需要在目录上启用“写”标志，以便在其中创建或删除新文件。但为什么这里不起作用呢？这是因为我们还需要在目录上启用执行权限，这是有道理的，因为为了在目录中创建或删除文件，我们需要访问该目录。如果我们想要更改很多文件的权限，例如整个子目录树，我们可以怎么做？使用`ls -lR`标志，我们可以列出所有包括的子目录和文件。现在，要更改子目录中所有文件的权限字符串，可以使用`chmod -R`标志：

```
ls -lRchmod 775 -R ../test_files  
```

一如既往，要小心递归标志，因为你很容易会将整个文件系统的文件权限更改为不安全的不可逆转的权限。

# 处理文件权限

在本节中，我们将学习 Linux 中文件访问控制的概念。我们还将学习和理解如何读取文件权限。最后，我们将学习如何更改文件所有权以及文件权限，并向您展示实际的文件权限示例。如果使用`ls -l`打印文件的详细信息，您将看到一系列不同的重要文件属性，我们需要学习以便理解文件权限。典型的`ls -l`输出看起来像`-lrwxr-xr-x olip administrator my-awsome-file.txt.` 系统中的每个文件都与一个用户名关联，也称为文件所有者。

每个文件还与一个组名关联，也称为组所有者。文件的所有权只能由 root 用户更改。文件所有权也可以由文件所有者更改。当用户创建新文件或目录时，文件的所有权将设置为创建文件的用户 UID。我们已经知道用户可以属于多个组，但需要设置一个作为主要组。这就是为什么每个新创建的用户都有一个与用户名相同的组。现在，每个想要访问文件的 Linux 用户都可以被归类为这些组中的一个。如果用户 ID 与要访问的文件的所有者 ID 匹配，用户就是文件所有者。如果用户与文件想要访问的组所有者匹配，用户就是组所有者。如果用户既不是文件所有者也不是组所有者，他就属于其他用户类别。这三个权限类别也称为权限组。最后，所有这些权限组，文件所有者、组所有者和其他组，每个都有三种权限类型，读、写和执行。这些权限类型管理着属于这些组之一的用户可以或不能对文件执行的实际操作。

现在，因为我们正在处理每个文件的大量不同信息，用户所有者、组所有者、权限类别和权限类型，一些 Linux 命令（如`ls`命令）使用了一种非常紧凑的形式来查看，使用了 9 位来完全映射所有权限组的所有权限。这 9 位信息也称为权限字符串。如果授予了读/写/执行权限，或者`rwx`标志被放置在字符串中的固定位置。如果权限被撤销，可以在字符串的特定位置找到破折号符号。在权限字符串中，从左到右，前三位是文件所有者的读/写/执行权限。接下来的三位是组所有者的，最后的三位是所有其他用户的。9 位权限字符串是一种非常紧凑的表示法，以适应屏幕，并来自计算机硬件中空间和内存昂贵的时代。对权限类型或 9 位权限字符串的更改只能由 root 用户设置或移除。文件和目录上的读、写和执行权限的定义是不同的。

首先讨论文件上下文中的读取、写入和执行的含义。如果文件上设置了`r`或读取标志，则相应的权限类别，文件所有者、组所有者或其他用户可以打开文件并读取其内容。`w`或写入标志用于修改或截断现有文件，但需要知道的一个常见误解和重要事实是，写入标志不允许创建新文件或删除现有文件。这不是文件的属性，而是父目录的属性，我们很快就会看到。`x`或执行标志允许执行文件。这对于在命令行上运行脚本文件或命令非常重要。

为了执行文件以将其作为脚本或命令运行，需要同时设置读取标志，因为 shell 需要读取文件的内容以执行其指令。在目录上下文中，读取、写入和执行权限的含义与在文件上工作时完全不同，这是每个 Linux 用户都必须意识到的。

首先从目录的`x`或执行权限开始，因为这是文件夹最重要的权限。在目录上下文中，`x`或执行权限的含义与文件上下文中完全不同。如果文件夹上设置了执行标志，这意味着相应的用户组或其他用户被允许进入该目录或路径，例如，使用`cd`命令。但`x`标志不仅对`cd`命令很重要，如果您需要使用写入标志重命名、删除或创建新文件，这也是必需的。在这里，执行标志也是必需的。作为一个经验法则，如果您需要在文件夹上设置一些标准权限，永远不要错过所需工作的权限组的执行权限，否则您将遇到问题，因为如果要执行某些操作，您总是需要进入目录。`r`或读取是读取目录内容的权限，例如，使用`ls`命令。

`w`或写入标志在目录中创建新文件或删除现有文件。正如我们之前所看到的，删除或创建新文件不是文件权限的属性，而是始终是文件所在目录权限的属性，因此如果要能够在其中创建或删除文件，则必须设置写入标志。为了使用写入标志创建、删除或移除文件，我们还需要为诸如`touch`或`rm`的命令设置执行标志，因为它们需要访问目录以执行操作。

现在，每个想要执行操作的实际用户，即读取、写入或执行文件或目录的用户，都将由操作系统检查，检查的依据是尝试访问是否合法。这是一个分层过程。首先进行的检查是用户 ID 是否与文件的用户所有者匹配。如果不匹配，将检查用户的所有组 ID 是否与文件的组所有权匹配。如果没有用户组匹配，将使用其他用户。现在，系统中的每个用户都匹配这三个权限类别中的一个。如果找到了正确的类别，将检查相应的三种权限类型，即读取、写入和执行，以查看它们是否被允许，以及它们是否与用户的尝试读取、写入或执行操作匹配。

使用基于八进制计数系统的快捷方法来更改 9 位权限字符串中的值是最好的。请注意，还有另一种可用的表示法，它使用短选项，如`-`、`+`、`r`、`w`和`e`，我们在本节中不讨论。您可以使用`man chmod`查找它。使用 0 到 7 之间的数字，这是八种不同的状态，因此可以称为八进制表示法，我们可以为每个权限类别（用户所有者、组所有者或其他用户）定义每种可能的读、写和执行组合。

以下是`chmod`的八进制表示法：

+   `0`：使用`0`，不允许读、写或执行权限

+   `1`：它表示只有执行权限

+   `2`：它表示只有写权限

+   `4`：它表示只有读权限

+   `3`：它表示执行和写权限的组合

+   `5`：它表示只有执行和读权限的组合

+   `6`：它表示只有写权限和读权限的组合

+   `7`：它表示完全权限或读、写和执行权限

因此，我们可以只使用三个数字轻松表示所有三个权限类别的权限类型。第一个数字表示文件的用户所有者的读、写和执行权限。第二个数字表示组所有者的所有文件权限，第三个数字表示系统中所有其他用户可用的所有读、写和执行权限。例如，八进制权限`777`表示系统中所有用户的读、写和执行权限。权限`775`表示文件的用户所有者的读、写和执行权限，文件的组所有者的读、写和执行权限，以及系统中所有其他用户的只读和执行权限。权限`660`表示文件的用户所有者的读和写权限，文件的组所有者的读/写权限，以及系统中所有其他用户根本没有权限，这意味着他们无法读取、写入或执行此文件。

由于我们在上一节中创建了一些新用户`Peter`和`Paul`，并分配了`project_a`和`project_b`组，现在让我们来实际工作和实验实际文件权限：

1.  由于我们在本章中正在处理权限，首先以 root 用户登录。

1.  现在，让我们首先创建一个目录，在其中放入一些文件以便使用：

```
mkdir test_files  
```

1.  然后切换到这个目录：

```
cd test_files  
```

1.  现在，让我们创建一些文件来玩：

```
touch file1
touch file2
echo "my_secret_pa$$worD" > file3
touch file4
printf '#!/bin/bashnecho "EXEC"' > file5  
```

1.  让我们使用`ls-l`查看文件权限。

现在我们知道，每个文件都有一个文件所有者，在`ls -l`输出的第三列中可以看到。每个文件的第四列中也有一个组所有者。`ls -l`输出中的第一个字符是文件类型，后跟 9 位权限字符串。

首先，让我们学习如何更改文件的用户所有者。您可以使用`chown`命令更改文件的用户所有者。您可以使用`chgrp`命令更改文件的用户组。让我们再次使用`ls -l`查看已更改的内容：

![](img/baf697f8-c90b-434b-ae88-2fc7d42e0850.png)

如您所见，`file1`和`file3`已更改了用户所有者，`file4`有一个新的组所有者。除了使用`chgrp`命令外，还有一种定义文件组成员资格的替代方法，系统管理员经常使用。它具有以下表示法：

```
chown [username]:[groupname] [file]  
```

这使用冒号来指定文件的用户所有者或组所有者。例如，要仅更改文件的组所有者，请使用：

```
chown :project_b file 4  
```

或者同时更改用户名和组使用：

```
chgrp project_a file 4  
```

让我们也创建一些子文件夹，以便稍后测试目录权限。还将一些文件放入我们新创建的子文件夹中。接下来，让我们对`test`目录使用一些非常危险的权限，以便在我们的测试期间每个人都能正确地使用文件。这不是为了生产而设计的。

正如我们之前学到的，我们将使用`chmod`八进制表示法来改变 9 位权限字符串文件权限。接下来，让我们为我们的新测试文件创建一些常见的权限。同时，为了展示一些东西，创建一些不寻常的权限。还要改变我们测试目录的权限：

![](img/03ed74fc-1212-4fc1-9f4b-f0249bb081ba.png)

最后，为了准备我们的测试，我们还需要改变一些目录的用户所有权权限和组所有权权限。现在，让我们玩弄一下我们新文件和文件夹的权限。`file1`是一个文件，对任何人都有完全的读取、写入和执行权限。这是一个非常危险的权限，在任何情况下都不建议使用，因为任何人都可以修改这个文件：

![](img/125881e6-8deb-4243-847b-ec5c86a4bcc1.png)

正如你所看到的，`peter`和`paul`可以修改这个文件并对其拥有完全访问权限。接下来的`file1`，`file2`，具有标准权限，这是每个文件创建时都会得到的权限。文件所有者可以读取和写入，组和所有其他用户只能读取和执行，但不能修改。

让我们看看如果各种用户尝试写入这个文件会发生什么：

![](img/af16701b-2ede-47f0-935e-e857fc9139dc.png)

正如你所看到的，只有文件所有者可以写入这个文件；所有其他用户都没有写入权限。下一个文件具有经常用于保护机密数据的权限，比如密码文件。

![](img/772a7ffe-bdbc-454b-97f3-a2cabbcd63e7.png)

正如你所看到的，只有文件所有者可以读取文件，其他人无法对文件执行任何其他操作。文件所有者是`paul`。如果你尝试使用各种用户名读取这个文件，你会学到两件事。首先，无论文件设置了哪种权限，root 用户始终可以完全访问文件。其次，除了 root 用户，谁都无法访问这个文件，除了`paul`，他有读取权限，其他人都不行。

下一个文件具有常用的权限设置。不仅文件所有者，而且文件唯一的组的成员应该对文件有完全控制权：

![](img/1534fe40-c894-44a8-b86b-8173b62ab4aa.png)

正如你所看到的，`olip`和`peter`都有对文件的写入权限，`paul`无法访问该文件。`olip`有对文件的写入权限，因为他是文件所有者。`peter`有对文件的访问权限，因为组所有者也有对文件的访问权限，而 Peter 是`project_a`组的成员，也是文件的组所有者组的成员。

现在，`file5`有一些不寻常的权限，这是有效的。`file5`是一个脚本文件，可以打印出一些东西：

![](img/876d52d0-cc77-40b9-a266-c714ca34c026.png)

正如我们所看到的，只有 root 用户有权限执行这个文件。为了执行一个脚本，我们将使用`./`表示法，我们将在另一个部分中看到。为了让`peter`能够执行一个脚本，我们只需将`project_a`组添加到`file5`中，因为我们知道`peter`是这个组的成员。但等等，为什么当`peter`是`project_a`组的成员，而`project_a`有权限执行脚本时，我们会收到权限被拒绝的错误？这是因为为了让 shell 运行一个脚本，它还需要访问读取脚本文件的内容。所以，让我们改变文件的权限，也包括读取标志。现在，用户`peter`能够执行这个脚本了。对于`root`用户，你不需要设置读取权限，因为`root`用户对每个文件都有所有权限，不管权限字符串中说了什么。

最后，一个常见的误解是，为了删除一个文件，你需要为想要删除文件的用户正确设置文件的写入权限标志，但这是不正确的：

![](img/b1c5895b-d3fa-4274-9411-95e7ec5abcd8.png)

如果这是真的，为什么彼得不能删除这个文件，因为我们给了这里的每个人完全的权限？这是因为文件删除完全取决于要删除的文件所在目录的写权限，而绝对不是任何文件权限。所以，在这个例子中，我们想要删除的文件在`root`目录中，对于用户彼得来说根本没有写权限。所以彼得无法删除或创建`/root`目录中的任何文件。

最后，让我们讨论目录权限。让我们首先查看我们的测试文件夹的目录权限。为了这样做，让我们切换到`test`文件夹的目录。让我们首先测试`folderA`上的权限：

![](img/550e69f2-8b8c-4eac-8d91-5ad3b3163622.png)

如你所见，`folderA`只对文件所有者设置了读权限，所以彼得是唯一能够读取`folderA`中所有文件和子文件夹的人；其他人都不能。你还可以看到因为目录上没有设置执行标志，没有人能够进入这个目录。

现在，让我们来看看`folderB`：

![](img/a4588cbc-c587-4585-92eb-22d5f587855a.png)

因为只有`project_a`文件夹上设置了执行权限，而且只有`project_a`组的组所有者设置了执行权限，所以只有彼得作为`project_a`组的一部分才能`cd`进入这个目录，但你不能列出文件。所以，总是将目录上的执行标志与读标志结合起来是一个好主意。对于`folderC`也是如此。首先，让我们试一下是否有人能够在这个目录中写入文件：

```
su peter -c 'touch folderC/a-new-file'  
```

正如你所看到的，没有人可以。如果你查看文件夹权限，这是因为我们的用户都没有对该文件的所有权权限。

所以，让我们将用户所有权设置为用户`olip`。仍然没有运气能够用用户`olip`在`folderC`中创建一个新文件。这是因为为了在目录中创建一个新文件，不仅需要在目录上设置写权限，还需要设置执行权限。如果你想在目录中删除文件，也是如此。最后，我们如何递归地为整个子目录树更改文件和文件夹权限？为了用一个命令递归地更改`folderA`中包含的所有文件和文件夹，使用`chmod -R`标志，它代表递归，并更改作为参数给出的目录中的所有文件和文件夹条目。你也可以对更改所有者命令使用`-R`标志。一如既往，小心使用递归标志，因为你可能会将文件更改为权限。当涉及到理解 Linux 中的权限时，有三件事你需要记住。这三个概念必须从左到右使用。首先，每个文件对于用户所有者、组所有者和所有其他用户，简称`u`、`g`和`o`，都有一组权限状态。对于这些类别中的每一个，都存在三种可能的权限状态，读、写和执行，或`r`、`w`和`x`。读、写和执行可以用八进制数字 4、2 和 1 来表示，分别代表`r`、`w`和`x`。你想要允许的每种读、写和执行的组合都可以用对应的八进制数字值的和来表示。

# 处理文本文件

在这一部分，我们将学习在命令行上打印文本文件内容的所有重要工具。我们还将学习如何使用文本文件查看器查看文本文件。在 Linux 中，存在两种不同的基本文件类型，文本文件和二进制文件。文本文件是配置文件，而二进制文件可以是图像文件或压缩数据文件。文件的编码定义了一个文件应该被视为文本文件还是二进制文件。文本文件通常使用 UTFR。在 Linux 上，文本文件通常使用 UTF-8 或 ASCII 进行编码。你可以使用`file`命令来检测文件类型，比如：

```
file /etc/passwd 
file ~file4.tar.gz  
```

要打印出文本文件的内容，可以使用`cat`命令。`cat`代表连接，这也是命令名称的原因。因此，让我们连接一些文件，并将结果放入新文件中，通过重定向`stdout`：

```
cat /etc/passwd /etc/grp /etc/services > /tmp/concatenated-file  
```

这一行将三个文件`passwd`，`group`和`services`连接到`/tmp`目录中的名为`concatenated-files`的新文件中。有时，使用`cat`打印整个文件的内容纯粹是过度的。如果我们只对文件开头或结尾的一些行感兴趣，可以使用`head`或`tail`命令。文件的开头有时也被称为文件头，而文件的结尾也被称为文件尾。要显示我们的新连接文件的前`10`行，请使用：

```
head /tmp/concatenated-file  
```

或者，如果您只对我们的新文件的最后 10 行感兴趣，请改用：

```
tail /tmp/concatenated-file  
```

要更改`head`和`tail`默认的打印前 10 行的行为，请使用`-n`选项。Head 和 tail 还有其他非常有用的选项，请使用手册页了解更多。一个更重要且经常使用的功能是使用`tail follow`选项。例如，使用`root`帐户的`follow`选项，`-f`标志保持`tail`命令打开，并且 tail 将不断监听新的文件内容，并在`var/log/messages`文件追加新文本时输出。如果您需要对永久写入的文件进行实时查看，这个命令需要被记住。要关闭 tail 程序，请使用“Ctrl”+“C”：

```
su root -c 'tail -f /var/log/messages'  
```

现在，要阅读文件的内容，可以使用`cat`命令来处理较小的文件。对于较大的文件，最好使用真正的文本查看程序，例如`less`，它具有一些强大的功能，如搜索、滚动和显示行号。学习如何使用 less 命令导航文本文件也非常有用，因为许多 Linux 命令都使用 less，也称为较少导航，以浏览页面或设置的文本内容，我们稍后将看到。要使用 less 打开文件，可以使用 less，然后文件名作为参数。除非使用管道，否则也可以直接使用`stdout`，这非常有用，因此我们可以轻松地导航和滚动较长的命令输出，这些输出无法适应屏幕。在 less 中导航非常简单，应该被记住，因为您将在 Linux 职业中经常使用它。还有很多要学习的。阅读 less 命令的手册页以查看所有可用选项。

以下是执行许多移动操作的方法：

+   要向下滚动一行，可以使用箭头键或“J”键。在这里，我们将每个操作只展示一个键盘选项。

+   要退出 less 命令，请使用“Q”键。

+   大写的*G*滚动到文件末尾，而小写的 g 滚动到文件开头。

+   按下箭头键可以逐行向下滚动。

+   按下箭头键可以逐行向上滚动。

+   按下“Page Down”键向下滚动一页，按下“Page Up”键向上滚动一页。

+   按下右箭头键可以向右滚动更长的行；要向左滚动，请使用左箭头键。

+   按下“Ctrl”+“G”以在页面底部显示文件信息。

+   按下“Return”键退出文件信息字段。

+   键入斜杠键，然后输入搜索词，例如`HTTP`，然后按下“Return”键进行前向搜索文件中的关键词`HTTP`。

+   按下“n”键将跳转到下一个搜索结果。按下大写的“N”键将跳回到上一个搜索结果。

+   请注意，如果搜索模式全部为小写，则搜索是不区分大小写的；否则，它是区分大小写的。例如，如果搜索的单词`HTTP`全部为大写字母，它只会找到确切以区分大小写形式的 HTTP。

+   现在，按下大写的“G”跳转到文件末尾。

+   使用斜杠键进行正常搜索会从文件顶部到底部搜索关键字。

+   如果您想要从底部向顶部搜索关键字，可以使用问号运算符，问号键，然后是关键字。

+   按下*n*键跳转到文件中的下一个更高搜索结果。按下大写*N*跳转到搜索结果的最后形式。

+   `Less -N`以行号模式启动 less，这意味着每一行都以相应的行号为前缀。

+   要转到特定行号，例如，第 100 行，输入行号后跟`g`，或者要转到第 20 行，输入`20g`。

+   要查看文本文件而不进行编辑，也可以使用 VIM 编辑器。

+   要以只读模式启动 VIM，输入 view 空格，然后是文件名。

+   我们将在下一节中使用 VIM 编辑器。

# 使用 VIM 文本编辑器。

在本节中，我们将学习如何安装 vi 改进版，简称 VIM，文本编辑器。我们还将学习使用 VIM 的所有基础知识。可以想象的最简单的文本编辑器之一是，这将创建一个名为`my-lorum-file`的新文件，其中包含`lorem ipsum dollar sit`，或者您可以使用`cat`命令交互式地创建一个新的文本文件

```
Another Line
this is the third line
EOF  
```

使用大写的字符串`EOF`停止向该文件写入。现在，如果您需要创建只有几个单词或几行文本的文本文件，`echo`和`cat`命令非常有用。如果您需要编辑更大的文本文件或想要编写自己的文件，例如项目的 read-me 文件，最好使用真正的文本编辑器。Linux 中可用的文本编辑器之一是 VIM，或者改进的 vi，它是每个 Linux 发行版都可以使用的非常强大的文本编辑器。它允许无鼠标文本编辑，一旦您熟练掌握 VIM，您就可以真正开始以思维的速度输入或编辑文本文件。但是，精通 VIM 可能需要几个月甚至几年的时间才能真正掌握，因为 VIM 是一个非常复杂的编辑器，具有许多不同的快捷键和功能。因此，我们无法在本节中展示所有内容，而只能展示基础知识，以便您可以快速开始使用 VIM。

VIM 是 vi 的改进版本，完全兼容 vi，vi 是上世纪 70 年代开发的 UNIX 文本编辑器。在 CentOS 7 最小安装中，默认情况下不安装 VIM。因此，让我们从安装 VIM 编辑器开始- su root -c 'yum install vim -y'。您可以使用文件名作为参数打开 VIM，也可以不带文件名打开，稍后保存文件名。VIM 最基本的概念是其模式。有三种不同的模式。插入模式、命令或正常模式和 ex 模式。以下截图显示了不同的模式：

![](img/de5683ce-09ec-46f8-89b4-48320eb698f3.png)

当您打开 VIM 时，您会进入正常或命令模式。从任何模式，您都可以通过按*Esc*键返回到正常模式。如果您不知道当前处于哪种模式，这非常有用。只需按下*Esc*键，您就会始终处于正常模式。从那里，您可以切换到插入或 ex 模式。有几个键可用于启动插入模式。按下*i*或*o*键将您从命令或正常模式带入插入模式，您可以在那里开始输入文本。如果您完成了输入文本，或者想要执行另一个正常模式命令或`ex`命令，请按*Esc*键返回正常模式。从那里，如果您按冒号键，您将进入 ex 模式。从那里，按下*Return*或*Esc*键将您带回正常模式。插入模式用于输入或插入文本。在插入模式中，每次按键都会在编辑器中打印。如果您想要导航光标或执行诸如复制和粘贴、删除行、文本搜索、撤消、重做等操作，您需要切换到正常模式。在正常模式中，每次按键都是一个命令。Ex 模式用于执行`ex`命令，例如，跳转到文件中的某一行，或者在整个文件中进行替换文本。

现在，我们将开始实际使用 VIM。首先，要退出编辑器，在正常模式下按以下顺序，按`:q!`，然后按*Return*键。如果你不在正常模式下，例如，你在插入模式下，那么你首先要按*Esc*键，然后`：q!`，然后按*Return*键退出 VI。现在，让我们用`/etc/services`文件再次打开 VIM。

让我们首先讨论基本的光标移动命令。光标移动命令只能在正常模式或命令模式下执行，这是启动 VIM 时的默认模式。如果你在其他模式下，比如插入模式，按*Esc*键进入正常模式。现在，要移动光标，你可以使用各种键盘快捷键：

+   要将光标向右移动，使用*l*键

+   要将光标向左移动，使用*h*键

+   要向下移动光标，使用*j*键

+   要向上移动光标，使用*k*键

+   你也可以使用箭头键来执行前面的操作

+   将光标移动到行尾，按*$*键

+   要将光标移动到行首，按*0*键

+   要向前移动光标一个单词，使用*w*键

+   要向后移动光标一个单词，使用*b*键

+   要跳转到文档末尾，使用大写*G*键，这也是 less 文本文件查看器中用于跳转到文档末尾的相同键

+   要跳转到文档开头，输入`gg`

+   这也类似于 less 命令，其中你使用小写`g`一次跳转到文档开头

+   要跳转到特定行号，请输入行号；例如，第 100 行，然后跟一个大写*G*

+   在 VI 编辑器中搜索文本模式基本上与在 less 文本查看器中搜索文本相同

+   使用/关键字后跟回车键开始向前搜索

+   按小写*n*跳转到下一个搜索结果

+   按大写*N*跳转到上一个搜索结果

+   要开始向后搜索，首先按大写*G*到文档末尾，然后使用熟悉的问号关键字进行搜索，按*Return*键从底部到顶部开始文本搜索

+   按*n*跳转到下一个更高的搜索结果，按*N*跳转到文档底部的下一个更低的搜索结果

+   现在，再次跳转到文件开头

在正常模式中一个非常有用的功能是在特定行设置标记以供引用。例如，首先转到行域。要在特定行设置标记，输入字符`m`，然后再输入从 a 到 z 的另一个字符。例如，输入`ma`。这将在以域开头的行中创建一个新的标记，由字符 a 引用。在以域开头的当前行，如果我们在文件中的其他位置，例如，按页向下滚动，然后现在使用引号字符后跟表示我们标记的字符，例如`'a`，我们将跳转回到我们设置引用标记`a`的行。如前所述，你可以从 a 到 z 设置多个标记，所以让我们添加另一个标记。只需转到另一行，例如 saft 行。现在，我们将使用`b`作为我们的标记。让我们创建一个标记，输入`mb`。现在，如果你转到文件中的其他位置，比如 fido 行，只需输入`'b`即可滚动回 saft 行。输入`'a`返回到域行。就是这么简单。

现在我们已经学会了在正常或命令模式下的基本移动命令，让我们现在转而学习一些正常模式下的删除命令。按下*x*键将删除光标下的字符，同时保持在正常模式下。连续按两次`dd`键将删除一行并将已删除的文本放入复制缓冲区。d 键也可以与其他键组合以实现高效的文本删除。使用`dw`删除光标下的当前单词。您甚至可以将`dw`命令与数字结合使用，例如要删除接下来的五个单词，请键入`5dw`。您已经知道，为了跳转到行尾，您使用*$*，而要跳转到行首，您使用*0*。如果要从当前光标位置删除到行尾，请使用`d$`。另一方面，如果要从当前光标位置删除到行首，请使用`d0`。

现在，让我们来看看已删除文本的撤消和重做命令。按下 u 键可以撤消上次的更改。对于每个撤消步骤，您也可以使用*Ctrl* + *R*执行相应的重做步骤。现在，对于复制和粘贴命令，只需复制和粘贴完整的行类型`yyp`。要复制多行，首先标记要复制的所有行。为此，按下*Shift* + *V*开始标记，然后按下向上或向下箭头键选择要复制的所有行。现在，按下*y*键复制您的文本，然后按下大写*P*插入您复制的文本。

您还可以剪切文本。要剪切文本行，首先使用大写*V*标记您的文本。现在，不要使用*y*键来复制文本，而是按下大写*C*键剪切文本。请注意，剪切文本将使您进入插入模式。要粘贴文本，您需要返回到正常模式；因此，现在按下*Esc*键。要在其他地方粘贴文本，请使用大写*P*键。

现在我们已经讨论了正常或命令模式下的所有基本命令，让我们转到插入模式。有几种方法可以从正常模式切换到插入模式。通常，要进入插入模式，您可以使用小写的*i*和*o*以及大写的*O*键。按下小写的*o*在光标后插入新行并进入插入模式。按下大写的*O*在光标前插入新行并进入插入模式。按下*i*会在光标后立即进入插入模式，而不插入新行。

最后，让我们讨论`ex`命令。让我们首先对文件进行一些更改。现在，为了执行`ex`命令，我们首先需要进入正常模式，从插入模式按下*Esc*键，然后按下冒号键开始输入`ex`命令。例如，要写入文件，请键入`w`。这将把您的更改写入并保存到文件中。您还可以使用`:`输入`ex`命令，然后按`wq`写入并退出 VIM 编辑器。

现在，让我们再次打开 VIM。要离开编辑器，请按`:q`，然后按*Return*键。如果您没有进行任何更改，这将离开编辑器。现在回到 vi 编辑器。使用`q ex`命令并按回车键只有在您没有对文件进行任何更改时才有效。让我们更改文件。现在，如果您想在对文件进行了一些更改的情况下离开编辑器，使用 ex 命令`q`将通知您即将离开编辑器而不保存更改。因此，如果您想在不保存更改的情况下退出编辑器，只需键入`:q!`。现在，从终端返回到服务文件。另一个非常有用的 ex 命令是在 vi 编辑器中执行命令行上的命令。这可以通过使用`ex`命令感叹号然后是您想要在命令行上执行的命令来完成，例如`ls`。这将切换到命令行并呈现结果；然后如果您按回车键，您将返回到编辑器。另一个非常有用的 ex 命令是`sh`命令。在`ex`命令中键入`sh`将在后台继续运行 VI 的情况下切换到命令行。在这里，您可以像在命令行上一样执行命令。如果您完成了命令行上的工作，可以通过键入`exit`返回到 VIM 编辑器。

要搜索和替换单词，VIM 为我们提供了一种类似集合的替换模式：

1.  如果您想要在整个文件中用单词`echo`替换为单词`hello world`，请使用以下命令：

```
:%s/echo/HELLOWORLD/g  
```

1.  要启用行号模式，请键入`set number`。

1.  要转到特定行，请在 ex 模式下键入行号。

1.  要离开行号模式，请键入`set nonumber`。

1.  要在 VIM 中打开不同的文件，请键入`e`，然后是文件名。

1.  要将文件另存为不同的名称，请键入`w`，然后是不同的文件名，例如`my-test-file`。

# 总结

在本章中，我们广泛讨论了 Linux 文件系统，其中包括文件链接、文件搜索、文件权限、用户和用户组以及 VIM 文本编辑器。我们还深入研究了每个概念的功能。

在下一章中，我们将介绍如何使用命令行。
