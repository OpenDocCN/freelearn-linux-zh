- en: Chapter 2. Troubleshooting Commands and Sources of Useful Information
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第2章。故障排除命令和有用信息的来源
- en: In the first chapter, we covered troubleshooting best practices and the high
    level process involved. Where the first chapter was a 20,000 ft view on troubleshooting,
    this chapter starts to dive into the specifics.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在第一章中，我们介绍了故障排除的最佳实践和涉及的高级流程。第一章是对故障排除的20,000英尺视图，而本章开始深入具体内容。
- en: This chapter will review common troubleshooting commands as well as common places
    to find helpful information. Within this book, we will utilize release 7 of Red
    Hat Enterprise Linux (also referred to as RHEL). All commands referenced in this
    chapter will be commands that are included with a default installation of RHEL
    7.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将回顾常见的故障排除命令以及查找有用信息的常见位置。在本书中，我们将使用Red Hat Enterprise Linux的7版（也称为RHEL）。本章引用的所有命令都是RHEL
    7默认安装包中包含的命令。
- en: We will reference commands that are installed by default, as I have found myself
    in situations where I could have used a specific command to identify an issue
    immediately but that command was not available to me. By limiting this chapter
    to default commands, you can be assured that the troubleshooting steps covered
    in this chapter are not only relevant to most RHEL 7 installations, but are also
    relevant to previous releases and other Linux distributions.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将引用默认安装的命令，因为我发现自己曾经处于这样的情况，我本可以使用特定的命令立即识别问题，但是这个命令对我不可用。通过将本章限制为默认命令，您可以确保本章涵盖的故障排除步骤不仅与大多数RHEL
    7安装相关，而且与以前的版本和其他Linux发行版相关。
- en: Finding useful information
  id: totrans-4
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 查找有用信息
- en: Before starting to explore troubleshooting commands, I first want to cover locations
    of useful information. Useful information is a bit of a vague term, pretty much
    every file, directory, or command can provide *useful information*. What I really
    plan to cover are places where it is possible to find information for almost any
    issue.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 在开始探索故障排除命令之前，我首先想要介绍有用信息的位置。有用信息是一个模糊的术语，几乎每个文件、目录或命令都可以提供*有用信息*。我真正打算介绍的是几乎可以找到几乎任何问题的信息的位置。
- en: Log files
  id: totrans-6
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 日志文件
- en: Log files are often the first place to start looking for troubleshooting information.
    Whenever a service or server is experiencing an issue, checking the log files
    for errors can often answer many questions quickly.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 日志文件通常是查找故障排除信息的第一个地方。每当服务或服务器遇到问题时，检查错误日志文件通常可以迅速回答许多问题。
- en: The default location
  id: totrans-8
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 默认位置
- en: By default, RHEL and most Linux distributions keep their log files in `/var/log/`,
    which is actually part of the **Filesystem Hierarchy Standard** (**FHS**) maintained
    by the Linux Foundation. However, while `/var/log/` might be the default location
    not all log files are located there ([http://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard](http://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard)).
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，RHEL和大多数Linux发行版将其日志文件保存在`/var/log/`中，这实际上是由Linux基金会维护的**文件系统层次结构标准**（**FHS**）的一部分。但是，虽然`/var/log/`可能是默认位置，并非所有日志文件都位于那里（[http://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard](http://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard)）。
- en: While `/var/log/httpd/` is the default location for Apache logs, this location
    can be changed with Apache's configuration files. This is especially common when
    Apache was installed outside of the standard RHEL package.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然`/var/log/httpd/`是Apache日志的默认位置，但可以通过Apache的配置文件更改此位置。当Apache安装在标准RHEL软件包之外时，这是非常常见的。
- en: Like Apache, most services allow for custom log locations. It is not uncommon
    to find custom directories or file systems outside of `/var/log` created specifically
    for log files.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 与Apache一样，大多数服务允许自定义日志位置。在`/var/log`之外找到专门用于日志文件的自定义目录或文件系统并不罕见。
- en: Common log files
  id: totrans-12
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 常见日志文件
- en: The following table is a short list of common log files and a description of
    what you can find within them.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 以下表格是常见日志文件的简要列表，以及您可以在其中找到的内容的描述。
- en: Tip
  id: totrans-14
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: Do keep in mind that this list is specific to Red Hat Enterprise Linux 7, and
    while other Linux distributions might follow similar conventions, they are not
    guaranteed.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 请记住，此列表特定于Red Hat Enterprise Linux 7，而其他Linux发行版可能遵循类似的约定，但不能保证。
- en: '| Log file | Description |'
  id: totrans-16
  prefs: []
  type: TYPE_TB
  zh: '| 日志文件 | 描述 |'
- en: '| --- | --- |'
  id: totrans-17
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| `/var/log/messages` | By default, this log file contains all syslog messages
    (except e-mail) of `INFO` or higher priority. |'
  id: totrans-18
  prefs: []
  type: TYPE_TB
  zh: '| `/var/log/messages` | 默认情况下，此日志文件包含所有`INFO`或更高优先级的syslog消息（除电子邮件）。 |'
- en: '| `/var/log/secure` | This log file contains authentication related message
    items such as:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: '| `/var/log/secure` | 此日志文件包含与身份验证相关的消息项，例如：'
- en: SSH logins
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SSH登录
- en: User creations
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用户创建
- en: Sudo violations and privilege escalation
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Sudo违规和权限提升
- en: '|'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '| `/var/log/cron` | This log file contains a history of `crond` executions
    as well as start and end times of `cron.daily`, `cron.weekly`, and other executions.
    |'
  id: totrans-24
  prefs: []
  type: TYPE_TB
  zh: '| `/var/log/cron` | 此日志文件包含`crond`执行的历史记录，以及`cron.daily`、`cron.weekly`和其他执行的开始和结束时间。
    |'
- en: '| `/var/log/maillog` | This log file is the default log location of mail events.
    If using postfix, this is the default location for all postfix-related messages.
    |'
  id: totrans-25
  prefs: []
  type: TYPE_TB
  zh: '| `/var/log/maillog` | 这个日志文件是邮件事件的默认日志位置。如果使用postfix，这是所有与postfix相关的消息的默认位置。
    |'
- en: '| `/var/log/httpd/` | This log directory is the default location for Apache
    logs. While this is the default location, it is not a guaranteed location for
    all Apache logs. |'
  id: totrans-26
  prefs: []
  type: TYPE_TB
  zh: '| `/var/log/httpd/` | 此日志目录是Apache日志的默认位置。虽然这是默认位置，但并不是所有Apache日志的保证位置。 |'
- en: '| `/var/log/mysql.log` | This log file is the default log file for mysqld.
    Much like the `httpd` logs, this is default and can be changed easily. |'
  id: totrans-27
  prefs: []
  type: TYPE_TB
  zh: '| `/var/log/mysql.log` | 这个日志文件是mysqld的默认日志文件。与`httpd`日志一样，这是默认的，可以很容易地更改。
    |'
- en: '| `/var/log/sa/` | This directory contains the results of the `sa` commands
    that run every 10 minutes by default. We will utilize this data more in later
    sections in this chapter and throughout this book. |'
  id: totrans-28
  prefs: []
  type: TYPE_TB
  zh: '| `/var/log/sa/` | 此目录包含默认每10分钟运行一次的`sa`命令的结果。我们将在本章的后续部分以及本书的整个过程中更多地利用这些数据。
    |'
- en: For many issues, one of the first log files to review is the `/var/log/messages`
    log. On RHEL systems, this log file receives all system logs of `INFO` priority
    or higher. In general, this means that any significant event sent to `syslog`
    would be captured in this log file.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 对于许多问题，要审查的第一个日志文件之一是`/var/log/messages`日志。在RHEL系统上，这个日志文件接收所有`INFO`优先级或更高级别的系统日志。一般来说，这意味着发送到`syslog`的任何重要事件都会在这个日志文件中被捕获。
- en: 'The following is a sample of some of the log messages that can be found in
    `/var/log/messages`:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是可以在`/var/log/messages`中找到的一些日志消息的示例：
- en: '[PRE0]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: As we can see, there are more than a few log messages within this sample that
    could be useful while troubleshooting issues.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们所看到的，在这个示例中有不止一条日志消息可能在故障排除问题时非常有用。
- en: Finding logs that are not in the default location
  id: totrans-33
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 寻找不在默认位置的日志
- en: Many times log files are not in `/var/log/`, which can be either because someone
    modified the log location to some place apart from the default, or simply because
    the service in question defaults to another location.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 很多时候日志文件不在“/var/log/”中，这可能是因为有人修改了日志位置到默认位置之外的某个地方，或者仅仅是因为相关服务默认使用另一个位置。
- en: In general, there are three ways to find log files not in `/var/log/`.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 一般来说，有三种方法可以找到不在“/var/log/”中的日志文件。
- en: Checking syslog configuration
  id: totrans-36
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 检查syslog配置
- en: If you know a service is using syslog for its logging, the best place to check
    to find which log file its messages are being written to is the **rsyslog** configuration
    files. The rsyslog service has two locations for configuration. The first is the
    `/etc/rsyslog.d` directory.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您知道某个服务正在使用syslog进行日志记录，查找其消息写入的日志文件的最佳位置是**rsyslog**配置文件。rsyslog服务有两个配置位置。第一个是`/etc/rsyslog.d`目录。
- en: The `/etc/rsyslog.d` directory is an include directory for custom rsyslog configurations.
    The second is the `/etc/rsyslog.conf` configuration file. This is the main configuration
    file for rsyslog and contains many of the default syslog configurations.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: '`/etc/rsyslog.d`目录是自定义rsyslog配置的包含目录。第二个是`/etc/rsyslog.conf`配置文件。这是rsyslog的主配置文件，包含许多默认的syslog配置。'
- en: 'The following is a sample of the default contents of `/etc/rsyslog.conf`:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是`/etc/rsyslog.conf`的默认内容示例：
- en: '[PRE1]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: By reviewing the contents of this file, it is fairly easy to identify which
    log files contain the information required, if not, at least, the possible location
    of syslog managed log files.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 通过审查这个文件的内容，很容易确定哪些日志文件包含所需的信息，如果不行，至少可以确定syslog管理的日志文件的可能位置。
- en: Checking the application's configuration
  id: totrans-42
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 检查应用程序的配置
- en: Not every application utilizes syslog; for those that don't, one of the easiest
    ways to find the application's log file is to read the application's configuration
    files.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 并非每个应用程序都使用syslog；对于那些不使用的应用程序，找到应用程序的日志文件的最简单方法之一是阅读应用程序的配置文件。
- en: 'A quick and useful method for finding log file locations from configuration
    files is to use the `grep` command to search the file for the word `log`:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 从配置文件中查找日志文件位置的一种快速有用的方法是使用`grep`命令在文件中搜索单词`log`：
- en: '[PRE2]'
  id: totrans-45
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '[PRE3]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: After reviewing the output of the preceding `grep` command, we can see that
    the configured log location for samba is `/var/log/samba/log.%m`. It is important
    to note that `%m`, in this example, is actually replaced with a "machine name"
    when creating the file. This is actually a variable within the samba configuration
    file. These variables are unique to each application but this method for making
    dynamic configuration values is a common practice.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 在审查上述`grep`命令的输出后，我们可以看到samba的配置日志位置是`/var/log/samba/log.%m`。需要注意的是，在这个例子中，`%m`实际上是在创建文件时用“机器名称”替换的。这实际上是samba配置文件中的一个变量。这些变量对每个应用程序都是唯一的，但这种动态配置值的方法是一种常见的做法。
- en: Other examples
  id: totrans-48
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 其他例子
- en: 'The following are examples of using the `grep` command to search for the word
    "`log`" in the Apache and MySQL configuration files:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是使用`grep`命令在Apache和MySQL配置文件中搜索单词“`log`”的示例：
- en: '[PRE4]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: In both instances, this method was able to identify the configuration parameter
    for the service's log file. With the previous three examples, it is easy to see
    how effective searching through configuration files can be.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 在这两种情况下，这种方法能够识别服务日志文件的配置参数。通过前面的三个例子，很容易看出搜索配置文件的效果有多好。
- en: Using the find command
  id: totrans-52
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 使用find命令
- en: 'The `find` command, which we will cover in depth later in this chapter, is
    another useful method for finding log files. The `find` command is used to search
    a directory structure for specified files. A quick way of finding log files is
    to simply use the `find` command to search for any files that end in "`.log`":'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在本章后面深入介绍的`find`命令是另一种查找日志文件的有用方法。`find`命令用于在目录结构中搜索指定的文件。查找日志文件的快速方法是简单地使用`find`命令搜索以“`.log`”结尾的任何文件：
- en: '[PRE5]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: The preceding is generally considered a last resort solution, and is mostly
    used when the previous methods do not produce results.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 上述通常被认为是最后的解决方案，大多数情况下是在之前的方法没有产生结果时使用。
- en: Tip
  id: totrans-56
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: When executing the `find` command, it is considered a best practice to be very
    specific about which directory to search. When being executed against very large
    directories, the performance of the server can be degraded.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 执行`find`命令时，最好的做法是非常具体地指定要搜索的目录。当针对非常大的目录执行时，服务器的性能可能会下降。
- en: Configuration files
  id: totrans-58
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 配置文件
- en: As discussed previously, configuration files for an application or service can
    be excellent sources of information. While configuration files won't provide you
    with specific errors such as log files, they can provide you with critical information
    (for example, enabled/disabled features, output directories, and log file locations).
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，应用程序或服务的配置文件可以是信息的绝佳来源。虽然配置文件不会提供特定的错误，比如日志文件，但它们可以提供关键信息（例如启用/禁用的功能、输出目录和日志文件位置）。
- en: Default system configuration directory
  id: totrans-60
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 默认系统配置目录
- en: In general, system, and service configuration files are located within the `/etc/`
    directory on most Linux distributions. However, this does not mean that every
    configuration file is located within the `/etc/` directory. In fact, it is not
    uncommon for applications to include a configuration directory within the application's
    `home` directory.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 一般来说，大多数Linux发行版的系统和服务配置文件位于`/etc/`目录中。但这并不意味着每个配置文件都位于`/etc/`目录中。事实上，应用程序通常会在应用程序的`home`目录中包含一个配置目录。
- en: So how do you know when to look in the `/etc/` versus an application directory
    for configuration files? A general rule of thumb is, if the package is part of
    the RHEL distribution, it is safe to assume that the configuration is within the
    `/etc/` directory. Anything else may or may not be present in the `/etc/` directory.
    For these situations, you simply have to look for them.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 那么，如何知道何时在`/etc/`而不是应用程序目录中查找配置文件？一个经验法则是，如果软件包是RHEL发行版的一部分，可以安全地假设配置位于`/etc/`目录中。其他任何东西可能存在于`/etc/`目录中，也可能不存在。对于这些情况，你只需要去寻找它们。
- en: Finding configuration files
  id: totrans-63
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 查找配置文件
- en: 'In most scenarios, it is possible to find system configuration files within
    the `/etc/` directory with a simple directory listing using the `ls` command:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 在大多数情况下，可以使用`ls`命令对`/etc/`目录进行简单的目录列表，以找到系统配置文件：
- en: '[PRE6]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '[PRE7]'
  id: totrans-66
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Using the rpm command
  id: totrans-67
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 使用rpm命令
- en: 'If the configuration files were deployed as part of a RPM package, it is possible
    to use the `rpm` command to identify configuration files. To do this, simply execute
    the `rpm` command with the `–q` (query) flag, and the `–c` (configfiles) flag,
    followed by the name of the package:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 如果配置文件是作为RPM软件包的一部分部署的，可以使用`rpm`命令来识别配置文件。为此，只需执行带有`-q`（查询）标志和`-c`（configfiles）标志的`rpm`命令，然后跟上软件包的名称：
- en: '[PRE8]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: The `rpm` command is used to manage RPM packages and is a very useful command
    when troubleshooting. We will cover this command further in the next section as
    we explore commands for troubleshooting.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: '`rpm`命令用于管理RPM软件包，在故障排除时非常有用。在下一节中，我们将进一步介绍这个命令，以探索故障排除的命令。'
- en: Using the find command
  id: totrans-71
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 使用find命令
- en: 'Much like finding log files, to find configuration files on a system, it is
    possible to utilize the `find` command. When searching for log files, the `find`
    command was used to search for all files where the name ends in "`.log`". In the
    following example, the `find` command is being used to search for all files where
    the name begins with "`http`". This `find` command should return at least a few
    results, which will provide configuration files related to the HTTPD (Apache)
    service:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 与查找日志文件类似，要在系统上查找配置文件，可以利用`find`命令。在搜索日志文件时，`find`命令用于搜索所有文件名以“`.log`”结尾的文件。在下面的例子中，`find`命令用于搜索所有文件名以“`http`”开头的文件。这个`find`命令应该至少返回一些结果，这些结果将提供与HTTPD（Apache）服务相关的配置文件：
- en: '[PRE9]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: The preceding example searches the `/etc` directory; however, this could also
    be used to search any application home directory for user configuration files.
    Similar to searching for log files, using the `find` command to search for configuration
    files is generally considered a last resort step and should not be the first method
    used.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的例子搜索了`/etc`目录；然而，这也可以用于搜索任何应用程序的主目录以查找用户配置文件。与搜索日志文件类似，使用`find`命令搜索配置文件通常被认为是最后的手段，不应该是第一个使用的方法。
- en: The proc filesystem
  id: totrans-75
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: proc文件系统
- en: 'An extremely useful source of information is the `proc` filesystem. This is
    a special filesystem that is maintained by the Linux kernel. The `proc` filesystem
    can be used to find useful information about running processes, as well as other
    system information. For example, if we wanted to identify the filesystems supported
    by a system, we could simply read the `/proc/filesystems` file:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: '`proc`文件系统是一个非常有用的信息来源。这是由Linux内核维护的一个特殊文件系统。`proc`文件系统可用于查找有关运行进程以及其他系统信息的有用信息。例如，如果我们想要识别系统支持的文件系统，我们可以简单地读取`/proc/filesystems`文件：'
- en: '[PRE10]'
  id: totrans-77
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: This filesystem is extremely useful and contains quite a bit of information
    about a running system. The `proc filesystem` will be used throughout the troubleshooting
    steps within this book. It is used in various ways while troubleshooting everything
    from specific processes to read-only filesystems.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 这个文件系统非常有用，包含了关于运行系统的大量信息。`proc文件系统`将在本书的故障排除步骤中使用。它在故障排除各种问题时以不同的方式使用，从特定进程到只读文件系统。
- en: Troubleshooting commands
  id: totrans-79
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 故障排除命令
- en: This section will cover frequently used troubleshooting commands that can be
    used to gather information from the system or a running service. While it is not
    feasible to cover every possible command, the commands used do cover fundamental
    troubleshooting steps for Linux systems.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 本节将介绍经常使用的故障排除命令，这些命令可用于从系统或运行的服务中收集信息。虽然不可能涵盖每个可能的命令，但所使用的命令确实涵盖了Linux系统的基本故障排除步骤。
- en: Command-line basics
  id: totrans-81
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 命令行基础知识
- en: The troubleshooting steps used within this book are primarily command-line based.
    While it is possible to perform many of these things from a graphical desktop
    environment, the more advanced items are command-line specific. As such, this
    book assumes that the reader has at least a basic understanding of Linux. To be
    more specific, this book assumes that the reader has logged into a server via
    SSH and is familiar with basic commands such as `cd`, `cp`, `mv`, `rm`, and `ls`.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 本书中使用的故障排除步骤主要基于命令行。虽然可能可以从图形桌面环境执行许多这些操作，但更高级的项目是命令行特定的。因此，本书假设读者至少具有对Linux的基本理解。更具体地说，本书假设读者已经通过SSH登录到服务器，并熟悉基本命令，如`cd`、`cp`、`mv`、`rm`和`ls`。
- en: For those who might not have much familiarity, I wanted to quickly cover some
    basic command-line usage that will be required knowledge for this book.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 对于那些可能不太熟悉的人，我想快速介绍一些基本的命令行用法，这将是本书所需的基本知识。
- en: Command flags
  id: totrans-84
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 命令标志
- en: 'Many readers are probably familiar with the following command:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 许多读者可能熟悉以下命令：
- en: '[PRE11]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Most should recognize that this is the `ls` command and it is used to perform
    a directory listing. What might not be familiar is what exactly the `–la` part
    of the command is or does. To understand this better, let''s look at the ls command
    by itself:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数人应该认识到这是“ls”命令，用于执行目录列表。可能不熟悉的是命令的“-la”部分是什么或者做什么。为了更好地理解这一点，让我们单独看一下ls命令：
- en: '[PRE12]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: The previous execution of the `ls` command looks very different from the previous.
    The reason for this is because the latter is the default output for `ls`. The
    `–la` portion of the command is what is commonly referred to as command flags
    or options. The command flags allow a user to change the default behavior of the
    command providing it with specific options.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 先前执行的“ls”命令与以前的看起来非常不同。这是因为后者是“ls”的默认输出。命令标志允许用户更改命令的默认行为，为其提供特定选项。
- en: 'In fact, the `–la` flags are two separate options, `–l` and `–a`; they can
    even be specified separately:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: '实际上，“-la”标志是两个单独的选项，“-l”和“-a”;它们甚至可以分开指定:'
- en: '[PRE13]'
  id: totrans-91
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '[PRE14]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'In addition to grouping and ungrouping, this book will also show flags in their
    long format. In the previous examples, we showed the flag `-a`, this is known
    as a short flag. This same option can also be provided in the long format `--all`:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 除了分组和取消分组，本书还将以长格式显示标志。在前面的例子中，我们显示了标志“-a”，这被称为短标志。这个选项也可以以长格式“--all”提供：
- en: '[PRE15]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: The `–a` and the `--all` flags are essentially the same option; it can simply
    be represented in both short and long form.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: “-a”和“--all”标志本质上是相同的选项;它可以简单地以短格式和长格式表示。
- en: One important thing to remember is that not every short flag has a long form
    and vice versa. Each command has its own syntax, some commands only support the
    short form, others only support the long form, but many support both. In most
    cases, the long and short flags will both be documented within the command's man
    page.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 一个重要的事情要记住的是，并非每个短标志都有长形式，反之亦然。每个命令都有自己的语法，有些命令只支持短形式，其他命令只支持长形式，但许多命令都支持两种形式。在大多数情况下，长标志和短标志都将在命令的手册页面中得到记录。
- en: The piping command output
  id: totrans-97
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 管道命令输出
- en: 'Another common command-line practice that will be used several times throughout
    this book is `piping` output. Specifically, examples such as the following:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 本书中将多次使用的另一种常见的命令行实践是将输出“传输”。具体来说，例如以下示例：
- en: '[PRE16]'
  id: totrans-99
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: In the preceding example, the output of the `ls -l --all` command is piped to
    the `grep` command. By placing `|` or the pipe character between the two commands,
    the output of the first command is "piped" to the input for the second command.
    The example preceding the `ls` command will be executed; with that, the `grep`
    command will then search that output for any instance of the pattern "`app`".
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的例子中，“ls -l --all”的输出被传输到“grep”命令。通过在两个命令之间放置“|”或管道字符，第一个命令的输出被“传输”到第二个命令的输入。将执行“ls”命令的示例;随后，“grep”命令将搜索该输出中的任何“app”模式的实例。
- en: 'Piping output to `grep` will actually be used quite often throughout this book,
    as it is a simple way to trim the output into a maintainable size. Many times
    the examples will also contain multiple levels of piping:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: '在本书中，将经常使用将输出传输到“grep”，因为这是将输出修剪为可维护大小的简单方法。许多时候，示例还将包含多个级别的管道:'
- en: '[PRE17]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: In the preceding code the output of `ls -la` is piped to the input of `grep`;
    however, this time, the output of `grep` is also piped to the input of `awk`.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的代码中，“ls -la”的输出被传输到“grep”的输入;然而，这一次，“grep”的输出也被传输到“awk”的输入。
- en: While many commands can be piped to, not every command supports this. In general,
    commands that accept user input from files or command-line also accept piped input.
    As with the flags, a command's man page can be used to identify whether the command
    accepts piped input or not.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然许多命令可以进行管道传输，但并非每个命令都支持这一点。一般来说，接受来自文件或命令行的用户输入的命令也接受管道输入。与标志一样，命令的手册页面可用于确定命令是否接受管道输入。
- en: Gathering general information
  id: totrans-105
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 收集一般信息
- en: When managing the same servers for a long time, you start to remember key information
    about those servers. Such as the amount of physical memory, the size and layout
    of their filesystems, and what processes should be running. However, when you
    are not familiar with the server in question it is always a good idea to gather
    this type of information.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 在长时间管理相同服务器时，您开始记住关于这些服务器的关键信息。例如物理内存的数量，文件系统的大小和布局，以及应该运行的进程。但是，当您不熟悉所讨论的服务器时，收集这种类型的信息总是一个好主意。
- en: The commands in this section are commands that can be used to gather this type
    of general information.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 本节中的命令是用于收集此类一般信息的命令。
- en: w – show who is logged on and what they are doing
  id: totrans-108
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: w-显示谁登录了以及他们在做什么
- en: 'Early in my systems administration career, I had a mentor who used to tell
    me: *I always run w when I log into a server*. This simple tip has actually been
    very useful over and over again in my career. The `w` command is simple; when
    executed it will output information such as system uptime, load average, and who
    is logged in:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 在我系统管理职业生涯的早期，我有一个导师告诉我：*我每次登录服务器时都会运行w*。这个简单的提示实际上在我的职业生涯中一次又一次地非常有用。“w”命令很简单;当执行时，它将输出系统正常运行时间，平均负载以及谁登录了：
- en: '[PRE18]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'This information can be extremely useful when working with unfamiliar systems.
    The output can be useful even when you are familiar with the system. With this
    command, you can see:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 当与不熟悉的系统一起工作时，这些信息可能非常有用。即使您熟悉该系统，输出也可能很有用。通过这个命令，您可以看到：
- en: 'When this system was last rebooted:'
  id: totrans-112
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 上次系统重启时：
- en: '`04:07:37 up 14:26`: This information can be extremely useful; whether it is
    an alert for a service like Apache being down, or a user calling in because they
    were locked out of the system. When these issues are caused by an unexpected reboot,
    the reported issue does not often include this information. By running the `w`
    command, it is easy to see the time elapsed since the last reboot.'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: '`04:07:37 up 14:26`：这些信息可能非常有用；无论是像Apache服务宕机的警报，还是用户因为被系统锁定而打进来。当这些问题是由意外重启引起时，报告的问题通常不包括这些信息。通过运行`w`命令，很容易看到自上次重启以来经过的时间。'
- en: 'The load average of the system:'
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 系统的平均负载：
- en: '`load average: 0.00, 0.01, 0.05`: The load average is a very important measurement
    of system health. To summarize it, the load average is the average number of processes
    in a `wait` state over a period of time. The three numbers in the output of `w`
    represent different times.'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: '`平均负载：0.00, 0.01, 0.05`：平均负载是系统健康的一个非常重要的衡量标准。总结一下，平均负载是一段时间内处于`等待`状态的进程的平均数量。`w`命令输出中的三个数字代表不同的时间。'
- en: The numbers are ordered from left to right as 1 minute, 5 minutes, and 15 minutes.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 这些数字从左到右依次是1分钟、5分钟和15分钟。
- en: 'Who is logged in and what they are running:'
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 谁登录了以及他们在运行什么：
- en: '`USER TTY LOGIN@ IDLE JCPU PCPU WHAT`'
  id: totrans-118
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`USER TTY LOGIN@ IDLE JCPU PCPU WHAT`'
- en: '`root tty1 Wed13 11:24m 0.13s 0.13s -bash`'
  id: totrans-119
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`root tty1 Wed13 11:24m 0.13s 0.13s -bash`'
- en: The final piece of information that the `w` command provides is users that are
    currently logged in and what command they are executing.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: '`w`命令提供的最后一条信息是当前登录的用户以及他们正在执行的命令。'
- en: This is essentially the same output as the `who` command, which includes the
    user logged in, when they logged in, how long they have been idle, and what command
    their shell is running. The last item in that list is extremely important.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 这基本上与`who`命令的输出相同，包括已登录的用户、他们登录的时间、他们已经空闲了多长时间，以及他们的shell正在运行的命令。列表中的最后一项非常重要。
- en: Oftentimes, when working with big teams, it is common for more than one person
    to respond to an issue or ticket. By running the `w` command immediately after
    login, you will see what other users are doing, preventing you from overriding
    any troubleshooting or corrective steps the other person has taken.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 在与大团队合作时，往往会有多个人响应一个问题或工单是很常见的。在登录后立即运行`w`命令，你将看到其他用户在做什么，避免你覆盖其他人已经采取的故障排除或纠正步骤。
- en: rpm – RPM package manager
  id: totrans-123
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: rpm – RPM软件包管理器
- en: The `rpm` command is used to manage **Red Hat package manager** (**RPM**). With
    this command, you can install and remove RPM packages, as well as search for packages
    that are already installed.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: '`rpm`命令用于管理**Red Hat软件包管理器**（**RPM**）。使用这个命令，你可以安装和删除RPM软件包，以及搜索已安装的软件包。'
- en: Earlier in this chapter, we saw how the `rpm` command can be used to look for
    configuration files. The following are several additional ways we can use the
    `rpm` command to find critical information.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章的前面，我们看到`rpm`命令可以用来查找配置文件。以下是我们可以使用`rpm`命令查找关键信息的几种额外方式。
- en: Listing all packages installed
  id: totrans-126
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 列出所有安装的软件包
- en: 'Often when troubleshooting services, a critical step is identifying the version
    of the service and how it was installed. To list all RPM packages installed on
    a system, simply execute the `rpm` command with `-q` (query) and `-a` (all):'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 在故障排除服务时，一个关键的步骤是确定服务的版本以及它是如何安装的。要列出系统上安装的所有RPM软件包，只需执行带有`-q`（查询）和`-a`（所有）的`rpm`命令：
- en: '[PRE19]'
  id: totrans-128
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: The `rpm` command is a very diverse command with many flags. In the preceding
    example the `-q` and `-a` flags are used. The `-q` flag tells the `rpm` command
    that the action being taken is a query; you can think of this as being put into
    a "search mode". The `-a` or `--all` flag tells the `rpm` command to list all
    packages.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: '`rpm`命令是一个非常多样化的命令，有很多标志。在前面的例子中使用了`-q`和`-a`标志。`-q`标志告诉`rpm`命令正在进行的操作是一个查询；你可以把它想象成进入了“搜索模式”。`-a`或`--all`标志告诉`rpm`命令列出所有软件包。'
- en: A useful feature is to add the `--last` flag to the preceding command, as this
    causes the `rpm` command to list the packages by install time with the latest
    being first.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 一个有用的功能是在前面的命令中添加`--last`标志，因为这会导致`rpm`命令按安装时间列出软件包，最新的排在最前面。
- en: Listing all files deployed by a package
  id: totrans-131
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 列出软件包部署的所有文件
- en: 'Another useful `rpm` function is to show all of the files deployed by a specific
    package:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个有用的`rpm`功能是显示特定软件包部署的所有文件：
- en: '[PRE20]'
  id: totrans-133
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: In the preceding example, we again use the `-q` flag to specify that we are
    running a query, along with the `--filesbypkg` flag. The `--filesbypkg` flag will
    cause the `rpm` command to list all of the files deployed by the specified package.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的例子中，我们再次使用`-q`标志来指定我们正在运行一个查询，以及`--filesbypkg`标志。`--filesbypkg`标志将导致`rpm`命令列出指定软件包部署的所有文件。
- en: This example can be very useful when trying to identify a service's configuration
    file location.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 当试图确定服务的配置文件位置时，这个例子非常有用。
- en: Using package verification
  id: totrans-136
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 使用软件包验证
- en: 'In this third example, we are going to use an extremely useful feature of `rpm`—verify.
    The `rpm` command has the ability to verify whether or not the files deployed
    by a specified package have been altered from their original contents. To do this,
    we will use the `-V` (verify) flag:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 在这第三个例子中，我们将使用`rpm`的一个非常有用的功能——验证。`rpm`命令有能力验证指定软件包部署的文件是否已经被更改。为了做到这一点，我们将使用`-V`（验证）标志：
- en: '[PRE21]'
  id: totrans-138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: In the preceding example, we simply run the `rpm` command with the `-V` flag
    followed by a package name. As the `-q` flag is used for querying, the `-V` flag
    is for verifying. With this command, we can see that only the `/etc/httpd/conf/httpd.conf`
    file was listed; this is because `rpm` will only output files that have been altered.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的例子中，我们只是运行了带有`-V`标志的`rpm`命令，后面跟着一个软件包名称。由于`-q`标志用于查询，`-V`标志用于验证。使用这个命令，我们可以看到只有`/etc/httpd/conf/httpd.conf`文件被列出；这是因为`rpm`只会输出已经被更改的文件。
- en: 'In the first column of this output, we can see which verification checks the
    file failed. While this column is a bit cryptic at first, the rpm man page has
    a useful table (as shown in the following list) explaining what each character
    means:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个输出的第一列中，我们可以看到文件失败的验证检查。虽然这一列起初有点神秘，但rpm手册中有一个有用的表格（如下列表所示），解释了每个字符的含义：
- en: '`S`: This means that the file size differs'
  id: totrans-141
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`S`: 这意味着文件大小不同'
- en: '`M`: This means that the mode differs (includes permissions and file type)'
  id: totrans-142
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`M`: 这意味着模式不同（包括权限和文件类型）'
- en: '`5`: This means that the digest (formerly `MD5 sum`) differs'
  id: totrans-143
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`5`: 这意味着摘要（以前是`MD5校验和`）不同'
- en: '`D`: This means indicates the device major/minor number mismatch'
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`D`: 这意味着设备主/次编号不匹配'
- en: '`L`: This means indicates the `readLink(2)` path mismatch'
  id: totrans-145
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`L`: 这意味着`readLink(2)`路径不匹配'
- en: '`U`: This means that the user ownership differs'
  id: totrans-146
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`U`: 这意味着用户所有权不同'
- en: '`G`: This means that the group ownership differs'
  id: totrans-147
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`G`: 这意味着组所有权不同'
- en: '`T`: This means that `mTime` differs'
  id: totrans-148
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`T`: 这意味着`mTime`不同'
- en: '`P`: This means that `caPabilities` differs'
  id: totrans-149
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`P`: 这意味着`caPabilities`不同'
- en: Using this list we can see that the `httpd`.`conf's` file size, `MD5` sum, and
    `mtime` (modify time) are not what was deployed by `httpd.rpm`. This means that
    it is highly likely that the `httpd.conf` file has been modified after installation.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 使用这个列表，我们可以看到`httpd`.`conf`文件大小、`MD5`校验和和`mtime`（修改时间）与`httpd.rpm`部署的不同。这意味着很可能`httpd.conf`文件在安装后被修改过。
- en: While the `rpm` command might not seem like a troubleshooting command at first,
    the preceding examples show just how powerful of a troubleshooting tool it can
    be. With these examples, it is simple to identify important files and whether
    or not those files have been modified from the deployed version.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然`rpm`命令一开始可能不像是一个故障排除命令，但前面的例子显示了它实际上是一个多么强大的故障排除工具。通过这些例子，很容易识别重要文件以及这些文件是否已经从部署版本中修改。
- en: df – report file system space usage
  id: totrans-152
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: df - 报告文件系统空间使用情况
- en: 'The `df` command is a very useful command when troubleshooting file system
    issues. The `df` command is used to output space utilization for mounted file
    systems:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: '`df`命令在故障排除文件系统问题时非常有用。`df`命令用于输出已挂载文件系统的空间利用情况：'
- en: '[PRE22]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'In the preceding example, the `df` command included the `-h` flag. This flag
    causes the `df` command to print any size values in a "human readable" format.
    By default, `df` will simply print these values in kilobytes. From the example,
    we can quickly see the current usage of all mounted filesystems. Specifically,
    if we look at the output, we can see that `/filesystem` is currently 24 percent
    used:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的例子中，`df`命令包括了`-h`标志。这个标志会导致`df`命令以“人类可读”的格式打印任何大小值。默认情况下，`df`会简单地以千字节打印这些值。从例子中，我们可以快速看到所有挂载文件系统的当前使用情况。具体来说，如果我们看输出，我们可以看到`/filesystem`目前使用了24%：
- en: '[PRE23]'
  id: totrans-156
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: This is a very quick and easy way to identify whether any file system is full.
    In addition, the `df` command is also very useful in showing details of what file
    systems are mounted and where they are mounted to. From the line containing the
    `/filesystem`, we can see that the underlying device is `/dev/mapper/rhel-root`.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个非常快速简单的方法来识别任何文件系统是否已满。此外，`df`命令还非常有用，可以显示已挂载的文件系统的详细信息以及它们被挂载到哪里。从包含`/filesystem`的那一行，我们可以看到底层设备是`/dev/mapper/rhel-root`。
- en: From this one command, we were able to identify two critical pieces of information.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 通过这个命令，我们能够识别出两个关键信息。
- en: Showing available inodes
  id: totrans-159
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 显示可用的inode
- en: 'The default behavior for `df` is to show the amount of used file system space.
    However, it can also be used to show the quantity of **inodes** available, used,
    and free for each file system. To output the inode utilization, simply add the
    `-i` (inode) flag when executing the `df` command:'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: '`df`的默认行为是显示已使用的文件系统空间量。但是，它也可以用来显示每个文件系统可用、已使用和空闲的**inodes**数量。要输出inode利用率，只需在执行`df`命令时添加`-i`（inode）标志：'
- en: '[PRE24]'
  id: totrans-161
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: It is still possible to use the `–h` flag with `df` to print the output in a
    human readable format. However, with the `–i` flag, this abbreviates the output
    to `M` for millions, `K` for thousands, and so on. This output can be easily confused
    with Megabytes or Kilobytes, so in general, I do not use the human readable inode
    output when sharing the output with other users/administrators.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 仍然可以使用`-h`标志与`df`一起以人类可读的格式打印输出。但是，使用`-i`标志，这将把输出缩写为`M`表示百万，`K`表示千，依此类推。这个输出很容易与兆字节或千字节混淆，所以一般情况下，我不会在与其他用户/管理员共享输出时使用人类可读的inode输出。
- en: free – display memory utilization
  id: totrans-163
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: free - 显示内存利用率
- en: 'When executed, the `free` command will output statistics about the memory available
    and in use on the system:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 执行`free`命令时，将输出系统上可用内存和已使用内存的统计信息：
- en: '[PRE25]'
  id: totrans-165
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: From the previous example, we can see that the output of the `free` command
    provides the total available memory, amount of memory currently used, and amount
    of memory free. The `free` command is a simple and quick way to identify the current
    state of memory on a system.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 从前面的例子可以看出，`free`命令的输出提供了总可用内存、当前使用的内存量和空闲内存量。`free`命令是识别系统内存当前状态的一种简单快速的方式。
- en: However, the output of `free` can be a bit confusing at first.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，`free`的输出一开始可能有点令人困惑。
- en: What is free, is not always free
  id: totrans-168
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 所谓的空闲，并不总是空闲
- en: Linux utilizes memory differently as compared to other operating systems. In
    the preceding output, you will see that it has 543,484 KB listed as cached. This
    memory, while technically used, is actually part of the available memory. The
    system can reallocate this cached memory as required.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: Linux与其他操作系统相比，利用内存的方式不同。在前面的输出中，您将看到有543,484 KB被列为缓存。这个内存，虽然在技术上被使用，实际上是可用内存的一部分。系统可以根据需要重新分配这个缓存内存。
- en: A quick and easy way of seeing what is actually used or free can be seen on
    the second line of output. The preceding output shows that 775,552 KB of memory
    is available on the system.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 一个快速简单的方法来查看实际使用或空闲的内容可以在输出的第二行看到。前面的输出显示系统上有775,552 KB的内存可用。
- en: The /proc/meminfo file
  id: totrans-171
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: /proc/meminfo文件
- en: 'In previous RHEL releases, the second line of the `free` command was the easiest
    method for identifying how much memory is available. However, with RHEL 7, there
    have been some improvements to the `/proc/meminfo` file. One of those improvements
    is the addition of the **MemAvailable** statistic:'
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 在以前的RHEL版本中，`free`命令的第二行是识别可用内存量的最简单方法。但是，随着RHEL 7，`/proc/meminfo`文件已经进行了一些改进。其中一个改进是增加了**MemAvailable**统计信息：
- en: '[PRE26]'
  id: totrans-173
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: The `/proc/meminfo` file is one of the many useful files located in the `/proc`
    file system. This file is maintained by the kernel and contains the system's current
    memory statistics. This file can be very useful when troubleshooting memory issues
    as it contains much more information than the output of the `free` command.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: '`/proc/meminfo`文件是位于`/proc`文件系统中的许多有用文件之一。该文件由内核维护，包含系统当前的内存统计信息。在排除内存问题时，此文件非常有用，因为它包含的信息比`free`命令的输出要多得多。'
- en: ps – report a snapshot of current running processes
  id: totrans-175
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: ps – 报告当前运行进程的快照
- en: 'The `ps` command is a fundamental command for any troubleshooting activity.
    This command, when executed, will output a list of running processes:'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: '`ps`命令是任何故障排除活动的基本命令。执行此命令将输出运行进程的列表：'
- en: '[PRE27]'
  id: totrans-177
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: The `ps` command has many flags and options to show different information about
    running processes. The following are a few example `ps` commands that are useful
    during troubleshooting.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: '`ps`命令有许多标志和选项，可显示有关运行进程的不同信息。以下是一些在故障排除期间有用的`ps`命令示例。'
- en: Printing every process in long format
  id: totrans-179
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 以长格式打印每个进程
- en: 'The following `ps` command uses the `-e` (everything, all process), `-l` (long
    format), and `-f` (full format) flags. These flags will cause the `ps` command
    to not only print every process but will also print them in a format that provides
    quite a bit of useful information:'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 以下`ps`命令使用`-e`（所有进程）、`-l`（长格式）和`-f`（完整格式）标志。这些标志将导致`ps`命令不仅打印每个进程，还将以提供相当多有用信息的格式打印它们：
- en: '[PRE28]'
  id: totrans-181
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: In the preceding output of `ps -elf`, we can see many useful pieces of information
    for the `kthreadd` process, information such as the **parent process ID** (**PPID**),
    the **priority** (**PRI**), the **niceness value** (**NI**), and the **resident
    memory size** (**SZ**) of the running processes.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 在`ps -elf`的前面输出中，我们可以看到`kthreadd`进程的许多有用信息，例如**父进程ID**（**PPID**）、**优先级**（**PRI**）、**niceness值**（**NI**）和运行进程的**驻留内存大小**（**SZ**）。
- en: I have found that the preceding example is a very general-purpose `ps` command
    and can be used in most situations.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 我发现前面的示例是一个非常通用的`ps`命令，可以在大多数情况下使用。
- en: Printing a specific user's processes
  id: totrans-184
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 打印特定用户的进程
- en: 'The preceding example can get quite large; making it difficult to identify
    specific processes. This example uses the `-U` flag to specify a user. This causes
    the `ps` command to print all processes running as the specified user; postfix
    in the following case:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的示例可能会变得非常庞大，使得难以识别特定进程。此示例使用`-U`标志来指定用户。这会导致`ps`命令打印作为指定用户运行的所有进程；在以下情况下是后缀：
- en: '[PRE29]'
  id: totrans-186
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: It is important to note that the `–U` flag can also be combined with other flags
    to provide even more information on the running processes. In the preceding example,
    the `-l` flag is once again used to print the output in the long format.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 需要注意的是，`–U`标志也可以与其他标志结合使用，以提供有关运行进程的更多信息。在前面的示例中，`-l`标志再次用于以长格式打印输出。
- en: Printing a process by process ID
  id: totrans-188
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 按进程ID打印进程
- en: 'If the process ID or PID is already known, it is possible to narrow down the
    process listing even further by specifying the process with the `–p` (process
    ID) flag:'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 如果进程ID或PID已知，可以通过指定`–p`（进程ID）标志来进一步缩小进程列表：
- en: '[PRE30]'
  id: totrans-190
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: This can be especially useful when combined with the `–L` (show threads with
    LWP column) or `–m` (show threads after process) flag, which are used to print
    process threads. When troubleshooting multithreaded applications the `-L` and
    `-m` flags can be critical.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 当与`–L`（显示带有LWP列的线程）或`–m`（显示进程后的线程）标志结合使用时，这可能特别有用，这些标志用于打印进程线程。在排除多线程应用程序故障时，`-L`和`-m`标志可能至关重要。
- en: Printing processes with performance information
  id: totrans-192
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 打印带有性能信息的进程
- en: 'The `ps` command allows the user to customize the columns printed with the
    `-o` (user defined format) flag:'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: '`ps`命令允许用户使用`-o`（用户定义格式）标志自定义打印的列：'
- en: '[PRE31]'
  id: totrans-194
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: The `–o` option allows for a wide number of custom columns. In the preceding
    version, I selected options that are similar to those printed in the top command.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: '`–o`选项允许使用许多自定义列。在前面的版本中，我选择了与top命令中打印的类似的选项。'
- en: The top command is one of the most popular Linux troubleshooting commands. It
    is used to show the top processes ordered by CPU usage (by default). In this chapter,
    I have opted to omit the top command, as I feel that the `ps` command is even
    more fundamental and flexible than the top command. As one becomes more familiar
    with the `ps` command, the top command will be easy to learn and understand.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: top命令是最受欢迎的Linux故障排除命令之一。它用于按CPU使用率（默认情况下）显示前几个进程。在本章中，我选择省略top命令，因为我认为`ps`命令比top命令更基本和灵活。随着对`ps`命令的熟悉，学习和理解top命令将变得容易。
- en: Networking
  id: totrans-197
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 网络
- en: Networking is an essential skill for any systems administrator. Without a properly
    configured network interface, a server serves little purpose. The commands in
    this section are specifically for looking up network configuration and current
    status. These commands are essential to learn, as they will not only be useful
    for troubleshooting but also for day-to-day setup and configuration.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 网络对于任何系统管理员来说都是一项基本技能。没有正确配置的网络接口，服务器就没有多大用处。本节中的命令专门用于查找网络配置和当前状态。这些命令是必须学习的，因为它们不仅对故障排除有用，而且对日常设置和配置也很有用。
- en: ip – show and manipulate network settings
  id: totrans-199
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: ip – 显示和操作网络设置
- en: The `ip` command is used to manage network settings such as interface configuration,
    routing and essentially anything network related. While these are not traditionally
    considered troubleshooting tasks, the `ip` command can also be used to display
    a system's network configuration. Without being able to look up networking details
    such as routing or device configuration, it would be very difficult to troubleshoot
    network-related issues.
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: '`ip`命令用于管理网络设置，如接口配置、路由和基本上与网络相关的任何内容。虽然这些通常不被认为是故障排除任务，但`ip`命令也可以用于显示系统的网络配置。如果无法查找网络详细信息，如路由或设备配置，将很难排除与网络相关的问题。'
- en: The following examples show various ways to use the `ip` command to identify
    critical network configuration settings.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 以下示例展示了使用`ip`命令识别关键网络配置设置的各种方法。
- en: Show IP address configuration for a specific device
  id: totrans-202
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 显示特定设备的IP地址配置
- en: 'One of the core uses of the `ip` command is to lookup a network interface and
    display its configuration. To do this, we will use the following command:'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: '`ip`命令的一个核心用途是查找网络接口并显示其配置。为了做到这一点，我们将使用以下命令：'
- en: '[PRE32]'
  id: totrans-204
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: In the preceding `ip` command, the first option provided `addr` (address) is
    used to define the type of information we are looking for. The second option `show`,
    tells `ip` to display the configuration of the first option. The third option
    `dev` (device) is followed by the network interface device in question; `enp0s3`.
    If the third option is omitted the `ip` command will show the address configuration
    for all network devices.
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的`ip`命令中，提供的第一个选项`addr`（地址）用于定义我们要查找的信息类型。第二个选项`show`告诉`ip`显示第一个选项的配置。第三个选项`dev`（设备）后面跟着所讨论的网络接口设备；`enp0s3`。如果省略了第三个选项，`ip`命令将显示所有网络设备的地址配置。
- en: The device name `enp0s3` might look a bit strange for those who have experience
    with previous RHEL releases. This device is following a newer network device naming
    scheme introduced with `systemd`. As of RHEL 7, network devices will use device
    names such as the previous, which are based on device driver and BIOS details.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 对于那些有经验的RHEL之前版本的人来说，设备名称`enp0s3`可能看起来有点奇怪。这个设备遵循了`systemd`引入的较新的网络设备命名方案。从RHEL
    7开始，网络设备将使用基于设备驱动程序和BIOS详细信息的设备名称。
- en: 'To find out more about RHEL 7''s new naming scheme simply reference the following
    URL:'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 要了解更多关于RHEL 7的新命名方案的信息，请参考以下URL：
- en: '[https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Networking_Guide/ch-Consistent_Network_Device_Naming.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Networking_Guide/ch-Consistent_Network_Device_Naming.html)'
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Networking_Guide/ch-Consistent_Network_Device_Naming.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Networking_Guide/ch-Consistent_Network_Device_Naming.html)'
- en: Show routing configuration
  id: totrans-209
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 显示路由配置
- en: 'The `ip` command can also be used to show routing configurations. This information
    is essential for troubleshooting connectivity issues between servers:'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: '`ip`命令还可以用于显示路由配置。这些信息对于排除服务器之间的连接问题至关重要。'
- en: '[PRE33]'
  id: totrans-211
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'The preceding `ip` command uses the `route` option followed by the `show` option
    to display all defined routes for this server. Like the previous example, it is
    possible to limit this output to a specific device by adding the `dev` (device)
    option followed by the device name:'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的`ip`命令使用`route`选项，后面跟着`show`选项来显示此服务器的所有定义路由。与前面的例子一样，也可以通过添加`dev`（设备）选项后跟设备名称来限制此输出到特定设备：
- en: '[PRE34]'
  id: totrans-213
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: Show network statistics for a specified device
  id: totrans-214
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 显示指定设备的网络统计信息
- en: 'Where the previous examples showed ways to lookup the current networking configuration,
    this next command uses the `-s` (statistics) flag to show network statistics for
    the specified device:'
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的例子展示了查找当前网络配置的方法，而这个命令使用`-s`（统计）标志来显示指定设备的网络统计信息：
- en: '[PRE35]'
  id: totrans-216
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: In the preceding example, the `link` (network device) option was used to specify
    that the statistics should be limited to the specified device.
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的例子中，使用了`link`（网络设备）选项来指定统计信息应该限制在指定的设备上。
- en: The statistics information shown can be useful when troubleshooting packets
    that are being dropped or to identify which interface has higher network utilization.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 显示的统计信息在排除丢包或识别哪个接口具有更高的网络利用率时非常有用。
- en: netstat – network statistics
  id: totrans-219
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: netstat - 网络统计
- en: The `netstat` command is an essential tool in any system administrator's tool
    belt. This can be seen by the fact that the `netstat` command is universally available
    even to operating systems that do not traditionally utilize command line for administration.
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: '`netstat`命令是任何系统管理员工具包中的基本工具。这可以通过`netstat`命令普遍适用于即使不传统使用命令行进行管理的操作系统来看出。'
- en: Printing network connections
  id: totrans-221
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 打印网络连接
- en: 'One of the primary uses of `netstat` is to print the existing established network
    connections. This can be done by simply executing `netstat`; however, if the `-a`
    (all) flag is used, the output will also include listening ports:'
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: '`netstat`的主要用途之一是打印现有的已建立的网络连接。这可以通过简单执行`netstat`来完成；然而，如果使用了`-a`（所有）标志，输出也将包括监听端口：'
- en: '[PRE36]'
  id: totrans-223
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: While the `-a` (all) flag used the preceding `netstat` causes to print all listening
    ports, the `-n` flag is used to force output into a numeric format, such as printing
    IP addresses rather than DNS host names.
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然在前面的`netstat`中使用了`-a`（所有）标志来打印所有监听端口，但`-n`标志用于强制输出为数字格式，例如打印IP地址而不是DNS主机名。
- en: The preceding example will be used heavily during [Chapter 5](part0032_split_000.html#UGI01-8ae10833f0c4428b9e1482c7fee089b4
    "Chapter 5. Network Troubleshooting"), *Network Troubleshooting*, where we will
    be troubleshooting network connectivity.
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的例子将在[第5章](part0032_split_000.html#UGI01-8ae10833f0c4428b9e1482c7fee089b4
    "第5章。网络故障排除")*网络故障排除*中大量使用，我们将在那里进行网络连接故障排除。
- en: Printing all ports listening for tcp connections
  id: totrans-226
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 打印所有监听tcp连接的端口
- en: 'I have seen many instances where a service is running and is visible via the
    `ps` command; however, the port for clients to connect to was not bound and listening.
    The following `netstat` command can be very useful when troubleshooting connectivity
    issues with a service:'
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 我曾经看到许多情况下，一个服务正在运行，并且可以通过`ps`命令看到；但是，客户端连接的端口没有绑定和监听。在解决服务的连接问题时，以下`netstat`命令非常有用：
- en: '[PRE37]'
  id: totrans-228
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'The preceding command is very useful as it combines three useful options:'
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的命令非常有用，因为它结合了三个有用的选项：
- en: '`–l` (listening), which tells `netstat` to only list listening sockets'
  id: totrans-230
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`–l`（监听）告诉`netstat`只列出正在监听的套接字'
- en: '`--tcp`, which tells `netstat` to limit the output to TCP connections'
  id: totrans-231
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--tcp`告诉`netstat`将输出限制为TCP连接'
- en: '`–p` (program), which tells `netstat` to list the PID and name of the process
    listening on that port'
  id: totrans-232
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`–p`（程序）告诉`netstat`列出在该端口上监听的进程的PID和名称'
- en: Delay
  id: totrans-233
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 延迟
- en: An often overlooked option with `netstat` is to utilize the delay feature. By
    adding a number at the end of the command, `netstat` will continuously run and
    will sleep for the specified number of seconds between executions.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: '`netstat`的一个经常被忽视的选项是利用延迟功能。通过在命令的末尾添加一个数字，`netstat`将持续运行，并在执行之间休眠指定的秒数。'
- en: 'If the following command is executed, the `netstat` command will print all
    listening TCP sockets every five seconds:'
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 如果执行以下命令，`netstat`命令将每五秒打印所有正在监听的TCP套接字：
- en: '[PRE38]'
  id: totrans-236
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: The delay feature can be very useful when investigating network connectivity
    issues. As it can easily show when an application binds a port for new connections.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 延迟功能在调查网络连接问题时非常有用。因为它可以很容易地显示应用程序何时为新连接绑定端口。
- en: Performance
  id: totrans-238
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 性能
- en: While we touched a bit on troubleshooting performance with commands such as
    `free` and `ps`, this section will show some very useful commands that answer
    the age-old question of "Why is it slow?"
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然我们稍微提到了使用`free`和`ps`等命令来解决性能问题，但本节将展示一些非常有用的命令，这些命令可以回答“为什么慢”的古老问题。
- en: iotop – a simple top-like I/O monitor
  id: totrans-240
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: iotop - 一个简单的类似top的I/O监视器
- en: 'The `iotop` command is a relatively newer command to Linux. In previous RHEL
    releases while available it was not installed by default. The `iotop` command
    provides a top command-like interface but rather than showing which processes
    are utilizing the most CPU time or memory, it shows processes ordered by I/O utilization:'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: '`iotop`命令是Linux上相对较新的命令。在以前的RHEL版本中，虽然可用，但默认情况下未安装`iotop`命令。`iotop`命令提供了一个类似top命令的界面，但它不是显示哪些进程正在使用最多的CPU时间或内存，而是显示按I/O利用率排序的进程：'
- en: '[PRE39]'
  id: totrans-242
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: Unlike some of the previous commands, `iotop` is very specialized to showing
    processes utilizing I/O. There are however, some very useful flags that can change
    iotop's default behavior. Flags such as `–o` (only), which tells `iotop` to only
    print processes using I/O rather than its default behavior of printing all processes.
    Another useful set of flags are `-q` (quiet) and `–n` (number of iterations).
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 与以前的一些命令不同，`iotop`非常专门用于显示正在使用I/O的进程。但是，有一些非常有用的标志可以改变`iotop`的默认行为。例如`–o`（仅）告诉`iotop`仅打印使用I/O的进程，而不是其默认行为打印所有进程。另一组有用的标志是`-q`（安静）和`–n`（迭代次数）。
- en: 'Together with the `-o` flag, these flags can be used to tell `iotop` to print
    only the processes using I/O without clearing the screen for the next iteration:'
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 连同`-o`标志一起，这些标志可以用来告诉`iotop`仅打印使用I/O的进程，而不清除下一次迭代的屏幕：
- en: '[PRE40]'
  id: totrans-245
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: If we look at the preceding example output, we can see two independent iterations
    of the `iotop` command. However, unlike previous examples, the output is continuous
    allowing us to see which processes were using I/O at each iteration.
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们看一下前面的示例输出，我们可以看到`iotop`命令的两个独立迭代。但是，与以前的示例不同，输出是连续的，允许我们看到每次迭代时使用I/O的进程。
- en: By default, the delay between `iotop` iterations is 1 second; however, this
    can be modified with the `-d` (delay) flag.
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，`iotop`迭代之间的延迟是1秒；但是，可以使用`-d`（延迟）标志进行修改。
- en: iostat – report I/O and CPU statistics
  id: totrans-248
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: iostat - 报告I/O和CPU统计信息
- en: 'Where `iotop` shows what processes are utilizing I/O, `iostat` shows what devices
    are being utilized:'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: '`iotop`显示正在使用I/O的进程，`iostat`显示正在被利用的设备：'
- en: '[PRE41]'
  id: totrans-250
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: The preceding `iostat` command uses the `-t` (timestamp) flag to print a timestamp
    with each report. The two numbers are interval and count values. In the preceding
    example, the `iostat` is run with a one second interval for a total count of two
    iterations.
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的`iostat`命令使用`-t`（时间戳）标志在每个报告中打印时间戳。两个数字是间隔和计数值。在前面的示例中，`iostat`以一秒的间隔运行，总共迭代两次。
- en: The `iostat` command can be very useful for diagnosing issues related to I/O.
    However, the output can often be misleading. When executed, the values provided
    in the first report are averages since the last reboot of the system. The subsequent
    reports are since the previous report. In this example, we executed two reports,
    one second apart. You can see that the numbers in the first report are much higher
    than the second report.
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: '`iostat`命令对诊断与I/O相关的问题非常有用。但是，输出通常会产生误导。当执行时，第一个报告中提供的值是系统上次重启以来的平均值。随后的报告是自上一个报告以来的。在这个例子中，我们执行了两个报告，相隔一秒。您可以看到第一个报告中的数字比第二个报告中的数字要高得多。'
- en: For this reason, many systems administrators simply ignore the first report
    but they do not fully understand why. Therefore, it is not uncommon for someone
    unfamiliar with `iostat` to react to the values in the first report.
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，许多系统管理员简单地忽略第一个报告，但他们并不完全理解为什么。因此，对于不熟悉`iostat`的人来说，对第一个报告中的值做出反应并不罕见。
- en: The `iostat` command does have a flag `-y` (omit first report), which will actually
    cause `iostat` to omit the first report. This is a good flag to teach users who
    may not be very familiar with using `iostat`.
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: '`iostat`命令有一个`-y`标志（省略第一个报告），这实际上会导致`iostat`省略第一个报告。这是一个很好的标志，可以教给那些可能不太熟悉使用`iostat`的用户。'
- en: Manipulating the output
  id: totrans-255
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 操纵输出
- en: 'The `iostat` command also has quite a few useful flags that allow you to manipulate
    how it presents data. Flags such as `–p` (device) allow you to limit statistics
    to a specified device or `–x` (extended stats) that will print extended statistics:'
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: '`iostat`命令也有一些非常有用的标志，允许您操纵它呈现数据的方式。例如`-p`（设备）标志允许您将统计信息限制为指定的设备，或者`-x`（扩展统计）将打印扩展统计信息：'
- en: '[PRE42]'
  id: totrans-257
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: The preceding example uses the `-p` flag to specify the `sda` device, the `-t`
    flag to print timestamps, and the `-x` flag to print extended statistics. These
    flags can be very useful when measuring I/O performance for specific devices.
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的示例使用了`-p`标志来指定`sda`设备，`-t`标志来打印时间戳，`-x`标志来打印扩展统计信息。在测量特定设备的I/O性能时，这些标志非常有用。
- en: vmstat – report virtual memory statistics
  id: totrans-259
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: vmstat - 报告虚拟内存统计信息
- en: 'Where `iostat` is used to report statistics about disk I/O performance, `vmstat`
    is used to report statistics about memory usage and performance:'
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: '`iostat`用于报告有关磁盘I/O性能的统计信息，而`vmstat`用于报告有关内存使用和性能的统计信息：'
- en: '[PRE43]'
  id: totrans-261
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: The `vmstat` syntax is very similar to `iostat` where you provide an interval
    and count of reports as command line arguments. Also, like `iostat`, the first
    report is actually an average since the last reboot and subsequent reports are
    since the previous report. Unfortunately, unlike the `iostat` command, the `vmstat`
    command does not include a flag to omit the first report. As such, in most cases,
    it is appropriate to simply ignore the first report.
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: '`vmstat`的语法与`iostat`非常相似，您可以在命令行参数中提供间隔和报告计数。与`iostat`一样，第一个报告实际上是自上次重启以来的平均值，随后的报告是自上一个报告以来的。不幸的是，与`iostat`命令不同，`vmstat`命令没有包含一个标志来省略第一个报告。因此，在大多数情况下，简单地忽略第一个报告是合适的。'
- en: 'While `vmstat` might not include a flag to omit the first report, it does have
    some very useful flags; they are flags such as `–m` (slabs), which causes `vmstat`
    to output the system''s `slabinfo` at a defined interval, and `-s` (stats), which
    prints an extended report of the memory statistics for the system:'
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然`vmstat`可能不包括省略第一个报告的标志，但它确实有一些非常有用的标志；例如`-m`（slabs），这会导致`vmstat`以定义的间隔输出系统的`slabinfo`，以及`-s`（stats），它会打印系统的内存统计的扩展报告：
- en: '[PRE44]'
  id: totrans-264
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: The preceding code is an example of the `-s` or `--stats` flag being used.
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的代码是使用`-s`或`--stats`标志的示例。
- en: sar – collect, report, or save system activity information
  id: totrans-266
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: sar - 收集、报告或保存系统活动信息
- en: One very useful utility is the `sar` command, `sar` is a utility that comes
    with the `sysstat` package. The `sysstat` package includes various utilities that
    collect system metrics such as disk, CPU, memory, and network utilization. By
    default, this collection will run every 10 minutes and is executed as a `cron`
    job within `/ettc/cron.d/sysstat`.
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 一个非常有用的实用程序是`sar`命令，`sar`是`sysstat`软件包附带的实用程序。`sysstat`软件包包括各种实用程序，用于收集磁盘、CPU、内存和网络利用率等系统指标。默认情况下，这个收集将每10分钟运行一次，并作为`cron`作业在`/ettc/cron.d/sysstat`中执行。
- en: 'While the data collected by `sysstat` can be very useful, this package is sometimes
    removed in high performance environments. As the collection of the system utilization
    statistics can add to the system''s utilization, causing performance degradation.
    To see if the `sysstat` package is installed, simply use the rpm command with
    the `-q` (query) flag:'
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然`sysstat`收集的数据可能非常有用，但在高性能环境中有时会删除这个软件包。因为系统利用率统计数据的收集可能会增加系统的利用率，导致性能下降。要查看`sysstat`软件包是否已安装，只需使用rpm命令和`-q`（查询）标志：
- en: '[PRE45]'
  id: totrans-269
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: Using the sar command
  id: totrans-270
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 使用sar命令
- en: 'The `sar` command allows users to review the information collected by the `sysstat`
    utilities. When executed with no flags, the `sar` command will print the current
    day''s CPU statistics:'
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: '`sar`命令允许用户查看`sysstat`实用程序收集的信息。当不带标志执行`sar`命令时，将打印当天的CPU统计信息：'
- en: '[PRE46]'
  id: totrans-272
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'Every day at midnight, the `systat` collector will create a new file to store
    the collected statistics. To reference the statistics within that file, simply
    use the `-f` (file) flag to run `sar` against the specified file:'
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 每天午夜，`systat`收集器将创建一个新文件来存储收集的统计信息。要引用该文件中的统计信息，只需使用`-f`（文件）标志来针对指定的文件运行`sar`：
- en: '[PRE47]'
  id: totrans-274
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: In the preceding code, the file specified was `/var/log/sa/sa13`; this file
    contains statistics for the 13th day of the current month.
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的代码中，指定的文件是`/var/log/sa/sa13`；这个文件包含了当月第13天的统计信息。
- en: 'The `sar` command has many useful flags, far too many to list in this chapter.
    A few extremely useful flags are listed as follows:'
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: '`sar`命令有许多有用的标志，远远不止在本章中列出的。以下列出了一些非常有用的标志：'
- en: '`-b`: This prints I/O statistics similar to the `iostat` command'
  id: totrans-277
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: -b：这会打印类似于`iostat`命令的I/O统计信息
- en: '`-n ALL`: This prints network statistics for all network devices'
  id: totrans-278
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-n ALL`：这会打印所有网络设备的网络统计信息'
- en: '`-R`: This prints memory utilization statistics'
  id: totrans-279
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-R`：这会打印内存利用率统计信息'
- en: '`-A`: This prints all statistics gathered. It is essentially equivalent to
    running `sar -bBdHqrRSuvwWy -I SUM -I XALL -m ALL -n ALL -u ALL -P ALL`'
  id: totrans-280
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-A`：这会打印所有收集的统计信息。它基本上等同于运行`sar -bBdHqrRSuvwWy -I SUM -I XALL -m ALL -n ALL
    -u ALL -P ALL`'
- en: While the `sar` command shows many statistics, we already covered commands such
    as `iostat` or `vmstat`. The biggest benefit of the `sar` command is the ability
    to review statistics in the past. This ability is critical when troubleshooting
    a performance issue that occurred for a short period of time or was already mitigated.
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然`sar`命令显示了许多统计信息，但我们已经涵盖了诸如`iostat`或`vmstat`之类的命令。`sar`命令最大的好处在于能够回顾过去的统计数据。当排除发生在短时间内或已经被缓解的性能问题时，这种能力是至关重要的。
- en: Summary
  id: totrans-282
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, you learned that log files, configuration files, and the `/proc`
    filesystem are key sources of information during troubleshooting. We also covered
    the basic use of many fundamental troubleshooting commands.
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，您了解到日志文件、配置文件和`/proc`文件系统是故障排除过程中的关键信息来源。我们还介绍了许多基本故障排除命令的基本用法。
- en: While reading this chapter, you might have noticed that quite a few commands
    are also used in day-to-day life for non-troubleshooting purposes. If we look
    back at the troubleshooting process from [Chapter 1](part0014_split_000.html#DB7S1-8ae10833f0c4428b9e1482c7fee089b4
    "Chapter 1. Troubleshooting Best Practices"), *Troubleshooting Best Practices*,
    the first step included information gathering.
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 在阅读本章的过程中，您可能已经注意到，相当多的命令也用于日常生活中的非故障排除目的。如果我们回顾一下来自[第1章](part0014_split_000.html#DB7S1-8ae10833f0c4428b9e1482c7fee089b4
    "第1章。故障排除最佳实践") *故障排除最佳实践* 的故障排除过程，第一步包括信息收集。
- en: While these commands might not explain the issue themselves, they can help gather
    information about the issue, which leads to a more accurate and quick resolution.
    Familiarity with these fundamental commands is critical to your success during
    troubleshooting.
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然这些命令本身可能无法解释问题，但它们可以帮助收集有关问题的信息，从而实现更准确和快速的解决方案。熟悉这些基本命令对于您在故障排除过程中取得成功至关重要。
- en: In the next few chapters, we will use these fundamental commands to troubleshoot
    real-world scenarios. The next chapter focuses on troubleshooting issues with
    a web-based application.
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的几章中，我们将使用这些基本命令来解决现实世界中的问题。下一章将重点解决与基于Web的应用程序相关的问题。
