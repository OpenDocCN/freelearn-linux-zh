- en: 2\. Understanding Linux distributions
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2. 理解Linux发行版
- en: '*Good things come in many flavors, and so do Linux distributions.*'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: '*好东西有很多种，Linux发行版也是如此。*'
- en: To create a successful cloud migration plan, you need a good understanding of
    the components and variables of the system that you want to migrate to the cloud.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建一个成功的云迁移计划，您需要对您想要迁移到云中的系统的组件和变量有一个良好的理解。
- en: In this chapter, you will learn about the relevant terminology and technical
    details of various Linux distributions to help you plan successful migrations
    to Azure. Even though all the distributions are based on the same operating system,
    each of them has its own small technical details that require detailed knowledge
    to successfully prepare for a migration. Along with the introduction to the distributions,
    we will have a look at the licensing options, as well as the differences between
    free and commercial open-source software. Commercial Linux distributions have
    various add-on features and support options. We will also cover some typical use
    cases for different distributions.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，您将学习有关各种Linux发行版的相关术语和技术细节，以帮助您计划成功迁移到Azure。尽管所有的发行版都是基于同一个操作系统，但每个发行版都有自己的一些小技术细节，需要详细的了解才能成功地为迁移做准备。除了介绍发行版，我们还将研究许可选项，以及免费和商业开源软件之间的区别。商业Linux发行版具有各种附加功能和支持选项。我们还将涵盖不同发行版的一些典型用例。
- en: The final section of this chapter is *Linux on Azure*, and it starts with a
    discussion of the Microsoft-endorsed distributions and the scope of support provided
    by Microsoft. The support is shared between Microsoft and the Linux vendor. We
    will also cover the licensing models in Azure for Linux virtual machines and what
    the potential savings for the customer are with each model. We will conclude this
    chapter with a demonstration using the Azure CLI to find details on VM images;
    this is useful if you want to see a list of available images on Azure.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的最后一部分是*Linux在Azure上*，它从微软认可的发行版和微软提供的支持范围开始讨论。支持由微软和Linux供应商共同提供。我们还将介绍Azure上Linux虚拟机的许可模型，以及每个模型对客户的潜在节省。我们将以使用Azure
    CLI进行演示来结束本章；如果您想查看Azure上可用镜像的列表，这将非常有用。
- en: 'This chapter will cover the following topics:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将涵盖以下主题：
- en: Linux licensing and open-source business models
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Linux许可和开源商业模型
- en: Popular Linux distributions
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 流行的Linux发行版
- en: 'Linux on Azure: benefits, licensing models, support'
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure上的Linux：好处、许可模型、支持
- en: By the end of this chapter, you will have learned the necessary tips and tricks
    for moving Linux subscriptions to the cloud. Let's start our discussion by exploring
    Linux licenses.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 通过本章的学习，您将学会将Linux订阅迁移到云的必要技巧和窍门。让我们从探讨Linux许可证开始我们的讨论。
- en: Linux licensing and open-source business models
  id: totrans-10
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Linux许可和开源商业模型
- en: This section focuses on commercial Linux distributions. If you are using only
    free community editions of Linux, such as CentOS or Debian, some of the content
    may not be applicable to you.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 本节重点介绍商业Linux发行版。如果您只使用免费的Linux社区版本，如CentOS或Debian，一些内容可能不适用于您。
- en: Open-source licenses
  id: totrans-12
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 开源许可证
- en: How do you make money from something that is free? To answer that, we must look
    back and see what it means when we say something is open source.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 如何从免费的东西中赚钱？要回答这个问题，我们必须回顾一下当我们说某样东西是开源时意味着什么。
- en: Linux distributions and the Linux kernel are open source, but at the same time,
    they are covered by copyright laws. To make things very complicated, there are
    numerous open-source licenses covering different parts of a Linux distribution.
    Some components may be covered by a **GNU General Public License** (**GPL**),
    some by an **Apache License** (**APL**), and some by an MIT license. To make this
    even more complex, it is important to realize that there may be multiple versions
    of the same license and that they may not all be compatible with each other or
    with any other license whatsoever.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: Linux发行版和Linux内核是开源的，但同时也受版权法保护。要使事情变得非常复杂，有许多开源许可证涵盖Linux发行版的不同部分。一些组件可能受到**GNU通用公共许可证**（**GPL**）的保护，一些可能受到**Apache许可证**（**APL**）的保护，还有一些可能受到MIT许可证的保护。更复杂的是，重要的是要意识到同一许可证可能有多个版本，它们可能彼此之间或与任何其他许可证都不兼容。
- en: At this point, it is enough to understand that all Linux distributions are covered
    by an open-source license. This means you have the right to download the source
    code of all the software included in a Linux distribution. What you can do with
    the source code is out of the scope of this book, since we are not creating our
    own Linux distributions. In this book, we do not have to go into the details of
    various open-source licenses and copyright laws.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一点上，了解所有Linux发行版都受开源许可证保护就足够了。这意味着您有权下载Linux发行版中包含的所有软件的源代码。您可以对源代码做什么超出了本书的范围，因为我们不是在创建自己的Linux发行版。在本书中，我们不必深入研究各种开源许可证和版权法的细节。
- en: Enterprise agreements
  id: totrans-16
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 企业协议
- en: When talking about commercial open source, and specifically commercial Linux
    distributions, the term **enterprise agreement** is something you will need to
    familiarize yourself with before thinking about moving your Linux servers to Azure.
    We might often skip reading the terms and conditions of such agreements before
    accepting them with a simple click of a mouse, but it's important to read them.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 在谈论商业开源，特别是商业Linux发行版时，**企业协议**是您在考虑将Linux服务器迁移到Azure之前需要熟悉的术语。我们可能经常在接受这些协议之前跳过阅读条款和条件，只是简单地点击鼠标，但是重要的是要阅读它们。
- en: An enterprise agreement for commercial Linux vendors typically states that you
    agree to pay to use their software according to their latest price lists and to
    follow the rules of where and how you can use the software. It also says many
    other things, but since this is not a software procurement book, we will not go
    into those details. However, it might make sense for you to have a conversation
    with your software purchasing team to check if they know the contract details.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 商业Linux供应商的企业协议通常规定您同意根据他们的最新价格表支付使用他们软件的费用，并遵守您可以使用软件的地点和方式的规定。当然，它还说了很多其他事情，但由于这不是一本软件采购书籍，我们不会深入讨论这些细节。但是，与您的软件采购团队交谈以核对他们是否了解合同细节可能是有意义的。
- en: Linux subscriptions
  id: totrans-19
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Linux订阅
- en: What proprietary software vendors call "licenses" can be loosely referred to
    as "subscriptions" in the Linux world. Technically these are, of course, two different
    things, but in a typical sales conversation, you may hear someone talk about Linux
    licenses—and as we learned earlier, those are not the licenses you are looking
    for.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 专有软件供应商所谓的“许可证”在Linux世界中可以宽泛地称为“订阅”。从技术上讲，它们当然是两回事，但在典型的销售对话中，您可能会听到有人谈论Linux许可证——正如我们之前所了解的那样，这些并不是您要寻找的许可证。
- en: '**Subscription** practically means the right to download, use, and update a
    commercial Linux distribution. It very often also comes with a technical support
    service with varying service level agreements. In order to subscribe to such a
    service, you will need to sign a contract with a commercial Linux vendor on behalf
    of your employer. This contract is usually referred to as an enterprise agreement,
    and it typically comes with some additional obligations. One of these obligations
    is to follow the rules of the service subscription agreement.'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: '**订阅**实际上意味着有权下载、使用和更新商业Linux发行版。通常还附带有各种服务级别协议的技术支持服务。为了订阅这样的服务，您需要代表您的雇主与商业Linux供应商签订合同。这份合同通常被称为企业协议，通常还附带一些额外的义务。其中之一就是遵守服务订阅协议的规定。'
- en: For example, the subscription rules for Red Hat Enterprise Linux state that
    you may only use the software on your own infrastructure. Practically, this also
    includes hosted environments, which are considered rented infrastructure. Public
    clouds are not considered as your own infrastructure and you will need to inform
    Red Hat if you want to move your Linux servers to the public cloud.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，Red Hat Enterprise Linux的订阅规则规定您只能在自己的基础设施上使用该软件。实际上，这也包括托管环境，这被视为租用的基础设施。公共云不被视为您自己的基础设施，如果您想将Linux服务器迁移到公共云，您需要通知Red
    Hat。
- en: SUSE has very similar subscription rules. As mentioned, it is a very good idea
    to check the contracts with your software purchasing department to ensure that
    you are following the rules.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: SUSE的订阅规则非常相似。正如前面提到的，最好与软件采购部门核对合同，以确保您遵守规定。
- en: With Ubuntu, the concept of subscriptions is a bit different; you do not need
    a subscription to use it at all. In this case, the subscription refers to a professional
    support service contract from Canonical, the company behind Ubuntu. In addition
    to the free Ubuntu Linux, Canonical also offers Ubuntu Pro, their commercial Ubuntu
    image on Azure.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 对于Ubuntu来说，订阅的概念有些不同；您根本不需要订阅就可以使用它。在这种情况下，订阅是指来自Ubuntu背后的公司Canonical的专业支持服务合同。除了免费的Ubuntu
    Linux，Canonical还提供了Ubuntu Pro，他们在Azure上的商业Ubuntu镜像。
- en: '*Figure 2.1* illustrates the differences between licenses, subscriptions, and
    support contracts of commercial and community Linux distributions:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.1展示了商业和社区Linux发行版的许可证、订阅和支持合同之间的区别：
- en: '![The relation of licenses and contracts](img/B17160_02_01.jpg)'
  id: totrans-26
  prefs: []
  type: TYPE_IMG
  zh: '![许可证和合同的关系](img/B17160_02_01.jpg)'
- en: 'Figure 2.1: The differences between licenses, subscriptions, and contracts'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.1：许可证、订阅和合同之间的区别
- en: Enough of licenses and subscriptions. Let's take a look at the actual Linux
    distributions.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 许可证和订阅就说到这里。让我们来看看实际的Linux发行版。
- en: Popular Linux distributions
  id: totrans-29
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 流行的Linux发行版
- en: Various Linux server distributions have gained quite a stable market share over
    the years. Corporate users usually standardize on one or two distributions depending
    on the business applications they use. Red Hat and SUSE are the two most famous
    enterprise Linux development companies and vendors and they both have similar
    offerings around the Linux operating system area. Nowadays, the third commercial
    Linux vendor, Canonical, is playing in the same category. Their Ubuntu Linux used
    to be best known as a developer workstation distribution, and it has quickly gained
    popularity as a production server operating system as well. Coupled with Canonical's
    commercial support offering, Ubuntu Linux is a great alternative to the two leading
    enterprise Linux distributions.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 多种Linux服务器发行版多年来已经获得了相当稳定的市场份额。企业用户通常会根据他们使用的业务应用程序来标准化一到两种发行版。Red Hat和SUSE是两家最著名的企业级Linux开发公司和供应商，它们在Linux操作系统领域都提供类似的产品。如今，第三家商业Linux供应商Canonical也在同一领域竞争。他们的Ubuntu
    Linux曾经以开发者工作站发行版而闻名，但它很快也以生产服务器操作系统的身份迅速赢得了人气。结合Canonical的商业支持服务，Ubuntu Linux是两家领先的企业级Linux发行版的一个很好的替代品。
- en: Red Hat was founded in 1993 when Bob Young and Marc Ewing joined forces and
    created *Red Hat Software*. In 1999, Red Hat went public on the **New York Stock
    Exchange** (**NYSE**). Before its acquisition by IBM in 2019, Red Hat had acquired
    dozens of small open-source companies, such as Cygnus (cross-platform tools),
    JBoss (Java middleware), Qumranet (the creators of KVM virtualization technology),
    Makara (a PaaS platform, the first version of OpenShift), ManageIQ (a hybrid cloud
    orchestrator, the first version of CloudForms), InkTank (the creators of Ceph
    storage technology), Ansible (a popular automation toolkit), and CoreOS (a small
    Linux distro for containers).
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: Red Hat成立于1993年，当时Bob Young和Marc Ewing联手创建了*Red Hat Software*。1999年，Red Hat在**纽约证券交易所**（**NYSE**）上市。在2019年被IBM收购之前，Red
    Hat收购了数十家小型开源公司，如Cygnus（跨平台工具）、JBoss（Java中间件）、Qumranet（KVM虚拟化技术的创造者）、Makara（PaaS平台，OpenShift的第一个版本）、ManageIQ（混合云编排器，CloudForms的第一个版本）、InkTank（Ceph存储技术的创造者）、Ansible（一种流行的自动化工具包）和CoreOS（用于容器的小型Linux发行版）。
- en: The complete acquisition list consists of more than 30 companies that most of
    you have probably not heard of, since the brands have been merged with Red Hat's
    other product lines. **Red Hat Enterprise Linux** (**RHEL**) is a very popular
    platform nowadays, especially for Java middleware JBoss products, as is the commercial
    Kubernetes packaging, OpenShift, since both are published by Red Hat as well.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 完整的收购清单包括30多家公司，你们大多数可能都没有听说过，因为这些品牌已经与Red Hat的其他产品线合并。**Red Hat Enterprise
    Linux**（**RHEL**）是目前非常受欢迎的平台，特别是对于Java中间件JBoss产品，以及商业Kubernetes打包OpenShift，因为它们都是由Red
    Hat发布的。
- en: SUSE was founded a year before Red Hat, in 1992, and became the first company
    to market Linux to enterprise customers. Rolard Dyroff, Burchard Steinbild, Hubert
    Mantel, and Thomas Fehr first named the company *Gesellschaft für Software und
    Systementwicklung mbH* and used the acronym SuSE, which came from the German phrase
    *Software- und System-Entwicklung,* meaning *software and systems development.*
    The first version of their product was an extension of the then-popular Slackware
    Linux distribution. In 1996, they released their first Linux distribution, based
    on the already-forgotten Linux distribution Jurix, and deviated from Slackware.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: SUSE成立于1992年，比Red Hat早一年，并成为第一家向企业客户推广Linux的公司。Rolard Dyroff、Burchard Steinbild、Hubert
    Mantel和Thomas Fehr最初将公司命名为*Gesellschaft für Software und Systementwicklung mbH*，并使用了缩写SuSE，这源自德语短语*Software-
    und System-Entwicklung*，意思是*软件和系统开发*。他们的产品的第一个版本是当时流行的Slackware Linux发行版的扩展。1996年，他们发布了基于已经被遗忘的Linux发行版Jurix的第一个Linux发行版，并偏离了Slackware。
- en: Over the years, SUSE has been acquired and changed names several times, most
    notably by Novell in 2003 and EQT Partners in 2018\. SUSE itself acquired **Hewlett
    Packard Enterprise's** (**HPE's**) OpenStack and CloudFoundry assets in 2017,
    as well as Rancher Labs—a company known for its Kubernetes management platform—in
    2020\. Today, **SUSE Linux Enterprise Server** (**SLES**) is a very common platform
    for SAP system deployments.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 多年来，SUSE已经被收购并多次更名，最著名的是2003年被Novell收购和2018年被EQT Partners收购。SUSE本身在2017年收购了**惠普企业**（**HPE**）的OpenStack和CloudFoundry资产，以及Rancher
    Labs——一家以其Kubernetes管理平台而闻名的公司——在2020年。如今，**SUSE Linux Enterprise Server**（**SLES**）是SAP系统部署的非常常见的平台。
- en: For non-commercial use, it seems like Ubuntu is the clear winner if you look
    at the number of deployments. Ubuntu is based on Debian, once a very popular Linux
    distribution for server workloads.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 对于非商业用途来说，Ubuntu似乎是明显的赢家，如果您看一下部署数量的话。Ubuntu基于Debian，曾经是非常受欢迎的用于服务器工作负载的Linux发行版。
- en: CentOS, being fully compatible with RHEL, is also popular since it's typically
    used by RHEL professionals on their hobbyist projects and other work that doesn't
    have an enterprise-level budget available.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: CentOS也很受欢迎，因为它与RHEL完全兼容，通常由RHEL专业人员在他们的业余项目和其他没有企业级预算的工作中使用。
- en: Over the years, there have been many popular Linux distributions for desktop
    use, but they have not gained popularity on server use cases. We will not be covering
    those in the scope of this book since Linux on Azure usually refers to using server
    operating systems.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 多年来，有许多受欢迎的Linux发行版用于桌面使用，但它们在服务器使用情况下并没有获得流行。在本书的范围内，我们不会涵盖这些内容，因为Azure上的Linux通常指的是使用服务器操作系统。
- en: In the next section, we will go into the details of using free and commercial
    Linux distributions on Azure, with a particular focus on RHEL, SLES, and Ubuntu
    Pro. However, most of the content is applicable to their free versions CentOS,
    openSUSE, and Ubuntu as well.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的部分中，我们将详细介绍在Azure上使用免费和商业Linux发行版的细节，特别关注RHEL、SLES和Ubuntu Pro。然而，大部分内容也适用于它们的免费版本CentOS、openSUSE和Ubuntu。
- en: Linux on Azure
  id: totrans-39
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Azure上的Linux
- en: 'In *Chapter 1*, *Linux: History and future in the cloud*, we mentioned that
    Microsoft came up with the motto "Microsoft ♡ Linux." On Azure, Linux mainly refers
    to the different Linux distributions that are supported on Azure. Microsoft Azure
    supports common Linux server distros including RHEL, CentOS, Ubuntu, Debian, SLES,
    openSUSE, Oracle Linux, and Flatcar Container Linux. You can find the up-to-date
    list and much more about Linux on Azure at this landing page: [https://azure.com/linux](https://azure.com/linux).'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 在*第1章* *Linux：云中的历史和未来*中，我们提到Microsoft提出了“Microsoft ♡ Linux”的口号。在Azure上，Linux主要指的是在Azure上受支持的不同Linux发行版。Microsoft
    Azure支持常见的Linux服务器发行版，包括RHEL、CentOS、Ubuntu、Debian、SLES、openSUSE、Oracle Linux和Flatcar
    Container Linux。您可以在此着陆页上找到最新的列表以及有关Azure上Linux的更多信息：[https://azure.com/linux](https://azure.com/linux)。
- en: If the operating system that you are looking for is not on the list or you need
    to have a customized or pre-configured image, feel free to visit Azure Marketplace
    where you can browse through hundreds of images that may suit your requirements.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您正在寻找的操作系统不在列表中，或者您需要定制或预配置的映像，欢迎访问Azure Marketplace，在那里您可以浏览数百个可能符合您需求的映像。
- en: 'If the Azure Marketplace images do not meet your organization''s standards
    or requirements, you can create and upload your own images to Azure:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 如果Azure市场的映像不符合您组织的标准或要求，您可以创建并上传自己的映像到Azure：
- en: '![A view of the Azure Marketplace that shows different types of pre-configured
    images](img/B17160_02_02.jpg)'
  id: totrans-43
  prefs: []
  type: TYPE_IMG
  zh: '![Azure市场的视图，显示了不同类型的预配置映像](img/B17160_02_02.jpg)'
- en: 'Figure 2.2: Azure Marketplace'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.2：Azure市场
- en: '*Figure 2.2* is a view of Azure Marketplace, showing some of the different
    types of pre-configured images that are available.'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: '*图2.2*是Azure市场的视图，显示了一些不同类型的预配置映像。'
- en: Benefits of Linux on Azure
  id: totrans-46
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在Azure上Linux的好处
- en: Deploying in the cloud is no different from what you are used to on-premises;
    you will be able to work with the Linux OS in the cloud in the same way as with
    an on-premises server. You can use the commands and tools that you are already
    acquainted with and add more packages as required.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 在云中部署与您在本地部署的方式没有区别；您将能够以与本地服务器相同的方式在云中使用Linux操作系统。您可以使用您已经熟悉的命令和工具，并根据需要添加更多软件包。
- en: You can use out-of-the-box features such as cloud-init, Azure Automation Runbooks,
    and Azure Custom Script Extension for Azure Resource Manager templates to automate
    configuration management during the deployment phase itself. By using these tools,
    administrators will be able to save time that would have been spent on lengthy
    and repetitive configuration management tasks.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用云初始化、Azure自动化Runbooks和Azure资源管理器模板的Azure自定义脚本扩展等开箱即用的功能来自动化部署阶段的配置管理。通过使用这些工具，管理员将能够节省在冗长和重复的配置管理任务上所花费的时间。
- en: As the environment is already set up and ready to log into, you do not have
    to go through the lengthy installation process that you used to do in the case
    of on-premises hypervisors while creating VMs. The credentials will be supplied
    during the Azure VM creation and, once the VM is deployed, you can log in and
    start using the VM.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 由于环境已经设置好并准备好登录，您无需像在本地虚拟化程序中创建虚拟机时那样经历冗长的安装过程。在Azure虚拟机创建过程中将提供凭据，一旦部署了虚拟机，您就可以登录并开始使用虚拟机。
- en: Since all deployments are integrated with Azure Monitor, you can monitor all
    the metrics associated with the VM, such as CPU usage, disk write, disk read,
    network out, network in, and so on. Azure exposes the Metrics API, so you can
    further utilize the developed dashboards to monitor the metrics of your mission-critical
    workloads. Along with the metrics, Azure provides an agent that can be installed
    on your Linux VMs known as the **OMS agent**. Using this agent, you can ingest
    syslogs, auth logs, and custom logs such as Apache logs to an Azure Log Analytics
    workspace. Once the data is ingested, you can use the **Kusto Query Language**
    (**KQL**) to analyze the logs.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 由于所有部署都与Azure监视器集成，您可以监视与虚拟机相关的所有指标，如CPU使用率、磁盘写入、磁盘读取、网络出站、网络入站等。Azure公开了指标API，因此您可以进一步利用开发的仪表板来监视您的关键工作负载的指标。除了指标，Azure还提供了一个可以安装在您的Linux虚拟机上的代理，称为**OMS代理**。使用此代理，您可以将syslog、auth日志和自定义日志（如Apache日志）传送到Azure日志分析工作区。一旦数据被传送，您可以使用**Kusto查询语言**（**KQL**）来分析日志。
- en: From a security standpoint, you can improve the security posture of your infrastructure
    using Azure Security Center. Azure Security Center can detect threats and provide
    policy insights and recommendations for your deployments.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 从安全的角度来看，您可以使用Azure安全中心改善基础架构的安全姿态。Azure安全中心可以检测威胁，并为您的部署提供策略洞察和建议。
- en: Additionally, we can now make use of Azure Active Directory Login for Linux
    VMs. This eradicates the management overhead and security risk of managing local
    user accounts on each Linux machine; users can sign in to Linux VMs with their
    corporate credentials.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，我们现在可以利用Azure Active Directory登录Linux虚拟机。这消除了在每台Linux机器上管理本地用户帐户的管理开销和安全风险；用户可以使用其企业凭据登录Linux虚拟机。
- en: From this non-exhaustive list of advantages, we see that Linux on Azure offers
    the best of both worlds; you get all the customization features of Linux and at
    the same time all the features and benefits provided by Microsoft Azure.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 从这个非详尽的优势清单中，我们可以看到在Azure上的Linux提供了最佳的两全其美；您既可以获得Linux的所有定制功能，同时也可以获得Microsoft
    Azure提供的所有功能和好处。
- en: Linux on Azure is very generic; the "on Azure" suffix can apply separately to
    each distro. For example, you should take "Red Hat on Azure" to mean all the Red
    Hat products that are supported on Azure. You might think RHEL is the only offering
    from Red Hat that is available on Azure, but you can also find other products
    such as Azure Red Hat OpenShift, Red Hat JBoss Enterprise Application Platform,
    Red Hat Gluster Storage, Red Hat OpenShift Container Platform, Red Hat CloudForms,
    and Red Hat Ansible Automation. You can see that all the major product lines of
    Red Hat are available on Azure; this is a clear example of how large organizations
    promote their products to Microsoft Azure. You will see similar approaches from
    other vendors, as in "SUSE on Azure" and "Ubuntu on Azure," which stand for the
    products supported by the respective vendors in Azure.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: Azure上的Linux非常通用；“在Azure上”后缀可以分别应用于每个发行版。例如，您应该将“Red Hat on Azure”理解为在Azure上支持的所有Red
    Hat产品。您可能认为RHEL是Red Hat在Azure上唯一提供的产品，但您也可以找到其他产品，如Azure Red Hat OpenShift、Red
    Hat JBoss Enterprise Application Platform、Red Hat Gluster Storage、Red Hat OpenShift
    Container Platform、Red Hat CloudForms和Red Hat Ansible Automation。您可以看到Red Hat的所有主要产品线都可以在Azure上使用；这清楚地说明了大型组织如何将其产品推广到Microsoft
    Azure。您将看到其他供应商采用类似的方法，比如“SUSE on Azure”和“Ubuntu on Azure”，它们代表了在Azure上由各自供应商支持的产品。
- en: Note
  id: totrans-55
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 注意
- en: 'Check out the product lines available on Azure for the following vendors:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 查看Azure上以下供应商提供的产品线：
- en: 'Red Hat product lines available on Azure: [https://Azure.com/RedHat](https://Azure.com/RedHat
    )'
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在Azure上可用的Red Hat产品线：[https://Azure.com/RedHat](https://Azure.com/RedHat)
- en: 'SUSE product lines available on Azure: [https://Azure.com/SUSE](https://Azure.com/SUSE
    )'
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在Azure上可用的SUSE产品线：[https://Azure.com/SUSE](https://Azure.com/SUSE)
- en: 'Ubuntu on Azure: [https://Azure.com/Ubuntu](https://Azure.com/Ubuntu )'
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure上的Ubuntu：[https://Azure.com/Ubuntu](https://Azure.com/Ubuntu)
- en: Microsoft recommends using endorsed Linux distributions in Azure to host your
    production workloads. The rationale for this is that all endorsed images are maintained
    by the most well-known Linux vendors in the world, such as Red Hat, Canonical,
    SUSE, and so on; basically, endorsed images are images published by these vendors.
    The complete Linux support matrix can be reviewed at [https://docs.microsoft.com/troubleshoot/azure/cloud-services/support-linux-open-source-technology#linux-support-matrix](https://docs.microsoft.com/troubleshoot/azure/cloud-services/support-linux-open-source-technology#linux-support-matrix).
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: Microsoft建议在Azure中使用认可的Linux发行版来托管生产工作负载。这样做的理由是，所有认可的图像都由全球最知名的Linux供应商维护，如Red
    Hat、Canonical、SUSE等；基本上，认可的图像是由这些供应商发布的图像。完整的Linux支持矩阵可以在[https://docs.microsoft.com/troubleshoot/azure/cloud-services/support-linux-open-source-technology#linux-support-matrix](https://docs.microsoft.com/troubleshoot/azure/cloud-services/support-linux-open-source-technology#linux-support-matrix)上查看。
- en: 'You can also bring your own images to Azure if you do not want to use an endorsed
    image. You may even customize Azure images using the Azure Image Builder tool,
    which is based on Hashicorp Packer: [https://docs.microsoft.com/azure/virtual-machines/image-builder-overview](https://docs.microsoft.com/azure/virtual-machines/image-builder-overview).'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以将自己的图像带到Azure，如果您不想使用认可的图像。您甚至可以使用基于Hashicorp Packer的Azure Image Builder工具来定制Azure图像：[https://docs.microsoft.com/azure/virtual-machines/image-builder-overview](https://docs.microsoft.com/azure/virtual-machines/image-builder-overview)。
- en: One key point to note here is that Microsoft provides support to endorsed distributions
    only. Having said that, let's take a look at how the technical support for Linux
    on Azure is arranged.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 这里需要注意的一点是，Microsoft仅为认可的发行版提供支持。话虽如此，让我们来看看Azure上Linux的技术支持是如何安排的。
- en: Linux support scope
  id: totrans-63
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Linux支持范围
- en: Microsoft provides support for the endorsed Linux distributions on Azure, and
    if there is a need to engage the vendor, they will be engaged on your behalf depending
    on the scenario. For example, if there is an issue with the image of Ubuntu 18.04
    LTS and Microsoft cannot fix it, they will engage Canonical (the publisher of
    Ubuntu) to check the scenario. Here are some of the key points that you should
    keep in mind when engaging Microsoft Support.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: Microsoft为Azure上认可的Linux发行版提供支持，如果需要与供应商合作，根据情况将代表您与供应商合作。例如，如果Ubuntu 18.04
    LTS的图像出现问题，微软无法解决，他们将联系Canonical（Ubuntu的发布者）来检查情况。在与Microsoft支持合作时，以下是一些关键点需要牢记。
- en: Microsoft's technical support team can help you mainly in Linux troubleshooting
    scenarios—for instance, if you are unable to connect to a Linux VM with SSH, or
    unable to install a package. The Linux vendor may have to be engaged for issues
    related to the Linux image itself. For this Microsoft has joint support and engineering
    agreements with Linux vendors such as Red Hat, SUSE, and Canonical.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: Microsoft的技术支持团队主要可以帮助您解决Linux故障排除方案，例如，如果您无法通过SSH连接到Linux VM，或者无法安装软件包。与Linux供应商相关的问题可能需要与Linux供应商合作解决。为此，微软与Red
    Hat、SUSE和Canonical等Linux供应商签订了联合支持和工程协议。
- en: Always get your Linux administrator involved while working with Microsoft Support.
    In most troubleshooting scenarios, you might need superuser (often referred to
    as **sudo**) permissions, which only the admins will have.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 在与Microsoft支持合作时，始终让您的Linux管理员参与其中。在大多数故障排除方案中，您可能需要超级用户（通常称为**sudo**）权限，只有管理员才有这些权限。
- en: Linux offers more room for customization than any other operating system available.
    Some organizations use custom Linux kernels or modules that cannot be supported
    by Microsoft Support. Although kernel-related issues are resolved by collaborating
    with the Linux vendor, in this scenario, even the vendor may not be able to help
    as they can typically only support the official kernel versions published by themselves.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: Linux提供了比其他任何操作系统更多的定制空间。一些组织使用无法得到Microsoft支持的自定义Linux内核或模块。尽管内核相关的问题是通过与Linux供应商合作解决的，但在这种情况下，即使供应商也可能无法提供帮助，因为他们通常只能支持自己发布的官方内核版本。
- en: Azure Advisor and Azure Security Center provide different security-, cost-,
    high availability-, and performance-related recommendations for our workloads.
    Following these recommendations is one of the best practices to run your workloads
    effectively on Azure. However, for performance tuning and optimization, customers
    may need to contact the vendor for resolution.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: Azure Advisor和Azure Security Center为我们的工作负载提供了不同的安全、成本、高可用性和性能相关的建议。遵循这些建议是在Azure上有效运行工作负载的最佳实践之一。然而，对于性能调优和优化，客户可能需要联系供应商解决问题。
- en: 'As mentioned earlier, Microsoft Support helps you to troubleshoot issues. This
    applies to the free Azure support, which is officially called "Basic" and is included
    for all Azure customers. If you need help to design, create architecture, or deploy
    applications on Azure, you have the option to purchase additional support, which
    ranges from development support to business-critical enterprise support plans.
    The paid plans include various levels of design and architecture support, and
    you can read more about them here: [https://azure.microsoft.com/support/plans/](https://azure.microsoft.com/support/plans/).'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 正如前面提到的，Microsoft支持帮助您解决问题。这适用于免费的Azure支持，官方称为“基本支持”，适用于所有Azure客户。如果您需要帮助设计、创建架构或在Azure上部署应用程序，您可以选择购买额外的支持，范围从开发支持到业务关键企业支持计划。付费计划包括各种级别的设计和架构支持，您可以在这里了解更多信息：[https://azure.microsoft.com/support/plans/](https://azure.microsoft.com/support/plans/)。
- en: Another option to get help with Azure design, architecture, and other technical
    questions is to engage with Microsoft's sales and partner teams, namely the **Customer Success
    Unit** (**CSU**) and **One Commercial Partner** (**OCP**). These teams are able
    to assist named commercial customers and partners. It is good to remember that
    these organizations are not replacements for Microsoft Support but are part of
    Microsoft's Global Sales and Marketing organization. To get in touch with the
    technical staff of the CSU and OCP teams, you should contact your named Microsoft
    account manager.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 获取有关Azure设计、架构和其他技术问题的帮助的另一种选择是与微软的销售和合作伙伴团队进行交流，即**客户成功单位**（**CSU**）和**一个商业合作伙伴**（**OCP**）。这些团队能够为指定的商业客户和合作伙伴提供帮助。需要记住的是，这些组织并不是微软支持的替代品，而是微软全球销售和营销组织的一部分。要与CSU和OCP团队的技术人员联系，您应该联系您指定的微软客户经理。
- en: 'A third and very popular option is to talk with the large network of Microsoft
    partners. They are able to provide a broad range of advisory, consulting, implementation,
    and operational assistance for Azure in general as well as Linux on Azure. Many
    of these partners are also partnered with some of the Linux vendors mentioned
    in this chapter. The easiest way to locate Microsoft partners is to use the Microsoft
    solution provider search tool: [https://www.microsoft.com/solution-providers/home](https://www.microsoft.com/solution-providers/home).'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 第三种非常受欢迎的选择是与微软合作伙伴的大型网络进行交流。他们能够为Azure总体以及Azure上的Linux提供广泛的咨询、咨询、实施和运营支持。这些合作伙伴中的许多也与本章提到的一些Linux供应商合作。查找微软合作伙伴的最简单方法是使用微软解决方案提供商搜索工具：[https://www.microsoft.com/solution-providers/home](https://www.microsoft.com/solution-providers/home)。
- en: Note
  id: totrans-72
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 注
- en: Along with the endorsed Linux distribution support, Microsoft also provides
    production support for certain OSS technologies such as PHP, Java, Python, Node.js,
    MySQL, Apache, Tomcat, and WordPress. This list is subject to change and the technical
    support available may be very limited.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 除了认可的Linux发行版支持外，微软还为某些开源技术提供生产支持，如PHP、Java、Python、Node.js、MySQL、Apache、Tomcat和WordPress。此列表可能会有所变化，可用的技术支持可能非常有限。
- en: Now that we are familiar with the scope of Azure Technical Support, let's look
    at how pricing works on Azure.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经熟悉了Azure技术支持的范围，让我们来看看Azure的定价是如何工作的。
- en: Licensing on Azure
  id: totrans-75
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Azure上的许可证
- en: 'In Azure, there are three licensing models: **pay-as-you-go** (**PAYG**), Azure
    Hybrid Benefit, and prepay. We will look at how these models vary and what the
    benefits are, starting with the PAYG model.'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 在Azure中，有三种许可模型：**按使用量付费**（**PAYG**）、Azure混合权益和预付费。我们将看看这些模型的差异以及其优势，首先从PAYG模型开始。
- en: The pay-as-you-go model
  id: totrans-77
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 按使用量付费模型
- en: 'As the name implies, in the PAYG model, customers are charged for the license
    as they use resources. For example, if you run a VM for 12 hours, you will see
    charges for:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 顾名思义，在PAYG模型中，客户会根据他们使用资源的时间来收取许可费用。例如，如果您运行一个VM 12小时，您将会看到以下费用：
- en: 12 hours of compute (which includes vCPU, RAM, and so on).
  id: totrans-79
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 12小时的计算（包括vCPU、RAM等）。
- en: 12 hours of Linux "license" or "subscription" use (if you are using distros
    such as RHEL or SLES that require a paid subscription).
  id: totrans-80
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 12小时的Linux“许可证”或“订阅”使用（如果您使用需要付费订阅的发行版，如RHEL或SLES）。
- en: The cost of a public IP address (if needed).
  id: totrans-81
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 公共IP地址的成本（如果需要）。
- en: The cost of egress network traffic.
  id: totrans-82
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 出口网络流量的成本。
- en: The cost of storage.
  id: totrans-83
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 存储成本。
- en: 'Usually, in the Azure Pricing Calculator ([https://azure.microsoft.com/pricing/calculator/](https://azure.microsoft.com/pricing/calculator/)),
    when you select a Linux VM that is running RHEL or SLES, you will be able to see
    the license cost. If you are using Ubuntu/CentOS, there will be no license cost.
    In *Figure 2.3*, you can see that for an RHEL VM there are compute and license
    costs under PAYG. The calculation is for 730 hours of consumption:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，在Azure定价计算器（[https://azure.microsoft.com/pricing/calculator/](https://azure.microsoft.com/pricing/calculator/)）中，当您选择运行RHEL或SLES的Linux
    VM时，您将能够看到许可成本。如果您使用Ubuntu/CentOS，则不会有许可成本。在*图2.3*中，您可以看到对于RHEL VM，在PAYG下有计算和许可成本。计算是针对730小时的消耗：
- en: '![Licensing cost for RHEL from the Azure Pricing Calculator](img/B17160_02_03.jpg)'
  id: totrans-85
  prefs: []
  type: TYPE_IMG
  zh: '![来自Azure定价计算器的RHEL许可成本](img/B17160_02_03.jpg)'
- en: 'Figure 2.3: Licensing cost for RHEL from the Azure Pricing Calculator'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.3：来自Azure定价计算器的RHEL许可成本
- en: 'On the other hand, if we pick Ubuntu/CentOS, the license cost will not be there,
    as shown in *Figure 2.4*:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 另一方面，如果我们选择Ubuntu/CentOS，许可成本将不复存在，如*图2.4*所示：
- en: '![Licensing cost does not apply to Ubuntu](img/B17160_02_04.jpg)'
  id: totrans-88
  prefs: []
  type: TYPE_IMG
  zh: '![Ubuntu不适用许可成本](img/B17160_02_04.jpg)'
- en: 'Figure 2.4: Licensing cost does not apply to Ubuntu'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.4：Ubuntu不适用许可成本
- en: To summarize, in PAYG, customers pay based on how long a VM runs. When the VM
    is deallocated, the compute cores are not utilized, which means no charges are
    incurred for compute cores or the license. This model is ideal for VMs that are
    deployed for testing and will be running for a short period of time, but if you
    have VMs running 24/7/365, this might not be the ideal model, as the license cost
    will keep on accumulating based on hours used. In these cases, it is better to
    go with the Azure Hybrid Benefit or prepay plans for potential savings.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 总之，在PAYG中，客户根据VM运行的时间付费。当VM被取消分配时，计算核心不被利用，这意味着不会因计算核心或许可证而产生费用。这种模型非常适合部署用于测试并且将在短时间内运行的VM，但如果您的VM全年无休地运行，这可能不是理想的模型，因为许可成本将根据使用的小时数不断累积。在这些情况下，最好选择Azure混合权益或预付费计划以节省成本。
- en: Azure Hybrid Benefit
  id: totrans-91
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Azure混合权益
- en: If you revisit the screenshot of the pricing calculator in *Figure 2.3*, you
    can see another option under **Software (Red Hat Enterprise Linux)**, one that
    reads **Azure Hybrid Benefit**. Previously, Azure Hybrid Benefit was referred
    to as a licensing benefit available for Windows Server and SQL VMs by which customers
    can bring their own Windows Server and SQL licenses to Azure. Using this method,
    the licensing cost is nullified, and customers can utilize the licenses that they
    had already purchased from their software assurance or volume licensing. In November
    2020, Azure Hybrid Benefit was made generally available for Linux.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您重新查看*图2.3*中的定价计算器的截图，您会发现在**软件（Red Hat Enterprise Linux）**下有另一个选项，即**Azure
    Hybrid Benefit**。以前，Azure Hybrid Benefit是指Windows Server和SQL VM的许可优惠，客户可以将自己的Windows
    Server和SQL许可证带到Azure中。使用这种方法，许可成本被抵消，客户可以利用他们已经从软件保障或大量许可购买的许可证。2020年11月，Azure
    Hybrid Benefit正式适用于Linux。
- en: Using Azure Hybrid Benefit, you can migrate your existing RHEL and SLES servers
    to Azure with **bring-your-own-subscription** (**BYOS**) billing. Normally, in
    the case of the PAYG model, you pay for both infrastructure (compute + storage
    + network) costs and software (license) costs. Since you are bringing your own
    subscription here, though, the software cost is nullified, and you pay only for
    the infrastructure, which drastically reduces the cost of hosting in Azure. You
    can convert your existing VMs under the PAYG model to BYOS billing without any
    downtime, which also means that the redeployment of these services is not required
    at all. When your BYOS expires, you can convert these VMs back to the PAYG model
    as required.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Azure Hybrid Benefit，您可以将现有的RHEL和SLES服务器迁移到Azure，并使用**自带订阅**（**BYOS**）计费。通常，在PAYG模式下，您需要支付基础设施（计算+存储+网络）成本和软件（许可证）成本。但是，在这里，由于您自带订阅，软件成本被抵消，您只需支付基础设施成本，这大大降低了在Azure中托管的成本。您可以在不中断服务的情况下将现有的VM转换为BYOS计费模式，这也意味着根本不需要重新部署这些服务。当您的BYOS到期时，您可以根据需要将这些VM转换回PAYG模式。
- en: All RHEL and SLES PAYG images on Azure Marketplace are eligible for Azure Hybrid
    Benefit. However, if you are choosing a custom image or any RHEL/SLES BYOS images
    from Azure Marketplace, those are not eligible for the benefit.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: Azure Marketplace上的所有RHEL和SLES PAYG映像都有资格享受Azure Hybrid Benefit。但是，如果您选择自定义映像或来自Azure
    Marketplace的任何RHEL/SLES BYOS映像，则这些映像不符合该优惠。
- en: 'Red Hat customers can follow the instructions below to get started with Azure
    Hybrid Benefit. Before we start, there are some prerequisites:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: Red Hat客户可以按照以下说明开始使用Azure Hybrid Benefit。在开始之前，有一些先决条件：
- en: You should have active or unused RHEL subscriptions that are eligible for Azure
    usage.
  id: totrans-96
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您应该拥有适用于Azure使用的活跃或未使用的RHEL订阅。
- en: You should have enabled one or more active or unused subscriptions for Azure
    usage with the Red Hat Cloud Access program. Red Hat Cloud Access is a program
    offered by Red Hat. Using this, you can run eligible Red Hat product subscriptions
    on Red Hat certified cloud providers such as Microsoft Azure, Amazon Web Services,
    and Google Cloud.
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您应该已经启用了一个或多个适用于Azure使用的活跃或未使用的订阅，使用了Red Hat Cloud Access计划。Red Hat Cloud Access是Red
    Hat提供的一个计划。使用此计划，您可以在诸如Microsoft Azure、Amazon Web Services和Google Cloud等Red Hat认证的云提供商上运行符合条件的Red
    Hat产品订阅。
- en: 'If you meet the prerequisites, the next step is to start using Azure Hybrid
    Benefit. Here are the steps you need to follow:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您符合先决条件，下一步就是开始使用Azure Hybrid Benefit。以下是您需要遵循的步骤：
- en: Choose one of the active or unused RHEL subscriptions and enable it for use
    in Azure. This is done from the Red Hat Cloud Access customer interface. Red Hat
    customers will be able to access this by logging in to [https://www.redhat.com/technologies/cloud-computing/cloud-access](https://www.redhat.com/technologies/cloud-computing/cloud-access).
    Only the subscriptions we enroll here are eligible to use Azure Hybrid Benefit.
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择一个活跃或未使用的RHEL订阅，并在Azure中启用它。这是通过Red Hat Cloud Access客户界面完成的。Red Hat客户可以通过登录[https://www.redhat.com/technologies/cloud-computing/cloud-access](https://www.redhat.com/technologies/cloud-computing/cloud-access)来访问此界面。只有我们在此处注册的订阅才有资格使用Azure
    Hybrid Benefit。
- en: Linking the subscription was the primary step; we can specify that the VMs use
    the RHEL subscription during the creation stage, or we can convert existing VMs.
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 链接订阅是主要步骤；我们可以在创建阶段指定VM使用RHEL订阅，或者可以转换现有的VM。
- en: During the creation of the VM, you can opt to use the existing RHEL subscription
    as shown in *Figure 2.5*:![Opting to use the existing RHEL subscription](img/B17160_02_05.jpg)
  id: totrans-101
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在创建VM时，您可以选择使用现有的RHEL订阅，如*图2.5*所示：![选择使用现有的RHEL订阅](img/B17160_02_05.jpg)
- en: 'Figure 2.5: Enabling Azure Hybrid Benefit during VM creation'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.5：在VM创建期间启用Azure Hybrid Benefit
- en: 'We can also convert existing VMs to Azure Hybrid Benefit without the need to
    redeploy. This can be achieved from the **Configuration** pane of the VM as shown
    in *Figure 2.6*:'
  id: totrans-103
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们还可以将现有的VM转换为Azure Hybrid Benefit，而无需重新部署。这可以通过VM的**配置**窗格来实现，如*图2.6*所示：
- en: '![Converting existing VMs to Azure Hybrid Benefit](img/B17160_02_06.jpg)'
  id: totrans-104
  prefs: []
  type: TYPE_IMG
  zh: '![将现有VM转换为Azure Hybrid Benefit](img/B17160_02_06.jpg)'
- en: 'Figure 2.6: Converting existing VMs to Azure Hybrid Benefit'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.6：将现有VM转换为Azure Hybrid Benefit
- en: Once this process is complete, in your Azure usage, you will see that the cost
    for the VM has dropped significantly. The process of attaching the RHEL subscription
    to Azure VMs can be done from the CLI and ARM templates as well if you would like
    to do this programmatically.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 完成此过程后，在您的Azure使用中，您会发现VM的成本已经大幅下降。如果您希望以编程方式执行此操作，可以使用CLI和ARM模板将RHEL订阅附加到Azure
    VM中。
- en: As mentioned earlier, customers have the freedom to switch back to a PAYG model
    whenever their RHEL subscriptions expire. Conversion back to the PAYG model is
    also done via the Configuration pane of the VM.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，客户可以在其RHEL订阅到期时自由切换回PAYG模式。切换回PAYG模式也是通过VM的配置窗格完成的。
- en: For SUSE customers, the process of attaching is pretty much the same; however,
    registration for using SUSE subscriptions is done via the SUSE Public Cloud program.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 对于SUSE客户，附加的过程基本相同；然而，使用SUSE订阅的注册是通过SUSE公共云计划完成的。
- en: This model is ideal for customers who have active or unused RHEL or SUSE subscriptions
    that they purchased from the respective vendors and who would like to utilize
    these in the cloud for potential savings over the PAYG model.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 这个模型非常适合那些拥有来自各自供应商购买的活跃或未使用的RHEL或SUSE订阅，并希望在云中利用这些订阅以节省PAYG模型的客户。
- en: In this model, we were using the subscription that we purchased from Red Hat
    or SUSE and attaching it to use with our Azure subscription. However, in the prepay
    model, which we are going to cover next, we will be purchasing Red Hat or SUSE
    software plans directly from Microsoft.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个模型中，我们使用了从Red Hat或SUSE购买的订阅，并将其附加到我们的Azure订阅中使用。然而，在预付模型中，我们将直接从微软购买Red Hat或SUSE软件计划。
- en: Prepay for Azure software plans
  id: totrans-111
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 预付Azure软件计划
- en: 'The final option under Software (Red Hat Enterprise Linux) in the Savings Options
    section of the Azure Pricing Calculator is 1 year reserved. *Figure 2.7* demonstrates
    the 1-year software plan being selected for Red Hat:'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: Azure定价计算器的节省选项部分中“软件（Red Hat企业Linux）”下的最终选项是1年预留。*图2.7*展示了选择Red Hat的1年软件计划：
- en: '![Selecting a one-year software plan for Red Hat](img/B17160_02_07.jpg)'
  id: totrans-113
  prefs: []
  type: TYPE_IMG
  zh: '![选择Red Hat的一年软件计划](img/B17160_02_07.jpg)'
- en: 'Figure 2.7: Calculating a software plan cost from the Azure Pricing Calculator'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.7：从Azure定价计算器计算软件计划成本
- en: In this model, customers can buy software plans directly from Microsoft for
    a term of 1 year and they can also renew if required by term-end. One catch here
    is that the plan amount should be paid upfront. In *Figure 2.7*, you can see that
    this has been mentioned in the cost; the moment a customer purchases a software
    plan from Azure, that charge will be added to the next invoice as an upfront cost
    for the next year.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个模型中，客户可以直接从微软购买1年期的软件计划，如果需要，还可以续订。这里的一个注意事项是计划金额应该提前支付。在*图2.7*中，您可以看到这已经在成本中提到；一旦客户从Azure购买了软件计划，该费用将被添加到下一张发票中，作为下一年的预付费用。
- en: Another key point to keep in mind here is that cancellation or exchange of these
    plans is not allowed. This means you should be buying the right plan for your
    workload. For example, if your product is SLES Priority for 2-4 vCPUs, you should
    purchase SLES Priority for 2-4 vCPUs. If you were to purchase SLES for HPC 1-2
    vCPUs instead of SLES Priority for 2-4 vCPUs by mistake, then you would not get
    the benefit and you would not be able to return or exchange this plan. A piece
    of advice here is to understand your workload and buy accordingly.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里要牢记的另一个关键点是，不允许取消或交换这些计划。这意味着您应该为您的工作负载购买正确的计划。例如，如果您的产品是适用于2-4个vCPU的SLES
    Priority，您应该购买适用于2-4个vCPU的SLES Priority。如果您错误地购买了适用于1-2个vCPU的SLES for HPC而不是适用于2-4个vCPU的SLES
    Priority，那么您将无法获得好处，也无法退货或交换此计划。在这里的建议是了解您的工作负载并相应购买。
- en: The software plan can be purchased from the Reservations pane in Azure, the
    very same place where we purchase reserved instances for Azure VMs, databases,
    and so on. The benefit will be applied automatically to the matching workload
    and no mapping is required.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 软件计划可以从Azure的预留窗格中购买，这正是我们购买Azure VM、数据库等预留实例的地方。好处将自动应用于匹配的工作负载，无需映射。
- en: For instance, if you have three SLES Priority instances, each with 4 vCPUs,
    then the right plan for you is SLES Priority for 2-4 vCPUs. Depending on the quantity
    you purchase, the discount is applied automatically to the instances. Assume that
    we purchased two SLES Priority for 2-4 vCPU plans; then, two out of three VMs
    will get the benefit and the remaining one will remain in the PAYG model. If you
    need the third one's cost also covered by the plan, then you need to buy another
    plan of the same kind. This new plan will automatically attach to the remaining
    VM.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，如果您有三个具有4个vCPU的SLES Priority实例，那么适合您的计划是适用于2-4个vCPU的SLES Priority。根据您购买的数量，折扣将自动应用于实例。假设我们购买了两个适用于2-4个vCPU的SLES
    Priority计划；那么三个VM中的两个将获得好处，剩下的一个将保持PAYG模型。如果您需要第三个的成本也由计划覆盖，那么您需要购买另一个相同类型的计划。这个新计划将自动附加到剩下的VM。
- en: Like Azure reserved instances, the software plans are a "use it or lose it"
    benefit. This means that if you deallocate all your VMs and the plan is not able
    to find a suitable VM to attach to, the benefit will be in vain. You cannot carry
    forward the unused hours.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 与Azure预留实例一样，软件计划是“使用或失去”好处。这意味着如果您取消分配所有VM，并且计划无法找到适合的VM进行附加，那么这个好处将是徒劳的。您无法结转未使用的小时数。
- en: Note
  id: totrans-120
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 注意
- en: You can avoid losing the benefit in the case of a migration by opening a billing
    support case on the Azure portal.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 在迁移的情况下，您可以通过在Azure门户上开启计费支持案例来避免失去好处。
- en: 'You should always do proper planning for your workloads before buying software
    plans to ensure that the most cost-effective plan is selected. Reiterating some
    of the considerations that we should be keeping in mind:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 在购买软件计划之前，您应该始终对工作负载进行适当的规划，以确保选择了最具成本效益的计划。重申一些我们应该牢记的考虑因素：
- en: The plan is ideal for 24/7/365 workloads; other servers need a billing support
    change request. If the plan is not able to discover the appropriate SKU, the utilization
    of the plan will be zero and you will lose a benefit.
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 该计划非常适合24/7/365的工作负载；其他服务器需要进行计费支持更改请求。如果计划无法发现适当的SKU，计划的利用率将为零，您将失去好处。
- en: No return or exchange is possible. Buy the right plan based on the product and
    vCores your VM has; buying the wrong plan or the wrong number of CPUs will result
    in a loss of money.
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 不允许退货或交换。根据您的VM的产品和vCores购买正确的计划；购买错误的计划或错误数量的CPU将导致损失。
- en: 'For SUSE plans, only certain SLES versions are supported. Make sure you check
    the version you are running using the `cat/etc/os-release` command and match with
    the documentation available here: [https://docs.microsoft.com/azure/cost-management-billing/reservations/understand-suse-reservation-charges#discount-applies-to-different-vm-sizes-for-suse-plans](https://docs.microsoft.com/azure/cost-management-billing/reservations/understand-suse-reservation-charges#discount-applies-to-different-vm-sizes-for-suse-plans).'
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于SUSE计划，只支持某些SLES版本。确保您使用`cat/etc/os-release`命令检查您正在运行的版本，并与此处提供的文档进行匹配：[https://docs.microsoft.com/azure/cost-management-billing/reservations/understand-suse-reservation-charges#discount-applies-to-different-vm-sizes-for-suse-plans](https://docs.microsoft.com/azure/cost-management-billing/reservations/understand-suse-reservation-charges#discount-applies-to-different-vm-sizes-for-suse-plans)。
- en: The plan's costs are upfront and will appear on your next invoice.
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计划的成本是预付的，并将出现在您的下一个发票上。
- en: In the next section, we will conclude the licensing part of the chapter with
    a helpful comparison of these licensing models and their benefits.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一节中，我们将以有益的比较结束本章的许可部分，比较这些许可模型及其优势。
- en: Savings comparison of licensing models
  id: totrans-128
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 许可模型的节省比较
- en: 'In the previous section, we saw the different types of licensing models that
    are available for your Linux workloads in Azure (refer to *Chapter 1*, *Linux:
    History and future in the cloud*). Here, we are going to make a comparison from
    the perspective of a customer and look at the savings percentage for each model.'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 在前一节中，我们看到了在Azure中为Linux工作负载提供的不同类型的许可模型（参见*第1章*，*Linux：云中的历史和未来*）。在这里，我们将从客户的角度进行比较，并查看每种模型的节省百分比。
- en: 'For demonstration purposes, we will be using the cost of an RHEL D2v3 VM running
    in East US for 730 hours in US dollars. At the time of writing, the cost of the
    software is $43.80 and $35.00 per month for the PAYG and prepay software plan
    models respectively. We are not taking into account the Azure Hybrid Benefit monthly
    charge as this subscription is bought from the respective model. If you are already
    partnered with Red Hat or SUSE, you could get some discounts on these subscriptions.
    Now let''s do the math; *Table 2.1* shows the cost per month for each model:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 为了演示目的，我们将使用在美国东部运行的RHEL D2v3 VM在美国东部运行730小时的成本（以美元计）。在撰写本文时，软件的成本分别为PAYG和预付软件计划模型分别为43.80美元和35.00美元/月。我们没有考虑Azure混合权益月度费用，因为此订阅是从相应的模型购买的。如果您已经与Red
    Hat或SUSE合作，您可以在这些订阅上获得一些折扣。现在让我们来做数学运算；*表2.1*显示了每种模型的每月成本：
- en: '![Azure licensing model comparison](img/B16170_Table_2.1.jpg)'
  id: totrans-131
  prefs: []
  type: TYPE_IMG
  zh: '![Azure许可模型比较](img/B16170_Table_2.1.jpg)'
- en: 'Table 2.1: Azure licensing model comparison'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 表2.1：Azure许可模型比较
- en: 'If we plot these values on a graph and calculate the savings percentage for
    a year, we will get a graph like the one shown in *Figure 2.8*:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们将这些值绘制在图表上，并计算一年的节省百分比，我们将得到一个类似于*图2.8*所示的图表：
- en: '![Graphical representation of savings percentage for a year](img/B17160_02_08.jpg)'
  id: totrans-134
  prefs: []
  type: TYPE_IMG
  zh: '![一年节省百分比的图形表示](img/B17160_02_08.jpg)'
- en: 'Figure 2.8: Calculating savings for licensing models'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.8：计算许可模型的节省
- en: The value may look small, but this is only for a single VM; in an enterprise
    environment where there will be thousands of VMs, the potential savings are very
    high.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 这个价值看起来很小，但这只是一个单独的VM；在将有成千上万个VM的企业环境中，潜在的节省非常高。
- en: 'Each model has its own use case scenarios:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 每种模型都有自己的用例场景：
- en: PAYG is ideal for testing or development where you are not planning to keep
    the VM running 24/7.
  id: totrans-138
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: PAYG非常适合测试或开发，您不打算让VM全天候运行。
- en: Azure Hybrid Benefit is appropriate if you have license subscriptions from Red
    Hat or SUSE and would like to use them in the cloud.
  id: totrans-139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果您拥有来自Red Hat或SUSE的许可订阅，并希望在云中使用它们，Azure混合权益是合适的。
- en: Prepay software plans are perfect for customers who do not have RHEL or SUSE
    subscriptions and would like to get some discounts on the software cost. However,
    this is a long-term commitment with Microsoft.
  id: totrans-140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 预付软件计划非常适合没有RHEL或SUSE订阅并希望在软件成本上获得一些折扣的客户。但是，这是与微软的长期承诺。
- en: 'Using Azure Reserved Instances, customers can also get a discount on the compute
    cost. In short, if you combine Azure Hybrid Benefit or a prepay software plan
    with Azure Reserved Instances, the overall savings percentage will be boosted
    to 50-70%. You can read more about Azure Reserved Instances for VMs here: [https://docs.microsoft.com/azure/cost-management-billing/reservations/save-compute-costs-reservations](https://docs.microsoft.com/azure/cost-management-billing/reservations/save-compute-costs-reservations).
    As this is not a licensing model, but more of a cost optimization technique, we
    will not cover this topic in this chapter. However, when we discuss assessment
    and migration in *Chapter 3*, *Assessment and migration planning*, we will discuss
    how to optimize cloud costs.'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Azure预留实例，客户还可以获得计算成本的折扣。简而言之，如果您将Azure混合权益或预付软件计划与Azure预留实例结合使用，整体节省百分比将提高到50-70%。您可以在此处阅读有关VM的Azure预留实例的更多信息：[https://docs.microsoft.com/azure/cost-management-billing/reservations/save-compute-costs-reservations](https://docs.microsoft.com/azure/cost-management-billing/reservations/save-compute-costs-reservations)。由于这不是一个许可模型，而更多是一种成本优化技术，我们将不在本章涵盖此主题。但是，当我们在*第3章*，*评估和迁移规划*中讨论评估和迁移时，我们将讨论如何优化云成本。
- en: Now that we are familiar with the licensing models, let's see how we can use
    the Azure **command-line interface (CLI)** to find the versions of available distros.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们熟悉了许可模型，让我们看看如何使用Azure**命令行界面（CLI）**来查找可用发行版的版本。
- en: Available distros
  id: totrans-143
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 可用的发行版
- en: 'In the introduction of the *Linux on Azure* section, we saw that Microsoft
    Azure supports common Linux distros such as Red Hat, Ubuntu, SUSE, CentOS, Debian,
    Oracle Linux, and CoreOS. We also saw how we can make use of Azure Marketplace
    to find the appropriate image as per our organization''s requirements. *Table
    2.2* displays the endorsed distros and the vendors/publishers who are providing
    these images:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 在*Linux on Azure*部分的介绍中，我们看到Microsoft Azure支持常见的Linux发行版，如Red Hat、Ubuntu、SUSE、CentOS、Debian、Oracle
    Linux和CoreOS。我们还看到了如何利用Azure Marketplace根据组织的需求找到合适的映像。*表2.2*显示了认可的发行版和提供这些映像的供应商/发布者：
- en: '![Endorsed Linux distributions on Azure](img/B16170_Table_2.2.jpg)'
  id: totrans-145
  prefs: []
  type: TYPE_IMG
  zh: '![Azure上认可的Linux发行版](img/B16170_Table_2.2.jpg)'
- en: 'Table 2.2: Endorsed Linux distributions on Azure'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 表2.2：Azure上认可的Linux发行版
- en: Though generic version numbers are given in the preceding table, it is very
    easy to find the image name and version from a publisher using the **Azure CLI**.
    In order to use the Azure CLI, we need to install it on our workstation. The Azure
    CLI can be installed on Linux, Mac, or Windows systems. If you are using the Cloud
    Shell in the Azure portal, by default the Azure CLI is installed for you.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管在上表中给出了通用版本号，但使用**Azure CLI**可以非常容易地从发布者那里找到图像名称和版本。为了使用Azure CLI，我们需要在我们的工作站上安装它。Azure
    CLI可以安装在Linux、Mac或Windows系统上。如果您在Azure门户中使用Cloud Shell，默认情况下会为您安装Azure CLI。
- en: 'Assuming that we are using a local computer (an Ubuntu computer, for example),
    we need to install the Azure CLI. You can find the specific installation steps
    depending on your operating system here: [https://docs.microsoft.com/cli/azure/install-azure-cli](https://docs.microsoft.com/cli/azure/install-azure-cli).
    For simplicity of demonstration, we will install the Azure CLI on an Ubuntu instance:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 假设我们正在使用本地计算机（例如Ubuntu计算机），我们需要安装Azure CLI。您可以根据您的操作系统在这里找到具体的安装步骤：[https://docs.microsoft.com/cli/azure/install-azure-cli](https://docs.microsoft.com/cli/azure/install-azure-cli)。为了简单起见，我们将在Ubuntu实例上安装Azure
    CLI：
- en: 'Microsoft has developed a script to run the installation in a single shot,
    which makes it convenient for beginners to ramp up quickly. If you prefer to perform
    this step by step, the Microsoft documentation has instructions for that as well.
    For Ubuntu, the installation can be done using the following command:'
  id: totrans-149
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 微软已经开发了一个脚本，可以一次性运行安装，这对于初学者来说非常方便。如果您更喜欢逐步执行此步骤，微软文档也有相应的说明。对于Ubuntu，可以使用以下命令进行安装：
- en: '[PRE0]'
  id: totrans-150
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'The output is shown in *Figure 2.9*:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 输出显示在*图2.9*中：
- en: '![Azure CLI installation on Ubuntu](img/B17160_02_09.jpg)'
  id: totrans-152
  prefs: []
  type: TYPE_IMG
  zh: '![Ubuntu上的Azure CLI安装](img/B17160_02_09.jpg)'
- en: 'Figure 2.9: Azure CLI installation on Ubuntu'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.9：Ubuntu上的Azure CLI安装
- en: The next step is to log in to our account from the Azure CLI in order to connect
    our Azure account to the Azure CLI. This can be accomplished by running the `az
    login` command. The console will prompt you to open a browser window and provide
    a code to complete the authentication process, as shown in *Figure 2.10*:![Logging
    in to Azure using the Azure CLI](img/B17160_02_10.jpg)
  id: totrans-154
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下一步是从Azure CLI登录到我们的帐户，以便将我们的Azure帐户连接到Azure CLI。这可以通过运行`az login`命令来实现。控制台将提示您打开一个浏览器窗口，并提供一个代码来完成身份验证过程，如*图2.10*所示：![使用Azure
    CLI登录到Azure](img/B17160_02_10.jpg)
- en: 'Figure 2.10: Logging in to Azure using the Azure CLI'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.10：使用Azure CLI登录到Azure
- en: In a browser window, you must enter the code shown in the terminal (as shown
    in *Figure 2.10*) and sign in using your credentials. Once signed in, the terminal
    will show all the subscriptions you have access to, as seen in *Figure 2.11*.
    If you do not want to authenticate using the code, you can log in using a service
    principal where you will be using the client ID and client secret as the username
    and password, respectively. Also, you can use Managed Identity if required:![Logging
    in to Azure by providing username and password and various other details](img/B17160_02_11.jpg)
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在浏览器窗口中，您必须输入终端中显示的代码（如*图2.10*所示），并使用您的凭据登录。登录后，终端将显示您可以访问的所有订阅，如*图2.11*所示。如果您不想使用代码进行身份验证，可以使用服务主体进行登录，其中您将使用客户端ID和客户端密钥分别作为用户名和密码。此外，如果需要，您还可以使用托管标识：![提供用户名和密码以及其他详细信息登录到Azure](img/B17160_02_11.jpg)
- en: 'Figure 2.11: Logged in to Azure'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.11：登录到Azure
- en: Now we will see how we can get information on the available VM images. The primary
    command used here is `az vm image`.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们将看到如何获取有关可用VM映像的信息。这里使用的主要命令是`az vm image`。
- en: To list the images (offline) for the VMs/VMSSs that are available on Azure Marketplace,
    you can use `az vm image list`. The response will be in JSON and we can format
    it to a table by appending the `-o table` parameter to the command. This will
    list offline cached images as shown in *Figure 2.12*:![The list of offline cached
    images](img/B17160_02_12.jpg)
  id: totrans-159
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要列出在Azure Marketplace上可用的VM/VMSS的映像（离线），您可以使用`az vm image list`。响应将以JSON格式显示，我们可以通过在命令后附加`-o
    table`参数来将其格式化为表格。这将列出离线缓存的映像，如*图2.12*所示：![离线缓存映像列表](img/B17160_02_12.jpg)
- en: 'Figure 2.12: Listing the VM images available'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.12：列出可用的VM映像
- en: To update the list and display all images, you can append the `–all` parameter
    to the command and call the command again.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 要更新列表并显示所有映像，可以在命令后附加`–all`参数并再次调用该命令。
- en: The preceding command may take a minute or two to refresh the list of all available
    images. Usually, when we query the image list, it is recommended to use the publisher
    or SKU or offer parameters, so that the search is limited to a set of images and
    the results can be retrieved very easily.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的命令可能需要一两分钟来刷新所有可用映像的列表。通常，当我们查询映像列表时，建议使用发布者、SKU或提供商参数，以便将搜索限制在一组映像上，并且可以非常容易地检索结果。
- en: In the next steps, we will be seeing how we can find the publisher, offer, or
    SKU for an image and use it in our `az vm image list` to narrow down the search.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的步骤中，我们将看到如何找到图像的发布者、提供商或SKU，并在我们的`az vm image list`中使用它来缩小搜索范围。
- en: In order to find the list of all publishers, we can use the `az vm image list-publishers`
    command. Location is a required parameter here, as some publishers publish only
    to a specific region, so it's recommended to check that the publisher has published
    to the region you are planning to deploy to. The following is the output:![The
    list of all publishers in the region](img/B17160_02_13.jpg)
  id: totrans-164
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了找到所有发布者的列表，我们可以使用`az vm image list-publishers`命令。在这里，位置是一个必需的参数，因为一些发布者只发布到特定的区域，所以建议检查发布者是否已经发布到您计划部署的区域。以下是输出：![该区域所有发布者的列表](img/B17160_02_13.jpg)
- en: 'Figure 2.13: Listing publishers in a region'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.13：列出区域的发布者
- en: 'For example, the publisher for Ubuntu is Canonical. If we want to list all
    the offers provided by this publisher, we can use the following command:'
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 例如，Ubuntu的发布者是Canonical。如果我们想列出该发布者提供的所有产品，我们可以使用以下命令：
- en: '[PRE1]'
  id: totrans-167
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Here the location is a required parameter, as offers may vary depending upon
    location. The output will be similar to the one shown in *Figure 2.14*:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，位置是一个必需的参数，因为产品可能会根据位置而变化。输出将类似于*图2.14*所示的内容：
- en: '![The list of images from the Canonical publisher in East US](img/B17160_02_14.jpg)'
  id: totrans-169
  prefs: []
  type: TYPE_IMG
  zh: '![在East US的Canonical发布者的图像列表](img/B17160_02_14.jpg)'
- en: 'Figure 2.14: Listing images from the Canonical publisher in East US'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.14：列出在East US的Canonical发布者的图像
- en: 'Let''s pick an offer; for instance, `UbuntuServer`. Now we need to list the
    SKUs to find the available SKUs for the image. We need to pass the publisher,
    offer, and location to the `az vm image list-skus` command in order to list the
    SKUs. The aforementioned parameters are mandatory for this command, so the final
    command will be as follows:'
  id: totrans-171
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 让我们选择一个产品；例如，`UbuntuServer`。现在我们需要列出SKU以找到图像的可用SKU。我们需要传递发布者、产品和位置到`az vm image
    list-skus`命令，以列出SKU。上述参数对于此命令是强制的，因此最终命令将如下所示：
- en: '[PRE2]'
  id: totrans-172
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'The output is as shown in *Figure 2.15*:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 输出如*图2.15*所示：
- en: '![The list of SKUs available for Canonical UbuntuServer offer in East US](img/B17160_02_15.jpg)'
  id: totrans-174
  prefs: []
  type: TYPE_IMG
  zh: '![Canonical UbuntuServer产品在East US可用的SKU列表](img/B17160_02_15.jpg)'
- en: 'Figure 2.15: Listing SKUs available for the Canonical UbuntuServer offer in
    East US'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.15：列出在East US可用的Canonical UbuntuServer产品的SKU
- en: 'Now we know the publisher, offer, and SKU. Let''s use these values in the `az
    vm image list` command to see the available versions of an image. Here we will
    be using `Canonical` as the publisher (`-p`), `UbuntuServer` as the offer (`-f`),
    and `19_04-gen2` as the SKU (`-s`). Combine these and call the following command:'
  id: totrans-176
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在我们知道了发布者、产品和SKU。让我们在`az vm image list`命令中使用这些值，以查看图像的可用版本。在这里，我们将使用`Canonical`作为发布者（`-p`），`UbuntuServer`作为产品（`-f`），`19_04-gen2`作为SKU（`-s`）。组合这些并调用以下命令：
- en: '[PRE3]'
  id: totrans-177
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'This will list the image version available for the specified publisher, offer,
    and SKU combination. The following is the sample output:'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 这将列出指定发布者、产品和SKU组合的图像版本。以下是示例输出：
- en: '![The list of versions of an image for a specific publisher, offer, and SKU
    combination](img/B17160_02_16.jpg)'
  id: totrans-179
  prefs: []
  type: TYPE_IMG
  zh: '![特定发布者、产品和SKU组合的图像版本列表](img/B17160_02_16.jpg)'
- en: 'Figure 2.16: Listing versions of an image for a specific publisher, offer,
    and SKU combination'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.16：列出特定发布者、产品和SKU组合的图像版本
- en: We can use `urn` from the output in the `az vm image show` command to get the
    details of the VM image as shown in *Figure 2.17*:![Finding details of the VM
    image](img/B17160_02_17.jpg)
  id: totrans-181
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以使用输出中的`urn`在`az vm image show`命令中获取VM图像的详细信息，如*图2.17*所示：![查找VM图像的详细信息](img/B17160_02_17.jpg)
- en: 'Figure 2.17: Finding VM image details'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.17：查找VM图像的详细信息
- en: The same `urn` can be used in our `az vm create` command to create a VM with
    that particular image version. A quick illustration has been given in *Figure
    2.18*:![Creating a VM using URN](img/B17160_02_18.jpg)
  id: totrans-183
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 相同的`urn`可以在我们的`az vm create`命令中使用，以创建具有特定图像版本的VM。*图2.18*中给出了一个快速示例：![使用URN创建VM](img/B17160_02_18.jpg)
- en: 'Figure 2.18: Creating a VM using URN'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.18：使用URN创建VM
- en: 'Before we conclude, please check *Table 2.3*, which lists all the commands
    we used in the preceding steps for quick reference:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们结束之前，请查看*表2.3*，其中列出了我们在前面步骤中使用的所有命令，以供快速参考：
- en: '| Command | Purpose | Required Parameters | Documentation |'
  id: totrans-186
  prefs: []
  type: TYPE_TB
  zh: '| 命令 | 目的 | 必需参数 | 文档 |'
- en: '| --- | --- | --- | --- |'
  id: totrans-187
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- |'
- en: '| az vm image list | Lists VM/VMSS images (offline/cached). | NA | [https://docs.microsoft.com/cli/azure/vm/image?view=azure-cli-latest](https://docs.microsoft.com/cli/azure/vm/image?view=azure-cli-latest)
    |'
  id: totrans-188
  prefs: []
  type: TYPE_TB
  zh: '| az vm image list | 列出VM/VMSS图像（离线/缓存）。 | 无 | [https://docs.microsoft.com/cli/azure/vm/image?view=azure-cli-latest](https://docs.microsoft.com/cli/azure/vm/image?view=azure-cli-latest)
    |'
- en: '| az vm image list --all | Lists all images from Azure Marketplace. This usually
    takes time due to the large dataset. It’s recommended that you filter using publisher,
    offer, and SKU for a quicker response. | NA |'
  id: totrans-189
  prefs: []
  type: TYPE_TB
  zh: '| az vm image list --all | 列出来自Azure Marketplace的所有图像。由于数据集较大，这通常需要时间。建议使用发布者、产品和SKU进行筛选，以获得更快的响应。
    | 无 |'
- en: '| az vm image list-publishers | Lists publishers available. | Location (`-l`)
    |'
  id: totrans-190
  prefs: []
  type: TYPE_TB
  zh: '| az vm image list-publishers | 列出可用的发布者。 | 位置（`-l`） |'
- en: '| az vm image list-offers | Lists VM image offers available. | Location (`-l`),
    publisher (`-p`) |'
  id: totrans-191
  prefs: []
  type: TYPE_TB
  zh: '| az vm image list-offers | 列出可用的VM图像产品。 | 位置（`-l`），发布者（`-p`） |'
- en: '| az vm image list-skus | Lists available SKUs for an offer from a publisher.
    | Location (`-l`), publisher (`-p`), offer (`-f`) |'
  id: totrans-192
  prefs: []
  type: TYPE_TB
  zh: '| az vm image list-skus | 列出发布者的产品的可用SKU。 | 位置（`-l`），发布者（`-p`），产品（`-f`） |'
- en: '| az vm image show | Shows details for a given URN. | Location (`-l`), URN
    (`-u`) |'
  id: totrans-193
  prefs: []
  type: TYPE_TB
  zh: '| az vm image show | 显示给定URN的详细信息。 | 位置（`-l`），URN（`-u`） |'
- en: '| az vm create | Creates a VM. | Name (`-n`), resource group (`-g`) | [https://docs.microsoft.com/cli/azure/vm?view=azure-cli-latest#az_vm_create](https://docs.microsoft.com/cli/azure/vm?view=azure-cli-latest#az_vm_create)
    |'
  id: totrans-194
  prefs: []
  type: TYPE_TB
  zh: '| az vm create | 创建VM。 | 名称（`-n`），资源组（`-g`） | [https://docs.microsoft.com/cli/azure/vm?view=azure-cli-latest#az_vm_create](https://docs.microsoft.com/cli/azure/vm?view=azure-cli-latest#az_vm_create)
    |'
- en: 'Table 2.3: Commands used for the hands-on exercise'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 表2.3：用于实践的命令
- en: In this hands-on exercise, we queried the image list to find the available images
    and created a VM using that. We learned how to narrow down the search using parameters
    such as publisher, offers, and SKU.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个实践操作中，我们查询了镜像列表以找到可用的镜像，并创建了一个VM。我们学会了如何使用发布者、提供和SKU等参数来缩小搜索范围。
- en: 'Although we used the Azure CLI to accomplish this task, if you are using PSCore
    or PowerShell, you can make use of the Azure Powershell module to perform the
    same operations. The documentation for this is available here: [https://docs.microsoft.com/powershell/module/az.compute/get-azvmimage?view=azps-5.2.0](https://docs.microsoft.com/powershell/module/az.compute/get-azvmimage?view=azps-5.2.0).'
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管我们使用Azure CLI来完成这项任务，但如果您使用PSCore或PowerShell，您可以利用Azure Powershell模块执行相同的操作。此文档可在此处找到：[https://docs.microsoft.com/powershell/module/az.compute/get-azvmimage?view=azps-5.2.0](https://docs.microsoft.com/powershell/module/az.compute/get-azvmimage?view=azps-5.2.0)。
- en: With that, we have reached the end of this chapter, and we will now summarize
    the topics we have discussed so far.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 就到这里，我们已经到达了本章的结尾，现在我们将总结我们迄今为止讨论的主题。
- en: Summary
  id: totrans-199
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 总结
- en: In the first chapter, we learned that there are different distros or flavors
    of Linux available depending on the user requirements. This chapter was more of
    an overview of popular Linux distributions and how Linux on Azure works. We also
    talked about commercial and free open-source software.
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 在第一章中，我们了解到根据用户需求，有不同的Linux发行版或口味可用。本章更多地是对流行的Linux发行版和Linux在Azure上的工作方式进行概述。我们还讨论了商业和免费开源软件。
- en: There are several advantages to using commercial distributions of Linux. Since
    we are paying for these subscriptions, it is expected that they provide additional
    features that are not found out of the box in free distributions. These add-ons
    include support, extra modules, and extended customization options. This chapter
    threw light on these areas as well.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 使用商业发行版的Linux有几个优势。由于我们为这些订阅付费，预期它们提供了在免费发行版中找不到的额外功能。这些附加组件包括支持、额外模块和扩展定制选项。本章也对这些领域进行了阐明。
- en: We looked closely at Linux on Azure. We started off with Azure Marketplace and
    the plethora of images it has. After that, we introduced the term "endorsed distributions";
    this is where Microsoft works with different vendors such as Red Hat, Canonical,
    and SUSE to bring their Linux images to the cloud. Microsoft recommends using
    an endorsed image for your production deployment. We also discussed the technical
    support matrix and the scope of support given by Microsoft Support. We saw some
    scenarios where vendors need to be engaged for the resolution to a problem.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 我们仔细研究了Azure上的Linux。我们从Azure Marketplace开始，介绍了它拥有的大量镜像。之后，我们介绍了“认可的发行版”这个术语；这是微软与不同的供应商合作，如红帽、Canonical和SUSE，将它们的Linux镜像带入云端。微软建议在生产部署中使用认可的镜像。我们还讨论了技术支持矩阵和微软支持提供的支持范围。我们看到了一些场景，供应商需要参与解决问题。
- en: After covering the Linux distros on Azure, we talked about the licensing models
    available in Linux and which one is best for you depending on the type of deployment.
    We also plotted a graph to portray the potential savings in each of the models.
    The last part of the chapter was more hands-on, where we saw how we can use the
    Azure CLI to find the different VM images available on Azure. However, the range
    of choice does not stop here; if you are not able to find the image you are looking
    for, Azure allows you the freedom to bring your own image.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 在涵盖了Azure上的Linux发行版之后，我们讨论了Linux可用的许可模型，以及根据部署类型选择哪种模型最适合您。我们还绘制了一张图表，展示了每种模型中潜在的节省。章节的最后部分更多地是实践操作，我们看到了如何使用Azure
    CLI在Azure上找到不同的VM镜像。然而，选择的范围并不止于此；如果您找不到您要找的镜像，Azure允许您自由地带入自己的镜像。
- en: Linux on Azure is an extensive topic and there are many books that clearly discuss
    how Linux administration can be done on Azure. This book is geared more toward
    the migration and assessment of Linux workloads. The licensing models and distros
    were explained to help you understand how things are done in the Azure realm.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 在Azure上的Linux是一个广泛的话题，有许多书籍清楚地讨论了如何在Azure上进行Linux管理。这本书更侧重于Linux工作负载的迁移和评估。许可模型和发行版被解释，以帮助您了解在Azure领域中的操作方式。
- en: In the next chapter, we will start to talk about migration. Many organizations
    begin to move to the cloud without proper assessment or planning. Planning and
    assessment are the cornerstones of migration and they need to be done properly
    before moving to the cloud. The planning phase is more about getting to know the
    capacity and checking prerequisites, while assessment is done using assessment
    tools to verify whether your workloads are ready for Azure or if they need any
    sort of refactoring first. With that said, we will talk more about these strategies
    and steps in the next chapter. Keep on reading!
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将开始讨论迁移。许多组织开始向云端迁移而没有进行适当的评估或规划。规划和评估是迁移的基石，在向云端迁移之前必须做好。规划阶段更多地是了解容量和检查先决条件，而评估是使用评估工具来验证您的工作负载是否准备好进入Azure，或者是否需要进行任何形式的重构。说到这里，我们将在下一章中更多地讨论这些策略和步骤。继续阅读！
