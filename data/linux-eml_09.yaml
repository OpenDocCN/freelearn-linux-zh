- en: Chapter 9. Antivirus Protection
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第9章。防病毒保护
- en: A common view is that Linux is not vulnerable to viruses, so why install an
    antivirus solution? While it is true that there are very few viruses for Linux,
    the primary objective is not to protect the mail server from infection, but to
    reduce or eliminate any risk to recipients. Your organization may have client
    PCs running Windows that are susceptible to viruses, or you could receive a virus
    laden e-mail that you may forward to a customer or business partner.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 一种普遍的观点是Linux不容易受到病毒攻击，那么为什么要安装防病毒解决方案？虽然Linux确实很少受到病毒攻击，但主要目标不是保护邮件服务器免受感染，而是减少或消除对接收者的任何风险。您的组织可能有运行Windows的客户端PC，容易受到病毒攻击，或者您可能收到带有病毒的电子邮件，您可能会将其转发给客户或商业伙伴。
- en: One of the many options for filtering with Procmail is to remove executable
    attachments from e-mails in order to protect your system from possible virus attacks.
    This will be, at best, a crude operation; at worst, it will remove files that
    do not contain viruses and possibly leave other infected documents such as scripts
    that are not executables.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Procmail进行过滤的众多选项之一是删除电子邮件中的可执行附件，以保护系统免受可能的病毒攻击。这将是一个粗糙的操作，最坏的情况下，它将删除不包含病毒的文件，并可能留下其他受感染的文档，如不是可执行文件的脚本。
- en: It is also possible to scan e-mails on the client side. But in a company environment,
    it is not always possible to rely on every individual having their machines up-to-date
    and correctly installed with suitable virus checking software. The obvious solution
    is to run an efficient process on the server to ensure that all e-mail sent or
    received by the organization is correctly scanned for viruses.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 也可以在客户端扫描电子邮件。但在公司环境中，不一定能够依赖每个人的机器都是最新的，并且正确安装了适当的病毒检测软件。明显的解决方案是在服务器上运行一个高效的进程，以确保组织发送或接收的所有电子邮件都经过正确的病毒扫描。
- en: There are a number of antivirus solutions available for Linux-based systems.
    We have chosen to focus on Clam AntiVirus, usually known as ClamAV. This is an
    open source software and regularly updates the database of viruses to be checked
    for before download.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 针对基于Linux的系统有许多防病毒解决方案可用。我们选择专注于Clam AntiVirus，通常称为ClamAV。这是一个开源软件，并定期更新病毒数据库，以便在下载之前进行检查。
- en: 'In this chapter, we will learn about:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将学习：
- en: The types of documents which may contain viruses that ClamAV can detect
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ClamAV可以检测到可能包含病毒的文档类型
- en: Installing and configuring the ClamAV components for detecting viruses
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装和配置ClamAV组件以检测病毒
- en: Setting up procedures to maintain an up-to-date antivirus database
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 建立程序以维护最新的防病毒数据库
- en: Integrating ClamAV with Postfix to scan all incoming e-mail messages and attachments
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将ClamAV与Postfix集成，以扫描所有传入的电子邮件消息和附件
- en: Extensively testing our installation with sample files containing test virus
    signatures and by using test e-mail bourne viruses
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过使用包含测试病毒签名的样本文件和测试电子邮件伯恩病毒来广泛测试我们的安装
- en: Adding each ClamAV component into our system startup and shutdown procedures
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将每个ClamAV组件添加到我们的系统启动和关闭程序中
- en: Introduction to ClamAV
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ClamAV简介
- en: Clam AntiVirus is an open source antivirus toolkit for Linux, Windows, and Mac
    OS X. The main design feature of ClamAV was to integrate it with mail servers
    to perform attachment scanning and help filter out known viruses. The package
    provides a flexible and scalable multithreaded daemon (`clamd`), a command-line
    scanner (`clamscan`), and a tool for automatic updating via the Internet (`freshclam`).
    The programs are based on a shared library, `libclamav`, distributed with the
    Clam AntiVirus package, which you can also use with your own software.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: Clam AntiVirus是一个面向Linux、Windows和Mac OS X的开源防病毒工具包。ClamAV的主要设计特点是将其与邮件服务器集成，以执行附件扫描并帮助过滤已知病毒。该软件包提供了一个灵活和可扩展的多线程守护程序（`clamd`）、一个命令行扫描程序（`clamscan`）和一个通过互联网进行自动更新的工具（`freshclam`）。这些程序基于一个共享库`libclamav`，与Clam
    AntiVirus软件包一起分发，您也可以将其与自己的软件一起使用。
- en: The version of ClamAV we are going to use in this chapter is the latest stable
    version, 0.95.2, that has an up-to-date virus database and signatures to enable
    detection of over 580,000 viruses, worms, and Trojans including Microsoft Office
    macro viruses, mobile malware, and other threats. Although not covered in this
    book, it is also able to perform on-access scanning under Linux with suitable
    installation into the Linux kernel.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在本章中使用的ClamAV版本是最新的稳定版本0.95.2，具有最新的病毒数据库和签名，可以检测超过580,000种病毒、蠕虫和特洛伊木马，包括Microsoft
    Office宏病毒、移动恶意软件和其他威胁。虽然本书未涉及，但它也能够在Linux下进行适当安装并进行实时扫描。
- en: Document types supported
  id: totrans-15
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 支持的文档类型
- en: 'A wide range of document types can contain or spread viruses and ClamAV provides
    protection from the majority of them:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: ClamAV可以提供对大多数文档类型的保护，这些文档类型可能包含或传播病毒：
- en: '**ELF** (**Executable and Linking Format)** files used by UNIX and UNIX-like
    operating systems such as Linux, Solaris, and OpenBSD.'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: UNIX和类UNIX操作系统（如Linux、Solaris和OpenBSD）使用的**ELF**（**可执行和链接格式**）文件。
- en: '**Portable Executable** (**PE**) files (32/64-bit) compressed with UPX, FSG,
    Petite, WWPack32, and obfuscated with SUE, Yoda''s Cryptor, and others. This is
    the standard format for Microsoft Windows Executables and one of the most common
    transports for viruses.'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**可移植可执行文件**（**PE**）文件（32/64位）使用UPX、FSG、Petite、WWPack32压缩，并使用SUE、Yoda''s Cryptor等进行混淆。这是Microsoft
    Windows可执行文件的标准格式，也是病毒最常见的传输方式之一。'
- en: 'Many forms of Microsoft documents can contain scripts or executables. The following
    document and archive types can be processed by ClamAV:'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 许多形式的Microsoft文档可能包含脚本或可执行文件。ClamAV可以处理以下文档和存档类型：
- en: MS OLE2
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: MS OLE2
- en: MS Cabinet files
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: MS Cabinet文件
- en: MS CHM (Compressed HTML)
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: MS CHM（压缩HTML）
- en: MS SZDD
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: MS SZDD
- en: MS Office Word and Excel documents
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: MS Office Word和Excel文档
- en: 'Support for other special files and formats include:'
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 支持其他特殊文件和格式，包括：
- en: HTML
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: HTML
- en: RTF
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: RTF
- en: PDF
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: PDF
- en: Files encrypted with CryptFF and ScrEnc
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用CryptFF和ScrEnc加密的文件
- en: uuencode
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: uuencode
- en: TNEF (winmail.dat)
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: TNEF（winmail.dat）
- en: 'Other common archive formats that may contain any form of document and that
    ClamAV can process include:'
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ClamAV可以处理的其他常见存档格式包括任何形式的文档：
- en: RAR (2.0)
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: RAR（2.0）
- en: ZIP
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ZIP
- en: gzip
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: gzip
- en: bzip2
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: bzip2
- en: tar
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: tar
- en: BinHex
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: BinHex
- en: SIS (SymbianOS packages)
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SIS（SymbianOS软件包）
- en: AutoIt
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: AutoIt
- en: Scanning of archives also includes the scanning of supported document formats
    held within the archives.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 扫描存档还包括扫描存档中保存的支持的文档格式。
- en: Downloading and installing ClamAV
  id: totrans-42
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 下载和安装ClamAV
- en: As viruses are being discovered on an almost daily basis, it is well worth installing
    the latest stable version of ClamAV software. If your system already has ClamAV
    installed, it is possible that the installation may be based on an out of date
    installation package. It is highly recommended that you download and install the
    latest version from the ClamAV website to ensure the highest level of security
    against viruses on your systems.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 由于几乎每天都会发现病毒，因此安装最新稳定版本的ClamAV软件非常值得。如果您的系统已经安装了ClamAV，则可能是基于过时的安装包进行安装。强烈建议您从ClamAV网站下载并安装最新版本，以确保系统对病毒具有最高级别的安全性。
- en: Adding a new system user and group
  id: totrans-44
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 添加新的系统用户和组
- en: You will have to add a new user and group to your system for the ClamAV system
    to use.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 您将不得不为ClamAV系统添加一个新用户和组。
- en: '[PRE0]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Installing from a package
  id: totrans-47
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 从软件包安装
- en: There are a number of installation packages available for ClamAV and details
    can be found on the ClamAV website at [http://www.clamav.net/download/packages/packages-linux.](http://www.clamav.net/download/packages/packages-linux.)
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: ClamAV有许多安装包可供选择，详细信息可以在ClamAV网站上找到（[http://www.clamav.net/download/packages/packages-linux.](http://www.clamav.net/download/packages/packages-linux.)）
- en: Note
  id: totrans-49
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Due to licensing restrictions, most binary packages don't have a built-in RAR
    support. For this reason, we recommend that you install ClamAV from source until
    any licensing issues are resolved.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 由于许可限制，大多数二进制软件包没有内置的RAR支持。因此，我们建议您在任何许可问题得到解决之前从源代码安装ClamAV。
- en: 'If you are using a Red Hat-based system, the installation may be performed
    using either of the following options, depending on which distribution you have
    installed:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您使用的是基于Red Hat的系统，则可以使用以下选项之一执行安装，具体取决于您安装了哪个发行版：
- en: '[PRE1]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: or
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 或者
- en: '[PRE2]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'If you are using a Debian-based system, the installation may be performed using
    the following command:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您使用的是基于Debian的系统，则可以使用以下命令执行安装：
- en: '[PRE3]'
  id: totrans-56
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Note
  id: totrans-57
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Make sure you are installing version 0.95.2 or higher as there are significant
    enhancements over previous versions. In general, you should always install the
    latest stable version available.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 确保安装的版本是0.95.2或更高版本，因为与以前的版本相比有重大改进。一般来说，您应该始终安装最新的稳定版本。
- en: Installing from source code
  id: totrans-59
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 从源代码安装
- en: Installing ClamAV from the original source code is not very difficult, and enables
    you to run any version you want and not just the version chosen by the package
    maintainer of your Linux distribution. The ClamAV source code can be downloaded
    from a number of mirrors accessible from the main ClamAV website ([http://www.clamav.net/download/sources](http://www.clamav.net/download/sources)).
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 从原始源代码安装ClamAV并不是很困难，可以让您运行任何您想要的版本，而不仅仅是您的Linux发行版的软件包维护者选择的版本。ClamAV源代码可以从主ClamAV网站的多个镜像下载（[http://www.clamav.net/download/sources](http://www.clamav.net/download/sources)）。
- en: Requirements
  id: totrans-61
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 要求
- en: 'The following elements are required to compile ClamAV:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 编译ClamAV需要以下元素：
- en: zlib and zlib-devel packages
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: zlib和zlib-devel软件包
- en: gcc compiler suite
  id: totrans-64
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: gcc编译器套件
- en: 'The following packages are optional but highly recommended:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 以下软件包是可选的，但强烈推荐：
- en: bzip2 and bzip2-devel library
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: bzip2和bzip2-devel库
- en: UnRAR package
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 解压包
- en: Building and installing
  id: totrans-68
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 构建和安装
- en: Once you have downloaded and unpacked the archive, `cd` to the directory, example,
    `clamav-0.95.2`. Before starting to build and install the software, it is well
    worthwhile reading through the `INSTALL` and `README` documents.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 下载并解压缩存档后，`cd`到目录，例如`clamav-0.95.2`。在开始构建和安装软件之前，值得阅读`INSTALL`和`README`文档。
- en: 'For most Linux systems, the simplest installation method can be reduced by
    following the steps listed here:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 对于大多数Linux系统，最简单的安装方法可以通过按照这里列出的步骤来简化：
- en: 'Run the `configure` utility to create the right build environment by running
    the `configure` command:'
  id: totrans-71
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行`configure`实用程序通过运行`configure`命令来创建正确的构建环境：
- en: '[PRE4]'
  id: totrans-72
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: After the configuration script is complete, you can run the `make` command to
    build the software executables.
  id: totrans-73
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置脚本完成后，可以运行`make`命令来构建软件可执行文件。
- en: '[PRE5]'
  id: totrans-74
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: The final step, as `root`, is to copy the executables into the correct position
    for operation on the system.
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后一步是以`root`身份将可执行文件复制到系统上的正确位置以进行操作。
- en: '[PRE6]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: In the last step, the software is installed into the `/usr/local` directory
    and the config files into `/etc` as specified by the`—sysconfdir` option as shown.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 在最后一步，软件安装到`/usr/local`目录，配置文件安装到`/etc`，如`—sysconfdir`选项所示。
- en: At all stages you should check the processes output for any significant errors
    or warnings.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 在所有阶段，您都应该检查进程输出是否有任何重大错误或警告。
- en: As with all packages built from the source code, you may wish to delete the
    unpacked archive after completion of the building, installing, and testing steps
    in this chapter.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 与所有从源代码构建的软件包一样，在完成本章的构建、安装和测试步骤后，您可能希望删除解压的存档。
- en: Quick test
  id: totrans-80
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 快速测试
- en: 'We can verify that the software is correctly installed, by trying the following
    test to scan the example test virus files in source directory recursively:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过尝试扫描源目录中的示例测试病毒文件来验证软件是否正确安装：
- en: Note
  id: totrans-82
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: The supplied test virus files do not contain real viruses and are harmless.
    They contain an industry agreed virus signature specifically designed for test
    purposes.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 提供的测试病毒文件不包含真正的病毒，是无害的。它们包含专门设计用于测试目的的行业认可的病毒签名。
- en: '[PRE7]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'It should find some test files in the `clamav-x.yz/test` directory. The scan
    result will be saved in the `scan.txt` log file. Check the log file, paying particular
    attention to any warnings indicating that support for a particular file or archive
    format has not been compiled in. The tail of the log file should contain a summary
    similar to the following:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 它应该在`clamav-x.yz/test`目录中找到一些测试文件。扫描结果将保存在`scan.txt`日志文件中。检查日志文件，特别注意任何警告，指示对特定文件或存档格式的支持未被编译进去。日志文件的末尾应该包含类似以下的摘要：
- en: '![Quick test](img/8648_09_01.jpg)'
  id: totrans-86
  prefs: []
  type: TYPE_IMG
  zh: '![快速测试](img/8648_09_01.jpg)'
- en: Editing the config files
  id: totrans-87
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 编辑配置文件
- en: After installation of the software, two configuration files need to be edited.
    The first file, `/etc/clamd.conf`, is for the actual virus scanning software.
    Most of the important configuration options for this file are discussed in the
    following sections. The second configuration file, `/etc/freshclam.conf`, is covered
    later in this chapter. This is where we add the configuration options for the
    automatic virus database updates.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 安装软件后，需要编辑两个配置文件。第一个文件`/etc/clamd.conf`是用于实际病毒扫描软件的。这个文件的大部分重要配置选项在接下来的章节中讨论。第二个配置文件`/etc/freshclam.conf`将在本章后面讨论。这是我们添加自动病毒数据库更新的配置选项的地方。
- en: clamd
  id: totrans-89
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: clamd
- en: You have to edit the configuration file in order to use the daemon, otherwise
    `clamd` won't run.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 您必须编辑配置文件才能使用守护进程，否则`clamd`将无法运行。
- en: '[PRE8]'
  id: totrans-91
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '[PRE9]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: This shows the location of the default configuration file. The format and options
    of this file are fully described in the `clamd.conf(5)` manual. The `config` file
    is well commented and configuration should be straightforward.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 这显示了默认配置文件的位置。该文件的格式和选项在`clamd.conf(5)`手册中有详细描述。`config`文件有很好的注释，配置应该是直观的。
- en: Examining the sample config file
  id: totrans-94
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 检查示例配置文件
- en: 'The sample `config` file that is provided is very well documented with comments
    at every significant configuration value. Here are some key values that you may
    wish to modify:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 提供的示例`config`文件在每个重要配置值处都有注释，非常详细。以下是一些您可能希望修改的关键值：
- en: '[PRE10]'
  id: totrans-96
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: The `Example` line will cause the program to halt with a configuration error
    and is a deliberate inclusion to force you to edit the file before the software
    operates correctly. Placing a `#` at the beginning of the line will be enough
    to resolve this problem after you have finished editing the file.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: '`Example`行将导致程序因配置错误而停止运行，并且是故意包含的，以强制您在软件正确运行之前编辑文件。在编辑完文件后，在该行的开头加上`#`就足以解决这个问题。'
- en: '[PRE11]'
  id: totrans-98
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: It is well worth setting up a log file to enable you to check for errors and
    monitor correct operation over the first few weeks of operation. Thereafter, you
    can decide whether to stop the logging or leave it operational.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 建立一个日志文件非常值得，以便您可以在运行的最初几周内检查错误并监视正确的操作。之后，您可以决定是否停止记录或保持其运行。
- en: '[PRE12]'
  id: totrans-100
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Enabling time stamping in the log files ensures that you can track down the
    time of the event being logged to aid in debugging problems and matching events
    to entries in other log files.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 在日志文件中启用时间戳可以确保您可以追踪事件被记录的时间，以帮助调试问题并将事件与其他日志文件中的条目匹配。
- en: '[PRE13]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Make sure that the database directory is correctly configured so that it is
    known exactly where the virus signature information is being stored. The installation
    process will have created the file `main.cvd`, and possibly `daily.cld`, as the
    database files containing the virus signatures.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 确保数据库目录正确配置，以确切地知道病毒签名信息存储在哪里。安装过程将创建文件`main.cvd`，可能还有`daily.cld`，作为包含病毒签名的数据库文件。
- en: '[PRE14]'
  id: totrans-104
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Using local mode is an important configuration change and is required to ensure
    the security of the system on which ClamAV is installed.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 使用本地模式是一个重要的配置更改，也是确保安装了ClamAV的系统的安全所必需的。
- en: '[PRE15]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: This is useful to start and stop scripts. As shown in the previous example,
    the ClamAV directory must be writable.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 这对于启动和停止脚本非常有用。如前面的示例所示，ClamAV目录必须是可写的。
- en: '[PRE16]'
  id: totrans-108
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: This is another security related configuration item to ensure that only local
    processes can gain access to the service.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 这是另一个与安全相关的配置项，以确保只有本地进程可以访问该服务。
- en: '[PRE17]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: This could be a useful feature to consider in some situations. However, with
    the wide range and frequency of virus delivery, this could prove to be a significant
    annoyance to have messages arriving throughout the night or day.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 在某些情况下，这可能是一个有用的功能。然而，由于病毒传递的广泛范围和频率，这可能会成为一个显著的烦恼，因为消息可能会在整个夜晚或白天到达。
- en: '[PRE18]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: By creating a user especially for ClamAV, we can assign ownership of files and
    processes to this user ID and help improve security of the files by restricting
    access to only this user ID. Also, when running processes are listed on the system,
    it is easy to identify those owned by the ClamAV system.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 通过为ClamAV创建一个专门的用户，我们可以将文件和进程的所有权分配给这个用户ID，并通过限制对只有这个用户ID的访问来提高文件的安全性。此外，当在系统上列出运行的进程时，很容易识别出ClamAV系统拥有的进程。
- en: freshclam
  id: totrans-114
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: freshclam
- en: You have to edit the configuration file, otherwise `freshclam` won't run.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 您必须编辑配置文件，否则`freshclam`将无法运行。
- en: '[PRE19]'
  id: totrans-116
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: '[PRE20]'
  id: totrans-117
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: A sample `freshclam` configuration file is also included in the source distribution.
    If you need more information about the configuration options and format, you should
    refer to the *freshclam.conf(5)* manual page.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 源分发中还包括了一个`freshclam`配置文件的示例。如果您需要更多关于配置选项和格式的信息，您应该参考*freshclam.conf(5)*手册页。
- en: Closest mirrors
  id: totrans-119
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 最近的镜像
- en: A number of mirror servers are available on the Internet from which you can
    download the latest antivirus database. To avoid overloading any one server, the
    configuration file should be set up to make sure that the download is being taken
    from the nearest available server. The included `update` utility makes use of
    the DNS system to locate a suitable server based on the country code you are requesting.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 互联网上有许多镜像服务器可供下载最新的防病毒数据库。为了避免过载任何一个服务器，配置文件应设置为确保下载来自最近可用的服务器。包含的`update`实用程序利用DNS系统来定位基于您请求的国家代码的合适服务器。
- en: The configuration file entry that you need to modify is `DatabaseMirror`. You
    may also specify the parameter `MaxAttempts`—number of times the database is downloaded
    from the server.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 需要修改的配置文件条目是`DatabaseMirror`。您还可以指定参数`MaxAttempts`——从服务器下载数据库的次数。
- en: The default database mirror is `clamav.database.net`, but you are able to apply
    multiple entries in the configuration file. The configuration entry should be
    made using the format `db.xx.clamav.net`, where `xx` represents your normal two-letter
    ISO country code. For example, if your server is in the United States, you should
    add the following lines to `freshclam.conf`. The full list of two-letters country
    codes is available at [http://www.iana.org/cctld/cctld-whois.htm](http://www.iana.org/cctld/cctld-whois.htm).
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 默认的数据库镜像是`clamav.database.net`，但您可以在配置文件中应用多个条目。配置条目应使用格式`db.xx.clamav.net`，其中`xx`代表您的正常两字母ISO国家代码。例如，如果您的服务器在美国，您应该将以下行添加到`freshclam.conf`。两字母国家代码的完整列表可在[http://www.iana.org/cctld/cctld-whois.htm](http://www.iana.org/cctld/cctld-whois.htm)上找到。
- en: '[PRE21]'
  id: totrans-123
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: If the connection to the first entry fails for any reason, an attempt will be
    made to download from the second mirror entry. You should not just use the default
    entry, as it may result in your server or IP address being blacklisted by the
    ClamAV database administrators for overloading and you may not able to obtain
    any updates at all.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 如果由于任何原因与第一个条目的连接失败，将尝试从第二个镜像条目下载。您不应该只使用默认条目，因为这可能导致您的服务器或IP地址被ClamAV数据库管理员列入黑名单，因为过载，您可能无法获取任何更新。
- en: Examining the sample config file
  id: totrans-125
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 检查示例配置文件
- en: 'The sample `config` file that is provided is very well documented with comments
    at every significant configuration value. Here are some key values that you may
    wish to modify:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 提供的示例`config`文件在每个重要配置值处都有注释，非常详细。以下是一些您可能希望修改的关键值：
- en: '[PRE22]'
  id: totrans-127
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: Make sure that this line is commented to allow the daemon to operate.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 确保此行已注释以允许守护程序运行。
- en: '[PRE23]'
  id: totrans-129
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: Enabling the log file is useful to track the ongoing updates that are being
    applied and to monitor the correct operation of the system during early testing
    stages.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 启用日志文件对于跟踪正在应用的持续更新以及在早期测试阶段监视系统的正确操作非常有用。
- en: '[PRE24]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: The previous option enables more detailed error messages to be included in the
    update log file.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的选项使得更详细的错误消息能够包含在更新日志文件中。
- en: '[PRE25]'
  id: totrans-133
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: This is an important configuration to reduce network traffic overheads and ensure
    that you are obtaining updates from a geographically close server.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个重要的配置，可以减少网络流量开销，并确保您从地理位置接近的服务器获取更新。
- en: '[PRE26]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: As the instruction says—leave this line alone.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 正如说明所说——不要动这一行。
- en: '[PRE27]'
  id: totrans-137
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: For busy servers with lots of traffic, it is worthwhile to update the virus
    database at a more frequent interval. However, this is recommended only for systems
    running version 0.8 or higher of the ClamAV software.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 对于忙碌的服务器和大量流量的服务器，值得以更频繁的间隔更新病毒数据库。但是，这仅建议适用于运行ClamAV软件版本0.8或更高版本的系统。
- en: '[PRE28]'
  id: totrans-139
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: To aid monitoring of the updates to configuration files, the options you have
    just seen are available to apply suitable actions if updates do or do not occur
    correctly.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 为了帮助监控对配置文件的更新，您刚刚看到的选项可用于在更新正确或不正确时应用适当的操作。
- en: File permissions
  id: totrans-141
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 文件权限
- en: 'Following the previous recommendation, `clamd` will be run as the `clamav`
    user and by default, when started, `freshclam` drops privileges and switches to
    the `clamav` user. Therefore, ownership of the socket, PID, and log files specified
    in the configuration files seen in the previous example should be set up using
    the following commands to allow correct access:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 根据先前的建议，`clamd`将作为`clamav`用户运行，并且默认情况下，当启动时，`freshclam`会放弃权限并切换到`clamav`用户。因此，应使用以下命令设置在前面示例中看到的配置文件中指定的套接字、PID和日志文件的所有权，以允许正确访问：
- en: '[PRE29]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: The user under which `freshclam` and `clamd` run can be changed in `freshclam.conf`
    and `clamd.conf`. However, you should verify that the ClamAV processes have access
    to the virus definition database if you change these parameters.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: '`freshclam`和`clamd`运行的用户可以在`freshclam.conf`和`clamd.conf`中更改。但是，如果更改这些参数，您应验证ClamAV进程是否可以访问病毒定义数据库。'
- en: Post installation testing
  id: totrans-145
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装后测试
- en: Now that we have the main components of ClamAV installed, we can verify the
    correct operation of each component.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经安装了ClamAV的主要组件，我们可以验证每个组件的正确操作。
- en: '`clamscan`—the command line scanner'
  id: totrans-147
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`clamscan`——命令行扫描程序'
- en: '`clamd`—the ClamAV daemon'
  id: totrans-148
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`clamd`——ClamAV守护程序'
- en: '`freshclam`—virus definitions updater'
  id: totrans-149
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`freshclam`——病毒定义更新程序'
- en: For these tests, we are going to need a virus or at least a non-destructive
    file that looks like a virus.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这些测试，我们需要一个病毒，或者至少一个看起来像病毒的非破坏性文件。
- en: EICAR test virus
  id: totrans-151
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: EICAR测试病毒
- en: A number of antivirus researchers have already worked together to produce a
    file that their (and many other) products detect as if it were a virus. Agreeing
    on one file for such purposes simplifies matters for users.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 许多防病毒研究人员已经共同努力制作了一个文件，他们（以及许多其他产品）检测到它像是病毒。就此类目的，达成一致意见简化了用户的事务。
- en: This test file is known as the **EICAR** (**Europeanx Institute for Computer
    Anti-virus Research) standard antivirus test file**. The file itself is not a
    virus, it does not contain any program code at all, and is therefore safe to pass
    on to other people. However, most antivirus products will react to the file as
    though it really is a virus, which can make it a rather tricky file to manipulate
    or send via e-mail if you or the recipient has good virus protection systems in
    place.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 这个测试文件被称为**EICAR**（**欧洲计算机防病毒研究所）标准防病毒测试文件**。该文件本身不是病毒，它根本不包含任何程序代码，因此可以安全地传递给其他人。但是，大多数防病毒产品会对该文件做出反应，就好像它真的是一个病毒，这可能会使它成为一个相当棘手的文件，如果您或接收者已经有良好的病毒防护系统，可能会很难操作或通过电子邮件发送。
- en: 'The file is a text file consisting entirely of printable ASCII characters so
    that it can easily be created with a regular text editor. Any antivirus product
    that supports the EICAR test file should detect it in any file that starts with
    the following 68 characters:'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 该文件是一个完全由可打印的ASCII字符组成的文本文件，因此可以很容易地使用常规文本编辑器创建。任何支持EICAR测试文件的防病毒产品都应该能够在任何以以下68个字符开头的文件中检测到它：
- en: '[PRE30]'
  id: totrans-155
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: When you are creating this file, you should take note of the following facts.
    The file uses only upper case letters, digits, and punctuation marks, and does
    not include spaces. There are a couple of common mistakes that can be made when
    recreating this file. These include ensuring that the third character is the capital
    letter `O`, not the digit zero (0), and that all 68 characters are one line, which
    must be the very first line in the file.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 在创建此文件时，您应该注意以下事实。该文件仅使用大写字母、数字和标点符号，并且不包括空格。在重新创建此文件时可能会出现一些常见错误。这些错误包括确保第三个字符是大写字母`O`，而不是数字零（0），并且所有的68个字符都在一行上，这必须是文件中的第一行。
- en: For more information on the EICAR antivirus test file, visit [http://www.eicar.org/anti_virus_test_file.htm](http://www.eicar.org/anti_virus_test_file.htm).
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 有关EICAR防病毒测试文件的更多信息，请访问[http://www.eicar.org/anti_virus_test_file.htm](http://www.eicar.org/anti_virus_test_file.htm)。
- en: Testing clamscan
  id: totrans-158
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 测试clamscan
- en: The first test we need to run is to make sure that the virus scanner is installed
    and that the virus definitions database is configured and included correctly.
    A virus database is supplied as part of the installation process.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要运行的第一个测试是确保病毒扫描程序已安装，并且病毒定义数据库已正确配置和包含。病毒数据库是安装过程的一部分。
- en: 'The simplest way to do this is to create a copy of the EICAR test file on your
    server and then run the `clamscan` program. We are using the`—i` flag so that
    only infected files will be shown. You should get output like this:'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 这样做的最简单方法是在服务器上创建EICAR测试文件的副本，然后运行`clamscan`程序。我们使用`—i`标志，以便只显示感染的文件。您应该得到以下输出：
- en: '![Testing clamscan](img/8648_09_02.jpg)'
  id: totrans-161
  prefs: []
  type: TYPE_IMG
  zh: '![测试clamscan](img/8648_09_02.jpg)'
- en: Note the warning about an out-of-date virus database. This is normal and will
    be rectified during `freshclam` testing.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意关于过时病毒数据库的警告。这是正常的，在进行`freshclam`测试期间将会得到纠正。
- en: Testing clamd
  id: totrans-163
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 测试clamd
- en: By using the `clamdscan` program, we can again scan the test file, but do this
    by instructing the `clamd` process to do the scanning. This is an excellent test
    to make sure that the `clamd` daemon process is running.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 通过使用`clamdscan`程序，我们可以再次扫描测试文件，但是通过指示`clamd`进程进行扫描。这是一个很好的测试，以确保`clamd`守护程序进程正在运行。
- en: 'The expected output should look something like the following:'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 预期的输出应该看起来像以下内容：
- en: '[PRE31]'
  id: totrans-166
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: '[PRE32]'
  id: totrans-167
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: If the clamd daemon is not running it can be started using the `# clamd` command.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 如果clamd守护程序没有运行，可以使用`# clamd`命令启动它。
- en: You should also check the `clamd` log file, as configured in `clamd.conf`, for
    any unexpected errors or warnings after running this test.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 在运行此测试后，您还应检查`clamd`日志文件（在`clamd.conf`中配置）是否包含任何意外的错误或警告。
- en: Testing freshclam
  id: totrans-170
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 测试freshclam
- en: 'Using the `freshclam` program interactively we can update the virus database
    with the latest definitions. This test will update the database only once. We
    shall see later how to perform automatic updates. Using the following command
    (as superuser) we would expect output similar to the following:'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`freshclam`程序进行交互式操作，我们可以使用最新的定义更新病毒数据库。此测试将仅更新数据库一次。稍后我们将看到如何执行自动更新。使用以下命令（作为超级用户），我们期望得到类似以下的输出：
- en: '![Testing freshclam](img/8648_09_03.jpg)'
  id: totrans-172
  prefs: []
  type: TYPE_IMG
  zh: '![测试freshclam](img/8648_09_03.jpg)'
- en: From the output, we can see that the update process downloaded two differential
    updates successfully and failed with a network problem on the third. Downloading
    the differences between the latest and current database helps to reduce network
    traffic and server load. In this case `freshclam` detected the failure and downloaded
    the latest daily update to bring the virus database up-to-date with an increased
    number of virus signatures.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 从输出中，我们可以看到更新过程成功下载了两个差异更新，并在第三次出现网络问题时失败。下载最新数据库与当前数据库之间的差异有助于减少网络流量和服务器负载。在这种情况下，`freshclam`检测到了失败，并下载了最新的每日更新，以使病毒数据库更新到具有增加病毒签名数量的状态。
- en: Now if you run the `clamscan` test again, you will notice that the out-of-date
    warning is no longer displayed.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 现在如果再次运行`clamscan`测试，您会注意到不再显示过时警告。
- en: You should also check that the `freshclam` log file contains output similar
    to the previous code after running this test.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 在运行此测试后，您还应检查`freshclam`日志文件是否包含类似于先前代码的输出。
- en: Introduction to ClamSMTP
  id: totrans-176
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ClamSMTP介绍
- en: 'In order to scan all e-mail passing through the server, a software interface
    is required between Postfix and ClamAV. The interface we are going to use is **ClamSMTP**.
    The following introduction from the ClamSMTP site ([http://memberwebs.com/stef/software/clamsmtp/](http://memberwebs.com/stef/software/clamsmtp/))
    describes the SMTP virus filter as:'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 为了扫描通过服务器的所有电子邮件，需要在Postfix和ClamAV之间使用软件接口。我们将使用的接口是**ClamSMTP**。来自ClamSMTP网站（[http://memberwebs.com/stef/software/clamsmtp/](http://memberwebs.com/stef/software/clamsmtp/)）的以下介绍描述了SMTP病毒过滤器：
- en: ClamSMTP is an SMTP filter that allows you to check for viruses using the ClamAV
    antivirus software. It accepts SMTP connections and forwards the SMTP commands
    and responses to another SMTP server. The 'DATA' email body is intercepted and
    scanned before forwarding. ClamSMTP aims to be lightweight, reliable, and simple
    rather than have a myriad of options. It's written in C without major dependencies.
  id: totrans-178
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ClamSMTP是一个SMTP过滤器，允许您使用ClamAV防病毒软件检查病毒。它接受SMTP连接并将SMTP命令和响应转发到另一个SMTP服务器。在转发之前拦截并扫描“DATA”电子邮件正文。ClamSMTP旨在轻量、可靠和简单，而不是拥有大量选项。它是用C编写的，没有主要依赖关系。
- en: Postfix is designed to allow external filters to be called to process mail messages
    and to return the processed data back to Postfix for onward delivery. ClamSMTP
    has been designed to work directly between Postfix and ClamAV to ensure efficient
    operation.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: Postfix旨在允许调用外部过滤器来处理邮件消息，并将处理后的数据返回给Postfix以进行进一步交付。ClamSMTP已经被设计为直接在Postfix和ClamAV之间工作，以确保高效运行。
- en: Some Linux distributions may have maintained packages for ClamSMTP, which can
    be installed via the relevant package manager. However, you should still complete
    the instructions that follow to configure and integrate ClamSMTP into Postfix.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 一些Linux发行版可能会维护ClamSMTP的软件包，可以通过相关软件包管理器安装。但是，您仍然应该完成后续的配置和集成ClamSMTP到Postfix的指示。
- en: The latest source code may be downloaded from [http://memberwebs.com/stef/software/clamsmtp/](http://memberwebs.com/stef/software/clamsmtp/),
    directly onto your Linux system using the `wget` command. Change to a suitable
    location to download and build the software. The command option for the current
    version (1.10) would be `wget <url>`.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 最新的源代码可以从[http://memberwebs.com/stef/software/clamsmtp/](http://memberwebs.com/stef/software/clamsmtp/)下载，直接使用`wget`命令下载到您的Linux系统上。切换到适当的位置以下载和构建软件。当前版本（1.10）的命令选项将是`wget
    <url>`。
- en: '[PRE33]'
  id: totrans-182
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: You should check the website for the latest version that you can download. After
    you have downloaded the file, unpack the contents of the file using the `tar`
    command.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 您应该检查网站以获取可以下载的最新版本。下载文件后，使用`tar`命令解压文件的内容。
- en: '[PRE34]'
  id: totrans-184
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: This will create a directory structure with all the relevant files contained
    below the current directory.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 这将创建一个目录结构，其中包含当前目录下的所有相关文件。
- en: Building and installing
  id: totrans-186
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 构建和安装
- en: Before building and installing the software, it is well worthwhile reading through
    the `INSTALL` and `README` documents.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 在构建和安装软件之前，值得阅读`INSTALL`和`README`文档。
- en: 'For most Linux systems, the simplest installation method is as follows:'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 对于大多数Linux系统，最简单的安装方法如下：
- en: Run the `configure` utility to create the right build environment by running
    the `configure` command.
  id: totrans-189
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行`configure`实用程序通过运行`configure`命令创建正确的构建环境。
- en: '[PRE35]'
  id: totrans-190
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'After the configuration script is complete, you can run the `make` command
    to build the software executables:'
  id: totrans-191
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置脚本完成后，您可以运行`make`命令来构建软件可执行文件：
- en: '[PRE36]'
  id: totrans-192
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'The final step, as `root`, is to copy the executables into the correct position
    for operation on the system:'
  id: totrans-193
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后一步，作为`root`，是将可执行文件复制到系统上的正确位置以进行操作：
- en: '[PRE37]'
  id: totrans-194
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: In the last step, the software is installed into the `/usr/local` directory
    and the config files into `/etc`.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 在最后一步，软件安装到`/usr/local`目录，配置文件安装到`/etc`目录。
- en: At all stages, you should check the processes output for any significant errors
    or warnings.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 在所有阶段，您应该检查进程输出以查找任何重要的错误或警告。
- en: Configuring into Postfix
  id: totrans-197
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 配置到Postfix
- en: Postfix provides support for mail filtering by passing mail items through external
    processes. This operation can be performed either before or after the mail has
    been queued. The way communication between Postfix and `clamsmtp` works is by
    pretending that `clamsmtp` is itself an SMTP server. This simple approach provides
    an easy way to create a distributed architecture whereby different processes could
    be working on different machines to spread the load in very busy networks. For
    our use, we will assume that we are using only one machine with all software running
    on that machine.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: Postfix通过将邮件项目通过外部进程来支持邮件过滤。此操作可以在邮件排队之前或之后执行。Postfix与`clamsmtp`之间的通信方式是假装`clamsmtp`本身是一个SMTP服务器。这种简单的方法提供了一种简单的方式来创建分布式架构，不同的进程可以在不同的机器上工作，以在非常繁忙的网络中分散负载。对于我们的用途，我们将假设我们只使用一台机器，所有软件都在该机器上运行。
- en: The `clamsmtp` filter interface was designed specifically to provide an interface
    between ClamAV and the Postfix mail system. The filter is implemented as an after-queue
    filter for antivirus scanning.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: '`clamsmtp`过滤器接口是专门设计为在ClamAV和Postfix邮件系统之间提供接口。该过滤器被实现为用于邮件防病毒扫描的后队列过滤器。'
- en: 'The first configuration option requires adding lines to the Postfix `main.cf`
    file:'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 第一个配置选项需要向Postfix的`main.cf`文件添加行：
- en: '[PRE38]'
  id: totrans-201
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: The `content_filter` instruction forces Postfix to send all mail through the
    service named `scan` on port `10025`. The scan service will be the one that we
    set up using `clamsmtpd`. The instruction for `receive_override_options` configures
    Postfix to perform `no_address_mappings`. This prevents Postfix from expanding
    any e-mail aliases or groups, which otherwise would have resulted in duplicate
    e-mails being received.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: '`content_filter`指令强制Postfix通过名为`scan`的服务在端口`10025`上发送所有邮件。扫描服务将是我们使用`clamsmtpd`设置的服务。`receive_override_options`的指令配置Postfix执行`no_address_mappings`。这可以防止Postfix扩展任何电子邮件别名或组，否则将导致接收到重复的电子邮件。'
- en: The second configuration change needs to be made to the Postfix `master.cf`
    file.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 第二个配置更改需要在Postfix的`master.cf`文件中进行。
- en: '[PRE39]'
  id: totrans-204
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: Note
  id: totrans-205
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: The formatting of the files is very important. You should ensure that there
    are no spaces around the `=` (equal) sign or`, (commas) in the text you added.`
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 文件的格式非常重要。您应该确保在您添加的文本中，`=`（等号）周围没有空格或`,（逗号）`。
- en: '`The first two lines, do the actual creation of the `scan` service. The remaining
    lines set up a service for accepting mail back into Postfix for delivery. The
    rest of the options are there to prevent a mail loop occurring and to relax address
    checking. When these changes have been made, you need to get Postfix to reread
    the modified configuration files by using the following command:`'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: “前两行实际上创建了`scan`服务。其余的行设置了一个服务，用于接受邮件返回到Postfix以进行投递。其他选项是为了防止邮件循环发生并放宽地址检查。当这些更改完成后，您需要使用以下命令让Postfix重新读取修改后的配置文件：”
- en: '[PRE40]'
  id: totrans-208
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: '`Configuring clamSMTP`'
  id: totrans-209
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: “配置clamSMTP”
- en: '`You have to create the configuration file, `/etc/clamsmtpd.conf`, otherwise
    `clamsmtpd` won''t run:`'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: “您必须创建配置文件`/etc/clamsmtpd.conf`，否则`clamsmtpd`将无法运行：”
- en: '[PRE41]'
  id: totrans-211
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: '`A sample `clamsmtp.conf` configuration file is included in the source distribution
    `doc` directory. This needs to be copied to the correct location and edited before
    the `clamsmtp` software will operate correctly.`'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: “源分发`doc`目录中包含了一个示例`clamsmtp.conf`配置文件。在`clamsmtp`软件正常运行之前，需要将其复制到正确的位置并进行编辑。”
- en: '[PRE42]'
  id: totrans-213
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: '`The format and options of this file are fully described in the `clamsmtpd.conf(5)`
    manual.`'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: “该文件的格式和选项在`clamsmtpd.conf(5)`手册中有详细描述。”
- en: '`Examining the sample config file`'
  id: totrans-215
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: “检查样本配置文件”
- en: '`The sample **config**file that is provided is very well documented with comments
    for each significant configuration value. Here are some key values that you may
    wish to modify.`'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: “提供的示例**config**文件非常详细地记录了每个重要配置值的注释。以下是您可能希望修改的一些关键值。”
- en: '[PRE43]'
  id: totrans-217
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: '`As we are using just one machine in this configuration, we should specify
    the `OutAddress` option as `127.0.0.1:10026` to match the option specified in
    `master.cf`.`'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: “由于我们在此配置中只使用一台机器，因此我们应该将`OutAddress`选项指定为`127.0.0.1:10026`，以匹配`master.cf`中指定的选项。”
- en: '[PRE44]'
  id: totrans-219
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: '`This address matches the option specified in `main.cf`.`'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: “此地址与`main.cf`中指定的选项匹配。”
- en: '[PRE45]'
  id: totrans-221
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: '`This should match the `LocalSocket` option in the `clamd.conf` file.`'
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: “这应该与`clamd.conf`文件中的`LocalSocket`选项匹配。”
- en: '[PRE46]'
  id: totrans-223
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: '`Throw away the message.`'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: “丢弃消息。”
- en: '[PRE47]'
  id: totrans-225
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: '`It is important to make sure that the processes are run as the same user as
    you use to run `clamd` or you may find that each process has problems accessing
    the other''s temporary files.`'
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: “重要的是要确保进程以与您用于运行`clamd`相同的用户身份运行，否则您可能会发现每个进程在访问其他临时文件时出现问题。”
- en: '[PRE48]'
  id: totrans-227
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: '`We are now ready to perform the start up of the `clamsmtpd` process. You should
    start this as `root` and verify that the process is present and running with the
    user id of `clamav`.`'
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: “现在我们准备启动`clamsmtpd`进程。您应该以`root`身份启动此进程，并验证该进程是否存在并以`clamav`用户ID运行。”
- en: '[PRE49]'
  id: totrans-229
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: '`If you have problems starting the service, make sure that the `clamd` (the
    ClamAV daemon) is running, and that it is listening on the socket you specified.
    You can set this in `clamd.conf` using the `LocalSocket` or `TCPSocket` directives
    (be sure that you only uncomment one of those lines). You should also make sure
    that the `ScanMail` directive is set to `on`.`'
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: “如果启动服务时遇到问题，请确保`clamd`（ClamAV守护程序）正在运行，并且它正在监听您指定的套接字。您可以在`clamd.conf`中使用`LocalSocket`或`TCPSocket`指令进行设置（确保只取消注释其中一行）。您还应确保`ScanMail`指令设置为`on`。”
- en: '`# Testing e-mail filtering'
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: “# 测试电子邮件过滤”
- en: Viruses, by definition, are things that we would prefer to avoid having any
    contact with at all. But in order to be certain that our filtering and detection
    processes are working correctly and that we are fully protected, we need to have
    access to a virus for testing purposes. Using real viruses for testing in the
    real world in a production ready environment is rather like setting fire to the
    trash can in your office to see whether the smoke detector is working. Such a
    test will give meaningful results, but with unappealing risks and unacceptable
    side effects. Therefore, we need our EICAR test file that can safely be mailed
    around and which is obviously non-viral, but which your antivirus software will
    react to as if it were a virus.
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 病毒，根据定义，是我们希望尽量避免接触的东西。但为了确保我们的过滤和检测过程正常运行，并且我们得到充分的保护，我们需要访问病毒进行测试。在现实世界的生产环境中使用真正的病毒进行测试，就像在办公室的垃圾桶里点火来测试烟雾探测器是否正常工作一样。这样的测试会产生有意义的结果，但伴随着令人不愉快的风险和不可接受的副作用。因此，我们需要EICAR测试文件，可以安全地发送邮件，并且显然不是病毒，但您的防病毒软件会对其做出反应，就像它是病毒一样。
- en: Testing mail-borne virus filtering
  id: totrans-233
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 测试邮件传播的病毒过滤
- en: The first test is to check that you can still receive mail.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 第一个测试是检查您是否仍然可以收到邮件。
- en: '[PRE50]'
  id: totrans-235
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: 'You should receive your mail with the addition of the following line in the
    header:'
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 您应该收到您的邮件，并在标题中添加以下行：
- en: '[PRE51]'
  id: totrans-237
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: If you did not receive the mail, check the system, postfix, and clamd log files.
    If necessary, you can also stop and restart the `clamsmtpd` daemon with the `-d
    4` option for extra debugging output.
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您没有收到邮件，请检查系统、postfix和clamd日志文件。如果需要，您还可以使用`-d 4`选项停止和重新启动`clamsmtpd`守护进程以获得额外的调试输出。
- en: The second simple test of scanning for mail-borne viruses can be performed by
    simply sending yourself a copy of the EICAR virus as an e-mail attachment.
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 通过简单地将EICAR病毒作为电子邮件附件发送给自己，可以执行第二个简单的测试，以检测邮件传播的病毒。
- en: The sample EICAR virus file must be created as an attachment to an e-mail. The
    following command chain from the Linux command prompt will send a very simple
    uuencoded attachment copy of the virus-infected file.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 必须将示例EICAR病毒文件创建为电子邮件的附件。从Linux命令提示符中执行以下命令链将发送一个非常简单的uuencoded附件副本的感染病毒文件。
- en: '[PRE52]'
  id: totrans-241
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: 'If everything is working and configured correctly, you should not receive the
    mail, as `clamsmtp` was instructed to drop the message. The absence of the message
    does not prove everything is working, so check the system or postfix log files
    for an entry similar to the following:'
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 如果一切正常并且配置正确，您不应该收到邮件，因为`clamsmtp`被指示丢弃该消息。消息的缺失并不意味着一切都正常，因此请检查系统或postfix日志文件，查看类似以下条目的内容：
- en: '[PRE53]'
  id: totrans-243
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: This proves the simple case of detecting a straightforward attachment containing
    a virus.
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 这证明了检测包含病毒的简单附件的简单情况。
- en: Of course, in the real world, viruses are slightly more clever than your average
    e-mail attachment. Thorough testing is required to be sure that the filtering
    is set up correctly. Luckily, there is a website ([http://www.gfi.com/emailsecuritytest/](http://www.gfi.com/emailsecuritytest/))
    available to send e-mails to you that contain the EICAR virus encoded within e-mails
    in a wide range of ways. Currently it supports 17 individual tests.
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，在现实世界中，病毒比你平均的电子邮件附件要聪明一些。需要进行彻底的测试，以确保过滤设置正确。幸运的是，有一个网站（[http://www.gfi.com/emailsecuritytest/](http://www.gfi.com/emailsecuritytest/)）可以向您发送包含EICAR病毒的电子邮件，以多种方式编码。目前它支持17个单独的测试。
- en: Thorough e-mail-borne testing
  id: totrans-246
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 彻底的电子邮件测试
- en: The site [http://www.gfi.com/emailsecuritytest/](http://www.gfi.com/emailsecuritytest/)
    requires you to register the e-mail address you wish to test and sends a confirmation
    e-mail to that address. In this e-mail is a link to follow that confirms that
    you are the valid user in control of that e-mail address. You are then able to
    send any or all of the 17 virus and e-mail client exploit tests to this e-mail
    address. If any of the virus bearing e-mails end up unfiltered in your inbox,
    then the installation has failed.
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 该网站[http://www.gfi.com/emailsecuritytest/](http://www.gfi.com/emailsecuritytest/)要求您注册要测试的电子邮件地址，并向该地址发送确认电子邮件。在这封电子邮件中有一个链接，确认您是控制该电子邮件地址的有效用户。然后，您可以将这些17个病毒和电子邮件客户端利用测试中的任何一个或全部发送到这个电子邮件地址。如果任何携带病毒的电子邮件最终未被过滤到您的收件箱中，那么安装就失败了。
- en: Note
  id: totrans-248
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: However, there are some test messages on the site that are not strictly viruses
    and so are not detected by the ClamAV process. This is because the messages do
    not themselves contain viruses and so there is nothing to find and therefore,
    nothing to stop.
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，该网站上有一些测试消息并不严格是病毒，因此不会被ClamAV进程检测到。这是因为这些消息本身并不包含病毒，因此没有东西可以找到，因此也没有东西可以停止。
- en: By definition, ClamAV traps only malicious code. The gfi ([http://www.gfi.com/emailsecuritytest/](http://www.gfi.com/emailsecuritytest/))
    site sends this type of test messages. The nature of these messages is that they
    have some malformed MIME tags that can fool Outlook clients. It is not the job
    of an antivirus program to detect such messages.
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 根据定义，ClamAV只捕获恶意代码。gfi（[http://www.gfi.com/emailsecuritytest/](http://www.gfi.com/emailsecuritytest/)）网站发送这种类型的测试消息。这些消息的性质是它们有一些格式错误的MIME标记，可以欺骗Outlook客户端。杀毒软件的工作不是检测这样的消息。
- en: Automating update of virus data
  id: totrans-251
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 自动更新病毒数据
- en: ClamAV is provided by volunteers, and the servers and bandwidth that are used
    to enable the software and virus database to be distributed are voluntarily funded.
    As such, it is important to ensure that there is a balance between the frequency
    of checking for updates to maintain an up-to-date database and overloading the
    various servers.
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: ClamAV由志愿者提供，用于分发软件和病毒数据库的服务器和带宽是自愿资助的。因此，重要的是要确保在维护最新数据库的更新频率和过载各种服务器之间保持平衡。
- en: Note
  id: totrans-253
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'The ClamAV group recommends the following: If you are running ClamAV 0.8x or
    higher, you can check for database updates as often as four times per hour provided
    you have the following option in `freshclam.conf: DNSDatabaseInfo current.cvd.clamav.net`.'
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: ClamAV组建议以下操作：如果您运行的是ClamAV 0.8x或更高版本，可以每小时检查四次数据库更新，只要您在`freshclam.conf`中有以下选项：DNSDatabaseInfo
    current.cvd.clamav.net。
- en: If you don't have that option, you must stick with one check per hour.
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您没有这个选项，您必须坚持每小时检查一次。
- en: Setting up auto updating
  id: totrans-256
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 设置自动更新
- en: The virus database files for ClamAV can be downloaded from the ClamAV servers
    in a variety of ways. This includes using automated or manual tools such as `wget`.
    However, this is not the preferred way of doing the updates.
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: ClamAV的病毒数据库文件可以以多种方式从ClamAV服务器下载。这包括使用自动化或手动工具，如`wget`。但这不是更新的首选方式。
- en: The `freshclam` utility we installed earlier with ClamAV is the preferred method
    to perform updates. It will download the latest antivirus database automatically
    on a regular basis. It can either be set up to work automatically from a `cron`
    entry or from the command line, or it can run as a daemon process and handle its
    own scheduling. When `freshclam` is started by a user with root privileges, it
    drops the special privileges and switches user ID to the `clamav` user.
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 我们之前使用ClamAV安装的`freshclam`实用程序是执行更新的首选方法。它将定期自动下载最新的杀毒软件数据库。它可以设置为自动从`cron`条目或命令行工作，也可以作为守护进程运行并处理自己的调度。当`freshclam`由具有root权限的用户启动时，它会放弃特权并切换用户ID为`clamav`用户。
- en: '`freshclam` uses the capabilities of the DNS system to obtain details of the
    latest version of virus database that is ready to be downloaded and where it can
    be obtained from. This can significantly reduce the load on your own as well as
    remote systems, as in most cases the only action performed is a check with the
    DNS server. Only if a newer version is available, it will attempt to perform a
    download.'
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: '`freshclam`使用DNS系统的功能来获取准备下载的最新病毒数据库的详细信息以及可以从哪里获取。这可以显著减少您自己以及远程系统的负载，因为在大多数情况下，执行的唯一操作是与DNS服务器的检查。只有在有更新版本可用时，它才会尝试执行下载。'
- en: 'We are now ready to start the `freshclam` process. If you have decided to run
    it as a daemon process, then simply execute the following command:'
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在准备启动`freshclam`进程。如果您决定将其作为守护进程运行，只需执行以下命令：
- en: '[PRE54]'
  id: totrans-261
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: Then check that the process is running and that the log file is being updated
    correctly.
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 然后检查进程是否正在运行，并且日志文件是否被正确更新。
- en: 'The other method available is to use the `cron` daemon to schedule the `freshclam`
    process to run at a regular period. To do this, you will need to add the following
    entry to the `crontab` file for either the `root` or the `clamav` user:'
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 另一种可用的方法是使用`cron`守护程序安排`freshclam`进程定期运行。为此，您需要为`root`或`clamav`用户的`crontab`文件添加以下条目：
- en: '[PRE55]'
  id: totrans-264
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: Note
  id: totrans-265
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '`N` can be any number of your choice between `1` and `59`. Please don''t choose
    any multiple of 10, because there are already too many servers using those time
    slots.'
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: '`N`可以是您选择的`1`到`59`之间的任意数字。请不要选择任何10的倍数，因为已经有太多服务器在使用这些时间段。'
- en: Proxy settings are only configurable via the configuration file, and `freshclam`
    will require strict read-only permissions for the owner of the config file when
    `HTTPProxyPassword` is enabled. For example,
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 代理设置仅可通过配置文件进行配置，并且在启用`HTTPProxyPassword`时，`freshclam`将要求配置文件的所有者具有严格的只读权限。例如，
- en: '[PRE56]'
  id: totrans-268
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: 'The following is an example of proxy settings:'
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是代理设置的示例：
- en: '[PRE57]'
  id: totrans-270
  prefs: []
  type: TYPE_PRE
  zh: '[PRE57]'
- en: Automating startup and shutdown
  id: totrans-271
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 自动化启动和关闭
- en: If you installed any or all of the ClamAV and ClamSMTP components via a package
    manager rather than from source, the necessary startup scripts may have been provided.
    Check to see if the necessary scripts have been included in the boot startup sequence.
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您通过软件包管理器而不是从源代码安装了ClamAV和ClamSMTP组件中的任何一个或全部组件，则可能已提供必要的启动脚本。请检查是否已将必要的脚本包含在引导启动顺序中。
- en: If you have installed ClamAV from the source code, the following scripts are
    examples for starting and stopping the necessary daemons at boot time. Depending
    on your distribution, the file locations may vary and you may need to execute
    additional commands to set run levels for each script. Please consult your distributions
    documentation.
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您从源代码安装了ClamAV，则以下脚本是用于在引导时启动和停止必要守护程序的示例。根据您的发行版，文件位置可能会有所不同，您可能需要执行其他命令来为每个脚本设置运行级别。请参阅您的发行版文档。
- en: ClamSMTP
  id: totrans-274
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ClamSMTP
- en: 'One of the contributed scripts that are available in the ClamSMTP sources is
    a script to be used for automatically starting and stopping the operating daemon
    when the system is booted. Check that the path names in the script match those
    in the config file and the installed directory, and then execute the following
    command from the root of the ClamSMTP source tree:'
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: ClamSMTP源中提供的一个贡献脚本是用于在系统引导时自动启动和停止操作守护程序的脚本。检查脚本中的路径名是否与配置文件和安装目录中的路径名匹配，然后从ClamSMTP源树的根目录执行以下命令：
- en: '[PRE58]'
  id: totrans-276
  prefs: []
  type: TYPE_PRE
  zh: '[PRE58]'
- en: After copying the file, make sure that the script has execute permissions and
    is not modifiable by anyone other than the system root user.
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 复制文件后，请确保脚本具有执行权限，并且除系统根用户外，其他人无法修改它。
- en: '[PRE59]'
  id: totrans-278
  prefs: []
  type: TYPE_PRE
  zh: '[PRE59]'
- en: Add the script to the system startup.
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 将脚本添加到系统启动中。
- en: '[PRE60]'
  id: totrans-280
  prefs: []
  type: TYPE_PRE
  zh: '[PRE60]'
- en: ClamAV
  id: totrans-281
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ClamAV
- en: Next is an example script to start and stop the `clamd` and `freshclamd` daemons
    at boot time. As before, verify the path names, adapt the script to your needs,
    and copy the script to the system initialization directory before adding it to
    the system startup.
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是一个示例脚本，用于在引导时启动和停止`clamd`和`freshclamd`守护程序。与以前一样，验证路径名，根据需要调整脚本，并在将其添加到系统启动之前将脚本复制到系统初始化目录。
- en: If `freshclam` is run as a `cron` job, rather than as a daemon, then remove
    the lines that start and stop the `freshclam` process from the script.
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 如果`freshclam`作为`cron`作业运行，而不是作为守护程序运行，则从脚本中删除启动和停止`freshclam`进程的行。
- en: '[PRE61]'
  id: totrans-284
  prefs: []
  type: TYPE_PRE
  zh: '[PRE61]'
- en: Monitoring log files
  id: totrans-285
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 监视日志文件
- en: It is important to monitor the log file on a regular basis. Here you will be
    able to track the regular updating of the virus database and make sure that your
    system is as well protected as possible.
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 定期监视日志文件非常重要。在这里，您将能够跟踪病毒数据库的定期更新，并确保您的系统受到尽可能多的保护。
- en: 'Regular update messages should appear similar to the following:'
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 定期更新消息应该类似于以下内容：
- en: '![Monitoring log files](img/8648_09_04.jpg)'
  id: totrans-288
  prefs: []
  type: TYPE_IMG
  zh: '![监视日志文件](img/8648_09_04.jpg)'
- en: 'Occasionally new software will be released and will need to be updated. In
    this case, you will get warning messages in the log file, such as the following:'
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 偶尔会发布新软件并需要更新。在这种情况下，您将在日志文件中收到警告消息，例如以下内容：
- en: '![Monitoring log files](img/8648_09_05.jpg)'
  id: totrans-290
  prefs: []
  type: TYPE_IMG
  zh: '![监视日志文件](img/8648_09_05.jpg)'
- en: In cases when there are Internet connection problems or the remote files themselves
    are unavailable while being updated, the process may log transient error messages.
    No action needs to be taken provided that these errors do not persist.
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: 在出现互联网连接问题或远程文件在更新时不可用的情况下，该过程可能会记录瞬态错误消息。只要这些错误不持续存在，就无需采取任何行动。
- en: Disinfecting files
  id: totrans-292
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 文件消毒
- en: A common request is for files to be disinfected automatically before being forwarded
    on to the final recipient. In the current version (0.95), ClamAV cannot disinfect
    files. The following information is available from the ClamAV documentation.
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 常见的请求是在转发给最终接收者之前自动对文件进行消毒。在当前版本（0.95）中，ClamAV无法对文件进行消毒。以下信息可从ClamAV文档中获取。
- en: 'We will add support for disinfecting OLE2 files in one of the next stable releases.
    There are no plans for disinfecting other types of files. There are many reasons
    for it: cleaning viruses from files is virtually pointless these days. It is very
    seldom that there is anything useful left after cleaning, and even if there is,
    would you trust it?'
  id: totrans-294
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 我们将在接下来的一个稳定版本中添加对OLE2文件的消毒支持。没有计划对其他类型的文件进行消毒。原因有很多：清除文件中的病毒在今天几乎是毫无意义的。清理后很少有任何有用的东西留下，即使有，你会相信它吗？
- en: Summary
  id: totrans-295
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: We have now installed and configured a very efficient antivirus system for checking
    all incoming e-mails for infected attachments, and have significantly secured
    our systems—both the server and the workstation—against attack.
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在已经安装并配置了一个非常高效的防病毒系统，用于检查所有传入电子邮件中的感染附件，并且已经显着加强了我们的系统——服务器和工作站——以防止攻击。
- en: Our Mail Transport Agent, Postfix, can now filter all messages using the ClamAV
    daemon via the ClamSMTP content filtering interface, to scan and detect a wide
    range of threats against a database of virus signatures. Using `freshclam`, we
    have ensured that our detection database has been kept up-to-date to guard against
    the latest threats and any new viruses released. Constant vigilance is still required
    to make sure that software and files are always kept totally up-to-date in this
    ongoing battle.`
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的邮件传输代理Postfix现在可以通过ClamSMTP内容过滤接口，使用ClamAV守护程序来过滤所有消息，以扫描和检测针对病毒签名数据库的各种威胁。通过使用`freshclam`，我们已经确保我们的检测数据库始终保持最新，以防范最新的威胁和任何新发布的病毒。在这场持续的战斗中，仍然需要保持不懈的警惕，以确保软件和文件始终保持完全最新。
