- en: '*Chapter 5*: Linux Security Standards with Real-Life Examples'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '*第5章*：具有实际示例的Linux安全标准'
- en: In this chapter, we'll explore the reasons why Linux hosts, like any hosts,
    need some care after initial installation – and in fact, throughout their life
    – to further secure them. Along the way, we'll cover various topics to build toward
    a final "big picture" of securing your Linux hosts.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将探讨为什么Linux主机，就像任何主机一样，在初始安装后需要一些关怀 - 事实上，在它们的整个生命周期中 - 以进一步加固它们。在此过程中，我们将涵盖各种主题，以建立加固Linux主机的最终“大局”。
- en: 'The following topics will be covered in the chapter:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将涵盖以下主题：
- en: Why do I need to secure my Linux hosts?
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为什么我需要保护我的Linux主机？
- en: Cloud-specific security considerations
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 云特定的安全考虑
- en: Commonly encountered industry-specific security standards
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 常见的行业特定安全标准
- en: The Center for Internet Security critical controls
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 互联网安全中心的关键控制
- en: The Center for Internet Security benchmarks
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 互联网安全中心基准
- en: SELinux and AppArmor
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SELinux和AppArmor
- en: Technical requirements
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: In this chapter, we'll be covering a number of topics, but the technical nuts
    and bolts will focus on hardening the SSH service, using our current Linux host
    or virtual machine. As in the last chapter, you may find that a second host is
    useful to test your changes as you go, but this isn't necessary to follow the
    examples.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将涵盖许多主题，但技术上的重点将放在加固SSH服务上，使用我们当前的Linux主机或虚拟机。与上一章一样，您可能会发现在进行更改时测试您的更改是否有用，但这并不是必须的。
- en: Why do I need to secure my Linux hosts?
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 为什么我需要保护我的Linux主机？
- en: Like almost every other operating system, the Linux install is streamlined to
    make the installation easy, with as few hiccups during and after the installation
    as possible. As we saw in earlier chapters, this often means an installation with
    no firewall enabled. In addition, the operating system version and package version
    will of course match the install media, rather than the latest version of each.
    In this chapter, we'll discuss how default settings in Linux are often not set
    to what most would consider secure, and how as an industry, we remedy this with
    legislation, regulations, and recommendations.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 就像几乎所有其他操作系统一样，Linux安装经过简化，使安装过程尽可能简单，尽可能少地出现问题。正如我们在前几章中看到的，这通常意味着没有启用防火墙的安装。此外，操作系统版本和软件包版本当然会与安装媒体匹配，而不是与每个软件包的最新版本匹配。在本章中，我们将讨论Linux中的默认设置通常不是大多数人认为安全的设置，作为行业，我们如何通过立法、法规和建议来解决这个问题。
- en: 'As for the initial installation being out of date, luckily, most Linux distributions
    have an auto-update process enabled. This is governed by two lines in the `/etc/apt/apt.conf.d/20auto-upgrades`
    file:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 至于初始安装是否过时，幸运的是，大多数Linux发行版都启用了自动更新过程。这由`/etc/apt/apt.conf.d/20auto-upgrades`文件中的两行控制：
- en: '[PRE0]'
  id: totrans-14
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Both settings are set to `1` (enabled) by default. The lines are self-explanatory
    – the first line governs whether the package lists are updated, the second turns
    true auto-update on or off. This default is not a bad setting for a desktop or
    a server that might be on the "cruise control" method of management. Note though
    that the `Unattended-Upgrade` line only enables security updates.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 这两个设置默认都设置为`1`（启用）。这两行都很容易理解 - 第一行控制包列表是否更新，第二行控制自动更新的开启或关闭。对于可能处于“巡航控制”管理方法的桌面或服务器来说，这个默认设置并不是一个坏设置。但需要注意的是，`Unattended-Upgrade`行只启用安全更新。
- en: 'In most well-managed environments, rather than unattended upgrades, you would
    expect to see scheduled maintenance windows, with upgrades and testing happening
    first on less critical servers before being deployed on more important hosts.
    In these situations, you''ll want the auto-update settings set to `0`, and to
    use manual or scripted update processes. For Ubuntu, the manual update process
    involves two commands, executed in the following sequence:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 在大多数良好管理的环境中，您会期望看到安排的维护窗口，先在不太关键的服务器上进行升级和测试，然后再部署到更重要的主机上。在这些情况下，您将希望将自动更新设置为`0`，并使用手动或脚本化的更新过程。对于Ubuntu，手动更新过程涉及两个命令，按以下顺序执行：
- en: '![](img/B16336_05_Table_01.jpg)'
  id: totrans-17
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16336_05_Table_01.jpg)'
- en: 'These can be combined in one line (see the next line of code), but you will
    have a few "Yes/No" prompts to answer during the upgrade step – first, to approve
    the entire process and volume of data. Also, you''ll be asked for decisions if
    any of your packages have changed their default behavior between versions:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 这些可以合并成一行（请参见下一行代码），但在升级步骤中您将需要回答一些“是/否”提示 - 首先是批准整个过程和数据量。此外，如果您的任何软件包在版本之间更改了默认行为，您将被要求做出决定：
- en: '[PRE1]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: The `&&` operator executes the commands in sequence. The second command only
    executes if the first completes successfully (with a return code of zero).
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: '`&&`运算符按顺序执行命令。第二个命令只有在第一个成功完成（返回代码为零）时才执行。'
- en: But wait, you say, some of my hosts are in the cloud – what about them? In the
    next section, you'll find that Linux is Linux no matter where you install it,
    and in some cases, your cloud instances might be less secure than your "in the
    data center" server template. No matter what your operating system or where you
    deploy, updates will be a key piece of your security program.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 但等等，您可能会说，我的一些主机在云中 - 那它们呢？在下一节中，您将发现无论您在何处安装，Linux都是Linux，而且在某些情况下，您的云实例可能比您的“数据中心”服务器模板更不安全。无论您的操作系统是什么，或者您在哪里部署，更新都将是您安全程序的关键部分。
- en: Cloud-specific security considerations
  id: totrans-22
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 云特定的安全考虑
- en: 'If you are spinning up virtual machines in any of the major clouds with their
    default images, there are a few things to consider from a security point of view:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您在任何主要云中启动虚拟机并使用它们的默认镜像，从安全的角度来看，有一些事情需要考虑：
- en: Some clouds have auto-updates enabled; some do not. However, everyone's image
    for every OS is always somewhat out of date. After you spin up a VM, you will
    need to update it, the same as you would a standalone host.
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 有些云启用了自动更新；有些没有。然而，每个操作系统的每个镜像总是有些过时。在您启动虚拟机之后，您将需要更新它，就像您会更新独立主机一样。
- en: Most cloud service images also have a host firewall, enabled in some restrictive
    mode. What these two firewall issues mean for you is, when you bring up your first,
    fresh Linux VM, don't expect to be able to "ping" it until you've had a peek at
    the host firewall configuration (remember from the last chapter – be sure to check
    both `iptables` and `nftables`).
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 大多数云服务镜像也有主机防火墙，在某些限制模式下启用。对于您来说，这两个防火墙问题意味着，当您首次启动新的Linux虚拟机时，不要指望能够“ping”它，直到您查看了主机防火墙配置（请记住上一章
    - 一定要检查`iptables`和`nftables`）。
- en: Many cloud service images will by default allow remote access directly for administrative
    access from the public internet. In the case of Linux, this means SSH over `tcp/22`.
    While this default setting for access is less common than in the earlier days
    of the various cloud service providers, it's still wise to check that you don't
    have SSH (`tcp/22`) open to the entire internet.
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 许多云服务镜像默认情况下允许直接从公共互联网进行管理访问。在Linux的情况下，这意味着通过`tcp/22`进行SSH。虽然这种访问的默认设置不像各种云服务提供商早期那样常见，但检查您是否对整个互联网开放了SSH（`tcp/22`）仍然是明智的。
- en: Often you may be using a cloud "service" rather than an actual server instance.
    For instance, a serverless database instance is common, where you have full access
    and control of your database, but the server hosting it is not visible to your
    users or application. The underlying server may be dedicated to your instance,
    but more likely, it will be shared across multiple organizations.
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通常，您可能正在使用云“服务”，而不是实际的服务器实例。例如，无服务器数据库实例很常见，您可以完全访问和控制您的数据库，但承载它的服务器对您的用户或应用程序不可见。潜在的服务器可能专用于您的实例，但更有可能是跨多个组织共享的。
- en: Now that we've discussed some differences between on-premise and cloud Linux
    deploys, let's discuss some differences in security requirements between industries.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经讨论了本地部署和云Linux部署之间的一些差异，让我们讨论一下不同行业之间的安全要求的差异。
- en: Commonly encountered industry-specific security standards
  id: totrans-29
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 常见的行业特定安全标准
- en: There are many industry-specific guidance and regulatory requirements, some
    of which you may be familiar with even if you're not in that industry. As they
    are industry-specific, we'll describe each at a high level – if any of these apply
    to you, you'll know that each of these is worthy of a book (or several books)
    on its own.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 有许多行业特定的指导和监管要求，其中一些即使您不在该行业，您可能也熟悉。由于它们是行业特定的，我们将对每个进行高层描述 - 如果其中任何一个适用于您，您将知道每个都值得一本书（或几本书）来描述。
- en: '![](img/B16336_05_Table_02a.jpg)![](img/B16336_05_Table_02b.jpg)'
  id: totrans-31
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16336_05_Table_02a.jpg)![](img/B16336_05_Table_02b.jpg)'
- en: While each of these standards and regulatory or legal requirements have an industry-specific
    focus, many of the underlying recommendations and requirements are very similar.
    The **Center for Internet Security** (**CIS**) "critical controls" are often used
    when there is no set of regulations that provide good security guidance. In fact,
    these controls are often used in conjunction with regulatory requirements to provide
    a better overall security posture.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管这些标准和监管或法律要求各自具有行业特定的重点，但许多基本建议和要求都非常相似。当没有提供良好安全指导的一套法规时，**互联网安全中心**（**CIS**）的“关键控制”通常被使用。事实上，这些控制通常与监管要求一起使用，以提供更好的整体安全姿态。
- en: The Center for Internet Security critical controls
  id: totrans-33
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 互联网安全中心关键控制
- en: While CIS' critical controls aren't standards for compliance, they are certainly
    an excellent foundation and a good working model for any organization. The critical
    controls are very practical in nature – rather than being compliance-driven, they
    are focused on real-world attacks and defending against them. The understanding
    is that if you focus on the controls, in particular, if you focus on them in order,
    then your organization will be well defended against the more common attacks seen
    "in the wild." For instance, just by looking at the order, it's apparent that
    you can't secure your hosts (**#3**) unless you know what hosts are on your network
    (**#1**). Similarly, logging (**#8**) isn't effective without an inventory of
    hosts and applications (**#2** and **#3**). As an organization works its way down
    the list, it quickly reaches the objective of not being the "slowest gazelle in
    the herd."
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然CIS的关键控制并不是合规标准，但它们无疑是任何组织的一个很好的基础和一个良好的工作模型。关键控制非常实用 - 它们不是以合规性为驱动，而是专注于现实世界的攻击和对抗。理解是，如果您专注于这些控制，特别是按顺序专注于它们，那么您的组织将很好地抵御“野外”中看到的更常见的攻击。例如，仅仅通过查看顺序，就可以明显地看出，您无法保护您的主机（**＃3**），除非您知道您网络上有哪些主机（**＃1**）。同样，日志记录（**＃8**）没有主机和应用程序清单（**＃2**和**＃3**）是无效的。当组织按照列表逐步进行工作时，它很快就会达到不成为“群体中最慢的羚羊”的目标。
- en: As with the CIS benchmarks, the critical controls are authored and maintained
    by volunteers. They are also revised over time – this is key as the world changes
    as time, operating systems, and attacks march on. While the threats of 10 years
    ago are still mostly with us, we now have new threats, we have new tools, and
    malware and attackers use different methods than we saw 10 years ago. This section
    describes version 8 of the critical controls (released in 2021), but be sure to
    reference the most current version if you are using the controls to make decisions
    in your organization.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 与CIS基准一样，关键控制由志愿者编写和维护。它们也会随着时间进行修订 - 这是关键的，因为世界随着时间、操作系统和攻击的不断发展而发生变化。虽然10年前的威胁仍然存在，但现在我们有新的威胁，我们有新的工具，恶意软件和攻击者使用的方法与10年前不同。本节描述了关键控制的第8版（于2021年发布），但如果您在组织中使用这些控制做决策，请务必参考最新版本。
- en: 'The critical controls (version 8) are broken into three implementation groups:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 关键控制（第8版）分为三个实施组：
- en: '**Implementation group 1 (IG1) – basic controls**'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: '**实施组1（IG1）-基本控制**'
- en: These controls are where organizations normally start. If these are all in place,
    then you can have some assurance that your organization is no longer *the slowest
    gazelle in the herd*. These controls are targeted toward smaller IT groups and
    commercial/off-the-shelf hardware and software.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 这些控制是组织通常开始的地方。如果这些都已经就位，那么您可以确保您的组织不再是“群中最慢的羚羊”。这些控制针对较小的IT团队和商业/现成的硬件和软件。
- en: '**Implementation group 2 (IG2) – medium-sized enterprises**'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: '**实施组2（IG2）- 中型企业**'
- en: The implementation group 2 controls expand on the IG1 controls, adding technical
    guidance for more specific configurations and technical processes that should
    be in place. This group of controls targets larger organizations, where there
    is a single person or a small group who has responsibility for information security,
    or who has regulatory compliance requirements.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 实施组2的控制扩展了IG1的控制，为更具体的配置和技术流程提供了技术指导。这组控制针对较大的组织，在那里有一个人或一小组负责信息安全，或者有法规合规要求。
- en: '**Implementation group 3 (IG3) – larger enterprises**'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: '**实施组3（IG3）- 大型企业**'
- en: These controls target larger environments with established security teams and
    processes. Many of these controls have more to do with the organization – working
    with staff and vendors and having policies and procedures for incident response,
    incident management, penetration tests, and red team exercises.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 这些控制针对已建立的安全团队和流程的较大环境。这些控制中的许多与组织有关 - 与员工和供应商合作，并为事件响应、事件管理、渗透测试和红队演习制定政策和程序。
- en: Each implementation group is a super-set of the previous, so IG3 includes both
    groups 1 and 2\. Each control has several sub-sections, and it is these sub-sections
    that are classified by the implementation group. For a full description of each
    control and implementation group, the source document for the critical controls
    is freely downloadable at [https://www.cisecurity.org/controls/cis-controls-list/](https://www.cisecurity.org/controls/cis-controls-list/),
    with both a click-through for descriptions as well as detailed PDF and Excel documents.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 每个实施组都是前一个的超集，因此IG3包括组1和2。每个控制都有几个子部分，正是这些子部分由实施组分类。有关每个控制和实施组的完整描述，关键控制的源文件可免费下载[https://www.cisecurity.org/controls/cis-controls-list/](https://www.cisecurity.org/controls/cis-controls-list/)，其中包括点击以获取描述以及详细的PDF和Excel文档。
- en: '![](img/B16336_05_Table_03a.jpg)![](img/B16336_05_Table_03b.jpg)![](img/B16336_05_Table_03c.jpg)![](img/B16336_05_Table_03d.jpg)'
  id: totrans-44
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16336_05_Table_03a.jpg)![](img/B16336_05_Table_03b.jpg)![](img/B16336_05_Table_03c.jpg)![](img/B16336_05_Table_03d.jpg)'
- en: Now that we've discussed the critical controls, how does that translate to securing
    a Linux host or a Linux-based infrastructure that you might see in your organization?
    Let's look at some specific examples, starting with critical controls number 1
    and 2 (hardware and software inventory).
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经讨论了关键控制措施，那么如何将其转化为保护Linux主机或您组织中可能看到的基于Linux的基础架构呢？让我们看一些具体的例子，从关键控制措施1和2（硬件和软件清单）开始。
- en: Getting a start on CIS critical security controls 1 and 2
  id: totrans-46
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 开始CIS关键安全控制1和2
- en: An accurate inventory of both hosts on the network and software running on each
    of those hosts is a key part of almost every security framework – the thinking
    being that you can't secure something if you don't know that it's there.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 对网络上的主机和每台主机上运行的软件的准确清单几乎是每个安全框架的关键部分 - 思想是如果您不知道它在那里，就无法保护它。
- en: Let's explore how we might do that for our Linux host with a zero-budget approach,
    using critical controls 1 and 2 as an example.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们探讨如何在我们的Linux主机上使用零预算方法来实施关键控制1和2。
- en: Critical control 1 – hardware inventory
  id: totrans-49
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 关键控制1 - 硬件清单
- en: Let's use the native Linux commands to explore critical controls 1 and 2 – hardware
    and software inventory.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们使用本机Linux命令来探索关键控制1和2 - 硬件和软件清单。
- en: 'Hardware inventory is easily obtainable – many system parameters are easily
    available as files, located in the `/proc` directory. The `proc` filesystem is
    virtual. The files in `/proc` are not real files; they reflect the operating characteristics
    of the machine. For instance, you can get the CPU (only the first CPU is shown
    in this output) just by looking at the correct files:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 硬件清单很容易获得 - 许多系统参数都可以作为文件轻松获得，位于`/proc`目录中。`proc`文件系统是虚拟的。`/proc`中的文件不是真实的文件；它们反映了机器的操作特性。例如，您可以通过查看正确的文件来获取CPU（此输出仅显示第一个CPU）：
- en: '[PRE2]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Memory information is easy to find as well:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 内存信息也很容易找到：
- en: '[PRE3]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Digging deeper into the `/proc` filesystem, we can find the settings on various
    IP or TCP parameters in many separate, discrete files in `/proc/sys/net/ipv4`
    (this listing is complete and formatted for easier viewing).
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 深入挖掘`/proc`文件系统，我们可以在`/proc/sys/net/ipv4`中的许多单独的文件中找到各种IP或TCP参数的设置（此列表已完整并格式化以便更轻松地查看）。
- en: 'Going past the hardware, there are multiple methods for getting the operating
    system version:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 硬件方面，有多种方法可以获取操作系统版本：
- en: '[PRE4]'
  id: totrans-57
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Most organizations choose to put the operating system information into the hardware
    inventory, though it's certainly just as correct to place it in the software inventory
    for that machine. In almost every operating system though, the installed applications
    will update at a more frequent cadence than the operating system, which is why
    the hardware inventory is so frequently the choice that is made. The important
    thing is that it's recorded in one inventory or the other. In most systems, the
    hardware and software inventory systems are the same system anyway, so that settles
    the discussion nicely.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数组织选择将操作系统信息放入硬件清单中，尽管将其放入该机器的软件清单中同样正确。在几乎每个操作系统中，安装的应用程序将以比操作系统更频繁的频率更新，这就是为什么硬件清单如此频繁地被选择的原因。重要的是它记录在一个清单中。在大多数系统中，硬件和软件清单系统是同一个系统，所以这样的讨论就很好地解决了。
- en: The `lshw` command is a nice "give me everything" command for a hardware inventory
    – the man page for `lshw` gives us additional options to dig deeper or be more
    selective in the display of this command. This command can collect too much information
    though – you'll want to be selective!
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: '`lshw`命令是一个很好的“给我所有东西”的命令，用于硬件清单——`lshw`的man页面为我们提供了更深入挖掘或更有选择性地显示此命令的附加选项。不过，这个命令可能收集太多信息——你需要有选择地进行收集！'
- en: 'Organizations often find a good compromise by writing a script to collect exactly
    what they need for their hardware inventory – for instance, the short script that
    follows is useful for basic hardware and OS inventory. It takes several files
    and commands we''ve used so far and expands on them by using a few new commands:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 组织通常通过编写脚本来找到一个很好的折衷方案，以收集他们的硬件清单所需的确切信息——例如，下面的简短脚本对基本的硬件和操作系统清单非常有用。它使用了我们迄今为止使用过的几个文件和命令，并通过使用一些新命令进行了扩展：
- en: '`fdisk` for disk information'
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`fdisk`用于磁盘信息'
- en: '`dmesg` and `dmidecode` for system information:'
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`dmesg`和`dmidecode`用于系统信息：'
- en: '[PRE5]'
  id: totrans-63
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'The output for your lab Ubuntu VM might look something like this (this example
    is a virtual machine). Note that we''re using `sudo` (mostly for the `fdisk` command,
    which needs those rights):'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 你的实验Ubuntu虚拟机的输出可能如下所示（此示例是虚拟机）。请注意，我们使用了`sudo`（主要是为了`fdisk`命令，它需要这些权限）：
- en: '[PRE6]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: With the information needed to populate our hardware inventory, let's look at
    our inventory of software next.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 有了填充硬件清单所需的信息，接下来让我们看看我们的软件清单。
- en: Critical control 2 – software inventory
  id: totrans-67
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 关键控制2——软件清单
- en: 'To inventory all installed packages, the `apt` or `dpkg` commands can be used.
    We''ll use this command to get a list of installed packages:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 要清点所有已安装的软件包，可以使用`apt`或`dpkg`命令。我们将使用这个命令来获取已安装软件包的列表：
- en: '[PRE7]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Note that with this many packages, it's best to either know what you are looking
    for and make a specific request (maybe by using the `grep` command), or to collect
    everything for multiple hosts, then use a database to find hosts that don't match
    on one thing or another.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，有这么多软件包时，最好要么知道自己在寻找什么并提出具体的请求（也许使用`grep`命令），要么收集多台主机的所有信息，然后使用数据库找出在某一方面不匹配的主机。
- en: 'The `dpkg` command will give us similar information:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: '`dpkg`命令将为我们提供类似的信息：'
- en: '[PRE8]'
  id: totrans-72
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'To get the files included in a package, use the following:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 要获取软件包中包含的文件，使用以下命令：
- en: '[PRE9]'
  id: totrans-74
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'To list all installed packages in most Red Hat distribution variants, use the
    following:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 要列出大多数Red Hat发行版中安装的所有软件包，请使用以下命令：
- en: '[PRE10]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'For more information on a specific package, use `rpm -qi`:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 要获取有关特定软件包的更多信息，使用`rpm -qi`：
- en: '[PRE11]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: For more information, on all packages (perhaps too much information), use `rpm
    -qia`.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 要获取所有软件包的更多信息（可能是太多信息），使用`rpm -qia`。
- en: These lists, as you can see, are very granular and complete. You may choose
    to inventory everything – even a complete text listing (with no database) can
    be valuable. If you have two similar hosts, you can use the `diff` command to
    see differences between two similar workstations (one working, one not).
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 这些清单，正如你所看到的，非常细致和完整。你可以选择清点所有东西——即使是完整的文本清单（没有数据库）也是有价值的。如果你有两台相似的主机，你可以使用`diff`命令来查看两台相似工作站之间的差异（一台工作，一台不工作）。
- en: Or if you are troubleshooting, it's common to check installed versions against
    known bugs, or file dates against known install dates, and so on.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，如果你在进行故障排除，通常会检查已安装的版本与已知的错误、文件日期与已知的安装日期等是否匹配。
- en: The inventory approaches discussed to date are all native to Linux but are not
    well suited to managing a fleet of hosts, or really even to managing one host
    well. Let's explore OSQuery, a management package that simplifies making progress
    on many of the critical controls and/or any regulatory frameworks you may need
    to comply with.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 迄今为止讨论的清单方法都是Linux本地的，但并不适合管理一大批主机，甚至不适合很好地管理一台主机。让我们来探索OSQuery，这是一个管理软件包，可以简化在许多关键控制和/或任何你可能需要遵守的监管框架上取得进展。
- en: OSQuery – critical controls 1 and 2, adding in controls 10 and 17
  id: totrans-83
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: OSQuery——关键控制1和2，添加控制10和17
- en: Rather than maintaining thousands of lines of text files as an inventory, a
    more common approach is to use an actual application or platform to maintain your
    inventory – either live on the hosts, in a database, or in some combination. OSQuery
    is a common platform for this. It gives administrators a database-like interface
    to the live information on the target hosts.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 与维护成千上万行文本文件作为清单不同，更常见的方法是使用实际的应用程序或平台来维护你的清单——可以是在主机上实时进行，可以是在数据库中，也可以是两者的结合。OSQuery是一个常见的平台。它为管理员提供了一个类似数据库的接口，用于目标主机上的实时信息。
- en: OSQuery is a common choice because it handles the most popular Linux and Unix
    variants, macOS, and Windows in one interface. Let's dive into the Linux side
    of this popular platform.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: OSQuery是一个常见的选择，因为它可以处理最流行的Linux和Unix变体、macOS和Windows，都在一个界面中。让我们深入了解这个流行平台的Linux部分。
- en: 'First, to install OSQuery, we''ll need to add the correct repository. For Ubuntu,
    use the following:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，要安装OSQuery，我们需要添加正确的存储库。对于Ubuntu，使用以下命令：
- en: '[PRE12]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Next, import the repository''s signing keys:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，导入存储库的签名密钥：
- en: '[PRE13]'
  id: totrans-89
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Then, update the package list:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，更新软件包列表：
- en: '[PRE14]'
  id: totrans-91
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Finally, we can install `osquery`:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们可以安装`osquery`：
- en: '[PRE15]'
  id: totrans-93
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'OSQuery has three main components:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: OSQuery有三个主要组件：
- en: '![](img/B16336_05_Table_04.jpg)'
  id: totrans-95
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16336_05_Table_04.jpg)'
- en: 'With the installation done, let''s explore the interactive shell. Note that
    without setting up the daemon and "connecting" your various hosts, we''re using
    a virtual database and only looking at our local host:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 安装完成后，让我们来探索交互式shell。请注意，如果没有设置守护程序并“连接”你的各种主机，我们使用的是一个虚拟数据库，只查看我们的本地主机：
- en: '[PRE16]'
  id: totrans-97
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Next let''s take a look at the database tables that we have available:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来让我们来看看我们可以使用的数据库表：
- en: '[PRE17]'
  id: totrans-99
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'There are dozens of tables that keep track of all kinds of system parameters.
    Let''s look at the OS version, for instance:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 有数十个表格来跟踪各种系统参数。让我们来看看操作系统版本，例如：
- en: '[PRE18]'
  id: totrans-101
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Or, to collect the local interface IP and subnet mask, excluding the loopback,
    use the following:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，要收集本地接口IP和子网掩码，不包括环回接口，使用以下命令：
- en: '[PRE19]'
  id: totrans-103
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'Or, to retrieve the local ARP cache, use the following:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，要检索本地ARP缓存，请使用以下命令：
- en: '[PRE20]'
  id: totrans-105
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Or, list the installed packages (note that this output is capped at 2):'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，列出已安装的软件包（请注意，此输出限制为2）：
- en: '[PRE21]'
  id: totrans-107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'You can also query running processes (display is capped at 10):'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以查询运行中的进程（显示限制为10）：
- en: '[PRE22]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: We can add additional information to our process list. Let's add the `SHA256`
    hash value for each process. A hash is a mathematical function that uniquely identifies
    data. For instance, if you have two files with different names but the same hash,
    they are very likely identical. While there's always a small possibility that
    you'll get a hash "collision" (the same hash for two non-identical files), hashing
    them again with a different algorithm removes any uncertainty. Hashing data artifacts
    is used extensively in forensics – in particular, in gathering evidence to prove
    the integrity of the chain of custody.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以向我们的进程列表添加额外的信息。让我们为每个进程添加`SHA256`哈希值。哈希是一种可以唯一标识数据的数学函数。例如，如果您有两个具有不同名称但相同哈希的文件，它们很可能是相同的。虽然总会有一小部分可能性会出现哈希“碰撞”（两个非相同文件的相同哈希），但使用不同算法再次对它们进行哈希处理可以消除任何不确定性。在取证中广泛使用哈希数据工件-特别是在收集证据以证明责任链完整性方面。
- en: Even in forensic analysis though, a single hash value is usually enough to establish
    uniqueness (or not).
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 即使在取证分析中，单个哈希值通常足以确定唯一性（或不确定性）。
- en: 'What does this mean for running processes? If your malware uses a random name
    in each instance to evade detection, hashing the process in RAM for all Linux
    hosts allows you to find identical processes on different hosts, running with
    different names:'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 这对运行进程意味着什么？如果您的恶意软件在每个实例中使用随机名称以规避检测，那么在所有Linux主机的RAM中对进程进行哈希处理，可以让您找到在不同主机上以不同名称运行的相同进程：
- en: '[PRE23]'
  id: totrans-113
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: This tool can be particularly effective in an incident response situation. With
    just the queries we've listed in these few pages, we can quickly find hosts with
    specific OS or software versions – in other words, we can find hosts that are
    vulnerable to a specific attack. In addition, we can collect the hash values of
    all running processes, to find malware that might be masquerading as a benign
    process. All of this can be accomplished with just a few queries.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 这个工具在事件响应情况下特别有效。通过我们在这几页中列出的查询，我们可以快速找到具有特定操作系统或软件版本的主机-换句话说，我们可以找到容易受到特定攻击的主机。此外，我们可以收集所有运行进程的哈希值，以找到可能伪装成良性进程的恶意软件。所有这些都可以通过只进行几次查询来完成。
- en: This last section took the high-level directives in the critical controls and
    translated them to "nuts-and-bolts" commands in Linux to achieve those goals.
    Let's see how that differs from more prescriptive and operating system or application-specific
    security guidance – in this case, applying a CIS benchmark to a host implementation.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 最后一部分将关键控件中的高级指令转换为Linux中的“实用”命令，以实现这些目标。让我们看看这与更具规范性和操作系统或应用程序特定的安全指导有何不同-在这种情况下，将CIS基准应用于主机实施。
- en: The Center for Internet Security benchmarks
  id: totrans-116
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 互联网安全中心基准
- en: CIS publishes security benchmarks that describe the security configuration of
    any number of infrastructure components. This includes all facets of several different
    Linux distributions, as well as many applications that might be deployed on Linux.
    These benchmarks are very "prescriptive" – each recommendation in a benchmark
    describes the problem, how to resolve it using OS commands or configurations,
    and how to audit for the current state of the setting.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: CIS发布描述任何数量基础设施组件的安全配置的安全基准。这包括几种不同Linux发行版的所有方面，以及可能部署在Linux上的许多应用程序。这些基准非常“规范”-基准中的每个建议都描述了问题，如何使用操作系统命令或配置解决问题，以及如何对当前设置的状态进行审计。
- en: A very attractive feature of the CIS benchmarks is that they are written and
    maintained by groups of industry experts who volunteer their time to make the
    internet a safer place. While vendors do participate in developing these documents,
    they are group efforts and the final recommendations need the consensus of the
    group. The end result is a vendor-agnostic, consensus- and community-driven document
    with very specific recommendations.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: CIS基准的一个非常吸引人的特点是，它们是由一群行业专家编写和维护的，他们自愿投入时间使互联网变得更安全。虽然供应商参与制定这些文件，但它们是团体努力的最终建议需要团体的共识。最终结果是一个与供应商无关、共识和社区驱动的具有非常具体建议的文件。
- en: The CIS benchmarks are created both to build a better platform (whatever the
    platform is) and to be audited against, so each recommendation has both a remediation
    and an audit section. The detailed explanations on each benchmark are key, so
    that the administrator has a good idea of not only what they are changing but
    why. This is important as not all recommendations might apply to every situation,
    and in fact, sometimes recommendations will conflict with each other, or result
    in specific things not working on the target system. These situations are described
    in the documents as they come up, but this emphasizes the importance of not implementing
    all recommendations to their maximum potential! It also makes it clear in an audit
    situation that striving for "100%" is not in anyone's best interest.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: CIS基准旨在构建更好的平台（无论平台是什么），并且可以进行审计，因此每个建议都有补救和审计部分。对每个基准的详细解释至关重要，这样管理员不仅知道他们在改变什么，还知道为什么。这一点很重要，因为并非所有建议都适用于每种情况，事实上，有时建议会相互冲突，或者导致目标系统上的特定事物无法正常工作。这些情况在文件中描述，但这强调了不要将所有建议都最大程度地实施的重要性！这也清楚地表明，在审计情况下，追求“100%”并不符合任何人的最佳利益。
- en: Another key feature of these benchmarks is that they are usually two benchmarks
    in one – there will be recommendations for "regular" organizations, as well as
    more stringent recommendations for higher-security environments.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 这些基准的另一个关键特点是它们通常是两个基准合二为一-对“常规”组织会有建议，对更高安全性环境则有更严格的建议。
- en: CIS does maintain an auditing application **CIS-CAT** (**Configuration Assessment
    Tool**) that will assess infrastructure against its benchmarks, but many industry-standard
    tools such as security scanners (such as Nessus) and automation tools (such as
    Ansible, Puppet, or Chef) will assess target infrastructure against the applicable
    CIS benchmark.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: CIS确实维护一个审计应用程序**CIS-CAT**（**配置评估工具**），它将根据其基准评估基础架构，但许多行业标准工具，如安全扫描仪（如Nessus）和自动化工具（如Ansible、Puppet或Chef），将根据适用的CIS基准评估目标基础架构。
- en: Now that we understand what the benchmarks are meant to accomplish, let's take
    a look at a Linux benchmark, in particular, one set of recommendations in that
    benchmark.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们了解了基准的目的，让我们来看看Linux基准，特别是其中一组建议。
- en: Applying a CIS benchmark – securing SSH on Linux
  id: totrans-123
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 应用CIS基准-在Linux上保护SSH
- en: When securing a server, workstation, or infrastructure platform, it's helpful
    to have a list of things that you'd like to secure, and how to accomplish that.
    This is what the CIS benchmarks are for. As discussed, you likely will never completely
    implement all recommendations in any CIS benchmark on any one host – security
    recommendations will often impair or disable services you might need, and sometimes
    recommendations will conflict with each other. This means that benchmarks are
    often evaluated carefully, and used as a primary input for an organization-specific
    build document.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 在保护服务器、工作站或基础架构平台时，有一个想要保护的事项清单以及如何实现的清单会很有帮助。这就是CIS基准的用途。正如讨论的那样，您可能永远不会完全在任何一个主机上实施所有CIS基准的建议-安全建议通常会损害或禁用您可能需要的服务，并且有时建议会相互冲突。这意味着基准通常会经过仔细评估，并被用作组织特定构建文档的主要输入。
- en: Let's use the CIS benchmark for Ubuntu 20.04 to secure the SSH service on our
    host. SSH is the main method of remotely connecting to and administering Linux
    hosts. This makes securing the SSH server on your Linux host an important task,
    and often the first configuration task after the network connection is established.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们使用Ubuntu 20.04的CIS基准来保护我们主机上的SSH服务。SSH是远程连接和管理Linux主机的主要方法。这使得在Linux主机上保护SSH服务器成为一项重要任务，并且通常是建立网络连接后的第一个配置任务。
- en: First, download the benchmark – the benchmark documents for all platforms are
    located at [https://www.cisecurity.org/cis-benchmarks/](https://www.cisecurity.org/cis-benchmarks/).
    If you aren't running Ubuntu 20.04, download the benchmark that is the closest
    match to your distribution. You'll find that SSH is such a common service that
    the recommendations for securing the SSH service are pretty consistent between
    distros, and often have matching recommendations on non-Linux platforms.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，下载基准-所有平台的基准文档位于[https://www.cisecurity.org/cis-benchmarks/](https://www.cisecurity.org/cis-benchmarks/)。如果您不是运行Ubuntu
    20.04，请下载与您的发行版最接近的基准。您会发现SSH是一种非常常见的服务，用于保护SSH服务的建议在发行版之间非常一致，并且在非Linux平台上通常有相匹配的建议。
- en: 'Before we start, update the repo list and upgrade the OS packages – note again
    how we''re running two commands at once. Using a single `&` terminator on a command
    runs it in the background, but using `&&` runs two commands in sequence, the second
    one executing when the first one completes successfully (that is, if it has a
    "return value" of zero):'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 在开始之前，更新存储库列表并升级操作系统软件包-再次注意我们如何同时运行两个命令。在命令上使用单个“&”终止符会将其在后台运行，但使用“&&”会按顺序运行两个命令，第二个命令在第一个成功完成时执行（也就是说，如果它具有零的“返回值”）：
- en: '[PRE24]'
  id: totrans-128
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: You can learn more about this on the `bash man` page (execute `man bash`).
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在“bash man”页面上了解更多信息（执行“man bash”）。
- en: 'Now that the OS components are updated, let''s install the SSH daemon, as it''s
    not installed by default on Ubuntu:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，操作系统组件已更新，让我们安装SSH守护程序，因为它在Ubuntu上默认情况下未安装：
- en: '[PRE25]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: In a modern Linux distro, this installs the SSH server, then does a basic configuration
    and starts the service.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 在现代Linux发行版中，这将安装SSH服务器，然后进行基本配置并启动服务。
- en: 'Now let''s get to securing this. Looking in the Ubuntu benchmark, in the SSH
    section, we see 22 separate recommendations for a wide variety of configuration
    settings:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们开始保护它。在Ubuntu基准中查看SSH部分，我们看到了22个不同的配置设置的建议：
- en: 5.2 Configure the SSH Server.
  id: totrans-134
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 5.2 配置SSH服务器。
- en: 5.2.1 Ensure permissions on `/etc/ssh/sshd_config` are configured.
  id: totrans-135
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 5.2.1 确保配置了“/etc/ssh/sshd_config”的权限。
- en: 5.2.2 Ensure permissions on SSH private host key files are configured.
  id: totrans-136
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 5.2.2 确保配置了SSH私有主机密钥文件的权限。
- en: 5.2.3 Ensure permissions on SSH public host key files are configured.
  id: totrans-137
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 5.2.3 确保配置了SSH公共主机密钥文件的权限。
- en: 5.2.4 Ensure SSH `LogLevel` is appropriate.
  id: totrans-138
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 5.2.4 确保SSH“LogLevel”适当。
- en: 5.2.5 Ensure SSH X11 forwarding is disabled.
  id: totrans-139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 5.2.5 确保禁用SSH X11转发。
- en: 5.2.6 Ensure SSH `MaxAuthTries` is set to `4` or less.
  id: totrans-140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 5.2.6 确保SSH“MaxAuthTries”设置为“4”或更少。
- en: 5.2.7 Ensure SSH `IgnoreRhosts` is enabled.
  id: totrans-141
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 5.2.7 确保启用了SSH“IgnoreRhosts”。
- en: 5.2.8 Ensure SSH `HostbasedAuthentication` is disabled.
  id: totrans-142
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 5.2.8 确保禁用了SSH“HostbasedAuthentication”。
- en: 5.2.9 Ensure SSH root login is disabled.
  id: totrans-143
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 5.2.9 确保SSH根登录已禁用。
- en: 5.2.10 Ensure SSH `PermitEmptyPasswords` is disabled.
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 5.2.10 确保禁用了SSH“PermitEmptyPasswords”。
- en: 5.2.11 Ensure SSH `PermitUserEnvironment` is disabled.
  id: totrans-145
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 5.2.11 确保禁用了SSH“PermitUserEnvironment”。
- en: 5.2.12 Ensure only strong ciphers are used.
  id: totrans-146
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 5.2.12 确保仅使用强大的密码。
- en: 5.2.13 Ensure only strong MAC algorithms are used.
  id: totrans-147
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 5.2.13 确保仅使用强大的MAC算法。
- en: 5.2.14 Ensure only strong key exchange algorithms are used.
  id: totrans-148
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 5.2.14 确保仅使用强大的密钥交换算法。
- en: 5.2.15 Ensure an SSH idle timeout interval is configured.
  id: totrans-149
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 5.2.15 确保配置了SSH空闲超时间隔。
- en: 5.2.16 Ensure SSH `LoginGraceTime` is set to one minute or less.
  id: totrans-150
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 5.2.16 确保SSH“LoginGraceTime”设置为一分钟或更短。
- en: 5.2.17 Ensure SSH access is limited.
  id: totrans-151
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 5.2.17 确保限制了SSH访问。
- en: 5.2.18 Ensure an SSH warning banner is configured.
  id: totrans-152
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 5.2.18 确保配置了SSH警告横幅。
- en: 5.2.19 Ensure SSH PAM is enabled.
  id: totrans-153
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 5.2.19 确保启用了SSH PAM。
- en: 5.2.20 Ensure SSH `AllowTcpForwarding` is disabled.
  id: totrans-154
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 5.2.20 确保禁用SSH“AllowTcpForwarding”。
- en: 5.2.21 Ensure SSH `MaxStartups` is configured.
  id: totrans-155
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 5.2.21 确保配置了SSH“MaxStartups”。
- en: 5.2.22 Ensure SSH `MaxSessions` is limited.
  id: totrans-156
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 5.2.22 确保限制了SSH“MaxSessions”。
- en: To illustrate how these work, let's look in more detail at two recommendations
    – disabling direct login of the root user (5.2.9) and ensuring that our encryption
    ciphers are strings (5.2.12).
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 为了说明这些工作原理，让我们更详细地看一下两个建议 - 禁用root用户的直接登录（5.2.9）和确保我们的加密密码是字符串（5.2.12）。
- en: Ensure SSH root login is disabled (5.2.9)
  id: totrans-158
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 确保SSH root登录已禁用（5.2.9）
- en: This recommendation is to ensure that users all log in with their named accounts
    – the user "root" should never log in directly. This ensures that any log entries
    that might indicate a configuration error or malicious activity will have a real
    person's name attached to them.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 这个建议是确保用户都使用他们的命名帐户登录 - 用户“root”不应该直接登录。这确保了任何可能指示配置错误或恶意活动的日志条目将附有一个真实的人名。
- en: The term for this is "non-repudiation" – if everyone has their own named accounts,
    and there are no "shared" accounts, then in the event of an incident, nobody can
    claim "everyone knows that password, it wasn't me."
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 这个术语叫做“不可否认性” - 如果每个人都有自己的命名帐户，而且没有“共享”帐户，那么在发生事故时，没有人可以声称“每个人都知道那个密码，不是我”。
- en: 'The audit command for this is to run the following:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 这个审计命令是运行以下命令：
- en: '[PRE26]'
  id: totrans-162
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: This default setting is non-compliant. We want this to be "no." The `without-password`
    value indicates that you can log in as root using non-password methods (such as
    using certificates).
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 这个默认设置是不符合要求的。我们希望这个是“no”。`without-password`值表示您可以使用非密码方法（如使用证书）以root用户身份登录。
- en: 'To fix this, we''ll look in the remediation section. This tells us to edit
    the `/etc/ssh/sshd_config` file, and add the line `PermitRootLogin no`. `PermitRootLogin`
    is commented out (with a `#` character), so we''ll either uncomment that out or,
    better yet, add our change directly under the commented value, as shown here:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 为了解决这个问题，我们将在补救部分查找。这告诉我们编辑`/etc/ssh/sshd_config`文件，并添加`PermitRootLogin no`这一行。`PermitRootLogin`被注释掉了（用`#`字符），所以我们要么取消注释，要么更好的是直接在注释值下面添加我们的更改，如下所示：
- en: '![Figure 5.1 – Edits made to the sshd_config file to deny root login over SSH'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: '![图5.1 - 对sshd_config文件的编辑，以拒绝SSH上的root登录'
- en: '](img/B16336_05_001.jpg)'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/B16336_05_001.jpg)'
- en: Figure 5.1 – Edits made to the sshd_config file to deny root login over SSH
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.1 - 对sshd_config文件的编辑，以拒绝SSH上的root登录
- en: 'Now we''ll rerun our audit check, and we''ll see that we''re now in compliance:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们将重新运行我们的审计检查，我们会看到我们现在符合要求了：
- en: '[PRE27]'
  id: totrans-169
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: With that recommendation implemented, let's look at our situation on SSH ciphers
    (CIS benchmark recommendation 5.2.12).
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 实施了这个建议后，让我们看看我们在SSH密码上的情况（CIS基准建议5.2.12）。
- en: Ensure only strong ciphers are used (5.2.12)
  id: totrans-171
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 确保只使用强密码（5.2.12）
- en: 'This check ensures that only strong ciphers are used to encrypt the actual
    SSH traffic. The audit check indicates that we should run `sshd –T` again, and
    look for the "ciphers" line. We want to ensure that we only have known string
    ciphers enabled, which at this time is a short list:'
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 这个检查确保只使用强密码来加密实际的SSH流量。审计检查表明我们应该再次运行`sshd –T`，并查找“ciphers”行。我们希望确保我们只启用已知的字符串密码，目前这是一个短列表：
- en: '`aes256-ctr`'
  id: totrans-173
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`aes256-ctr`'
- en: '`aes192-ctr`'
  id: totrans-174
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`aes192-ctr`'
- en: '`aes128-ctr`'
  id: totrans-175
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`aes128-ctr`'
- en: In particular, known weak ciphers for SSH include any `DES` or `3DES` algorithm,
    or any block cipher (appended with `cbc`).
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 特别是，SSH的已知弱密码包括任何`DES`或`3DES`算法，或任何块密码（附加了`cbc`）。
- en: 'Let''s check our current settings:'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们检查我们当前的设置：
- en: '[PRE28]'
  id: totrans-178
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: While we have the known compliant ciphers in the list, we also have some non-compliant
    ones. This means that an attacker could, with the right placement, "downgrade"
    the negotiated cipher to a less secure one as the session is established.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然我们在列表中有已知符合要求的密码，但我们也有一些不符合要求的密码。这意味着攻击者可以在适当的位置“降级”协商的密码为一个不太安全的密码，当会话建立时。
- en: 'In the remediation section, we''re instructed to look at the same file and
    update the "ciphers" line. Looking in the file, there is no "Ciphers" line at
    all, just a `Ciphers and keyring` section. This means that we''ll need to add
    that line, as shown here:'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 在补救部分，我们被指示查看同一个文件并更新“ciphers”行。在文件中，根本没有“Ciphers”行，只有一个`Ciphers and keyring`部分。这意味着我们需要添加那一行，如下所示：
- en: '[PRE29]'
  id: totrans-181
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: Keep the comment as is. So, for instance, if keyrings are needed later, the
    placeholder for them is there to find. It's always advisable to keep or add as
    many comments as possible – keeping configurations as "self-documenting" as possible
    is a great way to make things easy for the next person who may need to troubleshoot
    the change you just made. In particular, if years have passed and that next person
    is a future version of yourself!
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 保持注释不变。例如，如果以后需要密钥环，那么可以在那里找到它们的占位符。尽可能保留或添加尽可能多的注释是明智的 - 保持配置尽可能“自我记录”是使下一个可能需要排除您刚刚做出的更改的人的工作变得容易的好方法。特别是，如果多年过去了，那么下一个人是您自己的未来版本！
- en: 'Next, we''ll reload the `sshd` daemon to ensure that all of our changes are
    live:'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将重新加载`sshd`守护程序，以确保我们所有的更改都生效：
- en: '[PRE30]'
  id: totrans-184
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'Finally, rerun our audit check:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，重新运行我们的审计检查：
- en: '[PRE31]'
  id: totrans-186
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: Success!
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 成功！
- en: 'How else could we check cipher support on our host? This cipher change is an
    important setting that will likely need to be set on many systems, some of which
    might not have a Linux command line or `sshd_config` file that we can directly
    edit. Think back one chapter. We''ll check this setting from a remote system using
    `nmap`, with the `ssh2-enum-algos.nse` script. We''ll be looking at the `Encryption
    Algorithms` script output section for the ciphers:'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 我们如何在我们的主机上检查密码支持？这个密码更改是一个重要的设置，很可能需要在许多系统上设置，其中一些可能没有一个可以直接编辑的Linux命令行或`sshd_config`文件。回想一下上一章。我们将使用`nmap`从远程系统检查这个设置，使用`ssh2-enum-algos.nse`脚本。我们将查看密码的`Encryption
    Algorithms`脚本输出部分：
- en: '[PRE32]'
  id: totrans-189
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: Using a second tool to verify your configuration is an important habit to cultivate
    – while Linux is a reliable server and workstation platform, bugs do crop up.
    Plus, it's an easy slip of the finger to make your changes, then exit, but accidentally
    not save the configuration change – a double-check using another tool is a great
    way to ensure that things are as they should be!
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 使用第二个工具来验证您的配置是一个重要的习惯 - 虽然Linux是一个可靠的服务器和工作站平台，但是会出现错误。此外，很容易在进行更改后退出时不小心没有保存配置更改
    - 使用另一个工具进行双重检查是确保一切都如预期的好方法！
- en: Finally, if you are ever audited, arrange for a penetration test, or have actual
    malware on your network, it's likely that in each of these situations a network
    scan will be done to look for weak algorithms (or worse yet, Telnet or `rsh`,
    both of which are in cleartext). If you use the same tools and methods as your
    attacker (or auditor), you are more likely to catch that one host that got missed
    or that one group of hosts with the SSH bug you weren't expecting!
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，如果您曾经接受过审计，安排进行渗透测试，或者在您的网络上实际上有恶意软件，那么在每种情况下都很可能进行网络扫描以寻找弱算法（或更糟糕的是，明文Telnet或`rsh`）。如果您使用与攻击者（或审计人员）相同的工具和方法，您更有可能捕捉到被忽略的那一台主机或者那一组具有您意料之外的SSH漏洞的主机！
- en: 'What other key things should you check? While all of the settings for SSH are
    worth checking, a few of the others are key in every situation and environment:'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 您应该检查哪些其他关键事项？虽然值得检查SSH的所有设置，但在每种情况和环境中，其中一些是关键的：
- en: Check your **SSH logging level**, so that you know who logged in from what IP
    address (5.2.4).
  id: totrans-193
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 检查您的SSH日志级别，以便知道谁从哪个IP地址登录（5.2.4）。
- en: The **key exchange** and **MAC algorithms** checks are in the same vein as the
    ciphers check; they strengthen the protocol itself (5.2.13 and 5.2.14).
  id: totrans-194
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 密钥交换和MAC算法检查与密码检查类似；它们加强了协议本身（5.2.13和5.2.14）。
- en: You'll want to set an **idle timeout** (5.2.15). This is key because an unattended
    admin login can be a dangerous thing, for instance, if an administrator forgets
    to lock their screen. Also, if you have a person who is in the habit of closing
    their SSH window instead of logging out, on many platforms those sessions do not
    close. If you reach the maximum number of sessions (after a few months of this),
    the next connection attempt will fail. To resolve this, you'll need to get to
    the physical screen and keyboard to resolve this (restarting SSHD, for instance)
    or reload the system.
  id: totrans-195
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您需要设置一个空闲超时（5.2.15）。这很重要，因为无人看管的管理员登录可能是一件危险的事情，例如，如果管理员忘记锁定屏幕。此外，如果有人习惯于关闭他们的SSH窗口而不是注销，那么在许多平台上这些会话不会关闭。如果达到最大会话数（经过几个月后），下一次连接尝试将失败。要解决这个问题，您需要到物理屏幕和键盘上解决这个问题（例如重新启动SSHD）或重新加载系统。
- en: You'll want to set the **MaxSessions limit** (5.2.22). Especially if your host
    faces a hostile network (which is every network these days), an attack that simply
    starts hundreds of SSH sessions could exhaust resources on the host, impacting
    the memory and CPU available to other users.
  id: totrans-196
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您需要设置**MaxSessions限制**（5.2.22）。特别是如果您的主机面临敌对网络（这是现在的每个网络），一个简单地开始数百个SSH会话的攻击可能会耗尽主机上的资源，影响其他用户可用的内存和CPU。
- en: As discussed though, each recommendation in each section of the benchmarks should
    be reviewed and assessed to see how suitable it will be for your environment.
    It's common in this process to create a build document for your environment, a
    "gold image" host that you can then use as a template to clone production hosts
    going forward, and an audit script or a hardening script to help in maintaining
    your hosts once they are running.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管如此，应该审查和评估基准的每个部分中的每个建议，以查看它对您的环境是否合适。在这个过程中，通常会为您的环境创建一个构建文档，一个可以用作模板来克隆生产主机的“金像”主机，以及一个审计脚本或加固脚本，以帮助维护正在运行的主机。
- en: SELinux and AppArmor
  id: totrans-198
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: SELinux和AppArmor
- en: Linux has two commonly used **Linux Security Modules** (**LSMs**) that add additional
    security policies, controls, and changes to default behavior to the system. In
    many cases, they modify the Linux kernel itself. Both are available for most Linux
    distributions, and both carry some degree of risk in implementation – you'll want
    to do some preparation before implementing to gauge what the impact of implementing
    one or the other might be. It's not recommended to implement both, as they are
    likely to conflict.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: Linux有两个常用的Linux安全模块（LSMs），它们为系统添加了额外的安全策略、控制和更改默认行为。在许多情况下，它们修改了Linux内核本身。它们都适用于大多数Linux发行版，并且在实施时都带有一定程度的风险
    - 您需要在实施之前做一些准备工作，以评估实施其中一个可能产生的影响。不建议同时实施两者，因为它们很可能会发生冲突。
- en: '**SELinux** is arguably more complete and is definitely more complex to administer.
    It''s a set of kernel modifications and tools that are added to the base install.
    At a high level, it separates the configuration of security policies and the enforcement
    of those policies. Controls include **Mandatory Access Control**, **Mandatory
    Integrity Control**, **Role-Based Access Control** (**RBAC**), and **type enforcement**.'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: SELinux可以说更加完整，而且管理起来肯定更加复杂。它是一组添加到基本安装中的内核修改和工具。在高层次上，它分离了安全策略的配置和执行。控制包括强制访问控制、强制完整性控制、基于角色的访问控制（RBAC）和类型强制。
- en: 'SELinux features include the following:'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: SELinux的功能包括以下内容：
- en: Separating the definition of security policies from the enforcement of those
    policies.
  id: totrans-202
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将安全策略的定义与执行分开。
- en: Well-defined interfaces to policies (via tools and APIs).
  id: totrans-203
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 定义安全策略的明确定义的接口（通过工具和API）。
- en: Allowing applications to query for the policy definition or specific access
    controls. A common example would be allowing `crond` to run scheduled jobs in
    the correct context.
  id: totrans-204
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 允许应用程序查询策略定义或特定访问控制。一个常见的例子是允许`crond`在正确的上下文中运行计划任务。
- en: Support for modifying default policies or creating entirely new custom policies.
  id: totrans-205
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 支持修改默认策略或创建全新的自定义策略。
- en: Measures for protecting system integrity (domain integrity) and data confidentiality
    (multilevel security).
  id: totrans-206
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 保护系统完整性（域完整性）和数据保密性（多级安全）的措施。
- en: Controls over process initialization, execution, and inheritance.
  id: totrans-207
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对进程初始化、执行和继承进行控制。
- en: Additional security controls over filesystems, directories, files, and open
    file descriptors (for example, pipes or sockets).
  id: totrans-208
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对文件系统、目录、文件和打开文件描述符（例如管道或套接字）的额外安全控制。
- en: Security controls for sockets, messages, and network interfaces.
  id: totrans-209
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 套接字、消息和网络接口的安全控制。
- en: Controls over the use of "capabilities" (RBAC).
  id: totrans-210
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对“能力”（RBAC）的使用进行控制。
- en: Where possible, anything not permitted in a policy is denied. This "default
    deny" approach is one of the root design tenets of SELinux.
  id: totrans-211
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在可能的情况下，策略中不允许的任何内容都将被拒绝。这种“默认拒绝”方法是SELinux的根本设计原则之一。
- en: '**AppArmor** has many of the same features as SELinux, but it works with file
    paths instead of applying labels to files. It also implements mandatory access
    controls. You can assign a security profile to any application, including filesystem
    access, network permissions, and execution rules. This list also nicely outlines
    that AppArmor also enforces RBAC.'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: '**AppArmor**具有与SELinux许多相同的功能，但它使用文件路径而不是对文件应用标签。它还实施了强制访问控制。您可以为任何应用程序分配安全配置文件，包括文件系统访问、网络权限和执行规则。这个列表也很好地概述了AppArmor也实施了RBAC。'
- en: Since AppArmor doesn't use file labels, this makes it agnostic as far as the
    filesystem is concerned, making it the only option if a filesystem doesn't support
    security labels. On the other hand, it also means that this architecture decision
    limits it from matching all of the capabilities of SELinux.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 由于AppArmor不使用文件标签，这使得它在文件系统方面是不可知的，如果文件系统不支持安全标签，这使得它成为唯一的选择。另一方面，这也意味着这种架构决策限制了它匹配SELinux所有功能的能力。
- en: 'AppArmor features include restrictions on the following:'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: AppArmor的功能包括对以下内容的限制：
- en: File access controls
  id: totrans-215
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 文件访问控制
- en: Control of library loading
  id: totrans-216
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 库加载控制
- en: Control of process execution
  id: totrans-217
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 进程执行控制
- en: Coarse-grained controls over network protocols
  id: totrans-218
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对网络协议的粗粒度控制
- en: Named sockets
  id: totrans-219
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 命名套接字
- en: Coarse owner checks on objects (requires Linux kernel 2.6.31 or newer)
  id: totrans-220
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对象上的粗粒度所有者检查（需要Linux内核2.6.31或更新版本）
- en: 'Both LVMs have a learning option:'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 两种LVM都有学习选项：
- en: SELinux has a permissive mode, which means that the policies are enabled but
    not enforced. This mode allows you to test applications, then check the SELinux
    logs to see how your application might be affected when policies are enforced.
    The SELinux mode can be controlled by editing the `/etc/selinux/config` file,
    and changing the `selinux` line to **enforcing**, **permissive**, or **disabled**.
    A system reboot is required after making this change.
  id: totrans-222
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SELinux有一个宽容模式，这意味着策略已启用但未强制执行。这种模式允许您测试应用程序，然后检查SELinux日志，以查看在强制执行策略时您的应用程序可能受到的影响。可以通过编辑`/etc/selinux/config`文件并将`selinux`行更改为**enforcing**、**permissive**或**disabled**来控制SELinux模式。更改后需要重新启动系统。
- en: AppArmor's learning mode is called `aa-complain`. To activate this for all profiled
    applications, the command is `aa-complain/etc/apparmor.d/*`. After activating
    learning mode, then testing an application, you can see how it might be affected
    by AppArmor with the `aa-logprof` command (you'll need the full path to the profiles
    and logs for this command for this).
  id: totrans-223
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: AppArmor的学习模式称为`aa-complain`。要为所有配置文件的应用程序激活此模式，命令是`aa-complain/etc/apparmor.d/*`。激活学习模式后，然后测试一个应用程序，您可以使用`aa-logprof`命令查看AppArmor可能如何影响该应用程序（对于此命令，您需要配置文件和日志的完整路径）。
- en: 'To check the status of either LVM, the commands are as follows:'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 要检查LVM的状态，命令如下：
- en: For SELinux, the command is `getenforce`, or for more verbose output, `sestatus`.
  id: totrans-225
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于SELinux，命令是`getenforce`，或者更详细的输出是`sestatus`。
- en: For AppArmor, the analogous commands are `apparmor status` and `aa-status`.
  id: totrans-226
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于AppArmor，类似的命令是`apparmor status`和`aa-status`。
- en: In summary, AppArmor and SELinux are both complex systems. SELinux is considered
    to be much more complex, but also more complete. If you embark on the path of
    either approach, you'll want to kick the tires on a test system first. It is also
    wise to test and build your production configuration as much as possible on a
    clone of your production hosts before deploying for real. Both solutions can significantly
    increase the security posture of your hosts and applications, but both require
    a significant setup effort, as well as an ongoing effort to keep your hosts and
    applications running as they should, as they change over time.
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 总之，AppArmor和SELinux都是复杂的系统。 SELinux被认为更加复杂，但也更加完整。如果您选择其中一种方法，您应该首先在测试系统上进行测试。在部署之前，最好在生产主机的克隆上尽可能多地测试和构建您的生产配置。这两种解决方案都可以显著提高主机和应用程序的安全性，但都需要大量的设置工作，以及持续的努力来确保主机和应用程序在随着时间的推移而变化时能够正常运行。
- en: A more complete explanation of these two systems is beyond the scope of this
    book – both have several books dedicated to them if you wish to explore either
    more fully.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: '这两个系统的更完整的解释超出了本书的范围-如果您希望更全面地探索其中任何一个，它们都有几本专门的书籍。 '
- en: Summary
  id: totrans-229
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: The end goal of everything we've discussed – the regulatory frameworks, the
    critical controls, and the security benchmarks – is to make it easier to better
    secure your hosts and data centers. The key in each of these guidance constructs
    is to give you enough direction to get you where you need to go, without having
    to be a security expert. Each in turn gets more and more specific. The regulatory
    frameworks are generally very broad, leaving a fair amount of discretion in how
    things are accomplished. The critical controls are more specific, but still allow
    a fair amount of leeway in what solutions are deployed and how the end goal is
    accomplished. The CIS benchmarks are very specific, giving you the exact commands
    and configuration changes needed to accomplish your goal.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 我们讨论的一切的最终目标——监管框架、关键控制和安全基准——都是为了更容易地更好地保护您的主机和数据中心。在这些指导结构中的关键是为您提供足够的指导，使您能够达到所需的目标，而无需成为安全专家。每一个都变得越来越具体。监管框架通常非常广泛，在如何完成任务方面留下了相当大的自由裁量权。关键控制更为具体，但仍然允许在部署解决方案和实现最终目标方面有相当大的灵活性。CIS基准非常具体，为您提供了实现目标所需的确切命令和配置更改。
- en: I hope that with the journey we've taken in this chapter, you have a good idea
    of how these various sets of guidance approaches can be combined in your organization
    to better secure your Linux infrastructure.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 我希望通过本章我们所走过的旅程，您对如何在您的组织中结合这些各种指导方法来更好地保护您的Linux基础设施有一个良好的了解。
- en: In the next chapter, we'll discuss implementing DNS services on Linux. If you
    feel like you'd like to continue with more specifics on securing your host, don't
    worry – you'll find that this security discussion comes up again and again as
    we implement new services.
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将讨论在Linux上实施DNS服务。如果您希望继续了解如何更具体地保护您的主机，不用担心——随着我们实施新服务，这个安全讨论会一次又一次地出现。
- en: Questions
  id: totrans-233
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 问题
- en: 'As we conclude, here is a list of questions for you to test your knowledge
    regarding this chapter''s material. You will find the answers in the *Assessments*
    section of the *Appendix*:'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 随着我们的结束，这里有一些问题供您测试对本章材料的了解。您将在*附录*的*评估*部分找到答案：
- en: What US legislation is used to define privacy requirements in IT implementations?
  id: totrans-235
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在IT实施中，使用哪些美国立法来定义隐私要求？
- en: Can you be audited against the CIS critical controls?
  id: totrans-236
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你能按照CIS关键控制进行审计吗？
- en: Why would you routinely use multiple methods to check one security setting –
    for instance, encryption algorithms for SSH?
  id: totrans-237
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为什么您会经常使用多种方法来检查一个安全设置——例如SSH的加密算法？
- en: Further reading
  id: totrans-238
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 进一步阅读
- en: 'For more information on the topics covered in this chapter, you can check out
    the following links:'
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 有关本章涵盖的主题的更多信息，您可以查看以下链接：
- en: 'PCIDSS: [https://www.pcisecuritystandards.org/](https://www.pcisecuritystandards.org/)'
  id: totrans-240
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'PCIDSS: [https://www.pcisecuritystandards.org/](https://www.pcisecuritystandards.org/)'
- en: 'HIPAA: [https://www.hhs.gov/hipaa/index.html](https://www.hhs.gov/hipaa/index.html)'
  id: totrans-241
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'HIPAA: [https://www.hhs.gov/hipaa/index.html](https://www.hhs.gov/hipaa/index.html)'
- en: 'NIST: [https://csrc.nist.gov/publications/sp800](https://csrc.nist.gov/publications/sp800)'
  id: totrans-242
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'NIST: [https://csrc.nist.gov/publications/sp800](https://csrc.nist.gov/publications/sp800)'
- en: 'FEDRAMP: [https://www.fedramp.gov/](https://www.fedramp.gov/)'
  id: totrans-243
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'FEDRAMP: [https://www.fedramp.gov/](https://www.fedramp.gov/)'
- en: 'DISA STIGs: [https://public.cyber.mil/stigs/](https://public.cyber.mil/stigs/)'
  id: totrans-244
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'DISA STIGs: [https://public.cyber.mil/stigs/](https://public.cyber.mil/stigs/)'
- en: 'GDPR: [https://gdpr-info.eu/](https://gdpr-info.eu/)'
  id: totrans-245
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'GDPR: [https://gdpr-info.eu/](https://gdpr-info.eu/)'
- en: 'PIPEDA: [https://www.priv.gc.ca/en/privacy-topics/privacy-laws-in-canada/the-personal-information-protection-and-electronic-documents-act-pipeda/](https://www.priv.gc.ca/en/privacy-topics/privacy-laws-in-canada/the-personal-information-protection-and-electronic-documents-act-pipeda/)'
  id: totrans-246
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'PIPEDA: [https://www.priv.gc.ca/en/privacy-topics/privacy-laws-in-canada/the-personal-information-protection-and-electronic-documents-act-pipeda/](https://www.priv.gc.ca/en/privacy-topics/privacy-laws-in-canada/the-personal-information-protection-and-electronic-documents-act-pipeda/)'
- en: 'CIS: [https://www.cisecurity.org/controls/](https://www.cisecurity.org/controls/)'
  id: totrans-247
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'CIS: [https://www.cisecurity.org/controls/](https://www.cisecurity.org/controls/)'
- en: '[https://isc.sans.edu/forums/diary/Critical+Control+2+Inventory+of+Authorized+and+Unauthorized+Software/11728/](https://isc.sans.edu/forums/diary/Critical+Control+2+Inventory+of+Authorized+and+Unauthorized+Software/11728/)'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://isc.sans.edu/forums/diary/Critical+Control+2+Inventory+of+Authorized+and+Unauthorized+Software/11728/](https://isc.sans.edu/forums/diary/Critical+Control+2+Inventory+of+Authorized+and+Unauthorized+Software/11728/)'
- en: 'CIS benchmarks: [https://www.cisecurity.org/cis-benchmarks/](https://www.cisecurity.org/cis-benchmarks/)'
  id: totrans-249
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: CIS基准：[https://www.cisecurity.org/cis-benchmarks/](https://www.cisecurity.org/cis-benchmarks/)
- en: 'OSQuery: [https://osquery.readthedocs.io/en/stable/](https://osquery.readthedocs.io/en/stable/)'
  id: totrans-250
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'OSQuery: [https://osquery.readthedocs.io/en/stable/](https://osquery.readthedocs.io/en/stable/)'
- en: 'SELinux: [http://www.selinuxproject.org/page/Main_Page](http://www.selinuxproject.org/page/Main_Page)'
  id: totrans-251
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'SELinux: [http://www.selinuxproject.org/page/Main_Page](http://www.selinuxproject.org/page/Main_Page)'
- en: 'AppArmor: [https://apparmor.net/](https://apparmor.net/)'
  id: totrans-252
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'AppArmor: [https://apparmor.net/](https://apparmor.net/)'
