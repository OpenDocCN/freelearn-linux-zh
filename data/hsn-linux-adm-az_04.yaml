- en: 'Chapter 4: Managing Azure'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第4章：管理Azure
- en: In *Chapter 2*, *Getting Started with the Azure Cloud*, we took our first steps
    on a journey into the world of Azure. We discovered that there are many ways to
    manage an Azure environment and that these include the Azure portal and command-line
    interfaces. You can use the command-line interfaces within the Azure portal to
    run them on your workstation. Later in this book, we'll see that there are other
    great possibilities using automation and orchestration solutions. At the end of
    *Chapter 3*, *Basic Linux Administration*, we created a Linux VM and explored
    the basics of the Linux environment.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在*第2章*，*开始使用Azure云*中，我们迈出了进入Azure世界的第一步。我们发现有许多方法可以管理Azure环境，其中包括Azure门户和命令行接口。你可以在Azure门户中使用命令行接口在你的工作站上运行它们。在本书的后面，我们将看到使用自动化和编排解决方案还有其他很好的可能性。在*第3章*，*基本Linux管理*结束时，我们创建了一个Linux虚拟机，并探索了Linux环境的基础知识。
- en: Before we continue our journey, covering more advanced topics, this chapter
    covers components of the Azure infrastructure that are needed for our workloads,
    VMs, and containers. We discussed the filesystem in Linux, but how will we add
    more data disks to the VM? As a system administrator, you might need to allow
    or deny traffic to your VM based on your business requirements, but how this can
    be done in Azure? There will be scenarios where you need to have multiple network
    interfaces attached to the VM. How will you accomplish that? This section will
    answer all your questions on how to manage Azure resources that are related to
    your VM. We're talking about components that we've already used in previous chapters,
    sometimes even without knowing that we did.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们继续探讨更高级的主题之前，本章涵盖了Azure基础架构的组件，这些组件是我们工作负载、虚拟机和容器所需的。我们已经讨论了Linux中的文件系统，但是我们如何向虚拟机添加更多的数据磁盘呢？作为系统管理员，你可能需要根据业务需求允许或拒绝流量到你的虚拟机，但这在Azure中如何实现？在某些情况下，你需要将多个网络接口连接到虚拟机。你将如何完成这个任务？本节将回答你关于如何管理与虚拟机相关的Azure资源的所有问题。我们谈论的是我们在以前的章节中已经使用过的组件，有时甚至是在不知情的情况下。
- en: 'Basically, this chapter is about Azure resources. And, remember, they are all
    part of a resource group, a logical container into which resources are deployed
    and managed. The following are some of the key takeaways from this chapter:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 基本上，本章是关于Azure资源的。记住，它们都是资源组的一部分，资源组是一个逻辑容器，用于部署和管理资源。以下是本章的一些关键要点：
- en: Managing storage resources in Azure and different storage options available
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 管理Azure中的存储资源和不同的存储选项
- en: Managing networking resources in Azure and understanding their role in VMs
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 管理Azure中的网络资源并了解它们在虚拟机中的作用
- en: Using handy commands in PowerShell and the Azure CLI to manage resources in Azure
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用PowerShell和Azure CLI中的便捷命令来管理Azure中的资源
- en: Note
  id: totrans-7
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 注意
- en: In this book, we try to be as agnostic as possible regarding the available interfaces.
    Because this chapter is more about the theory than the interfaces, we'll use PowerShell
    as an example.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 在这本书中，我们尽可能中立地对待可用的接口。因为这一章更多关于理论而不是接口，我们将以PowerShell作为示例。
- en: Managing Azure Resources Using the Azure CLI and PowerShell
  id: totrans-9
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用Azure CLI和PowerShell管理Azure资源
- en: In this chapter, we will see how we can manage Azure resources using PowerShell
    and the Azure CLI. Every task that we are going to do here can also be done from
    the Azure portal. However, as a system administrator who is performing day-to-day
    tasks from the terminal, you should be able to manage your resources using the
    CLI or PowerShell. Almost every command in this chapter is written in PowerShell;
    however, at the end of this chapter, you will find the Azure CLI equivalent command
    for every command in PowerShell. The list of commands is way too long, so it's
    better to refer to the official Microsoft documentation or use the respective
    help commands.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将看到如何使用PowerShell和Azure CLI来管理Azure资源。我们在这里要做的每一个任务也可以从Azure门户中完成。然而，作为一个每天都在终端执行任务的系统管理员，你应该能够使用CLI或PowerShell来管理你的资源。本章中几乎每个命令都是用PowerShell编写的；然而，在本章结束时，你会找到每个PowerShell命令的Azure
    CLI等效命令。命令列表太长了，最好参考官方的微软文档或使用相应的帮助命令。
- en: In some instances, even in upcoming chapters, we will use the Azure portal.
    This is to simplify the process and to get you all introduced to an alternate
    method. You can use the portal if you prefer, but when it comes to automating
    tasks and orchestrating deployment, the CLI or PowerShell experience is a prerequisite.
    So, we would encourage you all to follow the PowerShell commands in this chapter
    and invest your time in testing the equivalent commands using the Azure CLI.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 在某些情况下，甚至在接下来的章节中，我们将使用Azure门户。这是为了简化流程，并让你们都了解另一种方法。如果你愿意，你可以使用门户，但是当涉及自动化任务和编排部署时，CLI或PowerShell体验是必不可少的。因此，我们鼓励你们在本章中遵循PowerShell命令，并投入时间测试使用Azure
    CLI的等效命令。
- en: Here are some of the technical requirements to complete the tasks in this chapter.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是本章完成任务的一些技术要求。
- en: Technical Requirements
  id: totrans-13
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 技术要求
- en: For this chapter, basic knowledge of storage and networking is required. In
    the *Further reading* section, you can find some suggestions to prepare yourself.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 对于本章，需要有存储和网络的基本知识。在*进一步阅读*部分，你可以找到一些准备自己的建议。
- en: It's not necessary, but it's a good idea to have at least one VM up and running.
    This way, you will not only be able to create new resources in this chapter but
    also look at the properties of an existing VM. In this section, we will create
    an Ubuntu VM named `ubuntu01` in the `chapter4` resource group for the examples.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然不是必需的，但最好至少有一个虚拟机正在运行。这样，你不仅可以在本章中创建新资源，还可以查看现有虚拟机的属性。在本节中，我们将在`chapter4`资源组中创建一个名为`ubuntu01`的Ubuntu虚拟机作为示例。
- en: 'Set the variables for the resource group and the location:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 设置资源组和位置的变量：
- en: '[PRE0]'
  id: totrans-17
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Create the resource group:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 创建资源组：
- en: '[PRE1]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Create the VM:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 创建虚拟机：
- en: '[PRE2]'
  id: totrans-21
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: For now, the parameters used in this example are not important; at the end of
    this chapter, you'll be able to understand them all.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 目前，在此示例中使用的参数并不重要；在本章结束时，您将能够理解它们。
- en: Not a real requirement, but nice to have, is the Azure Storage Explorer utility,
    which is available for free at [https://azure.microsoft.com/en-us/features/storage-explorer](https://azure.microsoft.com/en-us/features/storage-explorer).
    This is a standalone utility to install on your workstation. This utility will
    help you upload, download, and manage Azure blobs, files, queues, and tables.
    It also supports Azure Cosmos DB and Azure Data Lake. Another advantage is you
    can access the disks attached to VMs. Storage Explorer is also available as an
    option in the Azure portal.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 不是真正的要求，但很好拥有的是Azure Storage Explorer实用程序，可以免费在[https://azure.microsoft.com/en-us/features/storage-explorer](https://azure.microsoft.com/en-us/features/storage-explorer)上获得。这是一个独立的实用程序，可安装在您的工作站上。此实用程序将帮助您上传、下载和管理Azure
    blob、文件、队列和表。它还支持Azure Cosmos DB和Azure Data Lake。另一个优势是您可以访问连接到虚拟机的磁盘。Storage
    Explorer也作为Azure门户中的选项可用。
- en: Managing Storage Resources
  id: totrans-24
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 管理存储资源
- en: 'Microsoft''s cloud solution for handling data storage is Azure Storage. Azure
    Storage offers high availability, security, scalability, and accessibility. In
    Azure, we have different types of data or storage services. They are:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 微软的云解决方案用于处理数据存储的是Azure存储。Azure存储提供高可用性、安全性、可扩展性和可访问性。在Azure中，我们有不同类型的数据或存储服务。它们是：
- en: Azure Blobs
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure Blob
- en: Azure Files
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure文件
- en: Azure Queue
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure队列
- en: Azure Table
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure表
- en: 'Let''s take a closer look at each of these and understand what they are:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们更仔细地看看每一个，并了解它们是什么：
- en: '**Azure Blobs**: Optimized objects for storing massive amounts of unstructured
    data, such as text or binary data. They''re often used to make data available
    to other resources, for instance, to store VHD files that can be used to create
    virtual disks. Another use case is to use them as storage for audio and video
    files. Making a blob publicly accessible, it''s even possible to stream data.'
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure Blob：用于存储大量非结构化数据的优化对象，例如文本或二进制数据。它们通常用于使数据可用于其他资源，例如存储可用于创建虚拟磁盘的VHD文件。另一个用例是将它们用作音频和视频文件的存储。通过使blob公开访问，甚至可以流式传输数据。
- en: '**Azure Files**: Azure Files are file shares hosted in Azure that can be accessed
    via **Server Message Block** (**SMB**) and can be mounted to your local computer.
    You might wonder how these are different from normal file shares. The added advantage
    here is that the URL that will be generated will include a **shared access signature**
    (**SAS**) and the file share will be able to be accessed from anywhere in the
    world.'
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure文件：Azure文件是托管在Azure中可以通过**服务器消息块**（**SMB**）访问并可以挂载到本地计算机的文件共享。您可能想知道这些与普通文件共享有何不同。这里的附加优势是生成的URL将包括一个**共享访问签名**（**SAS**），并且文件共享将能够从世界各地访问。
- en: '**Azure Queue**: Used for passing messages from one resource to another, especially
    for serverless services such as Azure Web Apps and Functions. It can also be used
    to create a backlog of work to process asynchronously.'
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure队列：用于将消息从一个资源传递到另一个资源，特别是用于无服务器服务，如Azure Web应用程序和函数。它还可以用于创建异步处理的工作积压。
- en: '**Azure Table**: This is for the Azure Cosmos DB service.'
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure表：用于Azure Cosmos DB服务。
- en: '**Azure Disk**: This is for managed disk storage and unmanaged disks.'
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure磁盘：这是用于托管磁盘存储和非托管磁盘的。
- en: In this chapter, we will only cover Blob storage, Azure Files, and disk storage,
    because Queue and Table storage are for specific solutions that are only important
    for application developers.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们只会涵盖Blob存储、Azure文件和磁盘存储，因为队列和表存储是针对特定解决方案的，只对应用程序开发人员重要。
- en: Note
  id: totrans-37
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 注意
- en: If you have an enormous amount of data you want to store in the cloud, uploading
    can take too much time. Microsoft has a service called Azure Data Box Disk. It
    lets you send encrypted SSDs to your datacenter, copy the data, and send it back.
    For more information, visit [https://docs.microsoft.com/en-gb/azure/databox/data-box-disk-overview](https://docs.microsoft.com/en-gb/azure/databox/data-box-disk-overview).
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您有大量数据要存储在云中，上传可能需要太长时间。微软有一个名为Azure Data Box Disk的服务。它允许您将加密的SSD发送到您的数据中心，复制数据，然后发送回来。有关更多信息，请访问[https://docs.microsoft.com/en-gb/azure/databox/data-box-disk-overview](https://docs.microsoft.com/en-gb/azure/databox/data-box-disk-overview)。
- en: Storage Accounts
  id: totrans-39
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 存储帐户
- en: A storage account provides a namespace that is unique across Azure to contain
    storage objects such as blobs, files, tables, queues, and so on. An account is
    needed to access the storage. It also defines the type of storage that is being
    used.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 存储帐户提供了一个在Azure中唯一的命名空间，用于包含诸如blob、文件、表、队列等存储对象。需要帐户来访问存储。它还定义了正在使用的存储类型。
- en: 'There are three different kinds of storage accounts:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 有三种不同类型的存储帐户：
- en: '**Storage**: This old type of deprecated storage account doesn''t support all
    features (for instance, there is no archive option). It''s often more expensive
    than the newer V2.'
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 存储：这种旧类型的已弃用存储帐户不支持所有功能（例如，没有存档选项）。它通常比较新的V2更昂贵。
- en: '**StorageV2**: This is a newer type of storage account. It supports all types
    of storage and the latest features for blobs, files, queues, and tables.'
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: StorageV2：这是一种更新的存储帐户类型。它支持所有类型的存储和最新的blob、文件、队列和表功能。
- en: '**BlobStorage**: This has not been deprecated yet, but there is no reason to
    use it any longer. The biggest problem with this account type is that you can''t
    store files such as VHDs.'
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: BlobStorage：尚未被弃用，但不再有理由使用它。这种帐户类型的最大问题是无法存储VHD等文件。
- en: Note
  id: totrans-45
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 注意
- en: You don't need to create a storage account for managed disks. However, if you
    want to store VM boot diagnostic data, you'll need one. A boot diagnostic account
    is very useful if your VMs go to non-bootable state. The logs stored in this account
    can be used to find the root cause for the non-booting state of the VM. For testing,
    this is not a mandatory option, but for production workloads it is recommended
    to enable boot diagnostics, which will help you to understand what went wrong
    during a failure.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 对于托管磁盘，您无需创建存储账户。但是，如果您想要存储VM引导诊断数据，您将需要一个。引导诊断账户在VM进入非可引导状态时非常有用。存储在此账户中的日志可用于查找VM无法引导状态的根本原因。对于测试来说，这不是一个强制性选项，但对于生产工作负载，建议启用引导诊断，这将帮助您了解故障发生时出了什么问题。
- en: 'Another property is the SKU, as covered in *Chapter 2, Getting Started with
    the Azure Cloud*. It specifies what type of replication applies to the storage
    account. Here are the available types and, if you recall, we''ve already discussed
    what they are:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个属性是SKU，如*第2章，开始使用Azure云*中所述。它指定了适用于存储账户的复制类型。以下是可用的类型，如果您还记得，我们已经讨论过它们是什么：
- en: '**Standard_LRS**: Locally redundant storage accounts storage accounts'
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Standard_LRS**：本地冗余存储账户'
- en: '**Premium_LRS**: The same as LRS but supports FileStorage and BlockBlobStorage'
  id: totrans-49
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Premium_LRS**：与LRS相同，但支持FileStorage和BlockBlobStorage'
- en: '**Standard_GRS**: Geo-redundant storage accounts'
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Standard_GRS**：地理冗余存储账户'
- en: '**Standard_RAGRS**: Read-access geo-redundant storage accounts'
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Standard_RAGRS**：具有读取访问地理冗余存储账户'
- en: '**Standard_ZRS**: Zone-redundant storage accounts'
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Standard_ZRS**：区域冗余存储账户'
- en: 'The last important property is the access tier; it specifies the optimization
    of the storage. There are three types available:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 最后一个重要属性是访问层；它指定了存储的优化。有三种类型可用：
- en: '**Hot storage tier**: Data that needs to be accessed frequently will be stored
    in the hot tier.'
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**热存储层**：需要频繁访问的数据将存储在热存储层中。'
- en: '**Cool storage tier**: Data that is accessed infrequently and is stored for
    at least 30 days.'
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**冷存储层**：很少访问的数据，存储期至少为30天。'
- en: '**Archive storage tier**: Data that is rarely accessed and is stored for a
    period of at least 180 days with flexible latency requirements.'
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**归档存储层**：很少访问的数据，存储期至少为180天，具有灵活的延迟要求。'
- en: Setting an object-level access tier is only supported for Standard LRS, GRS,
    RA-GRS BlobStorage, and General Purpose V2 accounts. **General Purpose V1** (**GPv1**)
    accounts don't support tiering.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 设置对象级别的访问层仅支持Standard LRS、GRS、RA-GRS BlobStorage和通用 V2账户。**通用 V1**（**GPv1**）账户不支持分层。
- en: The choice made for the access tier also affects the cost; for instance, archive
    storage offers the lowest storage costs but also the highest access costs.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 访问层的选择也会影响成本；例如，归档存储提供了最低的存储成本，但也提供了最高的访问成本。
- en: 'The storage account name must be between three and 24 characters in length
    and must use only numbers and lowercase letters. Storage account names must be
    unique in Azure. Microsoft suggests using a globally unique name and a random
    number:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 存储账户名称长度必须在3到24个字符之间，并且只能使用数字和小写字母。存储账户名称在Azure中必须是唯一的。微软建议使用全局唯一名称和一个随机数：
- en: '[PRE3]'
  id: totrans-60
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Let''s create a storage account with redundancy as Standard_LRS:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们创建一个冗余为Standard_LRS的存储账户：
- en: '[PRE4]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Check the available storage accounts in your subscription:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 检查您的订阅中可用的存储账户：
- en: '[PRE5]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '![To check the available storage accounts, its name and location.](img/B15455_04_01.jpg)'
  id: totrans-65
  prefs: []
  type: TYPE_IMG
  zh: '![检查可用的存储账户、名称和位置。](img/B15455_04_01.jpg)'
- en: 'Figure 4.1: Available storage accounts'
  id: totrans-66
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图4.1：可用存储账户
- en: In the screenshot, you can see that there are three storage accounts available
    in three different regions for this subscription.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 在屏幕截图中，您可以看到此订阅中有三个不同区域的存储账户可用。
- en: 'Storage accounts are protected by keys. You''ll need the key if you want access
    to a storage account. A set of two keys are automatically created during the creation
    of an account. If you are still in the same session as when you created the account,
    you can receive the key:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 存储账户受密钥保护。如果您想要访问存储账户，您将需要密钥。在创建账户时会自动创建一组两个密钥。如果您仍然处于创建账户时的同一会话中，您可以接收密钥：
- en: '[PRE6]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Otherwise, you can use the following:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 否则，您可以使用以下内容：
- en: '[PRE7]'
  id: totrans-71
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'In the following screenshot, the `chapter42298` storage account available in
    the `$MyRG` resource group has a set of protected keys:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 在下面的屏幕截图中，位于$MyRG资源组中的`chapter42298`存储账户有一组受保护的密钥：
- en: '![To fetch protected keys for chapter 42298 storage account that is present
    in $MyRG resource group.](img/B15455_04_02.jpg)'
  id: totrans-73
  prefs: []
  type: TYPE_IMG
  zh: '![获取位于$MyRG资源组中的chapter 42298存储账户的受保护密钥。](img/B15455_04_02.jpg)'
- en: 'Figure 4.2: Fetching keys for chapter42298 storage account'
  id: totrans-74
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图4.2：获取chapter42298存储账户的密钥
- en: Managed Disks
  id: totrans-75
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 托管磁盘
- en: Earlier, when we deployed a VM, we needed to create a storage account where
    we could save the **virtual hard disk** (**VHD**) of the VM. Later, Microsoft
    introduced **Managed Disks** where we can simply create a disk and Microsoft takes
    care of the underlying storage account. On top of that, customers get added advantages
    such as easy resizing, more encryption options, and better performance.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 早些时候，当我们部署VM时，我们需要创建一个存储账户，用于保存VM的**虚拟硬盘**（**VHD**）。后来，微软推出了**托管磁盘**，我们可以简单地创建一个磁盘，微软负责底层存储账户。此外，客户还可以获得额外的优势，如轻松调整大小、更多的加密选项和更好的性能。
- en: 'When you create a VM with a managed disk, two disks will be attached to the
    VM: an OS disk and a temporary disk. All the disks are in VHD format. The data
    stored on the temporary disk will be cleared when you restart the VM, so Microsoft
    doesn''t recommend storing important data on the temporary disk as it is not persistent.'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 当您使用托管磁盘创建VM时，将会附加两个磁盘到VM：一个操作系统磁盘和一个临时磁盘。所有磁盘都以VHD格式存储。当您重新启动VM时，临时磁盘上存储的数据将被清除，因此微软不建议在临时磁盘上存储重要数据，因为它不是持久的。
- en: 'You can also add extra managed data disks. First, create the disk configuration:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以添加额外的托管数据磁盘。首先，创建磁盘配置：
- en: '[PRE8]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Let''s see how to create a sample disk configuration with a size of 5 GB and
    redundancy as Standard_LRS:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看如何创建一个大小为5GB且冗余为Standard_LRS的示例磁盘配置：
- en: '[PRE9]'
  id: totrans-81
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Now, you can create the actual disk:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，您可以创建实际的磁盘：
- en: '[PRE10]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'For example, here''s an implementation of the preceding command:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，以下是前面命令的实现：
- en: '[PRE11]'
  id: totrans-85
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'By executing the `$Disk01` command, you''ll see the newly created disk. In
    the following screenshot, the output is limited to make it more readable:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 通过执行`$Disk01`命令，您将看到新创建的磁盘。在以下屏幕截图中，输出被限制以使其更易读：
- en: '![Creating new disk using $Disk01 command](img/B15455_04_03.jpg)'
  id: totrans-87
  prefs: []
  type: TYPE_IMG
  zh: '![使用$Disk01命令创建新磁盘。](img/B15455_04_03.jpg)'
- en: 'Figure 4.3: Output of the $Disk01 command'
  id: totrans-88
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图4.3：$Disk01命令的输出
- en: 'The next step is to attach the managed datadisk. To do this, we''ll need the
    disk ID. So, we''ll run the following command using the disk name to find the
    ID:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 下一步是附加托管数据磁盘。为此，我们需要磁盘ID。因此，我们将使用磁盘名称运行以下命令以查找ID：
- en: '[PRE12]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Add the data disk:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 添加数据磁盘：
- en: '[PRE13]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'A **Logical Unit Number** (**LUN**) is a number used to identify the storage
    in the VM. You can start numbering at zero. Finally, update the VM settings:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: '**逻辑单元号**（**LUN**）是用于标识VM中存储的数字。您可以从零开始编号。最后，更新VM设置：'
- en: '[PRE14]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'You can now add the data disk to the VM. To summarize with a complete example,
    first you''ll need all the properties of the VM. To get the properties of the
    VM, we will use the following command and save the properties to a variable, `$myVM`:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，您可以将数据磁盘添加到VM。总结一个完整的示例，首先您需要VM的所有属性。要获取VM的属性，我们将使用以下命令并将属性保存到变量`$myVM`中：
- en: '[PRE15]'
  id: totrans-96
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'The next command is to add the disk that was created earlier on to the VM:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个命令是将之前创建的磁盘添加到VM中：
- en: '[PRE16]'
  id: totrans-98
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'The preceding command will show you the configured properties of the VM, as
    shown in this screenshot:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 上述命令将显示VM的配置属性，如此屏幕截图所示：
- en: '![The configured properties of the VM, by adding the disk created on the VM.](img/B15455_04_04.jpg)'
  id: totrans-100
  prefs: []
  type: TYPE_IMG
  zh: '![通过在VM上添加创建的磁盘来配置VM的属性。](img/B15455_04_04.jpg)'
- en: 'Figure 4.4: Adding the created disk on the VM'
  id: totrans-101
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图4.4：在VM上添加创建的磁盘
- en: As we can see from the output, the information is added to the `StorageProfile`,
    but the change is not active yet.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 从输出中可以看出，信息已添加到`StorageProfile`，但更改尚未生效。
- en: 'To make it active, use `Update-AzVM`. The output should give you the `StatusCode`
    as `OK`:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 要使其生效，请使用`Update-AzVM`。输出应该给出`StatusCode`为`OK`：
- en: '[PRE17]'
  id: totrans-104
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'As you can see in the following screenshot, `IsSuccessStatusCode` is telling
    you that the request was received. `StatusCode` is the result of the request:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 如您在以下屏幕截图中所见，`IsSuccessStatusCode`告诉您请求已收到。`StatusCode`是请求的结果：
- en: '![To make the StorageProfile active, update StatusCode using Update-AzVM command.](img/B15455_04_05.jpg)'
  id: totrans-106
  prefs: []
  type: TYPE_IMG
  zh: '![要使StorageProfile生效，请使用Update-AzVM命令更新StatusCode。](img/B15455_04_05.jpg)'
- en: 'Figure 4.5: Using the Update-AzVM command to update the StatusCode'
  id: totrans-107
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图4.5：使用Update-AzVM命令更新StatusCode
- en: 'Verify the result:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 验证结果：
- en: '[PRE18]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Or, even better, instead of reusing the variables, just query all the information
    in this one-liner:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，更好的是，不要重用变量，只需在这个一行命令中查询所有信息：
- en: '[PRE19]'
  id: totrans-111
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'You can see the name, size, and LUN:'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以看到名称、大小和LUN：
- en: '![The output representing the name, size, and LUN of Disk StorageProfile.](img/B15455_04_06.jpg)'
  id: totrans-113
  prefs: []
  type: TYPE_IMG
  zh: '![表示磁盘StorageProfile的名称、大小和LUN的输出。](img/B15455_04_06.jpg)'
- en: 'Figure 4.6: Disk storage profile'
  id: totrans-114
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图4.6：磁盘存储配置
- en: Azure Files
  id: totrans-115
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Azure Files
- en: Instead of adding data disks to a VM, you can use **Azure Files**. If you recall,
    we discussed Azure Files at the very beginning of this chapter and mentioned that
    it's different from a normal file share. Azure Files is a fully managed file shares
    in the cloud, which can be accessed via **Server Message Block** (**SMB**), and
    this can be mounted to Linux, Windows, and macOS.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用**Azure Files**而不是向VM添加数据磁盘。如果您还记得，我们在本章的开头讨论了Azure Files，并提到它与普通文件共享不同。Azure
    Files是云中完全托管的文件共享，可以通过**服务器消息块**（**SMB**）访问，并且可以挂载到Linux、Windows和macOS。
- en: Azure Files needs a storage account and supports Standard_LRS, Standard_ZRS,
    Standard_GRS, and Standard_ZRS (only on selected regions) SKU types. There are
    no premium storage or other access tiers than the standard (hot) available. (At
    the time of writing this book, sources at Microsoft state that there is no timeline
    available for the introduction of these features.)
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: Azure Files需要一个存储账户，并支持Standard_LRS、Standard_ZRS、Standard_GRS和Standard_ZRS（仅在选定的区域）SKU类型。除了标准（热）可用之外，没有高级存储或其他访问层。
    （在撰写本书时，微软的消息来源表示目前没有可用于引入这些功能的时间表。）
- en: 'Please note that you will really require the SMB 3.0 protocol for performance
    reasons. This means that you need a recent Linux distribution such as one of these
    listed here:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，出于性能原因，您确实需要SMB 3.0协议。这意味着您需要一个最新的Linux发行版，比如这里列出的一个：
- en: RHEL-based distributions 7.5 or higher
  id: totrans-119
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基于RHEL的发行版7.5或更高版本
- en: Ubuntu 16.04 or higher
  id: totrans-120
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Ubuntu 16.04或更高版本
- en: Debian 9
  id: totrans-121
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Debian 9
- en: SUSE SLE 12 SP3 / OpenSUSE LEAP 42.3 or higher
  id: totrans-122
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SUSE SLE 12 SP3 / OpenSUSE LEAP 42.3或更高版本
- en: 'You also need to force version 3 with the mount option: **vers=3.0**.'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 您还需要使用挂载选项强制版本3：**vers=3.0**。
- en: 'The first step involves creating the Azure Files share:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 第一步涉及创建Azure Files共享：
- en: '[PRE20]'
  id: totrans-125
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'For the storage account context, you can use the variable that was used to
    create the storage account or create the variable again:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 对于存储账户上下文，您可以使用用于创建存储账户的变量或重新创建变量：
- en: '[PRE21]'
  id: totrans-127
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'Let''s implement this and create a new file share:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们实现这个并创建一个新的文件共享：
- en: '[PRE22]'
  id: totrans-129
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Let''s check the value of `$myShare01`. The output clearly shows you the URL
    of the storage, when you created it, and whether snapshots are available or not:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们检查一下`$myShare01`的值。输出清楚地显示了存储的URL、创建时间以及快照是否可用：
- en: '![The URL of the storage displaying the values of myShare01](img/B15455_04_07.jpg)'
  id: totrans-131
  prefs: []
  type: TYPE_IMG
  zh: '![显示myShare01值的存储URL。](img/B15455_04_07.jpg)'
- en: 'Figure 4.7: Output of myShare01'
  id: totrans-132
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图4.7：myShare01的输出
- en: 'To review the properties of the created share, execute the following command:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看创建的共享的属性，请执行以下命令：
- en: '[PRE23]'
  id: totrans-134
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'As you can see in the following screenshot, it will give you the same output
    with a little bit more information, which is not important at all for our purposes:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 如下面的屏幕截图所示，它将为您提供相同的输出，但会提供一些更多的信息，这对我们的目的并不重要：
- en: '![The properties of the created share with more details](img/B15455_04_08.jpg)'
  id: totrans-136
  prefs: []
  type: TYPE_IMG
  zh: '![创建的共享属性的更多详细信息](img/B15455_04_08.jpg)'
- en: 'Figure 4.8: Properties of the created share'
  id: totrans-137
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图4.8：创建的共享属性
- en: 'In Linux, you can mount the file share manually with the following code:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 在Linux中，您可以使用以下代码手动挂载文件共享：
- en: '[PRE24]'
  id: totrans-139
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: Please note that we're not using the HTTPS scheme because CIFS is not using
    URIs. Azure will take care of the mapping between the different schemes.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，我们不使用HTTPS方案，因为CIFS不使用URI。Azure将负责在不同方案之间进行映射。
- en: 'Let''s go ahead and mount the file share. Your password and storage file share
    will be different from the example as the name is unique across Azure:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们继续挂载文件共享。您的密码和存储文件共享将与示例中的不同，因为名称在Azure中是唯一的：
- en: '[PRE25]'
  id: totrans-142
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: Also, you can use the connect option in the Azure portal ([https://portal.azure.com/](https://portal.azure.com/))
    for the file share and Azure will generate the commands for mounting the share
    to Linux as well as Windows and macOS systems.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，您还可以在Azure门户（[https://portal.azure.com/](https://portal.azure.com/)）中使用连接选项进行文件共享，Azure将生成挂载共享到Linux以及Windows和macOS系统的命令。
- en: 'In the following screenshot, you can see that upon clicking `Connect`, Azure
    generates the code to connect the file share to the Linux system. You can copy
    this code and paste this to your Linux system:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 在下面的屏幕截图中，您可以看到单击“连接”时，Azure会生成代码，将文件共享连接到Linux系统。您可以复制此代码并粘贴到您的Linux系统中：
- en: '![Azure generates the code to connect the file share to the Linux system on
    the click of Connect tab](img/B15455_04_09.jpg)'
  id: totrans-145
  prefs: []
  type: TYPE_IMG
  zh: '![单击“连接”选项卡时，Azure会生成代码，将文件共享连接到Linux系统](img/B15455_04_09.jpg)'
- en: 'Figure 4.9: Connecting the file share to the Linux system'
  id: totrans-146
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图4.9：将文件共享连接到Linux系统
- en: 'More information about Azure Files about mounting shares is available in *Chapter
    5, Advanced Linux Administration*, in the *Mounting Remote Filesystems* section.
    The following is an example of a mount unit for Azure Files:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 有关Azure文件挂载共享的更多信息，请参阅《第5章，高级Linux管理》中的《挂载远程文件系统》部分。以下是Azure文件的挂载单元的示例：
- en: '[PRE26]'
  id: totrans-148
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'Here, the `/root/.staffs` file contains the following entries:'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，`/root/.staffs`文件包含以下条目：
- en: '[PRE27]'
  id: totrans-150
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'Another great way to verify the share and manage the content is with Azure
    Storage Explorer. Start Azure Storage Explorer on your workstation and connect
    your Azure account. If you don''t want to add the entire account, you also have
    the option to add just the storage account using the SAS key. Storage Explorer
    will show different types of resources on the left side, as shown in this screenshot:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 验证共享和管理内容的另一种好方法是使用Azure存储资源管理器。在您的工作站上启动Azure存储资源管理器并连接您的Azure账户。如果您不想添加整个账户，您也可以选择使用SAS密钥仅添加存储账户。存储资源管理器将在左侧显示不同类型的资源，如此屏幕截图所示：
- en: '![Azure storage Explorer window displaying the different types of resources](img/B15455_04_10.jpg)'
  id: totrans-152
  prefs: []
  type: TYPE_IMG
  zh: '![Azure存储资源管理器窗口显示不同类型的资源](img/B15455_04_10.jpg)'
- en: 'Figure 4.10: Azure Storage Explorer'
  id: totrans-153
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图4.10：Azure存储资源管理器
- en: Azure Blob
  id: totrans-154
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Azure Blob
- en: '**Azure Blob storage** is a storage service that stores unstructured data (images,
    video, audio, backup data, and so on that doesn''t adhere to a data model) in
    the cloud as objects. Blob is object-based storage that can store any type of
    data.'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: '**Azure Blob存储**是一种存储服务，用于在云中以对象形式存储非结构化数据（图像、视频、音频、备份数据等，不符合数据模型）。Blob是基于对象的存储，可以存储任何类型的数据。'
- en: Inside a storage account, you can have containers; containers are very similar
    to directories or folders on your computer. For example, if you are storing your
    favorite music files in Azure, you can set the account name as *Music* and inside
    that, you can create a container based on the genre or artists, and the actual
    music files are the blobs. A storage account can have an unlimited number of containers
    and a container can have an unlimited number of blobs.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 在存储账户中，您可以拥有容器；容器与计算机上的目录或文件夹非常相似。例如，如果您将喜爱的音乐文件存储在Azure中，您可以将账户名称设置为*音乐*，在其中，您可以根据流派或艺术家创建一个容器，实际的音乐文件就是blob。一个存储账户可以拥有无限数量的容器，一个容器可以拥有无限数量的blob。
- en: 'Azure file shares are a great way to keep your data out of a VM. But they''re
    file-based, and that''s not the fastest choice for every data type. For instance,
    streaming from Azure Files, while possible, does not perform very well; uploading
    very big files can also be very challenging. Blob storage is a solution for this
    problem, and it scales much better: 5 TB for an Azure file share and 500 TB for
    a single blob container.'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: Azure文件共享是将数据保存在虚拟机之外的一种好方法。但它们是基于文件的，并不是每种数据类型的最快选择。例如，从Azure文件进行流式传输虽然可能，但性能并不是很好；上传非常大的文件也可能非常具有挑战性。Blob存储是这个问题的解决方案，它的扩展性更好：Azure文件共享为5TB，单个Blob容器为500TB。
- en: 'To be able to upload a blob, you have to create a container first:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 要能够上传blob，您必须首先创建一个容器：
- en: '[PRE28]'
  id: totrans-159
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'Here is an example of creating a container list:'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是创建容器列表的示例：
- en: '[PRE29]'
  id: totrans-161
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: '![Output displaying the creation of the container list](img/B15455_04_11.jpg)'
  id: totrans-162
  prefs: []
  type: TYPE_IMG
  zh: '![显示创建容器列表的输出](img/B15455_04_11.jpg)'
- en: 'Figure 4.11: Creating a container list'
  id: totrans-163
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图4.11：创建容器列表
- en: 'There are three types of permissions available when creating a container:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 创建容器时有三种权限可用：
- en: '**Container**: Provides full read access to a container and its blobs. Clients
    can enumerate blobs in the container through anonymous requests; other containers
    are not visible.'
  id: totrans-165
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**容器**：提供对容器及其blob的完全读取访问。客户端可以通过匿名请求枚举容器中的blob；其他容器是不可见的。'
- en: '**Blob**: Provides read access to blob data throughout a container through
    anonymous requests but does not provide access to container data. Other blobs
    are not visible.'
  id: totrans-166
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Blob**：通过匿名请求提供对容器中的blob数据的读取访问，但不提供对容器数据的访问。其他blob是不可见的。'
- en: '**Off**: Restricts access to just the storage account owner.'
  id: totrans-167
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**关闭**：限制访问仅限于存储账户所有者。'
- en: 'You can use Azure Storage Explorer again to view the container:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以再次使用Azure存储资源管理器查看容器：
- en: '![Using Azure storage Explorer window to view containers.](img/B15455_04_12.jpg)'
  id: totrans-169
  prefs: []
  type: TYPE_IMG
  zh: '![使用Azure存储资源管理器窗口查看容器。](img/B15455_04_12.jpg)'
- en: 'Figure 4.12: Viewing container using Azure storage explorer'
  id: totrans-170
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图4.12：使用Azure存储资源管理器查看容器
- en: 'Using PowerShell, you can create a blob:'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 使用PowerShell，您可以创建一个blob：
- en: '[PRE30]'
  id: totrans-172
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'You can verify the result using the following command:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用以下命令验证结果：
- en: '[PRE31]'
  id: totrans-174
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'Now you can upload a file to the container, making it into a blob, for instance:'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，您可以将文件上传到容器，将其转换为blob，例如：
- en: '[PRE32]'
  id: totrans-176
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'You can also list the result:'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以列出结果：
- en: '[PRE33]'
  id: totrans-178
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: All these operations can be performed from Bash as well.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 所有这些操作也可以在Bash中执行。
- en: You can mount the blob from the Linux Blobfuse reference link using **Blobfuse**;
    for more information, visit [https://github.com/Azure/azure-storage-fuse](https://github.com/Azure/azure-storage-fuse)
    and [https://docs.microsoft.com/en-us/azure/storage/blobs/storage-how-to-mount-container-linux](https://docs.microsoft.com/en-us/azure/storage/blobs/storage-how-to-mount-container-linux).
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用**Blobfuse**从Linux Blobfuse参考链接中挂载blob；有关更多信息，请访问[https://github.com/Azure/azure-storage-fuse](https://github.com/Azure/azure-storage-fuse)和[https://docs.microsoft.com/en-us/azure/storage/blobs/storage-how-to-mount-container-linux](https://docs.microsoft.com/en-us/azure/storage/blobs/storage-how-to-mount-container-linux)。
- en: An alternative solution to copy data into a blob is **AzCopy** (more information
    on this is available at [https://docs.microsoft.com/en-us/azure/storage/common/storage-use-azcopy-linux](https://docs.microsoft.com/en-us/azure/storage/common/storage-use-azcopy-linux)).
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 将数据复制到blob的另一种解决方案是**AzCopy**（有关更多信息，请访问[https://docs.microsoft.com/en-us/azure/storage/common/storage-use-azcopy-linux](https://docs.microsoft.com/en-us/azure/storage/common/storage-use-azcopy-linux)）。
- en: But, honestly, most of the time, this is not the way you will use Blob storage.
    Blob storage is not something you want access to on an operating system level,
    but rather on an application level, to store objects such as images and to make
    them publicly available. Microsoft provides great examples for getting started
    at [https://github.com/Azure-Samples?q=storage-blobs](https://github.com/Azure-Samples?q=storage-blobs).
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 但是，老实说，大多数情况下，这不是您将使用Blob存储的方式。Blob存储不是您希望在操作系统级别访问的内容，而是在应用程序级别访问的内容，用于存储诸如图像之类的对象并使其公开可用。微软提供了一些很好的入门示例，网址为[https://github.com/Azure-Samples?q=storage-blobs](https://github.com/Azure-Samples?q=storage-blobs)。
- en: 'In *Chapter 7, Deploying Your Virtual Machine*, there is a good example of
    an exception: uploading a VHD file to create a custom image using that VHD.'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 在*第7章，部署您的虚拟机*中，有一个很好的例外示例：上传VHD文件以创建使用该VHD的自定义映像。
- en: Managing Network Resources
  id: totrans-184
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 管理网络资源
- en: 'As discussed earlier, in *Chapter 3 Basic Linux Administration*, networking
    is very important. Azure Virtual Network is an Azure service that provides the
    following:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，在*第3章基本Linux管理*中，网络非常重要。Azure虚拟网络是Azure提供的一项服务，提供以下功能：
- en: Connectivity to your workload
  id: totrans-186
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 与工作负载的连接
- en: Connectivity from your workload to the outside world
  id: totrans-187
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 工作负载与外部世界的连接
- en: Connectivity between VMs
  id: totrans-188
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 虚拟机之间的连接
- en: Other connectivity options, such as VPN tunnels
  id: totrans-189
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 其他连接选项，如VPN隧道
- en: Traffic filtering
  id: totrans-190
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 流量过滤
- en: Advanced routing options, including BGP routes through a VPN tunnel
  id: totrans-191
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 包括通过VPN隧道的BGP路由在内的高级路由选项
- en: Virtual Network
  id: totrans-192
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 虚拟网络
- en: In Azure, the most important component of virtual networking is the **virtual
    network**, or **VNet** for short. A virtual network is crucial as it provides
    a highly secure isolated environment for your VMs to run in.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 在Azure中，虚拟网络的最重要组件是**虚拟网络**或**VNet**。虚拟网络至关重要，因为它为您的VM提供了一个高度安全的隔离环境。
- en: 'The following process might appear a little confusing and lengthy, but the
    intent here is to make you understand the process and commands. Let''s start with
    the creation of a virtual network:'
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 以下过程可能看起来有点混乱和冗长，但这里的目的是让您了解过程和命令。让我们从创建虚拟网络开始：
- en: '[PRE34]'
  id: totrans-195
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'So, if we wanted to create a virtual network with the name `MyVirtualNetwork`
    with the address space `10.0.0.0/16`, we would use:'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，如果我们想要创建名称为`MyVirtualNetwork`、地址空间为`10.0.0.0/16`的虚拟网络，我们将使用：
- en: '[PRE35]'
  id: totrans-197
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'Executing the variable you just created will show you all the properties:'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 执行刚刚创建的变量将显示所有属性：
- en: '![Output displaying the properties of the Virtual network.](img/B15455_04_13.jpg)'
  id: totrans-199
  prefs: []
  type: TYPE_IMG
  zh: '![显示虚拟网络属性的输出](img/B15455_04_13.jpg)'
- en: 'Figure 4.13: Virtual network properties'
  id: totrans-200
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图4.13：虚拟网络属性
- en: The `AddressSpace` or address is the network that can be used by one or more
    subnets. It's possible to add additional address spaces.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: '`AddressSpace`或地址是一个或多个子网可以使用的网络。可以添加额外的地址空间。'
- en: Subnets
  id: totrans-202
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 子网
- en: As stated, a subnet is created in a virtual network. All traffic between different
    subnets in the same network is routed in Azure so the subnets are able to reach
    one another. Of course, you can modify that behavior, for instance, when you want
    to use a load balancer.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，子网是在虚拟网络中创建的。在Azure中，同一网络中不同子网之间的所有流量都经过路由，因此子网可以相互访问。当然，您可以修改该行为，例如，当您想要使用负载均衡器时。
- en: 'Again, we''ll take the simplest command possible for the same reason as for
    virtual networks:'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 同样，出于与虚拟网络相同的原因，我们将使用最简单的命令：
- en: '[PRE36]'
  id: totrans-205
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'To create a subnet with the name `MySubnet` with the address pool as `10.0.1.0/24`,
    execute the following command:'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建名称为`MySubnet`、地址池为`10.0.1.0/24`的子网，请执行以下命令：
- en: '[PRE37]'
  id: totrans-207
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: Note
  id: totrans-208
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 注意
- en: It is possible that you'll get a warning that some objects are deprecated. You
    can safely ignore it.
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 可能会收到一条警告，指出某些对象已被弃用。您可以放心忽略它。
- en: 'If you execute `$mysubnet`, you''ll see that the subnet is added:'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 如果执行`$mysubnet`，您将看到子网已添加：
- en: '![Output displaying the details of the subnet using $myVnet.Subnets](img/B15455_04_14.jpg)'
  id: totrans-211
  prefs: []
  type: TYPE_IMG
  zh: '![显示使用$myVnet.Subnets的子网详细信息的输出](img/B15455_04_14.jpg)'
- en: 'Figure 4.14: Subnet details'
  id: totrans-212
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图4.14：子网详细信息
- en: As you can see in the preceding screenshot, we didn't use the full network,
    only a part of it.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 如前面的屏幕截图所示，我们没有使用整个网络，只使用了其中的一部分。
- en: 'Alternatively, verification can be done using the following command:'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，可以使用以下命令进行验证：
- en: '[PRE38]'
  id: totrans-215
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: The output will be exactly the same as the preceding screenshot.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 输出将与前面的截图完全相同。
- en: 'The first IP address of the subnet is the gateway for network traffic coming
    from the VM; it provides the following:'
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 子网的第一个IP地址是来自虚拟机的网络流量的网关；它提供以下内容：
- en: A default gateway, with **Source Network Address Translation** (**SNAT**) to
    gain internet access. To be able to do so, a public IP address must be configured.
    SNAT allows you to send the traffic generated from your VM (or any resource) in
    the private network to the internet via the gateway.
  id: totrans-218
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 默认网关，带有**源网络地址转换**（**SNAT**）以获得互联网访问。为了能够这样做，必须配置公共IP地址。SNAT允许您将来自私有网络中的虚拟机（或任何资源）生成的流量发送到互联网通过网关。
- en: The DNS server, if not configured otherwise.
  id: totrans-219
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: DNS服务器，如果未另行配置。
- en: The DHCP server.
  id: totrans-220
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: DHCP服务器。
- en: 'The last part of the virtual network configuration involves attaching the newly
    created subnet:'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟网络配置的最后一部分涉及附加新创建的子网：
- en: '[PRE39]'
  id: totrans-222
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'From the output, among some other information, you can see the address space
    and the subnet within:'
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 从输出中，除其他信息外，您可以看到地址空间和子网：
- en: '![By attaching the newly created subnet you can see the address space and the
    subnet](img/B15455_04_15.jpg)'
  id: totrans-224
  prefs: []
  type: TYPE_IMG
  zh: '![通过附加新创建的子网，您可以查看地址空间和子网](img/B15455_04_15.jpg)'
- en: 'Figure 4.15: Attaching the newly created subnet'
  id: totrans-225
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图4.15：附加新创建的子网
- en: Network Security Group
  id: totrans-226
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 网络安全组
- en: '**Network security group** (**NSG**) is the next component we need to take
    care of. It is essentially access control lists that are associated with a subnet.
    It also provides port forwarding to the VMs or containers. The rules are applied
    to all interfaces that are attached to the subnet.'
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: '**网络安全组**（**NSG**）是我们需要关注的下一个组件。它本质上是与子网关联的访问控制列表。它还为虚拟机或容器提供端口转发。规则适用于附加到子网的所有接口。'
- en: 'The first step is to create an NSG:'
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 第一步是创建一个NSG：
- en: '[PRE40]'
  id: totrans-229
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'For example, you can create an NSG this way:'
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，您可以通过以下方式创建NSG：
- en: '[PRE41]'
  id: totrans-231
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'In the enormous output, you will find several sections; one of the sections
    is named `Default Security Rules`. This section contains a set of rules, given
    in order of priority:'
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 在庞大的输出中，您将找到几个部分；其中一个部分名为`默认安全规则`。该部分包含一组规则，按优先级顺序给出：
- en: Allow inbound traffic from all VMs in the virtual network (`AllowVnetInBound`)
  id: totrans-233
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 允许来自虚拟网络中所有虚拟机的入站流量（AllowVnetInBound）
- en: Allow inbound traffic from Azure Load Balancer (`AllowAzureLoadBalancerInBound`)
  id: totrans-234
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 允许来自Azure负载均衡器的入站流量（AllowAzureLoadBalancerInBound）
- en: Deny all inbound traffic (`DenyAllInBound`)
  id: totrans-235
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 拒绝所有入站流量（DenyAllInBound）
- en: Allow outbound traffic from all VMs to all VMs in the virtual network (`AllowVnetOutBound`)
  id: totrans-236
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 允许来自虚拟网络中所有虚拟机到所有虚拟机的出站流量（AllowVnetOutBound）
- en: Allow outbound traffic from all VMs to the internet (`AllowInternetOutBound`)
  id: totrans-237
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 允许来自所有虚拟机到互联网的出站流量（AllowInternetOutBound）
- en: Deny all outbound traffic (`DenyAllOutBound`)
  id: totrans-238
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 拒绝所有出站流量（DenyAllOutBound）
- en: 'Before going into the rules, let''s associate the subnet with the NSG:'
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 在进入规则之前，让我们将子网与NSG关联起来：
- en: '[PRE42]'
  id: totrans-240
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'For example, here''s an implementation of the preceding command:'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，以下是前述命令的实现：
- en: '[PRE43]'
  id: totrans-242
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: 'It''s possible that you''ll get the same deprecation warnings as you saw before.
    You can ignore them again. Attach the NSG to the network:'
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 您可能会收到与之前看到的相同的弃用警告。您可以再次忽略它们。将NSG附加到网络：
- en: '[PRE44]'
  id: totrans-244
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'The output of this command will be in JSON and is lengthy because of all the
    parameters. If you look at the output, you will see that `NetworkSecurityGroup`
    is mentioned as `myNSG1`, which is the NSG we created:'
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 此命令的输出将为JSON格式，并且由于所有参数的原因而很长。如果您查看输出，您将看到`NetworkSecurityGroup`被称为`myNSG1`，这是我们创建的NSG：
- en: '![Attaching NetworkSecurityGroup to the network ](img/B15455_04_16.jpg)'
  id: totrans-246
  prefs: []
  type: TYPE_IMG
  zh: '![将NetworkSecurityGroup附加到网络](img/B15455_04_16.jpg)'
- en: 'Figure 4.16: NSG attached to the network'
  id: totrans-247
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图4.16：附加到网络的NSG
- en: 'If we want access to our VM using SSH, then we need to add a security rule:'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们想要使用SSH访问我们的虚拟机，那么我们需要添加一个安全规则：
- en: '[PRE45]'
  id: totrans-249
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: 'The `-SourceAddressPrefix` parameter is a sort of a shorthand for everything
    that is outside the virtual network and reachable by public internet. Other values
    are as follows:'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: '`-SourceAddressPrefix`参数是一种缩写，表示虚拟网络之外并可通过公共互联网到达的一切。其他值如下：'
- en: '`VirtualNetwork`: Everything within this virtual network and other connected
    networks.'
  id: totrans-251
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`VirtualNetwork`：此虚拟网络及其他连接的网络中的一切。'
- en: '`AzureLoadBalancer`: If you are using Azure Load Balancer, this provides access
    to your VMs.'
  id: totrans-252
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`AzureLoadBalancer`：如果您正在使用Azure负载均衡器，这将为您的虚拟机提供访问。'
- en: '`*`: Everything.'
  id: totrans-253
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`*`：一切。'
- en: '`Priority` ranges from `100` to `4096`. Higher numbers are created by Azure
    and can be overruled. The lower the priority number, the higher is the priority
    of the rule.'
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: '`优先级`范围从`100`到`4096`。较高的数字由Azure创建并可以被覆盖。优先级数字越低，规则的优先级越高。'
- en: 'The output of the previous command may have too much information, which is
    a bit confusing to interpret. In order to confirm whether port `22` traffic is
    allowed, we will filter the output using the following command:'
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 前一个命令的输出可能包含太多信息，这有点令人困惑。为了确认端口`22`的流量是否被允许，我们将使用以下命令过滤输出：
- en: '[PRE46]'
  id: totrans-256
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'The output, as shown in the following screenshot, verifies that TCP port `22`
    is open for inbound traffic. This port has a priority of `100`, but since it''s
    the only rule, that doesn''t matter:'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 如下截图所示的输出验证了TCP端口`22`对入站流量是开放的。该端口的优先级为`100`，但由于它是唯一的规则，这并不重要：
- en: '![Output to verify that TCP port 22 is open for inbound traffic](img/B15455_04_17.jpg)'
  id: totrans-258
  prefs: []
  type: TYPE_IMG
  zh: '![输出以验证TCP端口22是否开放以进行入站流量](img/B15455_04_17.jpg)'
- en: 'Figure 4.17: Listing the security rules set for the NSG'
  id: totrans-259
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图4.17：列出为NSG设置的安全规则
- en: 'Alternatively, you can use the following command:'
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，您可以使用以下命令：
- en: '[PRE47]'
  id: totrans-261
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: As you can see, the output is the same.
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 正如您所看到的，输出是相同的。
- en: Public IP Address and Network Interface
  id: totrans-263
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 公共IP地址和网络接口
- en: To be able to access the VM from the internet, a public IP address is needed
    along with a DNS label, which is the DNS name given to our VM.
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 要能够从互联网访问虚拟机，需要一个公共IP地址以及一个DNS标签，这是赋予我们的虚拟机的DNS名称。
- en: The public IP can be static or dynamic. In the case of a dynamic public IP,
    whenever you deallocate and then restart the VM, the IP will be released and disassociated
    from the VM. Next time you start the VM, a new public IP will be associated with
    the VM. So, every time you deallocate and then restart the VM, you have to check
    the public IP from the CLI or the portal to connect to the VM.
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 公共IP可以是静态的或动态的。对于动态公共IP，每当您取消分配然后重新启动VM时，IP将被释放并与VM解除关联。下次启动VM时，将为VM分配一个新的公共IP。因此，每次您取消分配然后重新启动VM时，都必须从CLI或门户验证公共IP以连接到VM。
- en: 'Here comes the important part about the DNS label: if you have already added
    a DNS label to your VM, you can always use that to connect to the VM, irrespective
    of the public IP the VM has. The DNS label doesn''t change when you deallocate
    and restart the VM. Also, the DNS label is unique across Azure.'
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: DNS标签的重要部分来了：如果您已经向VM添加了DNS标签，无论VM具有的公共IP是什么，您都可以始终使用该标签连接到VM。当您取消分配并重新启动VM时，DNS标签不会更改。此外，DNS标签在Azure中是唯一的。
- en: In the case of a static public IP, the IP will be reserved for you. Even if
    you deallocate and then restart the VM, the IP will not change. Having a static
    IP assigned to the VM will not stop you from adding a DNS label. If that's needed,
    you can add the label as well.
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 对于静态公共IP，IP将为您保留。即使您取消分配然后重新启动VM，IP也不会更改。将静态IP分配给VM不会阻止您添加DNS标签。如果需要，您也可以添加标签。
- en: 'Create a new dynamic public IP with the following command:'
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 使用以下命令创建新的动态公共IP：
- en: '[PRE48]'
  id: totrans-269
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: 'Verify it by viewing the content of the `$pip` variable. If the allocation
    method is `Dynamic`, the IP address is not allocated until the IP address is assigned
    to a network interface:'
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 通过查看`$pip`变量的内容来验证。如果分配方法是`动态`，则在将IP地址分配给网络接口之前，不会分配IP地址：
- en: '![Verifying the new dynamic public IP by viewing the content of the $pip variable.](img/B15455_04_18.jpg)'
  id: totrans-271
  prefs: []
  type: TYPE_IMG
  zh: '![通过查看$pip变量的内容来验证新的动态公共IP。](img/B15455_04_18.jpg)'
- en: 'Figure 4.18: Verifying the new dynamic public IP'
  id: totrans-272
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图4.18：验证新的动态公共IP
- en: So, that's why in the preceding screenshot, the `IpAddress` field states `Not
    Assigned`.
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，在前面的截图中，`IpAddress`字段显示为`未分配`。
- en: 'To create the network interface, use the following command:'
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 使用以下命令创建网络接口：
- en: '[PRE49]'
  id: totrans-275
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'If you get an error on the `SubnetId`, try to set the `myVnet` variable again
    and run the following command:'
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 如果在`SubnetId`上出现错误，请尝试重新设置`myVnet`变量并运行以下命令：
- en: '[PRE50]'
  id: totrans-277
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: 'To verify the result, execute the following command:'
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 要验证结果，请执行以下命令：
- en: '[PRE51]'
  id: totrans-279
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: '![Checking the IP address alloted to the network interface ](img/B15455_04_19.jpg)'
  id: totrans-280
  prefs: []
  type: TYPE_IMG
  zh: '![检查分配给网络接口的IP地址](img/B15455_04_19.jpg)'
- en: 'Figure 4.19: Checking the IP address allocated to the network interface'
  id: totrans-281
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图4.19：检查分配给网络接口的IP地址
- en: In the output, as you can see in the preceding screenshot, an IP address is
    allocated, which is `10.0.1.4` this time.
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 在输出中，正如您在前面的截图中所看到的，分配了一个IP地址，这次是`10.0.1.4`。
- en: Managing Compute Resources
  id: totrans-283
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 管理计算资源
- en: Let's sum up the components covered in this chapter that you need as a requirement,
    before you can deploy a VM. In the case of the storage account, it's not a real
    requirement, but do you want to work without being able to receive boot diagnostics
    in times of trouble? As mentioned earlier, a boot diagnostics account is very
    useful if your VMs go into a non-bootable state. The logs stored in this account
    can be used to find the root cause of the non-booting state of the VM. For testing,
    this is not a mandatory option, but for production workloads, it is recommended
    to enable boot diagnostics, which will help you understand what went wrong during
    a failure.
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们总结一下本章涵盖的组件，这些是您在部署VM之前需要的要求。对于存储账户来说，这不是一个真正的要求，但是您想在遇到麻烦时无法接收引导诊断吗？如前所述，如果您的VM进入非可引导状态，引导诊断账户非常有用。存储在此账户中的日志可用于查找VM非引导状态的根本原因。对于测试来说，这不是一个强制性选项，但对于生产工作负载，建议启用引导诊断，这将帮助您了解故障发生时出了什么问题。
- en: Note
  id: totrans-285
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 注意
- en: Every resource mentioned here is also used by Azure Container Service and Azure
    Kubernetes Service.
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 这里提到的每个资源也被Azure容器服务和Azure Kubernetes服务使用。
- en: 'If you remember, in the *Technical requirements* section, we looked at PowerShell
    code to create a new VM, where most of the variables were not defined. Here is
    the code again:'
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您还记得，在*技术要求*部分，我们看了一下使用PowerShell代码创建新VM的过程，其中大多数变量未定义。这里是代码：
- en: '[PRE52]'
  id: totrans-288
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: Now, I hope you are able to understand what each of these parameters stands
    for and how they are crucial for your VM.
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我希望您能理解这些参数各自代表什么，以及它们对于您的VM有多么重要。
- en: Virtual Machine Resources
  id: totrans-290
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 虚拟机资源
- en: In this section, we'll provide a few tables with the necessary components and
    the corresponding commands in PowerShell and Bash. It can be used together with
    the help available in PowerShell (`help <cmdlet>`), the Azure CLI (add the `--help`
    parameter to the command), or the Azure online documentation.
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将提供一些表格，其中包含必要的组件以及PowerShell和Bash中对应的命令。它可以与PowerShell中的帮助一起使用（`help
    <cmdlet>`），Azure CLI（在命令中添加`--help`参数），或Azure在线文档。
- en: '**Azure Profile**'
  id: totrans-292
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '**Azure配置文件**'
- en: 'The Azure profile comprises the settings needed to describe your Azure environment:'
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: Azure配置文件包括描述Azure环境所需的设置：
- en: '![A list of commands for Azure profile settings required to describe the Azure
    environment](img/B15455_04_20.jpg)'
  id: totrans-294
  prefs: []
  type: TYPE_IMG
  zh: '![描述Azure环境所需的Azure配置文件设置命令列表](img/B15455_04_20.jpg)'
- en: 'Figure 4.20: Azure profile settings commands'
  id: totrans-295
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图4.20：Azure配置文件设置命令
- en: '**Resource Group**'
  id: totrans-296
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '**资源组**'
- en: 'The resource group is needed to contain and manage resources:'
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
  zh: 资源组需要包含和管理资源：
- en: '![A list of commands to create and view the Azure resource groups](img/B15455_04_21.jpg)'
  id: totrans-298
  prefs: []
  type: TYPE_IMG
  zh: '![创建和查看Azure资源组的命令列表](img/B15455_04_21.jpg)'
- en: 'Figure 4.21: Azure resource group commands'
  id: totrans-299
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图4.21：Azure资源组命令
- en: '**Storage Account**'
  id: totrans-300
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '**存储账户**'
- en: 'The storage account is needed if you want to store data outside your VM/container:'
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您想在VM/容器外部存储数据，则需要存储账户：
- en: '![A list of commands for Azure storage account](img/B15455_04_22.jpg)'
  id: totrans-302
  prefs: []
  type: TYPE_IMG
  zh: '![用于Azure存储账户的命令列表。](img/B15455_04_22.jpg)'
- en: 'Figure 4.22: Azure storage account commands'
  id: totrans-303
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图4.22：Azure存储账户命令
- en: '**Virtual Networks**'
  id: totrans-304
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '**虚拟网络**'
- en: 'Virtual networking is needed for communication between VMs/containers and communication
    with the outside world:'
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟网络用于VM/容器之间的通信和与外部世界的通信：
- en: '![A list of commands that can be used to create and view Azure virtual network
    and subnet.](img/B15455_04_23.jpg)'
  id: totrans-306
  prefs: []
  type: TYPE_IMG
  zh: '![可用于创建和查看Azure虚拟网络和子网的命令列表。](img/B15455_04_23.jpg)'
- en: 'Figure 4.23: Azure virtual network commands'
  id: totrans-307
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图4.23：Azure虚拟网络命令
- en: '**Network Security Group**'
  id: totrans-308
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '**网络安全组**'
- en: 'The NSG consists of **Access Control Lists** (**ACL**) to protect your workloads
    and allow access where needed. It is, together with the public IP address, also
    needed for port forwarding to the VM/container:'
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: NSG包括**访问控制列表**（**ACL**）来保护您的工作负载并在需要时允许访问。它与公共IP地址一起，也需要用于端口转发到VM/容器：
- en: '![A list of commands for the Azure Network Security Group.](img/B15455_04_24.jpg)'
  id: totrans-310
  prefs: []
  type: TYPE_IMG
  zh: '![用于Azure网络安全组的命令列表。](img/B15455_04_24.jpg)'
- en: 'Figure 4.24: Azure NSG commands'
  id: totrans-311
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图4.24：Azure NSG命令
- en: '**Public IP Address and Network Interface**'
  id: totrans-312
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '**公共IP地址和网络接口**'
- en: 'The public IP address provides access from the outside world into the VM/container.
    It''s necessary for Port Address Translation (PAT) and SNAT:'
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: 公共IP地址提供了从外部世界进入VM/容器的访问。这对于端口地址转换（PAT）和SNAT是必要的：
- en: '![A list of commands for the Azure public IP address and network interface.](img/B15455_04_25.jpg)'
  id: totrans-314
  prefs: []
  type: TYPE_IMG
  zh: '![用于Azure公共IP地址和网络接口的命令列表。](img/B15455_04_25.jpg)'
- en: 'Figure 4.25: Azure public IP address and network interface commands'
  id: totrans-315
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图4.25：Azure公共IP地址和网络接口命令
- en: Summary
  id: totrans-316
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 摘要
- en: With the knowledge gained in this chapter, you should now have a better understanding
    of the things you encountered in *Chapter 2, Getting Started with the Azure Cloud*.
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: 通过本章获得的知识，您现在应该更好地理解了您在*第2章，开始使用Azure云*中遇到的事物。
- en: 'In this chapter, we explored all the Azure components that are needed before
    you can create your workload in Azure:'
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们探讨了在您可以在Azure中创建工作负载之前所需的所有Azure组件：
- en: You'll need a storage account for the VM boot diagnostic extension.
  id: totrans-319
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您需要一个存储账户来存储VM之外的数据。
- en: You'll want a storage account to store data outside your VM.
  id: totrans-320
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您需要一个存储账户来存储VM之外的数据。
- en: Networking components are needed to be able to communicate with your VM, enable
    communication between your machines, and for the VM to be able to reach the internet.
  id: totrans-321
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 需要网络组件才能与VM进行通信，启用机器之间的通信，并使VM能够访问互联网。
- en: The steps we have discussed so far will be very useful for you to understand
    the components related to VMs and also how each of those components is deployed
    in Azure. We started with storage solutions in Azure and then covered networking
    as well. We hope this gave you an idea of how these components come together to
    provide service delivery.
  id: totrans-322
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们讨论的步骤将对您理解与VM相关的组件以及这些组件如何在Azure中部署非常有用。我们从Azure中的存储解决方案开始，然后也涵盖了网络。我们希望这给您一个关于这些组件如何组合提供服务交付的想法。
- en: In the next chapter, we will be using the knowledge we gained from this chapter
    to identify and configure network and storage components in the Linux operating
    system. Besides network and storage topics, we'll explore other system administration
    tasks, such as software and service management.
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将利用本章获得的知识来识别和配置Linux操作系统中的网络和存储组件。除了网络和存储主题，我们还将探讨其他系统管理任务，如软件和服务管理。
- en: Questions
  id: totrans-324
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 问题
- en: Which resources are required before you can create your VM?
  id: totrans-325
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在您创建VM之前需要哪些资源？
- en: Which resources are recommended for a VM?
  id: totrans-326
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 哪些资源建议用于VM？
- en: In the examples, a random number generator was used several times—why?
  id: totrans-327
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在示例中，随机数生成器被多次使用——为什么？
- en: What is the purpose of `AddressPrefix` on a network?
  id: totrans-328
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 网络上的`AddressPrefix`的目的是什么？
- en: What is the purpose of `AddressPrefix` on a subnet?
  id: totrans-329
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 子网上的`AddressPrefix`的目的是什么？
- en: What is the purpose of the NSG?
  id: totrans-330
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: NSG的目的是什么？
- en: Why is the public IP address needed for communication with the outside world?
  id: totrans-331
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为什么需要公共IP地址与外部世界进行通信？
- en: What is the difference between a static and a dynamically allocated public IP
    address?
  id: totrans-332
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 静态和动态分配的公共IP地址有什么区别？
- en: Further Reading
  id: totrans-333
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 进一步阅读
- en: The book *Implementing Microsoft Azure Infrastructure Solutions* from Microsoft
    Press is intended as a reference guide for studying the 70-533 exam; even though
    the exam is deprecated, the content is still good for reference. It explains every
    part of the Azure infrastructure in detail, using the Azure portal and the command-line
    interfaces.
  id: totrans-334
  prefs: []
  type: TYPE_NORMAL
  zh: 微软出版社的书籍*Implementing Microsoft Azure Infrastructure Solutions*旨在作为学习70-533考试的参考指南；即使考试已经废弃，内容仍然适合参考。它使用Azure门户和命令行界面详细解释了Azure基础架构的每个部分。
- en: If you are new to networking, another recommended book, which is also written
    as a study guide for an exam, is the *Comptia Network+ Certification Guide* by
    Glen D. Singh and Rishi Latchmepersad.
  id: totrans-335
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您是网络方面的新手，另一本推荐的书籍，也是作为考试学习指南编写的，是Glen D. Singh和Rishi Latchmepersad的*Comptia
    Network+ Certification Guide*。
- en: Much older and more difficult to read is the freely available *TCP/IP Redbook*
    from IBM ([https://www.redbooks.ibm.com/redbooks/pdfs/gg243376.pdf](https://www.redbooks.ibm.com/redbooks/pdfs/gg243376.pdf));
    it covers much more than you need to know, but if you are interested in the topic,
    it's a must-read. Even if you are not interested in taking the Cisco ICND1 exam,
    Neil Anderson recorded a video at [https://www.packtpub.com](https://www.packtpub.com),
    which provides, besides the Cisco part, a very good introduction to networking.
  id: totrans-336
  prefs: []
  type: TYPE_NORMAL
  zh: 更古老且更难阅读的是IBM的免费*TCP/IP Redbook*（[https://www.redbooks.ibm.com/redbooks/pdfs/gg243376.pdf](https://www.redbooks.ibm.com/redbooks/pdfs/gg243376.pdf)）；它涵盖的内容远远超出您需要了解的范围，但如果您对这个主题感兴趣，这是必读的。即使您对参加思科ICND1考试不感兴趣，Neil
    Anderson在[https://www.packtpub.com](https://www.packtpub.com)录制了一个视频，除了思科部分外，还提供了对网络的很好介绍。
- en: Note
  id: totrans-337
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 注意
- en: Please be aware that the Azure environment is continuously changing, especially
    regarding storage and networking; it is important to validate sources against
    the documentation available on the Microsoft website. The date of publishing is
    perhaps the first thing you will want to check.
  id: totrans-338
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，Azure环境不断变化，特别是在存储和网络方面；验证来源与微软网站上可用的文档非常重要。发布日期可能是您首先要检查的内容。
