- en: Chapter 5. Basic IPCop Usage
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第5章。基本IPCop使用
- en: Now that we have covered the installation of the IPCop firewall and several
    situations in which we would want to deploy it, we can discuss how to administer
    and operate an IPCop firewall. Assuming that the installation has been successful,
    a default IPCop installation presents us with a web interface. The web interface
    allows us to configure the firewall via any web browser, and is (by default) enabled
    only for clients on the Green, internal interface.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经介绍了IPCop防火墙的安装以及我们想要部署它的几种情况，我们可以讨论如何管理和操作IPCop防火墙。假设安装成功，一个默认的IPCop安装会呈现给我们一个Web界面。Web界面允许我们通过任何Web浏览器配置防火墙，并且（默认情况下）仅对Green内部接口上的客户端启用。
- en: The web server runs on port 445 (for **HTTPS** traffic) by default, although
    these ports can be altered; the port is different from the commonly used/allocated
    port (443). It should be noted that accessing the web interface using this port
    will yield a certificate popup—this results from the use of a self-signed **SSL**
    certificate, and can safely be ignored.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: Web服务器默认情况下在端口445上运行（用于**HTTPS**流量），尽管这些端口可以被更改；该端口与常用/分配的端口（443）不同。应该注意，使用此端口访问Web界面将产生证书弹出窗口—这是由于使用自签名的**SSL**证书造成的，可以安全地忽略。
- en: The port assignment for HTTPS administration can be changed to any port above
    445 using the `setreservedports` command from the IPCop console or an **SSH**
    session, and this may be a consideration for anyone who wishes to access their
    IPCop host remotely, as some Internet Service Providers will firewall traffic
    to port 445 in order to prevent worms such as Sasser, which exploit vulnerabilities
    in Windows over port 445 (**SMB** over **TCP**). Alteration of this port to below
    445 must be done manually, although it should not be undertaken lightly, and will
    require the editing of the same files as `setreservedports` ([http://www.ipcop.org/modules.php?op=modload&name=phpWiki&file=index&pagename=IPCop140HttpsPortHowto](http://www.ipcop.org/modules.php?op=modload&name=phpWiki&file=index&pagename=IPCop140HttpsPortHowto)).
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: HTTPS管理的端口分配可以使用IPCop控制台或**SSH**会话中的`setreservedports`命令更改为445以上的任何端口，并且这可能是考虑到远程访问其IPCop主机的任何人的一个考虑因素，因为一些互联网服务提供商将防火墙流量到端口445，以防止像Sasser这样的蠕虫，它利用端口445上Windows的漏洞（**SMB**通过**TCP**）。将此端口更改为445以下必须手动完成，尽管不应轻率进行，并且需要编辑与`setreservedports`相同的文件（[http://www.ipcop.org/modules.php?op=modload&name=phpWiki&file=index&pagename=IPCop140HttpsPortHowto](http://www.ipcop.org/modules.php?op=modload&name=phpWiki&file=index&pagename=IPCop140HttpsPortHowto)）。
- en: Unencrypted traffic to port 81, supported in versions pre-1.4, is deprecated,
    and existed initially only to support browsers without support for HTTPS/ssl.
    Since version 1.4 of the IPCop firewall, this has been altered in order to allow
    only HTTPS administration (although port 81 can be reconfigured).
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 不加密的端口81的流量在1.4版本之前的版本中已经不再支持，并且最初只是为了支持不支持HTTPS/ssl的浏览器。自IPCop防火墙的1.4版本以来，已经进行了更改，以便仅允许HTTPS管理（尽管端口81可以重新配置）。
- en: Accessing our IPCop firewall via [https://ipcopfirewall:445/](https://ipcopfirewall:445/)
    (where ipcopfirewall is the name or IP address of the host), then, gives us the
    default configuration screen with an overview of the status of the IPCop firewall,
    the update status, system load, and menus for all of the appropriate configuration
    options. Any messages about certificates at this point can be safely ignored,
    and stem from the fact that your IPCop host generates its own SSL certificate,
    rather than using one issued by a **Certificate Authority** (**CA**) your browser
    may know about, such as VeriSign or CAcert.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 通过[https://ipcopfirewall:445/](https://ipcopfirewall:445/)（其中ipcopfirewall是主机的名称或IP地址）访问我们的IPCop防火墙，然后，我们会看到默认配置屏幕，其中包括IPCop防火墙的状态概述、更新状态、系统负载和所有适当配置选项的菜单。此时出现的有关证书的任何消息都可以安全地忽略，这是因为您的IPCop主机生成自己的SSL证书，而不是使用您的浏览器可能知道的**证书颁发机构**（**CA**）（如VeriSign或CAcert）颁发的证书。
- en: The System Menu
  id: totrans-6
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 系统菜单
- en: The items in the **System** menu are fairly critical to the system's functionality.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: '**系统**菜单中的项目对系统的功能性相当关键。'
- en: '![The System Menu](img/1361_05_01.jpg)'
  id: totrans-8
  prefs: []
  type: TYPE_IMG
  zh: '![系统菜单](img/1361_05_01.jpg)'
- en: Software Updates
  id: totrans-9
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 软件更新
- en: The first thing we should do, post-installation, is to ensure that our IPCop
    firewall has the appropriate updates applied. Although many software updates provide
    updates and bug fixes for new features and existing software packages, some address
    new security issues, and in order to maintain the integrity of the firewall; it
    is important to apply these as frequently as possible.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 安装后，我们应该做的第一件事是确保我们的IPCop防火墙应用了适当的更新。尽管许多软件更新提供了新功能和现有软件包的更新和错误修复，但有些是为了解决新的安全问题，为了维护防火墙的完整性；尽可能频繁地应用这些更新是很重要的。
- en: The Software Updates functionality is provided under the **System | Updates**
    menu.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 软件更新功能在**系统 | 更新**菜单下提供。
- en: '![Software Updates](img/1361_05_02.jpg)'
  id: totrans-12
  prefs: []
  type: TYPE_IMG
  zh: '![软件更新](img/1361_05_02.jpg)'
- en: The **Refresh update list** button connects to the IPCop servers and retrieves
    a list of released updates—the **Available updates** portion of the page will
    indicate when there are updates that need to be supplied, and provide a download
    link. The updates must be manually downloaded as-is (not unpacked or extracted)
    from the Internet and then uploaded (via the **Browse** button) to the firewall.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: '**刷新更新列表**按钮连接到IPCop服务器并检索已发布更新的列表—页面上的**可用更新**部分将指示何时需要提供更新，并提供下载链接。更新必须按原样（不解压或提取）从互联网手动下载，然后通过**浏览**按钮上传到防火墙。'
- en: As the name of the update files (`*.tgz.gpg`) indicates, the updates are signed
    with, the **GNU Privacy Guard** (**GPG**), which prevents unauthorized (or compromised)
    updates from being issued by anyone without first compromising the IPCop key used
    to sign the updates. The GPG signature prevents unpacking and reassembly or modification
    of the updates, causing IPCop to refuse to use an update file that has either
    been tampered with by an intruder or unpacked instead of being simply downloaded
    and uploaded.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 正如更新文件的名称（`*.tgz.gpg`）所示，更新使用**GNU隐私保护**（**GPG**）签名，这可以防止未经授权（或被篡改）的更新由任何人发布，而不是首先篡改用于签署更新的IPCop密钥。GPG签名防止更新文件被篡改或解压重组或修改，导致IPCop拒绝使用已被入侵者篡改或解压而不是简单下载和上传的更新文件。
- en: The update will indicate whether a restart of the IPCop firewall is required,
    but in many instances, it is not, and it is typically kernel updates that require
    this.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 更新将指示是否需要重新启动IPCop防火墙，但在许多情况下，不需要重新启动，通常是内核更新需要这样做。
- en: Some releases of the IPCop firewall (generally major version increments, such
    as 1.3-1.4) require that the firewall be completely reinstalled, as the upgrade
    procedure is too complex to be carried out via an update as with a minor version
    increment. In this case, the firewall configuration can be backed up, so the firewall
    is not being entirely rebuilt from scratch.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: IPCop防火墙的某些版本（通常是主要版本增量，例如1.3-1.4）要求完全重新安装防火墙，因为升级过程太复杂，无法通过更新进行。在这种情况下，可以备份防火墙配置，因此防火墙不需要完全从头开始重建。
- en: Passwords
  id: totrans-17
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 密码
- en: The next **System** menu allows us to alter passwords—this screen is relatively
    self-explanatory, giving us the option to reset the **admin** password (which
    gives complete control over the web interface) and the **dial** password. The
    **dial** user allows a user access only to connect or disconnect a connection,
    which must be manually dialed, such as an analog modem.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个**系统**菜单允许我们更改密码——这个屏幕相对简单，给了我们重置**admin**密码（可以完全控制Web界面）和**dial**密码的选项。**dial**用户只允许用户连接或断开连接，必须手动拨号，例如模拟调制解调器。
- en: The third account on the system, the root account (whose password you set during
    the installation), has the power to reset both the **admin** and **dial** user
    account passwords, but this facility must be used either on the console of the
    IPCop firewall or via SSH, which must be manually enabled.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 系统上的第三个帐户，即根帐户（在安装过程中设置的密码），具有重置**admin**和**dial**用户帐户密码的权限，但此功能必须在IPCop防火墙的控制台上或通过SSH使用，SSH必须手动启用。
- en: SSH Access
  id: totrans-20
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: SSH访问
- en: SSH access allows us to securely establish a console session using an account
    with the appropriate privileges (such as the root account) remotely. SSH is a
    very useful tool, and a thorough coverage of it is beyond the scope of this chapter
    or even this book. At its most basic, SSH may be used to run commands and administer
    the system in a manner (i.e. textually, at the command line) similar to that done
    on the console of the machine itself.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: SSH访问允许我们使用具有适当权限的帐户（例如根帐户）远程安全建立控制台会话。SSH是一个非常有用的工具，对它的全面覆盖超出了本章甚至本书的范围。在其最基本的形式下，SSH可用于以与机器本身的控制台上所做的方式（即文本方式，在命令行上）运行命令和管理系统。
- en: Within the context of IPCop this is extremely useful because we can run the
    setup program, which we ran during the installation procedure (allowing us to
    reset or alter parameters such as the network configuration and card allocation,
    or reset passwords). If you altered the topology of your network or added/replaced
    network cards in your IPCop firewall, you might want to reconfigure it via SSH.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 在IPCop的上下文中，这非常有用，因为我们可以运行安装过程中运行的设置程序（允许我们重置或更改参数，如网络配置和卡分配，或重置密码）。如果您更改了网络拓扑或在IPCop防火墙中添加/替换了网络卡，可能希望通过SSH重新配置它。
- en: '![SSH Access](img/1361_05_03.jpg)'
  id: totrans-23
  prefs: []
  type: TYPE_IMG
  zh: '![SSH访问](img/1361_05_03.jpg)'
- en: Note
  id: totrans-24
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '**SSH Keys**'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: '**SSH密钥**'
- en: '[http://hacks.oreilly.com/pub/h/66](http://hacks.oreilly.com/pub/h/66) is a
    good brief overview of the use of SSH keys, along with a few pointers to other
    resources (and a wide collection of user comments on the topic).'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: '[http://hacks.oreilly.com/pub/h/66](http://hacks.oreilly.com/pub/h/66)是关于使用SSH密钥的简要概述，以及其他资源的一些指针（以及关于该主题的大量用户评论）。'
- en: Key authentication allows the use of keys stored on client computers (in a similar
    manner to SSL) to authenticate clients, rather than passwords that are transmitted
    (over an encrypted tunnel) over the Internet each time they are used during the
    SSH authentication phase (SSH-USERAUTH). This authentication method, assuming
    that the key is not stolen or compromised, is significantly more secure than the
    use of passwords, but more complex to understand and configure, and a little less
    flexible (a key file is required on any system you want to use to log in to your
    SSH server, whereas a password only needs to be remembered).
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 密钥认证允许使用存储在客户端计算机上的密钥（类似于SSL）来验证客户端，而不是在SSH身份验证阶段（SSH-USERAUTH）期间每次通过互联网传输的密码。假设密钥未被盗用或泄露，这种身份验证方法比使用密码更安全，但更复杂，更难理解和配置，而且灵活性稍差（在要用于登录到SSH服务器的任何系统上都需要密钥文件，而密码只需记住）。
- en: SSH is also more useful generally as a diagnostic tool—there are many tools
    included with IPCop that can only be accessed via the command line, such as `vim`
    (a powerful text editor), network utilities such as `ping` and `traceroute`, and
    `tcpdump`, which is extremely useful for debugging networking issues by dumping
    network traffic or just viewing the headers on the console. We can also use many
    of the standard Unix utilities such as `touch` and `grep`. Many of these (in fact
    all the commands mentioned in this paragraph apart from `vim` and `tcpdump`) are
    provided by `busybox`, the program that runs to provide the shell used when you
    log in at the console or via ssh.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: SSH通常也更有用作为诊断工具——IPCop中包含许多只能通过命令行访问的工具，如`vim`（强大的文本编辑器）、诸如`ping`和`traceroute`的网络实用工具，以及`tcpdump`，通过转储网络流量或仅在控制台上查看标头来调试网络问题非常有用。我们还可以使用许多标准的Unix实用程序，如`touch`和`grep`。这些（实际上，除了`vim`和`tcpdump`之外，本段中提到的所有命令）都是由`busybox`提供的，该程序在您通过控制台或ssh登录时运行以提供所使用的shell。
- en: Note
  id: totrans-29
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '**The Busybox Shell**'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: '**Busybox Shell**'
- en: 'Learn more about the `busybox` shell and the options it provides at: [http://www.busybox.net/downloads/BusyBox.html](http://www.busybox.net/downloads/BusyBox.html).'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下网址了解有关`busybox` shell及其提供的选项：[http://www.busybox.net/downloads/BusyBox.html](http://www.busybox.net/downloads/BusyBox.html)。
- en: Connecting to SSH
  id: totrans-32
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 连接到SSH
- en: 'Accessing SSH on a Linux or Unix system is fairly easy—once we have enabled
    SSH, it runs on the (non-default) port 222, so a command similar to the following
    will get you into your IPCop host (assuming a hostname of "IPCop"):'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 在Linux或Unix系统上访问SSH相当容易——一旦我们启用了SSH，它将在（非默认）端口222上运行，因此类似于以下命令将使您进入IPCop主机（假设主机名为"IPCop"）：
- en: '[PRE0]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: At this point, you can work as if you were logged into the machine. On the Windows
    platform, an excellent free SSH client exists called **PuTTY**, whilst Linux and
    recent Unix platforms such as OS X almost universally have a command-line SSH
    client installed. In OS X this is accessible via `Terminal.app`, while konsole,
    gnome-terminal, rxvt, or any other Linux terminal emulator may be used in any
    recent Linux desktop to use SSH.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一点上，您可以像登录到机器一样工作。在Windows平台上，有一个名为**PuTTY**的优秀免费SSH客户端，而Linux和最近的Unix平台（如OS
    X）几乎普遍安装了命令行SSH客户端。在OS X中，可以通过`Terminal.app`访问，而在任何最近的Linux桌面中都可以使用konsole、gnome-terminal、rxvt或任何其他Linux终端仿真器来使用SSH。
- en: Note
  id: totrans-36
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '**Download PuTTY**'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: '**下载PuTTY**'
- en: Download PuTTY from [http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html](http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html)
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 从[http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html](http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html)下载PuTTY
- en: 'To use PuTTY, launch the `putty.exe` file downloaded from the above URL. This
    should pop up a box similar to the one shown in the following figure:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用PuTTY，请启动从上述网址下载的`putty.exe`文件。这应该会弹出一个类似于以下图示的框：
- en: '![Connecting to SSH](img/1361_05_04.jpg)'
  id: totrans-40
  prefs: []
  type: TYPE_IMG
  zh: '![连接到SSH](img/1361_05_04.jpg)'
- en: To connect to an IPCop host, enter the hostname or IP address of the host into
    the **Host Name** box, and the port number **222** into the **Port** box. You
    can save these settings by entering a profile name into the **Saved Sessions**
    textbox and clicking **Save**; the next time you open PuTTY, there will be an
    entry listed in the multi-list box, which presently only says **Default Settings**,
    with the name you entered into the **Saved Sessions** box. You can simply double-click
    this entry to connect. Use the username **root** and the password you set during
    the installation to connect, and you should have a prompt very similar to the
    one listed previously on a Linux system.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 要连接到IPCop主机，请将主机名或IP地址输入**主机名**框中，并将端口号**222**输入**端口**框中。您可以通过在**已保存的会话**文本框中输入配置文件名称并单击**保存**来保存这些设置；下次打开PuTTY时，将在多列表框中列出一个条目，目前只显示**默认设置**，其中包含您在**已保存的会话**框中输入的名称。您只需双击此条目即可连接。使用用户名**root**和安装过程中设置的密码进行连接，然后您应该会得到一个与之前在Linux系统上列出的非常相似的提示。
- en: A Little More about SSH
  id: totrans-42
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 关于SSH的更多信息
- en: SSH itself is a mature protocol in very wide deployment, and as such poses a
    minimal (and well understood) security risk. It is designed and maintained by
    the OpenSSH team, well known for OpenBSD, which has a reputation as one of the
    most secure operating systems in the world. As such, if you do not have a requirement
    for the form of richer VPN connectivity that the VPN functionality in IPCop can
    provide, SSH offers a lower profile alternative (and peace of mind).
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: SSH本身是一个成熟的协议，在非常广泛的部署中，并因此构成了最小（并且被充分理解的）安全风险。它由OpenSSH团队设计和维护，以OpenBSD而闻名，后者被认为是世界上最安全的操作系统之一。因此，如果您不需要IPCop中VPN功能提供的更丰富的VPN连接形式，SSH提供了一个更低调的选择（和安心）。
- en: SSH also provides us with several other powerful tools—the SSH protocol includes
    functionality that allows network connections to be tunneled over SSH (**TCP forwarding**).
    By enabling this option on our IPCop firewall and exposing SSH to the outside
    world, we have a very lightweight, platform-independent way to access internal
    network resources, and/or the IPCop configuration page without the overhead or
    complexity of a VPN.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: SSH还为我们提供了其他几个强大的工具——SSH协议包括允许通过SSH进行网络连接隧道化的功能（**TCP转发**）。通过在我们的IPCop防火墙上启用此选项并将SSH暴露给外部世界，我们可以以非常轻量级、平台无关的方式访问内部网络资源和/或IPCop配置页面，而无需VPN的开销或复杂性。
- en: This might, for instance, be a great way to access a customer's machine internally
    while it sits behind an IPCop firewall, or to simply access the IPCop web interface
    without exposing the web server to the Internet.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，这可能是在IPCop防火墙后面内部访问客户机器的一个很好的方式，或者只是访问IPCop Web界面而不将Web服务器暴露给互联网。
- en: Note
  id: totrans-46
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '**Using SSH to Tunnel Network Traffic**'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: '**使用SSH进行网络流量隧道**'
- en: 'Briefly, there are several ways to use SSH via our IPCop firewall in order
    to tunnel network traffic. With TCP forwarding enabled, we can use Dynamic port
    forwarding to send connections through the SSH session via a proxy server. Using
    the command-line version of SSH, we do this using a command similar to the following:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 简而言之，有几种方法可以通过我们的IPCop防火墙使用SSH来隧道网络流量。启用TCP转发后，我们可以使用动态端口转发通过代理服务器通过SSH会话发送连接。使用SSH的命令行版本，我们可以使用类似以下的命令：
- en: '[PRE1]'
  id: totrans-49
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: As long as we leave this `SSH` connection open (and we can use it as an ordinary
    SSH connection), our local machine (i.e. the system we initiated the connection
    on) will have a proxy server running on the loopback interface (i.e. listening
    only on the address 127.0.0.1) and on port 1234\. We can then use any proxy-aware
    application to connect to any host that the IPCop host can connect to. This can
    be a poor man's VPN, used to access websites privately on a public internet connection,
    or as mentioned above, we can use it to access the web interface on the IPCop
    host or internal network resources.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 只要我们保持这个`SSH`连接打开（并且我们可以像普通的SSH连接一样使用它），我们的本地机器（即我们启动连接的系统）将在回环接口上运行一个代理服务器（即仅在地址127.0.0.1上监听）和端口1234。然后，我们可以使用任何支持代理的应用程序连接到IPCop主机可以连接到的任何主机。这可以是一个穷人的VPN，用于在公共互联网连接上私下访问网站，或者如上所述，我们可以使用它来访问IPCop主机或内部网络资源上的Web界面。
- en: The SSH man page is extremely comprehensive—`man ssh` on any Linux/Unix system
    (apart from IPCop) or a Google search for "man ssh" will provide a comprehensive
    listing of the other options available with the `ssh` command. PuTTY also supports
    similar options (including dynamic port forwarding in the same manner) via the
    GUI.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: SSH man页面非常全面——在任何Linux/Unix系统（除IPCop外）上使用`man ssh`，或者在Google上搜索"man ssh"，都会提供`ssh`命令的其他可用选项的全面列表。PuTTY也通过GUI支持类似的选项（包括以相同方式进行动态端口转发）。
- en: '![A Little More about SSH](img/1361_05_05.jpg)'
  id: totrans-52
  prefs: []
  type: TYPE_IMG
  zh: '![关于SSH的更多信息](img/1361_05_05.jpg)'
- en: Enter the port you wish to use on the client for proxying connections into the
    **Source port** box, pick **Dynamic**, hit **Add**, and then connect as normal.
    Once this has been configured for a specific connection, this setting will be
    saved along with the hostname and port number if you choose to save your profile
    in PuTTY.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 在**源端口**框中输入您希望在客户端上用于代理连接的端口，选择**动态**，点击**添加**，然后像平常一样连接。一旦为特定连接配置了这个设置，如果选择在PuTTY中保存配置文件，这个设置将与主机名和端口号一起保存。
- en: Note
  id: totrans-54
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '**SSH and TCP Forwarding**'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: '**SSH和TCP转发**'
- en: '[http://www.securityfocus.com/infocus/1816](http://www.securityfocus.com/infocus/1816)
    is an excellent security focus article written by Brian Hatch in 2005 about SSH''s
    capabilities in this area. It is complex, but well worth reading if you are even
    remotely interested in this topic.'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: '[http://www.securityfocus.com/infocus/1816](http://www.securityfocus.com/infocus/1816)是Brian
    Hatch于2005年撰写的关于SSH在这一领域的能力的一篇优秀的安全焦点文章。这很复杂，但如果您对这个主题有丝毫兴趣，那么阅读起来是非常值得的。'
- en: The **SSH Access** page also lets us view the SSH keys. Use of these is strongly
    encouraged—but beyond the scope of this book. Again, the SSH documentation (and
    the SSH man pages) is strongly encouraged as a good source of information on this.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: '**SSH访问**页面还允许我们查看SSH密钥。强烈建议使用这些——但超出了本书的范围。同样，SSH文档（和SSH man页面）强烈建议作为了解这一点的良好信息来源。'
- en: GUI Settings
  id: totrans-58
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: GUI设置
- en: 'The **GUI Settings** menu is shown in the following image:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: '**GUI设置**菜单显示在以下图片中：'
- en: '![GUI Settings](img/1361_05_06.jpg)'
  id: totrans-60
  prefs: []
  type: TYPE_IMG
  zh: '![GUI设置](img/1361_05_06.jpg)'
- en: The only option that we might want to seriously look at (and which isn't immediately
    obvious) is the **Enable Javascript** option, which we might want to disable if
    we are connecting to IPCop with older (or text-mode) clients.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可能要认真看一下的唯一选项（并且不是立即明显的）是**启用Javascript**选项，如果我们使用较旧（或文本模式）的客户端连接到IPCop，我们可能需要禁用它。
- en: Backup
  id: totrans-62
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 备份
- en: We can use the **Backup menu** in IPCop to back up our settings to a floppy
    disk or to a file accessible via the network. Apart from being useful for disaster
    recovery purposes, this also forms an important part of the upgrade procedure
    between major version increments where an in-place upgrade is not always possible
    (and the firewall must be reinstalled and the configuration restored).
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用IPCop中的**备份菜单**将设置备份到软盘或通过网络访问的文件中。除了用于灾难恢复目的，这也是升级主要版本增量之间的重要部分，其中不总是可能进行就地升级（必须重新安装防火墙并恢复配置）。
- en: '![Backup](img/1361_05_07.jpg)'
  id: totrans-64
  prefs: []
  type: TYPE_IMG
  zh: '![备份](img/1361_05_07.jpg)'
- en: The **Backup Configuration:** option at the top allows us to create backups
    on the IPCop host itself—hitting the **Create** button allows us to create a backup
    that is listed under **Backup Sets**.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 顶部的**备份配置：**选项允许我们在IPCop主机上创建备份——点击**创建**按钮允许我们创建一个列在**备份集**下的备份。
- en: Note
  id: totrans-66
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '**Backup Encryption**'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: '**备份加密**'
- en: As of version IPCop 1.4.0, backup functionality with encryption written by Tim
    Butterfield is included in IPCop. When IPCop makes encrypted backups, it does
    so using a random key stored on the machine itself, required to restore the backup.
    If your backups are encrypted, you will require a copy of the key to restore the
    backup.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 从IPCop 1.4.0版本开始，IPCop包括了由Tim Butterfield编写的带加密功能的备份。当IPCop进行加密备份时，它会使用存储在机器本身上的随机密钥来进行，恢复备份时需要该密钥。如果您的备份是加密的，您将需要一个密钥的副本来恢复备份。
- en: 'For more information on how this works, see the author''s original page on
    the backup add-on prior to integration into the main body of IPCop code:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 有关这是如何工作的更多信息，请参阅作者在将备份附加组件集成到IPCop代码主体之前的原始页面：
- en: '[http://www.timbutterfield.com/computer/ipcop/backup.php](http://www.timbutterfield.com/computer/ipcop/backup.php)'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: '[http://www.timbutterfield.com/computer/ipcop/backup.php](http://www.timbutterfield.com/computer/ipcop/backup.php)'
- en: '![Backup](img/1361_05_08.jpg)'
  id: totrans-71
  prefs: []
  type: TYPE_IMG
  zh: '![备份](img/1361_05_08.jpg)'
- en: By picking the backup in question and clicking on **Select**, we can download
    the appropriate backups and save them for archiving on another machine, or to
    a CD, tape, etc. As there is limited space on many IPCop firewalls, this allows
    the maintenance of a comprehensive backup set in a manner that does not compromise
    operational efficiency (and in a manner which is more disaster-tolerant than simply
    storing the backups on the same host). As firewall configuration tends to remain
    relatively static, a backup regimen for an IPCop host may not need to be frequent,
    but for obvious reasons, a regular backup schedule (or a procedure for backing
    up after each significant change) is strongly recommended.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 通过选择相关的备份并点击“选择”，我们可以下载适当的备份并将其保存在另一台机器上进行归档，或者保存到CD、磁带等。由于许多IPCop防火墙的空间有限，这允许以不影响操作效率的方式维护全面的备份集（并且比仅在同一主机上存储备份更具有容灾能力）。由于防火墙配置往往相对静态，IPCop主机的备份计划可能不需要频繁，但出于明显的原因，强烈建议定期备份计划（或在每次重大更改后备份的程序）。
- en: Shutdown
  id: totrans-73
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 关机
- en: The **Shutdown:** menu is relatively straightforward, allowing a manual restart
    or shutdown of the IPCop host, and also allowing us to schedule a periodic restart
    of the host.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 关机菜单相对简单，允许手动重新启动或关闭IPCop主机，并允许我们安排主机定期重新启动。
- en: '![Shutdown](img/1361_05_09.jpg)'
  id: totrans-75
  prefs: []
  type: TYPE_IMG
  zh: '![关机](img/1361_05_09.jpg)'
- en: Checking the Status of Our IPCop Firewall
  id: totrans-76
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 检查我们的IPCop防火墙的状态
- en: Part of our management procedures should include monitoring of the IPCop firewall
    in order to ensure that CPU load, memory usage, network throughput, etc., maintain
    healthy levels. It is an extremely important role of the system administrator
    to establish a **baseline** for his or her systems in order to be able to identify
    abnormalities—many intrusions and hardware failures are first noticed by a drop
    (or rise) in network activity or CPU load.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的管理程序的一部分应该包括监视IPCop防火墙，以确保CPU负载、内存使用、网络吞吐量等保持健康水平。系统管理员的一个极其重要的角色是为他或她的系统建立一个基线，以便能够识别异常
    - 许多入侵和硬件故障首先是通过网络活动的下降（或上升）或CPU负载来注意到的。
- en: '![Checking the Status of Our IPCop Firewall](img/1361_05_10.jpg)'
  id: totrans-78
  prefs: []
  type: TYPE_IMG
  zh: '![检查我们的IPCop防火墙的状态](img/1361_05_10.jpg)'
- en: The basic status screen allows us to view a number of basic system statistics
    before we inspect more detailed graphs of the statistics for the lifetime of the
    firewall. Services running on the IPCop box obviously have a serious impact on
    the ability of the box to do its job, and as a quick indicator the **Services:**
    display is useful in the event that the firewall ceases to function properly in
    order to ensure that the firewall thinks that the right services are running.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 基本状态屏幕允许我们在检查防火墙的生命周期统计数据之前查看一些基本系统统计数据。在IPCop盒上运行的服务显然会严重影响盒子执行其工作的能力，作为一个快速指示器，服务显示在防火墙停止正常运行时是有用的，以确保防火墙认为正确的服务正在运行。
- en: Many of the services, such as **Secure shell server** and the **Web proxy**,
    are not running by default—the previous image illustrates the default settings
    with the addition of the SSH server (which we enabled earlier in the chapter).
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 许多服务，如安全外壳服务器和Web代理，默认情况下未运行 - 前一图像说明了默认设置，并添加了SSH服务器（我们在本章前面启用了）。
- en: '![Checking the Status of Our IPCop Firewall](img/1361_05_11.jpg)'
  id: totrans-81
  prefs: []
  type: TYPE_IMG
  zh: '![检查我们的IPCop防火墙的状态](img/1361_05_11.jpg)'
- en: '**Memory:** is fairly self-evident. Performance issues, particularly in a host
    that is a web proxy for larger networks—may be caused by inadequate memory. Although
    not always an indicator of memory issues, particularly if a host is under heavy
    load and in use by some of the more intensive functionality IPCop provides (such
    as the proxy server), the **Swap** indicator is worth understanding. **Swapping**
    is the process by which memory allocated to processes is moved to the hard drive,
    rather than being stored in the system''s **Random Access Memory**. This effectively
    allows the system to operate with more physical memory than the host has, at the
    cost of speed when the swapping operation is performed; accessing data on the
    hard disk for a program whose memory has been *swapped out* is significantly slower
    than accessing it from *real* memory.'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 内存是相当明显的。性能问题，特别是在作为较大网络的Web代理的主机中可能是由于内存不足引起的。虽然不总是内存问题的指标，特别是如果主机负载过重并且使用了IPCop提供的一些更密集的功能（如代理服务器），但是值得了解交换指示器。交换是将分配给进程的内存移动到硬盘上的过程，而不是存储在系统的随机存取内存中。这实际上允许系统使用比主机实际拥有的更多物理内存，但在执行交换操作时会降低速度；访问已经被交换出的程序的数据的硬盘上的速度比从真实内存中访问要慢得多。
- en: It is important to note that due to the way in which Linux allocates and manages
    memory, the percentage of used memory (on the top line) does *not* represent the
    amount of memory that is immutably in use—the Linux kernel caches frequently accessed
    files in a **disk cache** in memory to improve performance, which accounts for
    some of the memory usage. It is often more sane to view the memory without **buffers/cache**
    (the second indicator) for a better indication of how much memory is actually
    *available*. This is a prettier, graphed version of the output from the `free`
    command.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 重要的是要注意，由于Linux分配和管理内存的方式，已使用内存的百分比（顶部行）*不*代表不可变地使用的内存量 - Linux内核将频繁访问的文件缓存到内存中的磁盘缓存中以提高性能，这解释了一些内存使用情况。通常更明智的做法是查看没有缓冲/缓存的内存（第二个指示器），以更好地指示实际*可用*内存量。这是`free`命令的输出的更美观、图形化版本。
- en: '![Checking the Status of Our IPCop Firewall](img/1361_05_12.jpg)'
  id: totrans-84
  prefs: []
  type: TYPE_IMG
  zh: '![检查我们的IPCop防火墙的状态](img/1361_05_12.jpg)'
- en: '**Disk usage:** for your IPCop system should also be relatively self-evident.
    The **/boot** partition is used to store the Operating System kernel and configuration
    information (since this is managed as part of the software update process, the
    usage isn''t critical even at high levels). The largest partition, used for the
    only thing that really grows, is mounted to **/var/log**, and as the name indicates,
    is used for storing log files.'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: IPCop系统的**磁盘使用情况**也应该相对不言而喻。**/boot**分区用于存储操作系统内核和配置信息（由于这是作为软件更新过程的一部分进行管理，即使在高水平下使用也不是关键）。用于唯一真正增长的东西的最大分区被挂载到**/var/log**，正如名称所示，用于存储日志文件。
- en: '![Checking the Status of Our IPCop Firewall](img/1361_05_13.jpg)'
  id: totrans-86
  prefs: []
  type: TYPE_IMG
  zh: '![检查我们的IPCop防火墙的状态](img/1361_05_13.jpg)'
- en: '**Uptime and users:** Uptime is self-evident. Users might not be; since this
    is (literally) the output from the `w` command, **users** refers to users logged
    into the Linux host itself, via an interactive session on the console or SSH.
    This should not be taken to mean that no one is *using* IPCop as a firewall, proxy
    server, or logged in via the web interface.'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: '**运行时间和用户：** 运行时间是不言而喻的。用户可能不是；因为这是（字面上）`w`命令的输出，**用户**指的是通过控制台或SSH登录到Linux主机本身的用户。这不应被理解为没有人*使用*IPCop作为防火墙、代理服务器或通过Web界面登录。'
- en: Load in this context is, in accordance with the `w` command, *Unix* load. The
    three numbers that are listed represent load for the last 1, 5, and 15 minutes
    respectively. The number represents the number of processes using or waiting for
    CPU time, or in an uninterruptible sleep. Each such process adds 1 to the load
    number, and the number you see is an average of this for the period in question.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，负载是根据`w`命令的*Unix*负载。列出的三个数字分别代表过去1、5和15分钟的负载。该数字代表正在使用或等待CPU时间的进程数量，或处于不可中断的睡眠状态。每个这样的进程都会使负载数字加1，您看到的数字是该时段的平均值。
- en: Load is not always a good measure of the load of the box, and network throughput,
    specific CPU statistics, and a more fine-grained output detailing process-specific
    information is often far more useful as a diagnostic tool (rather than a rough
    indicator).
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 负载并不总是衡量系统负载的好方法，网络吞吐量、特定CPU统计信息以及更详细的输出，详细说明特定进程的信息通常更有用作为诊断工具（而不是粗略指标）。
- en: '![Checking the Status of Our IPCop Firewall](img/1361_05_14.jpg)'
  id: totrans-90
  prefs: []
  type: TYPE_IMG
  zh: '![检查我们的IPCop防火墙的状态](img/1361_05_14.jpg)'
- en: '**Loaded modules:** is another piece of operating system - specific information.
    The Linux kernel bundles pieces of functionality as loadable *modules*, which
    may be removed or just not loaded if they aren''t necessary. Each piece of functionality
    that is modular and in use will show up here; the majority of these will be loaded
    at startup time, and represent everything from device drivers for network cards
    to the modules required by iptables to perform different firewalling functions
    (some of which are displayed in the previous figure).'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: '**加载的模块：** 是另一个特定于操作系统的信息。Linux内核将功能模块捆绑为可加载的*模块*，如果不需要，可以将其移除或者不加载。每个模块化并且正在使用的功能都会显示在这里；其中大多数将在启动时加载，并代表从网络卡的设备驱动程序到iptables所需的模块，用于执行不同的防火墙功能（其中一些显示在前一个图中）。'
- en: Unless you have a specific need to understand or view which modules are in use
    (or are just curious), this is not terribly useful information. The previous figure
    is essentially the output of the `lsmod` command.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 除非您有特定的需求了解或查看正在使用哪些模块（或者只是好奇），这并不是非常有用的信息。前一个图形基本上是`lsmod`命令的输出。
- en: '![Checking the Status of Our IPCop Firewall](img/1361_05_15.jpg)'
  id: totrans-93
  prefs: []
  type: TYPE_IMG
  zh: '![检查我们的IPCop防火墙的状态](img/1361_05_15.jpg)'
- en: 'This is the output of the command `uname -a`, which displays, from left to
    right: Kernel name, Network node hostname, Kernel release, Kernel version, Machine
    hardware name, and Operating System.'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 这是命令`uname -a`的输出，从左到右显示：内核名称、网络节点主机名、内核发布版本、内核版本、机器硬件名称和操作系统。
- en: Network Status
  id: totrans-95
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 网络状态
- en: The information contained on the **Network Status** screen is frequently very
    useful in troubleshooting networking issues.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: '**网络状态**屏幕上包含的信息通常在故障排除网络问题时非常有用。'
- en: The first tool we are given is a colorized version of the output from the `ifconfig`
    command, with the network interfaces on the system being given the colors that
    IPCop uses to refer to them. Quite often when the IPCop host is attached to a
    network such as a Cable or ADSL connection that allocates configuration information
    via DHCP, this can be useful for verifying whether a loss of connectivity is related
    to the IPCop host or if there is a network outage with the service provider. Since
    we can see the number of errors and dropped packets, this can frequently be useful
    in troubleshooting other networking issues too.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 我们得到的第一个工具是`ifconfig`命令的着色版本输出，系统上的网络接口被赋予IPCop用于标识它们的颜色。当IPCop主机连接到通过DHCP分配配置信息的网络（如电缆或ADSL连接）时，这通常对于验证连接丢失是否与IPCop主机相关或服务提供商的网络中断有关是很有用的。由于我们可以看到错误和丢包的数量，这通常也对于排除其他网络问题很有用。
- en: '![Network Status](img/1361_05_16.jpg)'
  id: totrans-98
  prefs: []
  type: TYPE_IMG
  zh: '![网络状态](img/1361_05_16.jpg)'
- en: The **lo** interface represents the **Local Loopback** adapter, with the address
    of **127.0.0.1**, and should always be present. On this system, the Red interface
    is inactive, but on a fully populated IPCop system, we could see up to five interfaces
    here (Red, Green, Orange, Blue, and loopback).
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: '**lo**接口代表**本地环回**适配器，地址为**127.0.0.1**，应始终存在。在这个系统上，红色接口是不活动的，但在一个完全配置的IPCop系统上，我们可以在这里看到多达五个接口（红色、绿色、橙色、蓝色和环回）。'
- en: '![Network Status](img/1361_05_17.jpg)'
  id: totrans-100
  prefs: []
  type: TYPE_IMG
  zh: '![网络状态](img/1361_05_17.jpg)'
- en: The **Current dynamic leases** table is actually showing us the *DHCP* leases
    handed out to clients on the internal network segments. In this case we have two
    clients, one of them has not provided a hostname with the DHCP request, and the
    other (**Knoppix**) has. IPCop registers hostnames with DNS, so the host **Knoppix**
    should be addressable as **Knoppix** via IPCop's DNS server.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: '**当前动态租约**表实际上显示了分配给内部网络段上客户端的*DHCP*租约。在这种情况下，我们有两个客户端，其中一个没有在DHCP请求中提供主机名，另一个（**Knoppix**）提供了。IPCop会将主机名注册到DNS，因此主机**Knoppix**应该可以通过IPCop的DNS服务器作为**Knoppix**进行寻址。'
- en: Expired leases are scored through (struck out). The output displayed here essentially
    consists of the contents of `/var/state/dhcp/dhcpd.leases`.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 过期的租约通过（划掉）进行了评分。这里显示的输出基本上包括`/var/state/dhcp/dhcpd.leases`的内容。
- en: Apart from letting us debug DHCP, this is also a quick and useful way to get
    hold of the MAC address for specific systems, either for setting up static reservations
    or for any other purpose.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 除了让我们调试DHCP，这也是获取特定系统的MAC地址的一种快速有用的方法，无论是用于设置静态预留还是其他任何目的。
- en: '![Network Status](img/1361_05_18.jpg)'
  id: totrans-104
  prefs: []
  type: TYPE_IMG
  zh: '![网络状态](img/1361_05_18.jpg)'
- en: The routing table is used by the firewall to determine where to forward (or
    send) IP datagrams being handled by the system. A full discussion of routing is
    beyond the scope of this book, but the host routing table is an excellent first
    port of call for many networking issues, and a thorough understanding of routing
    is vital for the efficient administration of a firewall, network, or even a set
    of workstations.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 路由表由防火墙用于确定系统处理的IP数据报应该转发（或发送）到何处。关于路由的全面讨论超出了本书的范围，但主机路由表是许多网络问题的一个很好的起点，对路由的彻底理解对于有效管理防火墙、网络甚至一组工作站至关重要。
- en: '![Network Status](img/1361_05_19.jpg)'
  id: totrans-106
  prefs: []
  type: TYPE_IMG
  zh: '![网络状态](img/1361_05_19.jpg)'
- en: The ARP table consists of the current mappings between IP addresses and hardware
    (MAC) addresses on the local network segment(s). There are generally entries for
    each client on the network as well as one for the upstream router (either a Cable/ADSL
    router, or more usually the ISP's upstream router). As with many other items,
    this is extremely useful for some aspects of network troubleshooting, but beyond
    the scope of this book.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: ARP表包括本地网络段上IP地址和硬件（MAC）地址之间的当前映射。通常每个网络上的客户端都有条目，以及上游路由器的一个条目（通常是电缆/ADSL路由器，或更通常是ISP的上游路由器）。与许多其他项目一样，这对于某些网络故障排除非常有用，但超出了本书的范围。
- en: System Graphs
  id: totrans-108
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 系统图表
- en: IPCop uses a package called **rrdtool** ([http://oss.oetiker.ch/rrdtool/](http://oss.oetiker.ch/rrdtool/))
    to maintain a set of graphs of a number of statistics pertaining to the system
    and network activity. These are automatically set up when the system is installed,
    and statistics we have access to under the **System Graphs** menu are **CPU Usage,
    Memory Usage, Swap Usage**, and **Disk Access**.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: IPCop使用一个名为**rrdtool**的软件包（[http://oss.oetiker.ch/rrdtool/](http://oss.oetiker.ch/rrdtool/)）来维护一组与系统和网络活动相关的统计数据图表。这些在系统安装时会自动设置，我们在**系统图表**菜单下可以访问的统计数据包括**CPU使用率、内存使用率、交换使用率**和**磁盘访问**。
- en: '![System Graphs](img/1361_05_20.jpg)'
  id: totrans-110
  prefs: []
  type: TYPE_IMG
  zh: '![系统图表](img/1361_05_20.jpg)'
- en: The previous figure is an example of such a graph (for CPU usage). Clicking
    on a specific graph drills down on that particular statistic, giving you graphs
    detailing that metric for the last day, week, month, and year.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的图表是这种图表的一个示例（用于CPU使用率）。点击特定图表会深入到该特定统计数据，为您提供上一天、上一周、上一月和上一年的该指标的图表。
- en: You should note that due to **UTF** issues with rrdtool (which prevents the
    use of special characters), IPCop is currently constrained to generating these
    graphs in English only.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 您应该注意，由于rrdtool的UTF问题（这会阻止使用特殊字符），IPCop目前受到限制，只能以英语生成这些图表。
- en: Network Graphs
  id: totrans-113
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 网络图表
- en: IPCop also maintains graphs of network traffic across the interfaces in the
    system. These work in an identical manner to **System Graphs**.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: IPCop还维护系统中各接口上的网络流量图表。这些与**系统图表**的工作方式完全相同。
- en: '![Network Graphs](img/1361_05_21.jpg)'
  id: totrans-115
  prefs: []
  type: TYPE_IMG
  zh: '![网络图表](img/1361_05_21.jpg)'
- en: Connections
  id: totrans-116
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 连接
- en: The **Connections** feature displays a colorized output detailing all of the
    connections presently made through the IPCop firewall. Clicking on an IP Address
    in this screen performs a **reverse DNS lookup** on the address, giving you the
    hostname associated with the address if reverse DNS is configured (i.e. if the
    address has a **PTR** record).
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: '**连接**功能显示了通过IPCop防火墙当前进行的所有连接的彩色输出。在此屏幕上点击IP地址会对该地址执行**反向DNS查找**，如果配置了反向DNS（即地址有**PTR**记录），则会给出与地址相关的主机名。'
- en: Services
  id: totrans-118
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 服务
- en: Although IPCop is a firewall package, it contains many pieces of functionality
    that are outside the scope of a plain firewall. DNS and DHCP functionality, for
    instance, are normally served by separate hosts. IPCop, designed for smaller deployments
    in which half a dozen different servers (router, firewall, DHCP server, DNS server,
    Proxy server, IDS, etc.) are simply not feasible, bundles all of this functionality
    together.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然IPCop是一个防火墙软件包，但它包含许多功能，超出了普通防火墙的范围。例如，DNS和DHCP功能通常由单独的主机提供。IPCop专为较小的部署设计，其中半打不同的服务器（路由器、防火墙、DHCP服务器、DNS服务器、代理服务器、入侵检测系统等）根本不可行，它将所有这些功能捆绑在一起。
- en: The **Services** tab is where we can configure many of the features in IPCop
    that are separate elements, and require more complex setup. Some of these are
    covered in their own chapter; others, which are almost always deployed with IPCop
    (such as DNS and DHCP), will be covered here.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: '**服务**选项卡是我们可以配置IPCop中许多独立元素并需要更复杂设置的功能的地方。其中一些在它们自己的章节中介绍；其他几乎总是与IPCop一起部署的功能（如DNS和DHCP）将在此介绍。'
- en: DHCP Server
  id: totrans-121
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DHCP服务器
- en: The top of the **DHCP Server** page allows us to reconfigure some of the options
    we set up when we installed IPCop (such as the start and end address and lease
    time). Others, such as options for **WINS** servers and the option for **Additional
    DHCP Options**, can now be added to our configuration.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: '**DHCP服务器**页面的顶部允许我们重新配置安装IPCop时设置的一些选项（如起始和结束地址和租约时间）。其他选项，如**WINS**服务器和**附加的DHCP选项**，现在可以添加到我们的配置中。'
- en: '![DHCP Server](img/1361_05_22.jpg)'
  id: totrans-123
  prefs: []
  type: TYPE_IMG
  zh: '![DHCP服务器](img/1361_05_22.jpg)'
- en: If you do not understand DHCP, you probably have no need to reconfigure this
    (if your IPCop box is functioning as expected). You would, however, be well advised
    to understand DHCP (and the various flaws that it has).
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您不了解DHCP，那么您可能不需要重新配置它（如果您的IPCop盒子正常运行）。但是，您最好了解DHCP（以及它存在的各种缺陷）。
- en: Further down the page, we can configure **fixed leases**. Fixed leases (sometimes
    referred to as reservations) allow you to configure the DHCP server to respond
    with a specific IP address (rather than a random address from the pool) for a
    host matching a certain MAC address. The benefit of this is that you can have
    the power that centrally managing your IP configuration gives you while having
    the ability to reliably make connections to hosts by IP address rather than relying
    on DNS.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 在页面的下方，我们可以配置**固定租约**。固定租约（有时称为保留）允许您配置DHCP服务器，以便为与特定MAC地址匹配的主机响应特定的IP地址（而不是从池中随机选择的地址）。这样做的好处是，您可以在集中管理IP配置的同时，通过IP地址可靠地连接到主机，而不是依赖DNS。
- en: '![DHCP Server](img/1361_05_23.jpg)'
  id: totrans-126
  prefs: []
  type: TYPE_IMG
  zh: '![DHCP服务器](img/1361_05_23.jpg)'
- en: For some devices, such as network printers or IP cameras, that frequently do
    not handle dynamic DNS (or use an unfriendly and often unchangeable hostname),
    this is godsend if you don't want to manually set IP addresses statically on every
    networked device on your network.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 对于一些设备，如网络打印机或IP摄像头，通常不处理动态DNS（或使用不友好且经常不可更改的主机名），如果您不想在网络上的每个设备上手动设置IP地址，这是一个福音。
- en: Below this, we can (again) see the **Current dynamic leases**. This is a useful
    inclusion, if we have just attached a DHCP-capable device to our network but want
    to allocate it a specific address; we can copy the MAC address, create a fixed
    lease for it, and restart the device—at which point it should reacquire the correct
    (static) address.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 在此之下，我们可以（再次）看到**当前动态租约**。如果我们刚刚将一个支持DHCP的设备连接到我们的网络，但想要为其分配一个特定的地址，这是一个有用的功能；我们可以复制MAC地址，为其创建一个固定租约，并重新启动设备，此时它应该重新获取正确的（静态）地址。
- en: The **Root Path** and **Filename** options, which may be unfamiliar to many
    network administrators or IT Professionals, are used for configuring systems booting
    from the network and reading files via **NFS**. In the vast majority of deployments
    (as the page indicates), it is safe to ignore them
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: '**根路径**和**文件名**选项对许多网络管理员或IT专业人员来说可能不熟悉，用于配置从网络引导系统和通过**NFS**读取文件。在绝大多数部署中（如页面所示），可以安全地忽略它们。'
- en: Dynamic DNS
  id: totrans-130
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 动态DNS
- en: Many internet connections in smaller businesses or at home use dynamically assigned
    IP addresses, via protocols such as PPP or DHCP, from a pool owned by the ISP.
    This enables the ISP to minimize the number of IP addresses it requires (as theoretically,
    it only needs as many IP addresses as the maximum number of clients online at
    any given time) and makes centralized configuration easier.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 许多较小企业或家庭中的互联网连接使用动态分配的IP地址，通过PPP或DHCP等协议，从ISP拥有的地址池中分配。这使得ISP可以最小化所需的IP地址数量（理论上，它只需要与任何给定时间在线的最大客户端数量一样多的IP地址），并且使得集中配置更容易。
- en: As a client's IP address will typically change session-for-session, as is the
    case with dial-up, or at indeterminate intervals, as is the case with ADSL or
    Cable clients, incoming connections are a problem. There is no way to get a client
    to VPN into the IPCop server, or deliver mail to the site the IPCop host exists
    on, if the IP address is constantly changing.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 由于客户端的IP地址通常会话对话地更改，如拨号连接的情况，或者在不确定的时间间隔内更改，如ADSL或Cable客户端的情况，传入连接是一个问题。如果IP地址不断变化，就无法让客户端VPN到IPCop服务器，或者将邮件传递到IPCop主机所在的站点。
- en: Dynamic DNS Providers solve this problem. By using an agent on the client machine
    that constantly updates a server on the Internet, the Dynamic DNS Provider can
    update a DNS name (such as youripcopserver.afraid.org) with the current IP address,
    so that as long as the IPCop host remains online, clients can always connect to
    it via the same DNS name.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 动态DNS提供商解决了这个问题。通过在客户机上使用一个代理，不断更新互联网上的服务器，动态DNS提供商可以更新DNS名称（例如youripcopserver.afraid.org）与当前IP地址，这样只要IPCop主机保持在线，客户端就可以始终通过相同的DNS名称连接到它。
- en: IPCop has support for an extensive list of Dynamic DNS Providers, most of which
    are free. Afraid.org ([http://freedns.afraid.org/](http://freedns.afraid.org/))
    is an excellent choice, and has a reliable and well-setup service. All of the
    dynamic DNS providers work in fundamentally the same way—you register an account
    via the provider's website, and then provide IPCop with the details such that
    it can register itself. At this point (and given a minute or two for everything
    to start working) the hostname you registered for should resolve to your IPCop's
    Red IP address. Generally speaking, this is very simple and straightforward.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: IPCop支持广泛的动态DNS提供商列表，其中大多数是免费的。Afraid.org（[http://freedns.afraid.org/](http://freedns.afraid.org/)）是一个很好的选择，具有可靠和良好设置的服务。所有动态DNS提供商的工作原理基本相同——您通过提供商的网站注册一个帐户，然后提供IPCop所需的详细信息，以便它可以注册自己。此时（并给一两分钟让一切开始运作），您注册的主机名应该解析为IPCop的红色IP地址。一般来说，这非常简单和直接。
- en: If you want to test this externally but do not have an external host to do it
    from, there are several online DNS testing services such as [www.dnsstuff.com](http://www.dnsstuff.com)
    that you can use in order to look up the **A** record for your domain in order
    to see if it resolves to the right IP address.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您想在外部进行此测试，但没有外部主机可以进行测试，有几个在线DNS测试服务，如[www.dnsstuff.com](http://www.dnsstuff.com)，您可以使用它们来查找您域名的**A**记录，以查看它是否解析为正确的IP地址。
- en: '![Dynamic DNS](img/1361_05_24.jpg)'
  id: totrans-136
  prefs: []
  type: TYPE_IMG
  zh: '![动态DNS](img/1361_05_24.jpg)'
- en: Generally speaking, the **The classical RED IP used by IPCop during connection**
    option, which is checked by default will be the most appropriate option for you.
    If your IPCop router is behind another router, you will experience problems in
    actually connecting to the IPCop box via the Internet, and even more problems
    in connecting to internal services, as your traffic will effectively be undergoing
    Network Address Translation twice. The recommended solution if (as the page suggests)
    you are behind another NAT router is to remove that other NAT router and plug
    the IPCop Red interface directly into your internet connection if you're able
    to do so.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 一般来说，默认情况下选中的**在连接期间IPCop使用的经典RED IP**选项将是最适合您的选项。如果您的IPCop路由器位于另一台路由器后面，实际上连接到IPCop盒子通过互联网会遇到问题，甚至在连接到内部服务时也会遇到更多问题，因为您的流量实际上会经历两次网络地址转换。如果您能够这样做，建议的解决方案（如页面所建议的）是删除其他NAT路由器，并将IPCop红色接口直接插入您的互联网连接。
- en: Note
  id: totrans-138
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '**Configuring Port Forwarding**'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: '**配置端口转发**'
- en: Note that in order to be able to connect to your IPCop host (or any resources
    behind it) you will have to configure port forwards to internal services in addition
    to being able to resolve the IP address of your IPCop host from the Internet.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，为了能够连接到您的IPCop主机（或其后面的任何资源），您将不得不配置端口转发到内部服务，以及能够从互联网解析您IPCop主机的IP地址。
- en: Some routers for which this is not possible (such as Ethernet ADSL modems) will
    allow you to enable a bridged mode instead of performing NAT themselves. ADSL
    Routers using Conexant chipsets (among others) have a half-bridge feature that
    passes along the IP address received from the ADSL provider to the first computer
    plugged into the router's Ethernet port(s) via DHCP. This is a hack, but a useful
    one, as it allows one host to be directly connected to the Internet without the
    need for complex setups.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 一些路由器不允许这样做（例如以太网ADSL调制解调器），它们将允许您启用桥接模式，而不是执行NAT。使用Conexant芯片组（等等）的ADSL路由器具有半桥特性，通过DHCP将从ADSL提供商接收的IP地址传递给通过电缆/DSL调制解调器的第一台计算机的路由器以太网端口。这是一个技巧，但是一个有用的技巧，因为它允许一个主机直接连接到互联网，而无需复杂的设置。
- en: You should consult your manufacturer's documentation or support service for
    information on setting this up, as this is a fairly complex topic that varies
    greatly from router to router.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 您应该咨询制造商的文档或支持服务，以获取有关设置的信息，因为这是一个非常复杂的主题，因各个路由器而异。
- en: Note
  id: totrans-143
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '**Dynamic DNS**'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: '**动态DNS**'
- en: Note that the phrase **Dynamic DNS** refers to two things within the context
    of this book. One, mentioned here, refers to the IP address of the IPCop host
    being registered with a provider on the Internet in order that the clients on
    the Internet can find the IPCop host via a predictable hostname (such as *youripcopbox.afraid.org)*
    even when the IP address changes.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，在本书的上下文中，短语**动态DNS**指的是两件事。其中一种是在此提到的，指的是将IPCop主机的IP地址注册到互联网上的提供商，以便互联网上的客户可以通过可预测的主机名（例如*youripcopbox.afraid.org*）找到IPCop主机，即使IP地址发生变化。
- en: The second, mentioned elsewhere, refers to the process by which clients in the
    IPCop Green network register *their* hostnames with the IPCop DNS Service in order
    that other machines on the IPCop internal segments can resolve their IP addresses
    from their hostnames. This second service is strictly internal and has no direct
    bearing on the outside world.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 另一种是在其他地方提到的，指的是IPCop Green网络中的客户端向IPCop DNS服务注册*它们的*主机名，以便IPCop内部段上的其他计算机可以从它们的主机名解析其IP地址。这第二个服务严格来说是内部的，与外部世界没有直接关系。
- en: Edit Hosts
  id: totrans-147
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 编辑主机
- en: The hosts file, present in Linux/Unix as `/etc/hosts` and in Windows as `%SystemRoot%\System32\Drivers\Hosts`,
    provides a means to manually set hostname-IP address relationships without the
    need for DNS. This can be useful for testing purposes, as a backup to DNS, or
    in environments with no DNS. In the event that you needed to force IPCop to resolve
    a particular hostname to a specific IP address, you could do so here without the
    need for a complex DNS configuration. This is something that you should not play
    with unless you have a good understanding of what it does.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 主机文件在Linux/Unix中为`/etc/hosts`，在Windows中为`%SystemRoot%\System32\Drivers\Hosts`，提供了一种手动设置主机名-IP地址关系的方法，而无需使用DNS。这对于测试目的、作为DNS的备份或在没有DNS的环境中可能很有用。如果您需要强制IPCop将特定主机名解析为特定IP地址，您可以在这里这样做，而无需复杂的DNS配置。这是一件事，除非您对其功能有很好的理解，否则不应该随意更改。
- en: Time Server
  id: totrans-149
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 时间服务器
- en: '**NTP** is a protocol designed to synchronize time from the Internet. Very
    simply, your IPCop host connects to a Stratum 2 NTP server and ascertains the
    time; this Stratum 2 NTP server itself connects to a Stratum 1 server (or more
    than one) in order to maintain its time source to an acceptable level of accuracy.'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: '**NTP**是一种旨在从互联网同步时间的协议。非常简单地说，您的IPCop主机连接到一个Stratum 2 NTP服务器，并确定时间；这个Stratum
    2 NTP服务器本身连接到一个Stratum 1服务器（或多个服务器），以便将其时间源维持在可接受的精度水平。'
- en: The Stratum 1 server(s) maintain their time against an external time source
    such as a GPS clock, or radio receiver. This divide is maintained in order to
    reduce the load on the Stratum 1 servers, which would otherwise be unable to cope
    with the number of clients. It is considered as a bad practice to synchronize
    your server to a Stratum 1 NTP source unless you have a large (numbered in the
    thousands) network. You should also try to pick a Stratum 2 server (or pool) that
    is as close to you as possible, because the closer the server is, the more accurately
    your system will be able to set its clock.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: Stratum 1服务器根据外部时间源（如GPS时钟或无线电接收器）维护其时间。保持这种分工是为了减轻Stratum 1服务器的负载，否则它们将无法应对客户端的数量。将服务器同步到Stratum
    1 NTP源被认为是一种不良做法，除非您有一个庞大的（以千计计数）网络。您还应尽量选择一个距离您尽可能近的Stratum 2服务器（或池），因为服务器越接近，系统就能越准确地设置其时钟。
- en: Accurate time is extremely important for networked devices and in particular
    for firewalls, as being able to accurately discern the order in which logged events
    (such as intrusions) occurred is often crucial for maintaining a functional infrastructure
    and investigating (and prosecuting) intruders.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 准确的时间对于网络设备非常重要，特别是对于防火墙，因为能够准确辨别记录事件（如入侵）发生的顺序通常对于维护功能性基础设施和调查（和起诉）入侵者至关重要。
- en: NTP generally maintains an accuracy level of between 5-15 milliseconds over
    the Internet. A detailed explanation of where NTP originated, why it is important,
    along with a list of available NTP servers, is available online at [http://ntp.isc.org/bin/view/Main/WebHome](http://ntp.isc.org/bin/view/Main/WebHome).
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: NTP通常在互联网上保持5-15毫秒的精度水平。有关NTP的起源、重要性以及可用NTP服务器列表的详细解释，请访问[http://ntp.isc.org/bin/view/Main/WebHome](http://ntp.isc.org/bin/view/Main/WebHome)。
- en: IPCop has the ability to synchronize to an external NTP source and also provide
    an NTP service for the clients on the local network.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: IPCop具有同步到外部NTP源并为本地网络上的客户端提供NTP服务的能力。
- en: '![Time Server](img/1361_05_25.jpg)'
  id: totrans-155
  prefs: []
  type: TYPE_IMG
  zh: '![时间服务器](img/1361_05_25.jpg)'
- en: The default settings, if you check the **Obtain time from a Network Time Server**
    setting, should work—but you are recommended to pick a **Primary NTP Server**
    (or pool) that is closer to you. As the configuration page indicates, IPCop can
    also automatically synchronize the time.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 默认设置，如果您勾选了**从网络时间服务器获取时间**设置，应该可以正常工作，但建议您选择一个离您更近的**主要NTP服务器**（或池）。正如配置页面所示，IPCop也可以自动同步时间。
- en: IPCop will also let you set the time via the web interface. This is useful for
    an initial installation if the system clock is particularly out of sync, as an
    NTP update may not occur straightaway if you synchronize manually. If you do not
    wish to use NTP for whatever reason, you can keep your time updated in this way—or
    just use it to test NTP by setting the time incorrectly and then verifying whether
    NTP does indeed work.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: IPCop还可以通过Web界面设置时间。如果系统时钟特别不同步，手动同步后可能不会立即发生NTP更新。如果出于某种原因不希望使用NTP，您可以保持通过此方式更新时间，或者只是用它来测试NTP，方法是将时间设置不正确，然后验证NTP是否确实起作用。
- en: Firewall Functionality
  id: totrans-158
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 防火墙功能
- en: The **Firewall** drop-down menu in IPCop contains functionality to configure
    functions of the firewall itself. Since IPCop's design philosophy is to treat
    the Green zone as implicitly trusted and downgrade trust from there onwards, there
    is no egress filtering natively built into IPCop. Instead, your two main choices
    for configuration here are **External Access**, which lets you control which ports
    IPCop will allow in the inbound direction, and **Port Forwarding**. See[Chapter
    9](ch09.html "Chapter 9. Customizing IPCop") for more information on setting up
    a more granular firewall policy, particularly for egress traffic (i.e. traffic
    traversing from Green to Red).
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: IPCop中的**防火墙**下拉菜单包含配置防火墙本身功能的功能。由于IPCop的设计理念是将绿色区域视为隐式信任，并从那里降低信任，因此IPCop本身没有出口过滤功能。因此，在这里配置的两个主要选择是**外部访问**，它允许您控制IPCop允许的入站方向的端口，以及**端口转发**。有关设置更细粒度的防火墙策略的更多信息，请参见[第9章](ch09.html
    "第9章。自定义IPCop") ，特别是有关出口流量（即从绿色到红色的流量）的设置。
- en: External Access
  id: totrans-160
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 外部访问
- en: All traffic initiated in the Red zone is dropped by the IPCop firewall's rules
    by default. Almost all traffic coming in through the firewall in response to a
    request made by a client inside the network (such as a website being served in
    response to a client sending a *get* request for the website) is allowed, but
    in order to allow external hosts to connect to the IPCop firewall itself—to access
    a service such as the web interface or SSH—we need to add an external access rule.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: IPCop防火墙默认情况下会丢弃红色区域中发起的所有流量。几乎所有通过防火墙进入网络的流量（例如响应网络内部客户端发出的对网站的*get*请求而提供的网站）都是允许的，但为了允许外部主机连接到IPCop防火墙本身，以访问诸如Web界面或SSH之类的服务，我们需要添加一个外部访问规则。
- en: '![External Access](img/1361_05_26.jpg)'
  id: totrans-162
  prefs: []
  type: TYPE_IMG
  zh: '![外部访问](img/1361_05_26.jpg)'
- en: As we can see, IPCop by default has only one external access rule, for port
    113 (ident). Although there is no service running on this port by default on the
    IPCop Host, this rule exists in order to allow services that make connections
    to ident (such as IRC or Internet Relay Chat) to connect without waiting for the
    connection to timeout. By opening this port via external access, any connection
    to ident on the IPCop firewall will meet with a closed port, speeding up the connection
    compared to a filtered port.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们所看到的，IPCop默认只有一个外部访问规则，用于端口113（ident）。尽管IPCop主机默认情况下没有在此端口上运行的服务，但此规则存在是为了允许连接到ident（例如IRC或Internet
    Relay Chat）的服务连接而不必等待连接超时。通过外部访问打开此端口，IPCop防火墙上对ident的任何连接都将遇到关闭的端口，从而加快连接速度，而不是过滤端口。
- en: By default, then, if we add an allow rule, traffic destined for the allowed
    port will hit that port on IPCop's external interface. The **External Access**
    screen lets us allow traffic in through IPCop's outermost defenses—actually port
    forwarding (or allowing the traffic to hit a specific internal machine) is done
    in the next section.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，默认情况下，如果我们添加一个允许规则，流向允许端口的流量将会命中IPCop的外部接口上的端口。**外部访问**屏幕让我们可以通过IPCop的最外层防御允许流量进入，实际上端口转发（或允许流量命中特定内部机器）是在下一部分完成的。
- en: Port Forwarding
  id: totrans-165
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 端口转发
- en: Since we only have one external (Red) IP address and multiple internal clients,
    in order to allow a connection to a specific port on a specific internal machine
    from the Internet, we have to assign a port on the Red interface to correspond
    with the service on the internal machine, and *forward* this traffic to the client
    internally.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们只有一个外部（红色）IP地址和多个内部客户端，为了允许从互联网连接到特定内部机器上的特定端口，我们必须在红色接口上分配一个端口与内部机器上的服务对应，并将这个流量*转发*到内部客户端。
- en: Under certain circumstances, such as if we were publishing an internal SSH (22)
    server to the web, we might choose to use a different external port to the port
    listening on the internal host. We might, for instance, port forward port 4022
    on the firewall to port 22 on the internal host. The benefits of this approach
    are that we can accommodate many instances of the same service (using ports 4023,
    4024, etc.) and that there is a slight security benefit in hiding the port our
    SSH service is running on.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 在某些情况下，例如如果我们要将内部SSH（22）服务器发布到网络上，我们可能选择使用不同的外部端口来监听内部主机上的端口。例如，我们可能将防火墙上的端口4022转发到内部主机上的端口22。这种方法的好处是我们可以容纳同一服务的多个实例（使用端口4023、4024等），并且隐藏我们的SSH服务运行的端口会有轻微的安全性好处。
- en: One major disadvantage of this approach is that in some circumstances, the port
    is critical for the application running on it. HTTP traffic, for instance, defaults
    to port 80—the browser requires an extra parameter (usually denoted by a colon
    followed by the port number at the end of the IP address or hostname) to access
    HTTP traffic on an alternative port, as is the case with IPCop's own relocated
    HTTP/HTTPS interfaces on port 81 and 445.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 这种方法的一个主要缺点是在某些情况下，端口对于运行在其上的应用程序是至关重要的。例如，HTTP流量默认使用端口80——浏览器需要额外的参数（通常在IP地址或主机名的末尾由冒号跟随端口号表示）来访问替代端口上的HTTP流量，就像IPCop自己在端口81和445上的HTTP/HTTPS接口一样。
- en: If we relocate HTTP traffic to port 81 (or another port), clients behind a firewall
    allowing connections only to port 80 may also be inadvertently prevented from
    accessing our web server.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们将HTTP流量重定向到端口81（或其他端口），那么在防火墙只允许连接到端口80的客户端后面，可能会意外地阻止访问我们的Web服务器。
- en: Some services require a specific port number. If we have an internal mail server
    to which we forward port 25 (SMTP) from our IPCop firewall, we must use port 25
    externally or mail servers relaying mail to us will not be able to connect to
    the mail server—SMTP servers use port 25, and no means exist for using an alternative
    port on the Web.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 一些服务需要特定的端口号。如果我们有一个内部邮件服务器，我们从IPCop防火墙转发端口25（SMTP）到该服务器，我们必须在外部使用端口25，否则向我们中继邮件的邮件服务器将无法连接到邮件服务器——SMTP服务器使用端口25，Web上没有使用替代端口的方法。
- en: '![Port Forwarding](img/1361_05_27.jpg)'
  id: totrans-171
  prefs: []
  type: TYPE_IMG
  zh: '![端口转发](img/1361_05_27.jpg)'
- en: Our **Source port**, then, refers to the port that we open on the external interface.
    The **Destination port** refers to the port on the target host. If we wanted to
    forward port 4022 externally to port 22 on the internal host 10.1.1.123, for instance,
    we would enter **4022** into the **Source port** box, **22** into the **Destination
    port** box, and **10.1.1.123** into the **Destination IP** box.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，我们的**源端口**指的是我们在外部接口上打开的端口。**目标端口**指的是目标主机上的端口。例如，如果我们想要将外部端口4022转发到内部主机10.1.1.123上的端口22，我们会在**源端口**框中输入**4022**，在**目标端口**框中输入**22**，并在**目标IP**框中输入**10.1.1.123**。
- en: Note
  id: totrans-173
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '**Forwarding Multiple Ports**'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: '**转发多个端口**'
- en: You can forward multiple consecutive ports by specifying a port range. This
    is accomplished through use of colons to delineate between the lowest and highest
    port in the range. If, for instance, we wanted to port forward ports 10 to 30
    on the external interface to ports 10 to 30 on a server within the network, we
    would put **10:30** in **Source port** and **10:30** in **Destination port**.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过指定端口范围来转发多个连续的端口。这是通过使用冒号来界定范围中最低和最高的端口来实现的。例如，如果我们想要将外部接口上的端口10到30转发到网络中的服务器上的端口10到30，我们会在**源端口**和**目标端口**中分别输入**10:30**。
- en: The **Source IP, or network (blank for "ALL")** box allows us to accept connections
    only from specific hosts. We might want to do this if we were opening up a protocol
    such as **RDP** (**3389**) to the Web, which we were not entirely happy with the
    security of. Alternatively, we may choose to actively allow connections only from
    trusted IP blocks as a matter of course, and pursue this approach for all of our
    port forwarding rules (apart from SMTP , which requires that connections be made
    to it by so many different hosts that setting up IP-based filtering in this manner
    is virtually impossible).
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: '**源IP或网络（空白表示“全部”）**框允许我们仅接受特定主机的连接。如果我们要打开一个诸如**RDP**（**3389**）这样的协议到Web上，而我们对其安全性并不完全满意，我们可能会选择这样做。或者，我们可能会选择仅从受信任的IP地址块主动允许连接，而对所有的端口转发规则都采取这种方法（除了SMTP，它要求连接来自许多不同的主机，以至于以这种方式设置基于IP的过滤几乎是不可能的）。'
- en: We might want to choose a different *protocol* if we were port forwarding a
    protocol such as DNS, which uses both UDP and TCP.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们要转发诸如DNS这样同时使用UDP和TCP的协议，我们可能会选择不同的*协议*。
- en: Firewall Options
  id: totrans-178
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 防火墙选项
- en: The **Firewall options** page allows us to enable and disable responses to **ICMP**
    (**Internet Control Message Protocol) echo** (ping) requests to various interfaces
    on the IPCop box. Generally it is considered to be a good practice to disable
    any unnecessary traffic, although ping can be particularly useful when testing,
    and it is a quite common omission among firewall rules to allow this traffic.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: '**防火墙选项**页面允许我们启用和禁用 IPCop 主机上各个接口对**ICMP**（互联网控制消息协议）**回显**（ping）请求的响应。通常认为禁用任何不必要的流量是一个好的做法，尽管在防火墙规则中允许这种流量是一个相当常见的遗漏。'
- en: Although not a major issue pertaining to this option, since it only allows ICMP
    responses to be sent from the IPCop host, there are major reasons to disallow
    ICMP traffic in environments strict about outgoing traffic. It is possible to
    tunnel IP traffic (i.e. all connections made via TCP, UDP, and ICMP, including
    web access, DNS, port scans, and any other type of TCP/IP network activity) over
    ICMP.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然这个选项并不是一个与此相关的主要问题，因为它只允许从 IPCop 主机发送 ICMP 响应，但在严格控制出站流量的环境中，有很多理由禁止 ICMP
    流量。可以通过 ICMP 隧道传输 IP 流量（即通过 TCP、UDP 和 ICMP 进行的所有连接，包括网页访问、DNS、端口扫描和任何其他类型的 TCP/IP
    网络活动）。
- en: This can lead to a situation in which, using an airport or coffee shop network,
    a rogue user can access the Internet without paying (since such pre-authentication
    or payment systems often allow DNS and ICMP traffic to traverse the firewall they
    have in place), or in a business, an employee can circumvent the firewall policy
    to gain access to unauthorized resources and sites.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 这可能导致这样一种情况，即在使用机场或咖啡店网络时，一个恶意用户可以在不支付的情况下访问互联网（因为这种预认证或支付系统通常允许 DNS 和 ICMP
    流量穿过他们设置的防火墙），或者在企业中，员工可以规避防火墙策略以访问未经授权的资源和站点。
- en: See [http://thomer.com/icmptx/](http://thomer.com/icmptx/) for more details
    on tunneling IP over ICMP.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 有关通过 ICMP 进行 IP 隧道传输的更多详细信息，请参见 [http://thomer.com/icmptx/](http://thomer.com/icmptx/)。
- en: '![Firewall Options](img/1361_05_28.jpg)'
  id: totrans-183
  prefs: []
  type: TYPE_IMG
  zh: '![防火墙选项](img/1361_05_28.jpg)'
- en: Network Troubleshooting with Ping
  id: totrans-184
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用 Ping 进行网络故障排除
- en: Of the three protocols running on top of IP, which constitute the **TCP/IP stack**
    in common usage on the Internet (TCP, UDP, and ICMP) ICMP is often the most overlooked.
    ICMP can be viewed as a sort of management channel—ICMP is primarily used for
    sending error messages and other pieces of information that are used to diagnose
    problems and handle data.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 在运行在 IP 之上的三个协议中，构成了互联网上常用的**TCP/IP 协议栈**（TCP、UDP 和 ICMP）中，ICMP 经常被忽视。ICMP 可以被视为一种管理通道，主要用于发送错误消息和其他用于诊断问题和处理数据的信息。
- en: Ping actually uses the ICMP `echo request` and `echo reply` messages, and the
    first utility called ping was written in 1983\. The way this works is sometimes
    equated to **SONAR**—an initiating host sends an *echo request* message, usually
    to a specific host by IP address. The receiving host then replies with an *echo
    reply* message, and the initiating computer calculates the round trip time, which
    it displays in milliseconds (ms).
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: Ping 实际上使用 ICMP 的“回显请求”和“回显回复”消息，第一个名为 ping 的实用程序是在 1983 年编写的。这种工作方式有时被等同于**声纳**，发起主机发送一个*回显请求*消息，通常是发送到特定的
    IP 地址的主机。接收主机然后回复一个*回显回复*消息，发起计算往返时间，以毫秒（ms）显示出来。
- en: 'This provides a good, quick test of:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 这提供了一个很好的、快速的测试：
- en: Connectivity (whether the other host replies)
  id: totrans-188
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 连接性（对方主机是否回复）
- en: Network latency (the length of time taken)
  id: totrans-189
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 网络延迟（所花费的时间长度）
- en: Network reliability (leaving the `ping` command running, with the `-t` flag
    in Windows or by default with many other implementations of ping, is often a good
    way to detect sudden spikes in network usage or latency, or losses of connectivity).
  id: totrans-190
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 网络可靠性（保持使用`ping`命令运行，使用 Windows 的 `-t` 标志或者在许多其他 ping 实现中默认情况下，通常是检测网络使用或延迟突然增加或连接丢失的好方法）。
- en: More recently, many hosts on the Internet have started firewalling ICMP traffic
    of this sort, not responding to `echo request` packets. In some instances, this
    may be to reduce bandwidth usage, while in others administrators may have blocked
    it for security reasons. Microsoft ([www.microsoft.com](http://www.microsoft.com))
    is one example of a high profile site that drops ping requests—Google ([www.google.com](http://www.google.com))
    is an example of one that doesn't.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 最近，互联网上许多主机已经开始对这种类型的 ICMP 流量进行防火墙处理，不回应“回显请求”数据包。在某些情况下，这可能是为了减少带宽使用，而在其他情况下，管理员可能出于安全原因而阻止它。微软（[www.microsoft.com](http://www.microsoft.com)）是一个高调的网站的例子，它会丢弃
    ping 请求，而谷歌（[www.google.com](http://www.google.com)）则是一个不会丢弃的例子。
- en: Note
  id: totrans-192
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '**More about Ping**'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: '**有关 Ping 的更多信息**'
- en: See [http://ftp.arl.mil/~mike/ping.html](http://ftp.arl.mil/~mike/ping.html)
    for more about ping from the original author of ping, Mike Muuss, as well as a
    link to (and picture of) the story of ping the duck, a worthy addition to any
    IT library or bookshelf!
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 有关 ping 的更多信息，请参见 [http://ftp.arl.mil/~mike/ping.html](http://ftp.arl.mil/~mike/ping.html)，了解
    ping 的原始作者 Mike Muuss 的更多信息，以及 ping 故事的链接（和图片），这是任何 IT 图书馆或书架的有价值的补充！
- en: Summary
  id: totrans-195
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: We have been through the mainstay of IPCop configuration in the web interface,
    and should by this point have a solid understanding of how we can employ the various
    options IPCop makes available to us to administer, troubleshoot, and monitor our
    IPCop firewall in a variety of different scenarios.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经通过 IPCop 网页界面的主要配置，并且到目前为止应该对我们如何利用 IPCop 提供的各种选项来管理、故障排除和监控 IPCop 防火墙在不同场景下有了扎实的理解。
