# 第一章：Linux 简介

**操作系统**（**OS**）是一种特殊的软件，运行在您的计算机上，使得启动和运行诸如 Microsoft Word 和 Excel 之类的程序成为可能。除此之外，它还为您处理计算机的输入和输出，并提供文件系统和硬件控制。您可能已经了解的操作系统的例子有 Windows、macOS、iOS 或 Android。

在本章中，我们将涵盖以下主题：

+   Linux 系统概述

+   虚拟化

+   安装 VirtualBox 和 CentOS

+   使用 VirtualBox

+   通过 SSH 连接虚拟机

# Linux 系统概述

Linux 不是特定和完整工作的操作系统的名称，而是仅实现操作系统的基本内核，称为内核。大多数类型的 Linux 操作系统都是免费的，但提供成千上万的程序和软件，完全免费使用。其中大多数程序也是开源的，这意味着您可以查看程序的确切蓝图，以及任何人都可以更改它。Linux 非常流行并且被广泛使用的一个非常重要的领域是管理许多网络服务。这些是在 Linux 服务器后台运行的程序，不断等待外部事件以响应某种操作或信息。例如，流行的互联网服务如 Web 服务器，用于向用户呈现网站；用于电子邮件通信的主服务器；以及用于存储和传递任何类型数据的数据库服务器。如前所述，Linux 只是内核部分的名称，而不是完整的工作操作系统。要使其完整，您需要将其与各种程序捆绑在一起，然后称为**发行版**。

如今，人们可以在众多不同的 Linux 发行版中进行选择，每个都设计用于特定目的，各自具有优缺点。它们之间的主要区别在于所选软件与 Linux 内核捆绑在一起。最重要的 Linux 发行版家族是基于 Red Hat 和 Debian 的 Linux 发行版。CentOS 是目前最重要的免费 Red Hat 基础 Linux 服务器发行版之一。它是一个非常稳定、安全和可靠的操作系统，因此经常用于在企业环境中运行非常关键的网络服务。此外，值得知道的是，该操作系统的开发非常强大，更新也经过精心选择和适当测试。本书的第一章是关于安装 Linux；在这里，我们将通过向您介绍虚拟化的概念来轻松开始。然后，我们将使用名为 VirtualBox 的免费虚拟化软件创建一个新的 CentOS 7 **虚拟机**（**VM**）。

# 虚拟化

在这一部分，我们将为您概述虚拟化的概念。我们还将向您展示如何使用 VirtualBox，并在此之后向您展示如何在 VirtualBox 中安装您的第一个 CentOS 7 虚拟机。虚拟化是一个非常热门的话题，目前的核心 IT 技能就是虚拟化。

简而言之，虚拟化是一种技术，可以在同一台计算机上并行运行独立的操作系统。例如，如果您目前正在使用 Windows 计算机，您可以在桌面上并行运行另一个操作系统，如 Linux 或 macOS，以及一个简单的 Windows 应用程序。现代虚拟化软件甚至不限制您只能运行一个并行操作系统，而是可以并行运行多个系统。限制仅由您自己的计算机硬件定义。现代 IT 中虚拟化技术的应用是无穷无尽的，您将在各个领域找到它们。优势可以从转移 IT 基础设施范式到撤消操作系统更改，这对初学者来说非常理想。

在云计算或现代数据中心中，强大的虚拟化服务器集群同时运行许多不同的操作系统，而不是使用专用服务器硬件。如果您在虚拟化时代之前想要使用 Linux，您需要访问专用的物理计算机。此外，大多数初学者在开始使用 Linux 时会多次搞砸他们的新 Linux 安装。通常，这种系统更改可能很难重新启动，唯一有效和有用的后果就是在卡住时重新安装完整系统。虚拟化摆脱了所有这些问题。由于其强大的功能，例如克隆、拍摄快照或创建图像，我们将在整个章节中方便地使用它来处理所有示例，这也消除了破坏某些东西的恐惧。目前，桌面和非图形服务器环境都有广泛的不同虚拟化产品可供选择，无论是商业还是开源领域。

在核心级别，所有这些不同的虚拟化产品都具有相同的基本功能和共同的定义，我们需要在深入研究之前搞清楚。当我们谈论在物理机操作系统的同时运行的操作系统时，我们将从现在开始称它们为 VM 或虚拟机。在同样的上下文中，运行虚拟化软件的主要操作系统称为主机系统或 hypervisor。在此主机上运行的 VM 称为客户系统或客户。复制和克隆是虚拟化的最重要功能之一。这可以节省宝贵的时间，例如，如果您需要另一台相同的机器或使您的工作更具可移植性。只需将图像复制到笔记本电脑或不同的数据中心，您就完成了。虚拟机的便携式副本也称为图像。另一个令人敬畏的功能是拍摄虚拟机的快照。拍摄这样的快照只需要几秒钟，但会保存虚拟机在任何给定时间点的完整和当前状态。如果您想保留虚拟机的特定版本，以便以后恢复，这将非常有用。不同虚拟化产品共有的另一个特性是支持的网络模式类型。

虚拟机连接到网络的不同模式可以如下：

+   NAT：您的虚拟机的所有传入和传出网络流量都将通过主机网络适配器进行。这意味着该虚拟机在当前网络中不可见，我们只能看到主机的 MAC 和 IP 地址。

+   桥接：这种网络模式意味着虚拟机会像正常的物理机一样暴露自己并连接到周围的物理网络，具有自己独特的 MAC 地址。此网络中的 DHCP 服务器将为该机器提供与主机机器不同的 IP 地址。

+   主机模式：这意味着虚拟机只能与其主机通信并对其可见，而不能与网络的其他部分通信。

+   特定虚拟网络：这是一个非常好的功能，您可以在周围物理网络之外定义私有和隔离的子网，并将虚拟机关联到它。这可能很有用，以便只有虚拟机可以看到并与其他在同一虚拟网络中的机器进行通信。

# 安装 VirtualBox 和 CentOS

在本节中，我们将向您展示如何安装名为 VirtualBox 的免费虚拟化软件，然后创建一个新的 CentOS 7 虚拟机。我们还将完成非常重要的后安装任务，这些任务将在接下来的部分中执行。安装 VirtualBox 非常简单。可用于每个主要操作系统的可执行安装程序。安装 VirtualBox 的步骤如下：

1.  打开你喜欢的网页浏览器，导航到[`www.virtualbox.org/`](https://www.virtualbox.org/)。现在，在主页上清晰可见的下载按钮上点击。

1.  选择你选择的目标主机操作系统。在我们的例子中，我们将选择 Windows。

1.  点击 Windows hosts 开始下载。同时，不要忘记下载你可以在同一下载页面上找到的 VirtualBox 扩展包。

这是一个可以提供更好的 USB 支持等其他有用功能的软件包。下载完成后，打开下载的安装程序运行并使用默认设置进行安装。

现在，让我们在 VirtualBox 中创建一个新的 CentOS 7 虚拟机。为了这样做，我们首先需要从官方 CentOS 网站([`www.centos.org/`](https://www.centos.org/))下载 CentOS 7 Minimal ISO 文件版本 1611。这个文件只包含运行非图形 Linux 服务器所需的最重要的软件包，这正是我们想要的。

创建一个新的 CentOS 7 虚拟机的步骤如下：

1.  打开一个网页浏览器，导航到[`www.centos.org/`](https://www.centos.org/)。导航到 Get CentOS Now | Minimal ISO。

1.  在下一个屏幕上，选择靠近你当前位置的下载 URL 以获得更快的下载速度。我目前位于德国，所以我的实际下载 URL 很可能与你的不同，如果你在其他地方的话。

1.  等待下载完成。

在一台现代和快速的计算机上，你可以在几分钟内在 VirtualBox 中安装一个完全工作的操作系统，比如 CentOS 7。

1.  在你的系统上运行 VirtualBox。现在，让我们重现以下步骤来安装我们的第一个 CentOS 7 虚拟机：

1.  点击新建按钮创建一个新的虚拟机。如果你将虚拟机名称输入为`CentOS 7`，VirtualBox 将会正确识别另外两个字段，类型和版本，为 Linux 和 Red Hat (64 位)。

1.  点击下一步按钮继续下一步。

1.  现在，选择你的虚拟机需要多少内存或 RAM。如果你不想让主机系统出现性能问题，保持在内存大小窗口中显示给你的绿色区域内。

1.  对于一个基本的无头服务器，也就是一个非图形服务器，建议至少有 2GB 的 RAM。不用担心，你以后也可以更改这个设置。

1.  点击下一步按钮，在下一个屏幕上保持默认设置不变。现在，点击创建。

1.  选择 VDI 选项，然后点击下一步。现在，在这个屏幕上，保持动态分配选项。点击下一步。

1.  在下一个屏幕上，将虚拟硬盘大小加倍到`16GB`，因为`8GB`对我们的工作来说太少了。

1.  最后，点击创建按钮创建一个新的空虚拟机，准备安装 CentOS 7。

现在，让我们在空的虚拟机中安装 CentOS 7：

1.  选择我们的 CentOS 7 服务器虚拟机，然后点击绿色的启动按钮启动它。在这里，我们下载的 CentOS 7 ISO 文件将被 VirtualBox 用作虚拟 CD-ROM，这是它可以被引导或启动的地方。

1.  点击小文件夹符号，导航文件浏览器到你下载的 CentOS 7 Minimal ISO 文件，然后点击开始按钮。

1.  现在，你的虚拟机将呈现一个基于文本的启动菜单，在这里我们将使用键盘上的上箭头键选择安装 CentOS Linux 7，然后按*Enter*开始安装程序。

1.  等待一段时间后，你将看到第一个图形安装屏幕。

在我们第一次点击或在 VM 窗口中输入之前，我们需要知道一旦进入，我们如何切换回主机系统。如果你在客户窗口上点击一次，一个弹出窗口将显示告诉你如何来回切换控制。

1.  选择安装程序语言。在我们的例子中，我们使用了默认的英语。

这不是你的 CentOS 7 安装语言。我们将在下一个屏幕上设置这种类型的信息。

1.  点击“继续”。现在，我们在主安装屏幕上，可以自定义我们的安装。您需要等待直到所有项目都已加载。

在这里，所有标有感叹号的项目都需要在我们继续安装之前完成，但您也可以在此处进行可选设置，如设置位置信息。

1.  接下来，我们需要设置安装目标。单击“安装目标”。由于我们使用的是空的 VM，我们将使用整个硬盘进行安装，这是默认设置，因此只需单击位于屏幕左上角的“完成”。

1.  在实际安装之前，让我们快速在这里启用我们的以太网网络卡，这样我们就不必在安装后使用命令行来执行此操作。如果您在代理后面，您也可以在此菜单中添加此类信息。如果准备好了，请单击“完成”。

1.  现在，让我们点击“开始安装”。在安装进行中，为管理员或 root 帐户设置一个强大和安全的密码，该帐户具有对系统的所有权限和控制。设置好强密码后，单击“完成”。

1.  现在，从同一屏幕上，您可以为日常工作创建一个普通用户帐户。

任何安全的 Linux 系统的第一条规则是除非必须，否则不要使用 root 用户。

1.  创建新用户帐户后，单击“完成”。

1.  现在等待安装完成。安装完成后，单击“重新启动”按钮重新启动系统。

1.  在启动屏幕上按*Enter*键将始终选择并使用最新的内核。

1.  现在，等待直到您在此窗口中获得登录屏幕，这也称为我们的**服务终端**。

1.  使用您在安装过程中设置的`root`用户和密码登录。

1.  然后，在终端中输入以下命令并按*Enter*键：

```
# yum update -y    
```

此命令将安装可用的所有最新软件更新，因为安装程序媒体中没有包含它们。

如果在运行此命令时出现新错误，则您的互联网连接可能出现问题，请在主机系统上排除互联网连接故障。

如果 CentOS 7 系统的核心（称为**内核**）已更新，我们需要重新启动系统。因此，在终端中输入`reboot`，然后按*Enter*。重新启动后，再次按*Enter*键，然后等待登录屏幕加载并重新登录。

接下来，我们输入另外两个命令，这将清除所有空闲空间，以便我们可以创建系统的较小备份映像。现在，在终端中使用管理员/根访问权限输入以下命令：

```
dd if=/dev/zero of=/dd.img; rm -f /dd.img    
```

![](img/dd89f9b1-6c49-4d9c-bd2e-d1777de8164d.png)

现在，按*Enter*键。此命令将通过创建一个包含仅零的大文件来覆盖 Linux 文件系统的所有空闲空间，直到磁盘已满。这将需要一些时间，因此您需要耐心等待。如果此命令输出一些文本，则已完成。您可以忽略错误输出，因为这是预期行为。

最后，为了设置 SSH 端口转发，我们需要记下 VM 连接的网络适配器的实际 IP 地址。运行以下命令：

```
ip addr list   
```

按*Enter*，在输出行中输入 IP 地址，即在单词`inet`之后的值。在我们的示例中，它是`10.0.2.15`。

要关闭 VM，请使用以下命令，然后按*Enter*键：

```
shutdown -h
```

# 使用 VirtualBox

在本节中，我们将学习正确使用 VirtualBox 所需的最重要步骤。请注意，这里讨论的大多数设置可以直接从 VirtualBox 转换为任何其他桌面虚拟化软件，如 KVM、VMware、Workstation 或 Parallels Desktop。

让我们按照以下步骤导出 VM 映像：

1.  将光标移动到 Oracle VM VirtualBox Manager 屏幕的左上角。在这里，单击“文件”菜单，然后在下拉菜单中选择“导出设备...”。

1.  在同一个下拉菜单中，您会找到另一个名为“导入设备...”的菜单项，它允许您在创建图像文件后导入图像文件。

1.  现在，点击“导出设备...”开始该过程。

1.  在“导出虚拟设备”屏幕上，选择要创建镜像的虚拟机，然后点击“下一步”。

1.  现在，在存储设置屏幕上保持默认设置不变，然后再次点击“下一步”。

1.  同样，在设备设置屏幕上，我们不想更改任何内容，所以点击“导出”按钮开始该过程。这将需要一些时间，所以您需要耐心等待。

1.  导出过程完成后，让我们来看看生成的文件会是什么样子。

1.  转到 VirtualBox 导出文件的位置（通常在“文档”文件夹中找到），然后右键单击并选择“属性...”选项查看文件的属性：

![](img/84e27e87-2606-4198-be4b-93ece918959e.png)

正如您所看到的，导出的 VM 大小超过 600 MB，这非常棒。现在可以将此镜像文件复制到备份位置，或者转移到另一台机器或数据中心进行运行。在使用 VM 之前，我们还应该在安装后立即从当前状态创建一个快照，这样我们可以在需要时恢复到现状。

按照以下步骤创建 VM 的快照：

1.  选择适当的 VM，然后点击标记的 VM 的“快照”选项。给它一个合适的名称和一个可选的描述。

1.  我们要做的下一件事是创建 VM 的一些精确副本，这样我们就有了多个 CentOS 7 服务器。为此，请右键单击 VM，然后选择“克隆...”选项。给它一个合适的名称，并标记名为“重新初始化所有网络卡的 MAC 地址”的选项，这样它将被视为我们网络中的唯一机器。

1.  在克隆类型窗口中，选择“完全克隆”，然后点击“下一步”继续。现在，点击“克隆”按钮，同时保持默认选项选中。

1.  重复之前的步骤，创建另一个完全克隆的 VM。

现在，让我们演示使用快照的威力。在做一些冒险之前，应该始终先拍摄一个快照。例如，启动我们的一个 CentOS 7 VM 并登录系统。现在，让我们想象我们想要在`/boot`目录上工作，那里存放着 Linux 内核。这是一个关键目录，因此在继续之前创建当前 VM 状态的快照是一个好主意：

![](img/d48ee046-1913-4a74-a58a-256d28f88b26.png)

在上一张截图中，您可以看到我犯了一个严重的错误。我完全删除了整个内核目录，所以目录现在是空的。如果我现在重新启动系统会发生什么？让我们看看：

![](img/bf467dd6-3550-4fbb-925a-537770181535.png)

如前面的截图所示，我没有内核无法启动，系统现在完全无响应，这真的很难修复。对于这个问题，最好的解决方案是恢复到上一个快照的状态。

执行以下步骤将 VM 状态恢复到上一个快照：

1.  首先关闭 VM。现在，选择您选择的快照，然后点击“还原”按钮。这将询问您是否要创建当前状态的快照。如果我们不想这样做，那么我们点击“还原”按钮，如下截图所示：

![](img/e3e6cd80-c64a-4825-84cf-816ead02378b.png)

1.  现在，您可以启动 VM。如下截图所示，我们即将执行“删除”命令：

![](img/009ab1bc-88f1-436b-8356-4e05c96f302c.png)

1.  如果我们再次启动机器，所有问题都消失了，我们回到了删除内核文件之前的状态。建议经常使用快照功能，因为它可以节省宝贵的时间。

1.  最后，如果需要的话，我们可以轻松调整虚拟机的硬件参数，如下面的截图所示：

![](img/78ae2521-726f-4e1b-b095-44527e0b4f62.png)

在进行任何硬件更改之前，请确保关闭虚拟机，然后继续。

您只能在机器的一部分上进行此操作。选择您选择的虚拟机，然后点击“设置”，然后点击“系统”，在那里您可以调整内存。此外，您还可以在这里调整虚拟进程。点击“显示”以更改视频内存设置。在存储下，您可以附加虚拟硬盘或创建新的硬盘。在网络下，您可以为您的虚拟机创建新的网络适配器，并在不同的网络模式之间进行选择。在 USB 下，选择 USB 2.0（EHCI）控制器，这样我们就可以正确地将物理 USB 设备连接到我们的虚拟机上。

# 通过 SSH 连接虚拟机

通过 VirtualBox 用户界面使用新的 Linux 操作系统的终端窗口将使您开始，并可用于配置新服务器的最基本设置。访问服务器命令行的更便捷、高效和专业的方法是使用终端仿真器程序和 SSH。终端仿真器是在您的操作系统的单独窗口中运行的外部程序。它可以与您服务器的主要黑白终端完全相同地使用：

![](img/f63d8094-3876-4c70-8f94-f9fac7a7018f.png)

它具有许多便利的功能，例如从操作系统窗口中轻松复制和粘贴剪贴板，以及自定义字体大小和颜色。此外，它使用选项卡进行更好的导航，但是您如何与这样的终端仿真器从您的服务器进行通信呢？这是通过客户端-服务器连接完成的。在您的主机上运行的终端仿真器将被拒绝；我们将连接到 CentOS 7 服务器上执行命令。可以使用 SSH 进行这种连接。这是一种远程访问和使用 Linux 服务器的系统。它使用强加密进行安全连接。由于 SSH 是任何 Linux 服务器上通信的最基本核心服务之一，因此它已经安装并在 CentOS 7 上启用。我们所需要做的就是在我们的终端仿真器程序中运行一个 SSH 客户端，它可以连接和与运行 Linux 和 macOS 上的 SSH 服务的任何服务器进行通信。

在 Windows 上，您需要安装 PuTTY 程序，其中不仅包含 SSH 客户端程序，还是一个完全操作的终端仿真器。在我们可以访问 CentOS 7 SSH 服务之前，我们需要使其正确的网络地址可用于运行终端仿真器的主机系统。用于客户端和服务器之间通信的正确网络连接始终包括 IP 地址或域名，以及特定端口号。域名或 IP 就像一个房子号码，而端口号就像房子里确切的公寓号码。我们总是需要这两个值来正确传递网络数据包。默认情况下，任何客户虚拟机的端口对外部主机系统不可用，因此我们首先需要使用称为**端口转发**的功能来创建主机和客户之间的链接。SSH 默认运行在端口`22`上，但非管理员用户或路由用户不能使用低端口号进行转发。由于我们以普通用户身份运行 VirtualBox，因此我们需要将端口`22`转发到高于`1024`的用户端口。

在我们的示例中，我们使用端口`2222`。要做到这一点，请执行以下步骤：

1.  选择您选择的虚拟机，然后导航到“设置”选项。点击“网络”选项卡。

1.  探索高级选项。现在，点击“端口转发”按钮创建新的端口转发规则。

1.  在“端口转发规则”窗口中，单击“添加新的端口转发规则”按钮。现在，使用`127.0.0.1` IP 作为主机 IP 部分，这是本地主机的 IP，然后是主机端口`2222`。对于客户端 IP 部分，输入`10.0.2.15`，客户端端口`22`，如下截图所示：

![](img/aca9aac7-0be6-4362-8fc0-7e861efd7dbc.png)

1.  单击“确定”以创建此规则。

1.  对我们之前克隆的另外两个 CentOS 7 VM 重复相同的操作。确保使用不同的主机端口，以便为每个主机创建不同的网络端点连接。

1.  第一个 CentOS 7 VM 服务器现在可以使用 IP`127.0.0.1`和端口`2222`访问，第二个使用端口`2223`，第三个使用端口`2224`。现在，启动所有三个 CentOS 7 VM。

1.  打开您喜欢的终端仿真器，例如 xterm、GNOME 终端，或者（就像我例子中的那样）Xfce4 终端。

1.  要使用终端仿真器登录到您的第一个 CentOS 7 服务器，请使用 root 凭据。在终端窗口中输入以下命令：

```
ssh -p space 2222 root@127.0.0.1\.     
```

1.  按下*Enter*键。此命令将把您的本地 SSH 客户端连接到 IP 地址`127.0.0.1`上运行的 SSH 服务器，端口为`2222`，该端口被重定向到 VM 的网络地址`10.0.2.15`上的端口`22`。

1.  如果首次登录服务器，终端会提示输入`yes`。

1.  现在，输入您在安装过程中设置的 root 用户凭据。

1.  现在，我们可以像在真实的终端屏幕上一样工作和输入命令。我们还可以使用另外两个端口登录另外两个 CentOS 7 VM。

1.  要退出 SSH 会话，请输入`exit`并按*Enter*。

1.  在 Windows 系统上，您可以使用名为 PuTTY 的免费程序执行完全相同的操作。

1.  只需打开 PuTTY 图形用户界面，输入 SSH 服务器的 IP 地址`127.0.0.1`，并使用端口`2222`进行连接。现在，使用 root 帐户访问 VM。

1.  设置端口转发后，最简单的方法是使用 Mac 或 Linux 上可用的免费 SCP 程序。在 Windows 上，您需要下载 PSCP。

1.  从 CentOS 7 VM 客户机下载名为`/etc/passwd`的文件到主机上的当前目录，使用 root 用户，输入以下命令：

```
scp -P 2222 root@127.0.0.1:/etc/passwd .    
```

1.  当要求时，输入您的 root 密码。现在我们可以在本地查看文件：

![](img/3c35fec6-0326-4903-a313-e3297605db72.png)

1.  另一种上传名为`my-local-file`的本地文件到服务器，并输入`scp -P 2222 my-local-file root@127.0.0.1:~`。

1.  按下*Enter*，输入您的 root 密码。文件现在已上传到服务器的`/home`文件夹中，该文件夹由`~`指定。

# 总结

在本章中，我们介绍了 Linux 和 VirtualBox 的基本概念。我们首先了解了操作系统的工作原理，然后向虚拟化方向发展。接下来，我们介绍了 VirtualBox 和 CentOS 的安装。然后，我们学习了如何使用 VirtualBox 并使用 SSH 连接它。

在下一章中，我们将了解命令行的工作原理。
