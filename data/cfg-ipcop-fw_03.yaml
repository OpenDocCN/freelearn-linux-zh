- en: Chapter 3. Deploying IPCop and Designing a Network
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第3章。部署IPCop和设计网络
- en: Now that we understand what IPCop is capable of as a firewall unconnected to
    any other system, we need to start considering how it does connect to them, and
    what are the implications for us. As you must now be realizing, the scope for
    deploying IPCop is quite varied, and especially in conjunction with a knowledge
    of Linux and the flexibility of open-source software, the number of possible permutations
    of even one IPCop box are fairly limitless! That said, there is a core of functionality
    used by the majority of networks, and among all of those permutations, there are
    a few core network layouts that will probably be common among the majority of
    IPCop deployments.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们了解了IPCop作为一个与任何其他系统不连接的防火墙的功能，我们需要开始考虑它如何连接到它们，以及对我们有什么影响。正如你现在可能意识到的那样，部署IPCop的范围是相当广泛的，特别是与Linux的知识和开源软件的灵活性结合在一起，即使是一个IPCop盒子的可能排列方式也是相当无限的！也就是说，大多数网络使用的功能核心，在所有这些排列中，有一些核心网络布局可能在大多数IPCop部署中是常见的。
- en: What we will try to do here, therefore, is outline a few common methods of deploying
    IPCop and the motivation behind these topologies, depending on which IPCop components
    we want to deploy.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，我们在这里要做的是概述部署IPCop的几种常见方法以及这些拓扑结构背后的动机，这取决于我们想要部署哪些IPCop组件。
- en: Trust Relationships between the Interfaces
  id: totrans-3
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 接口之间的信任关系
- en: As we now understand, the four types of network interface—Green, Red, Blue,
    and Orange—supported by IPCop have differing levels of trust associated with them.
    Here is a simple table outlining what traffic is allowed to go to and from which
    interfaces. This table, and the knowledge contained within it, should form the
    basis of our planning when considering how many interfaces to use and what to
    use them for. This is basically the Traffic Flow diagram from the IPCop administrative
    guide ([http://www.ipcop.org/1.4.0/en/admin/html/section-firewall.html](http://www.ipcop.org/1.4.0/en/admin/html/section-firewall.html)).
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们现在了解的那样，IPCop支持的四种网络接口——绿色、红色、蓝色和橙色——它们之间有不同级别的信任。这里有一个简单的表格，概述了允许从哪个接口到哪个接口的流量。这个表格和其中包含的知识应该成为我们规划的基础，当考虑使用多少个接口以及用途时。这基本上是IPCop管理指南中的流量流动图表。
- en: '| Interface From | Interface To | Status | How To Access |'
  id: totrans-5
  prefs: []
  type: TYPE_TB
  zh: '| 从接口 | 到接口 | 状态 | 如何访问 |'
- en: '| --- | --- | --- | --- |'
  id: totrans-6
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- |'
- en: '| RedRedRedRed | FirewallOrangeBlueGreen | CLOSEDCLOSEDCLOSEDCLOSED | External
    AccessPort ForwardingPort Forwarding / VPNPort Forwarding / VPN |'
  id: totrans-7
  prefs: []
  type: TYPE_TB
  zh: '| 红色红色红色红色 | 防火墙橙蓝绿 | 关闭关闭关闭关闭 | 外部访问端口转发/ VPN端口转发/ VPN端口转发/ VPN |'
- en: '| OrangeOrangeOrangeOrange | FirewallRedBlueGreen | CLOSEDOPENCLOSEDCLOSED
    |   |   | DMZ PinholesDMZ Pinholes |'
  id: totrans-8
  prefs: []
  type: TYPE_TB
  zh: '| 橙色橙色橙色橙色 | 防火墙红蓝绿 | 关闭打开关闭关闭 |   |   | DMZ针孔DMZ针孔 |'
- en: '| BlueBlueBlueBlue | FirewallRedOrangeGreen | CLOSEDCLOSEDCLOSEDCLOSED | Blue
    AccessBlue AccessBlue AccessDMZ Pinholes / VPN |   |   |'
  id: totrans-9
  prefs: []
  type: TYPE_TB
  zh: '| 蓝蓝蓝蓝 | 防火墙红橙绿 | 关闭关闭关闭关闭 | 蓝色访问蓝色访问蓝色访问DMZ针孔/ VPN |   |   |'
- en: '| GreenGreenGreenGreen | FirewallRedOrangeBlue | OPENOPENOPENOPEN |   |   |
      |'
  id: totrans-10
  prefs: []
  type: TYPE_TB
  zh: '| 绿绿绿绿 | 防火墙红橙蓝 | 打开打开打开打开 |   |   |   |'
- en: In visualizing the way in which traffic goes through the IPCop firewall, we
    can see it as a sort of giant junction with a traffic cop (literally, an IP Cop—hence
    the name!) in the middle of it. When a car (in network parlance, a packet of data)
    reaches the crossroads, the cop decides in which direction the packet should go
    (based on the routing tables IPCop uses), and pushes it in the appropriate direction.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 在可视化流量通过IPCop防火墙的方式时，我们可以将其看作是一个巨大的十字路口，中间有一个交通警察（字面上就是IP Cop——因此得名！）。当一辆车（在网络术语中，一包数据）到达十字路口时，警察根据IPCop使用的路由表决定数据包应该朝哪个方向前进，并将其推向适当的方向。
- en: In the case of a Green client accessing the Internet, we can see from the previous
    table that this access is OPEN, so the cop allows the traffic through. In other
    instances, however, this might not be the case. If a Blue client tries to access
    a client on the Green segment, for instance, the cop might allow the traffic through
    if it comes over a VPN or through DMZ pinholes—but if a client on the Blue segment
    has neither of these things explicitly allowing the traffic, it is stopped. The
    car is pulled over, the occupants victims of some virtual time in the cells!
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 在绿色客户端访问互联网的情况下，我们可以从前面的表格中看到这种访问是打开的，所以警察允许流量通过。然而，在其他情况下，情况可能并非如此。例如，如果蓝色客户端尝试访问绿色段上的客户端，警察可能会允许流量通过，如果它通过VPN或通过DMZ针孔——但如果蓝色段上的客户端没有这些东西明确允许流量通过，它就会被阻止。汽车被拦下，车上的人成了虚拟牢房的受害者！
- en: 'Note that (generally) when we illustrate IPCop Configurations, the Red interface
    is uppermost (North), the Orange interface is to the left (West), the Blue interface
    is to the right (East), and the Green interface is to the bottom (South). With
    all four interfaces, this appears like this:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，当我们说明IPCop配置时，红色接口位于最上方（北），橙色接口位于左侧（西），蓝色接口位于右侧（东），绿色接口位于底部（南）。有了这四个接口，它看起来像这样：
- en: '![Trust Relationships between the Interfaces](img/1361_03_01.jpg)'
  id: totrans-14
  prefs: []
  type: TYPE_IMG
  zh: '![接口之间的信任关系](img/1361_03_01.jpg)'
- en: Altering IPCop Functionality
  id: totrans-15
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 改变IPCop功能
- en: As with many aspects of the behavior of the IPCop firewall, it is possible to
    alter the behavior of the firewalling rules in order to customize IPCop to meet
    a topology un-catered for by the default rules. Within the context of the firewall
    rules, IPCop has had a file since the 1.4-series release that allows users to
    specifically add their own firewall rules (`/etc/rc.d/rc.firewall.local`). Since
    version 1.3, there have been iptables chains, *CUSTOMINPUT, CUSTOMFORWARD,* etc.,
    allowing iptables rules to be added manually.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 与IPCop防火墙的许多行为方面一样，可以改变防火墙规则的行为，以定制IPCop以满足默认规则无法满足的拓扑结构。在防火墙规则的上下文中，自1.4系列发布以来，IPCop就有一个文件允许用户专门添加自己的防火墙规则(`/etc/rc.d/rc.firewall.local`)。自1.3版本以来，已经有了iptables链，*CUSTOMINPUT,
    CUSTOMFORWARD,*等，允许手动添加iptables规则。
- en: 'Specifically using iptables is out of our scope here, but we recommend that
    interested readers read:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 具体使用iptables超出了我们的范围，但我们建议感兴趣的读者阅读：
- en: The Linux iptables HOWTO at [http://www.linuxguruz.com/iptables/howto/](http://www.linuxguruz.com/iptables/howto/)
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: Linux iptables HOWTO网址：[http://www.linuxguruz.com/iptables/howto/](http://www.linuxguruz.com/iptables/howto/)
- en: 'Topology One: NAT Firewall'
  id: totrans-19
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 拓扑结构一：NAT防火墙
- en: Our first topology exists as a drop-in replacement for the many NAT firewalls
    that exist in the market. In small offices and homes, solutions such as the embedded
    NAT firewalls sold by D-Link, Linksys, and friends are frequently deployed in
    order to provide small networks with cost-effective Internet access. Solutions
    such as **Internet Connection Sharing** (see [http://www.microsoft.com/windowsxp/
    using/networking/learnmore/default.mspx](http://www.microsoft.com/windowsxp/)
    for more information on Internet Connection Sharing from Microsoft), a combined
    NAT firewall, DNS Proxy, and DHCP Server, built into client editions of Windows
    since Windows 98, are also frequently used in order to allow one PC with a modem
    or network interface to act as a network gateway for other clients. For our purposes
    here, we will consider **ICS**, as such a topology with ICS is effectively a superset
    of the work required to replace a router such as a Linksys or NETGEAR model as
    mentioned previously Our migration from one of these routers to IPCop would be
    identical save for the decommissioning of the ICS software on the client—if we
    remove the router, this is unnecessary and the router can be left configured as-is
    (and/or kept as a backup, or reused elsewhere) (See [http://www.annoyances.org/exec/show/ics](http://www.annoyances.org/exec/show/ics)
    for more information on implementing (and consequently, decommissioning) ICS on
    different Windows versions).
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的第一个拓扑结构是许多市场上存在的NAT防火墙的即插即用替代品。在小型办公室和家庭中，诸如D-Link、Linksys等公司销售的嵌入式NAT防火墙经常被部署，以提供小型网络经济有效的互联网访问。诸如**Internet
    Connection Sharing**（有关Microsoft的Internet Connection Sharing的更多信息，请参见[http://www.microsoft.com/windowsxp/
    using/networking/learnmore/default.mspx](http://www.microsoft.com/windowsxp/)），这是自Windows
    98以来内置在客户端版本的Windows中的一种组合NAT防火墙、DNS代理和DHCP服务器，也经常被用于允许一个带调制解调器或网络接口的PC充当其他客户端的网络网关。在这里，我们将考虑**ICS**，因为这样的拓扑结构与ICS实际上是替换以前提到的Linksys或NETGEAR型号路由器所需工作的超集。我们从这些路由器之一迁移到IPCop的过程将是相同的，只是需要在客户端上停用ICS软件——如果我们移除路由器，这是不必要的，路由器可以保持配置不变（和/或作为备份，或在其他地方重复使用）（有关在不同Windows版本上实施（因此，停用）ICS的更多信息，请参见[http://www.annoyances.org/exec/show/ics](http://www.annoyances.org/exec/show/ics)）。
- en: 'Such a topology with ICS might look like this:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 这样的拓扑结构与ICS可能看起来像这样：
- en: '![Topology One: NAT Firewall](img/1361_03_02.jpg)'
  id: totrans-22
  prefs: []
  type: TYPE_IMG
  zh: '![拓扑结构一：NAT防火墙](img/1361_03_02.jpg)'
- en: Such solutions, while cheap and convenient, are often not scalable or reliable,
    and provide poor security. They open workstations up to unnecessary security risks,
    provide limited throughput, and are often unreliable, requiring frequent reboots
    and locking up.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 这样的解决方案虽然便宜和方便，但通常不具备可扩展性或可靠性，并且安全性较差。它们使工作站面临不必要的安全风险，提供有限的吞吐量，并且经常不可靠，需要频繁重启和死机。
- en: As with software firewalls, a network firewall is designed as a barrier in between
    your workstations and the Internet. By connecting one of your workstations directly
    to the Internet and using a solution like ICS, although you reduce the resources
    required to share the internet connection, you expose that workstation to unnecessary
    risk. There is also an obligation for that PC to be on all the time—compared to
    a low-end PC with no unnecessary components and a low-power PSU running IPCop,
    this may be noisier, and have more power consumption.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 与软件防火墙一样，网络防火墙被设计为工作站和互联网之间的屏障。通过将其中一个工作站直接连接到互联网，并使用ICS等解决方案，虽然可以减少共享互联网连接所需的资源，但也会使该工作站面临不必要的风险。此外，该计算机还需要一直开机运行——与没有不必要组件和低功率电源运行IPCop的低端PC相比，这可能会更吵，而且功耗更大。
- en: IPCop offers a cost-effective replacement in such situations, providing small
    businesses and home users with a powerful firewall without the need for over-complexity,
    and adding other features not present in embedded solutions or ICS, such as a
    customizable DHCP Server, Intrusion Detection, a Proxy Server, and so on.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，IPCop提供了一种经济有效的替代方案，为小型企业和家庭用户提供了强大的防火墙，而无需过于复杂，并添加了嵌入式解决方案或ICS中不存在的其他功能，如可定制的DHCP服务器、入侵检测、代理服务器等。
- en: 'With IPCop acting as a replacement in this situation, the replacement network
    might look like this:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，使用IPCop作为替代，替代网络可能看起来像这样：
- en: '![Topology One: NAT Firewall](img/1361_03_03.jpg)'
  id: totrans-27
  prefs: []
  type: TYPE_IMG
  zh: '![拓扑结构一：NAT防火墙](img/1361_03_03.jpg)'
- en: 'Such a topology ensures that firewalling is done before data gets to clients,
    using a package designed to act as a network firewall, greatly increasing the
    quality of service to clients as well as the security that their network offers.
    In this situation, the components of IPCop in use would be:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 这样的拓扑结构确保了在数据传输到客户端之前进行防火墙处理，使用专门设计为网络防火墙的软件包，极大地提高了客户端的服务质量以及他们的网络提供的安全性。在这种情况下，IPCop使用的组件将是：
- en: Green/Red zones
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 绿色/红色区域
- en: DHCP Server
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: DHCP服务器
- en: DNS Server
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: DNS服务器
- en: 'In such a situation, a network administrator or consultant might also choose
    to enable any of the following pieces of functionality in order to enhance the
    services provided to the network:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，网络管理员或顾问还可以选择启用以下任何一项功能，以增强为网络提供的服务：
- en: Intrusion Detection
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 入侵检测
- en: IPSec in order to allow remote work or remote support
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: IPSec以允许远程工作或远程支持
- en: Port Forwarding in order to allow remote access to VNC or Terminal Services/Remote
    Desktop for a simplified model of remote access for remote support (more convenient
    than IPSec although inherently more insecure)
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 端口转发以允许远程访问VNC或终端服务/远程桌面，用于远程支持的简化模型（比IPSec更方便，尽管固有地更不安全）
- en: Decommissioning of ICS in such a situation is quite simple—we would merely disable
    the ICS functionality, as depicted in the following screenshot (taken from the
    network connections property of the external, internet-facing ICS network interface).
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，停用ICS非常简单——我们只需禁用ICS功能，如下图所示（从外部、面向互联网的ICS网络接口的网络连接属性中获取）。
- en: '![Topology One: NAT Firewall](img/1361_03_04.jpg)'
  id: totrans-37
  prefs: []
  type: TYPE_IMG
  zh: '![拓扑结构一：NAT防火墙](img/1361_03_04.jpg)'
- en: Removing ICS is as simple as deselecting the **Allow other network users to
    connect through this computer's Internet connection** option. After we have done
    this, we should hit **OK**, reboot if asked to, and then we are free to disable
    and/or remove the external interface on the workstation (disable if we wish to
    leave a second network card in the machine or if it has two onboard cards, or
    remove if we are using an external modem or other piece of hardware we intend
    to remove or install in our IPCop host).
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 删除ICS就像取消选择**允许其他网络用户通过此计算机的互联网连接进行连接**选项一样简单。完成后，我们应该点击**确定**，如果有要求，重新启动，然后我们可以自由地禁用和/或删除工作站上的外部接口（如果我们希望在机器上留下第二张网络卡或者它有两张内置卡，或者如果我们使用外部调制解调器或其他打算从我们的IPCop主机中删除或安装的硬件）。
- en: Note
  id: totrans-39
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '**IPCop''s Intrusion Detection System**'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: '**IPCop的入侵检测系统**'
- en: The Intrusion Detection feature is a powerful component of IPCop, which is easy
    to enable and use. Although precise analysis of the log files that IPCop's IDS
    generates requires considerable skill and experience, it is simple to turn on
    and unless there are specific space requirements for the IPCop firewall (i.e.
    it is running on a device with a very small hard disk or compact flash card, or
    with inadequate CPU/memory to perform analysis), there is no compelling reason
    not to enable the IDS system.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 入侵检测功能是IPCop的一个强大组件，易于启用和使用。尽管对IPCop的IDS生成的日志文件进行精确分析需要相当的技能和经验，但它很容易打开，除非IPCop防火墙有特定的空间要求（即在运行设备上有一个非常小的硬盘或紧凑闪存卡，或者CPU/内存不足以进行分析），否则没有理由不启用IDS系统。
- en: Firewall rules for this topology are simple; as the Green segment is automatically
    allowed to access resources on the Red interface, there is no topology-specific
    setup required in order to set this up.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这种拓扑结构，防火墙规则很简单；因为绿色段自动被允许访问红色接口上的资源，所以不需要特定于拓扑结构的设置来设置这个。
- en: Another substantial benefit in deploying IPCop for such a small office situation
    is that in the event that the business is required to grow, the solution that
    it has is scalable. Such a business running a handful of Windows workstations
    in a workgroup may decide that a workgroup is insufficient for its needs and that
    it requires centralized management, file storage, and configuration.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 在这样一个小办公室环境中部署IPCop的另一个重要好处是，如果业务需要增长，它所拥有的解决方案是可扩展的。这样一个运行着一些Windows工作站的工作组的企业可能会决定工作组不足以满足其需求，需要集中管理、文件存储和配置。
- en: IPCop, even in a pre-upgrade scenario like this, is advantageous simply because
    it provides a built-in, open upgrade path. There is no hardware or software upgrade
    required to move from simple NAT and DHCP to a network with several network segments,
    port forwarding, and a proxy server. If the Server already has several network
    cards (and with the price of these nowadays, there's no reason for it not to,
    if an expansion is anticipated), this can even be done with little or no noticeable
    interruption in service to existing clients.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 即使在这样的预升级场景中，IPCop也是有利的，因为它提供了内置的开放升级路径。从简单的NAT和DHCP转移到具有多个网络段、端口转发和代理服务器的网络不需要硬件或软件升级。如果服务器已经有几张网络卡（而且现在这些价格很便宜，如果预期会扩展的话，没有理由不这样做），甚至可以在几乎没有或没有明显中断现有客户服务的情况下完成。
- en: 'Topology Two: NAT Firewall with DMZ'
  id: totrans-45
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 拓扑结构二：带有DMZ的NAT防火墙
- en: In a small office situation with a growing company, the need for incoming email
    might force the activation of the Orange zone, and the deployment and installation
    of a mail server in this segment.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 在一个不断发展的小公司办公室环境中，对于传入电子邮件的需求可能会迫使激活橙色区域，并在该区段部署和安装邮件服务器。
- en: Such a company might choose to keep its Desktop and Internal Server infrastructure
    within the Green network segment and put their its server in the DMZ on a switch/hub,
    or simply attached to the Orange interface of the IPCop host using a crossover
    cable. As such systems are exposed to the Internet, this segmentation provides
    a considerable advantage by providing a 'stop line' past which it would be harder
    for an intruder to escalate his or her access to the network.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 这样的公司可能会选择将其桌面和内部服务器基础设施放在绿色网络段内，并将其服务器放在DMZ上的交换机/集线器上，或者简单地使用交叉线缆连接到IPCop主机的橙色接口。由于这些系统暴露在互联网上，这种分段提供了一个重要的优势，使得入侵者更难以扩大对网络的访问。
- en: Note
  id: totrans-48
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '**DMZ and External Network Segment Infrastructure**'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: '**DMZ和外部网络段基础设施**'
- en: Although it's often extremely convenient to attach a DMZ server or external
    router to the firewall (or another router) using crossover cables, using a hub
    or switch can often pay dividends—inevitably, when you might actually need a switch
    or hub in this role may be while troubleshooting connectivity issues associated
    with these systems, and in such scenarios you may not be able to find and install
    a hub/switch in adequate time, or may not want to interrupt any connectivity that
    is still remaining.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管使用交叉电缆将DMZ服务器或外部路由器连接到防火墙（或另一个路由器）通常非常方便，但使用集线器或交换机通常会产生回报——不可避免的是，当您实际上可能需要在这些系统相关的连接问题上进行故障排除时，您可能需要交换机或集线器，而在这种情况下，您可能无法及时找到并安装交换机/集线器，或者可能不想中断仍然存在的任何连接。
- en: Using hubs and switches also plans for future expansion, and enables you to
    add another system with even less effort. Small switches with half a dozen ports
    really aren't expensive, either!
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 使用集线器和交换机也可以为未来的扩展计划，并且使您可以更轻松地添加另一个系统。带有半打端口的小型交换机也不贵！
- en: Microsoft's Exchange mail server has for some time supported such a configuration
    through the use of the 'front end' and 'back end' exchange roles (although these
    roles will be deprecated with future Exchange releases). With a different network
    configuration however, such as Linux clients using a management system such as
    Novell's eDirectory or RedHat's Directory Server (RHDS), or a filtering appliance,
    a similar system with externally-facing SMTP servers (perhaps running the open-source
    MTA exim) would be equally beneficial.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 微软的Exchange邮件服务器在相当长的一段时间内通过使用“前端”和“后端”交换角色来支持这样的配置（尽管这些角色将在未来的Exchange版本中被弃用）。然而，通过不同的网络配置，例如使用Novell的eDirectory或RedHat的Directory
    Server（RHDS）等管理系统的Linux客户端，或者过滤设备，一个类似的系统与外部面向SMTP服务器（也许运行开源MTA exim）同样有益。
- en: '![Topology Two: NAT Firewall with DMZ](img/1361_03_05.jpg)'
  id: totrans-53
  prefs: []
  type: TYPE_IMG
  zh: '![拓扑结构二：带DMZ的NAT防火墙](img/1361_03_05.jpg)'
- en: In this topology, Clients are freely able to connect to the mail server (whether
    via POP, IMAP, RPC, or RPC over HTTP). In order for a mail server that exists
    as part of the network domain to authenticate to the directory server, we would
    also need to open the appropriate ports (contingent upon the directory provider)
    to the directory server using the DMZ Pinholes feature.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种拓扑结构中，客户端可以自由连接到邮件服务器（无论是通过POP、IMAP、RPC还是RPC over HTTP）。为了使作为网络域的一部分存在的邮件服务器能够对目录服务器进行身份验证，我们还需要使用DMZ
    Pinholes功能打开适当的端口（取决于目录提供者）到目录服务器。
- en: Note
  id: totrans-55
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '**Firewalling Active Directory Domain Controllers**'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 防火墙活动目录域控制器
- en: Information on specifically which ports Active Directory needs to replicate
    (i.e. in between domain controllers, if a mail host and the directory server were
    domain controllers) is available at [http://www.microsoft.com/technet/prodtechnol/windows2000serv/technologies/activedirectory/deploy/confeat/adrepfir.mspx](http://www.microsoft.com/technet/prodtechnol/windows2000serv/technologies/activedirectory/deploy/confeat/adrepfir.mspx)
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 有关活动目录需要复制的特定端口的信息（即在域控制器之间，如果邮件主机和目录服务器是域控制器）可在[http://www.microsoft.com/technet/prodtechnol/windows2000serv/technologies/activedirectory/deploy/confeat/adrepfir.mspx](http://www.microsoft.com/technet/prodtechnol/windows2000serv/technologies/activedirectory/deploy/confeat/adrepfir.mspx)找到
- en: Although in such a scenario the security benefit to a DMZ would be limited as
    the compromise of the mail host would mean the compromise of a domain controller,
    there would still be a slight security benefit—running a domain controller in
    an internet-facing role, however, is not recommended!
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管在这种情况下，将邮件主机的妥协意味着域控制器的妥协，DMZ的安全性好处将受到限制，但仍然会有一些安全性好处——在互联网面向角色中运行域控制器是不推荐的！
- en: 'Ports required by Clients or Servers talking to a domain controller can be
    found in the following article, which details the ports required to configure
    the Windows firewall on a Windows 2003 system:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 客户端或服务器与域控制器通信所需的端口可以在以下文章中找到，该文章详细介绍了在Windows 2003系统上配置Windows防火墙所需的端口：
- en: '[http://support.microsoft.com/default.aspx?scid=kb;en-us;555381&sd=rss&spid=3198](http://support.microsoft.com/default.aspx?scid=kb;en-us;555381&sd=rss&spid=3198)'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: '[http://support.microsoft.com/default.aspx?scid=kb;en-us;555381&sd=rss&spid=3198](http://support.microsoft.com/default.aspx?scid=kb;en-us;555381&sd=rss&spid=3198)'
- en: We also have a Port Forwarding rule set up from the external IP address of the
    IPCop firewall to port 25 on the mail server. This allows external mail servers
    to connect to the mail server in order to deliver email.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还设置了一个端口转发规则，从IPCop防火墙的外部IP地址到邮件服务器的25号端口。这允许外部邮件服务器连接到邮件服务器以传递电子邮件。
- en: In this topology, a compromise of the mail server (which in the Green segment
    could compromise the entire network segment) is controlled, as there is some level
    of protection provided by the firewall.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种拓扑结构中，邮件服务器的妥协（在绿色段可能会妥协整个网络段）是受控的，因为防火墙提供了一定程度的保护。
- en: 'In such a topology, we use the following capabilities of the IPCop Firewall:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种拓扑结构中，我们使用IPCop防火墙的以下功能：
- en: Red, Orange, Green zones
  id: totrans-64
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 红色、橙色、绿色区域
- en: DMZ Pinholes
  id: totrans-65
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: DMZ Pinholes
- en: DHCP Server
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: DHCP服务器
- en: DNS Server
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: DNS服务器
- en: Port Forwarding to Orange segment
  id: totrans-68
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 端口转发到橙色段
- en: 'We might also choose to employ any of the following elements of functionality:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还可以选择使用以下功能中的任何一个：
- en: Intrusion Detection System
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 入侵检测系统
- en: Port Forwarding to web server on the mail server (for external access of IMAP
    or Exchange mailboxes via a webmail solution such as Horde, SquirrelMail, or Outlook
    Web Access)
  id: totrans-71
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 端口转发到邮件服务器上的Web服务器（通过Horde、SquirrelMail或Outlook Web Access等Web邮件解决方案进行IMAP或Exchange邮箱的外部访问）
- en: Proxy Server (for desktop Internet access)
  id: totrans-72
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 代理服务器（用于桌面互联网访问）
- en: IPSec for remote access to Servers in the Green and Orange segment or for external
    support
  id: totrans-73
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用于远程访问绿色和橙色段的服务器或外部支持的IPSec
- en: Back-end mail server with mailboxes in the Green zone, using the Server in the
    Orange zone as a relay, performing anti-spam and anti-virus scanning/filtering
  id: totrans-74
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 后端邮件服务器在绿色区域中，使用橙色区域中的服务器作为中继，执行反垃圾邮件和反病毒扫描/过滤
- en: 'Topology Three: NAT Firewall with DMZ and Wireless'
  id: totrans-75
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 拓扑结构三：带有DMZ和无线的NAT防火墙
- en: In a larger organization, or if the network above grew, we might choose to expand
    our network topology using one or more IPCop firewalls. Very large networks are
    out of the scope of this book alone, as they require aggregated knowledge and
    experience that a networking/IT professional will need to glean from multiple
    sources.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 在一个更大的组织中，或者如果上面的网络增长了，我们可能会选择使用一个或多个IPCop防火墙来扩展我们的网络拓扑结构。非常大的网络超出了本书的范围，因为它们需要网络/IT专业人员从多个来源获取的知识和经验。
- en: Note
  id: totrans-77
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '**The IPCop Mailing List**'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: '**IPCop邮件列表**'
- en: The IPCop user mailing list is a very good source of information on extending
    IPCop and deploying it in more advanced roles. It is worth subscribing to and
    perusing for those who have more than a passing interest in IPCop. The archives
    for this mailing list can be found at [https://sourceforge.net/mailarchive/forum.php?forum_id=4957](http://https://sourceforge.net/mailarchive/forum.php?forum_id=4957)
    and there is a subscription page at [http://lists.sourceforge.net/lists/listinfo/ipcop-user](http://lists.sourceforge.net/lists/listinfo/ipcop-user).
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: IPCop用户邮件列表是有关扩展IPCop并在更高级角色中部署它的非常好的信息来源。对于那些对IPCop有更多兴趣的人来说，订阅并浏览这个邮件列表是值得的。这个邮件列表的存档可以在[https://sourceforge.net/mailarchive/forum.php?forum_id=4957](http://https://sourceforge.net/mailarchive/forum.php?forum_id=4957)找到，并且有一个订阅页面在[http://lists.sourceforge.net/lists/listinfo/ipcop-user](http://lists.sourceforge.net/lists/listinfo/ipcop-user)。
- en: Several IPCop firewalls might be used by such an individual in order to separate
    several sites, or in order to further segregate one or more DMZs with physically
    distinct firewalls.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 一个人可能会使用多个IPCop防火墙，以便分隔多个站点，或者进一步将一个或多个DMZ与物理上不同的防火墙分隔开。
- en: It is also worth considering that IPCop is designed primarily for networks in
    which it is the only network firewall, in the Small and Medium Business, and Home/Home
    Office market. Although it is possible to set IPCop up in larger deployments,
    this is fairly rare, and there are other packages that are arguably more suited
    to such deployments. In such circumstances, the constraints of IPCop's network
    segmentation begin to be more burdensome than they are convenient, and the amount
    of work required to tailor IPCop to meet an organization's needs may exceed the
    work it would take to manually set up another firewall package to suit the same
    topology.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 值得考虑的是，IPCop主要是为中小型企业和家庭/家庭办公市场设计的网络防火墙。虽然可以在更大的部署中设置IPCop，但这相当罕见，而且有其他软件包可能更适合这样的部署。在这种情况下，IPCop的网络分割的限制开始变得更加繁重，而不是方便，而且为了满足组织的需求，需要的工作量可能超过手动设置另一个防火墙软件包以适应相同拓扑结构的工作量。
- en: In this example, we will consider the broadest scope in which one IPCop box
    could be deployed, using all four network interfaces to protect a network with
    an internal (Green) network, an Internet or WAN connection (Red), a DMZ containing
    more than one Server (Orange), and a wireless segment (Blue) with an IPSec VPN
    system.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，我们将考虑一个IPCop盒子可以部署的最广泛的范围，使用所有四个网络接口来保护一个具有内部（绿色）网络、互联网或广域网连接（红色）、包含多个服务器的DMZ（橙色）和一个带有IPSec
    VPN系统的无线段的网络。
- en: In such a situation, we would almost certainly choose to deploy all of the higher-end
    features that IPCop contains, such as the Proxy Server and the Intrusion Detection
    System.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，我们几乎肯定会选择部署IPCop包含的所有高端功能，例如代理服务器和入侵检测系统。
- en: '![Topology Three: NAT Firewall with DMZ and Wirelesstopology two, NAT firewall
    with DMZIPCop functionalities](img/1361_03_06.jpg)'
  id: totrans-84
  prefs: []
  type: TYPE_IMG
  zh: '![拓扑结构三：带有DMZ和无线的NAT防火墙，IPCop功能](img/1361_03_06.jpg)'
- en: 'In this situation, the services we are providing for individual network interfaces
    are as follows:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，我们为各个网络接口提供的服务如下：
- en: On the Red Interface, in addition to the default firewalling policy, we are
    invoking the Port Forwarding feature to allow connections to the mail server on
    port 25 in the DMZ, and also to port 443 (HTTPS) on the mail server in order to
    allow connections to the business webmail system. We are also allowing incoming
    IPSec connections to the IPCop firewall in order to allow remote access to staff
    who work remotely and to provide remote connectivity for support purposes for
    the IT Staff and third-party software and hardware vendors.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 在红色接口上，除了默认的防火墙策略外，我们还调用了端口转发功能，以允许在DMZ上的邮件服务器上的25号端口和邮件服务器上的443号端口（HTTPS）的连接，以允许对业务网络邮件系统的连接。我们还允许对IPCop防火墙的传入IPSec连接，以允许远程访问远程工作的员工，并为IT人员和第三方软件和硬件供应商提供远程连接以支持目的。
- en: On the Blue interface, we are providing connectivity via an IPSec VPN for clients
    in order that they can access services run from Servers internally on the Green
    segment and DMZ segment. Vendors and visitors are allowed access to the Green
    segment through use of WPA in pre-shared key mode configured on the wireless access
    point.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 在蓝色接口上，我们通过IPSec VPN为客户提供连接，以便他们可以访问在绿色段和DMZ段内运行的服务器提供的服务。供应商和访客可以通过在无线接入点上配置的预共享密钥模式的WPA来访问绿色段。
- en: Note
  id: totrans-88
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '**WPA and WEP**'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: '**WPA和WEP**'
- en: WPA was designed to introduce some features of a more advanced wireless standard
    designed to entirely supplant WEP, but before this standard was ready. The insecurity
    of the WEP system for securing 802.11 wireless LANs is well-documented, and WPA
    most notably employs the TKIP protocol (in addition to other changes) to constantly
    change the encryption key used to encrypt data transmitted over the air. Using
    TKIP, instead of one constantly used key, greatly reduces the severity of the
    encryption being broken (as in effect, it is only broken for a short timeframe),
    although it does mean that the Pre-Shared Key, used to generate these encryption
    keys, must be strong, and closely guarded.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: WPA旨在引入更先进的无线标准的一些特性，以完全取代WEP，但在该标准准备就绪之前。WEP系统用于保护802.11无线局域网的不安全性已经有充分的文献记录，WPA最显著地采用TKIP协议（以及其他更改）来不断更改用于加密通过空中传输的数据的加密密钥。使用TKIP，而不是一个不断使用的密钥，大大减轻了加密被破解的严重性（实际上，它只在短时间内被破解），尽管这意味着用于生成这些加密密钥的预共享密钥必须强大且严加保护。
- en: WPA-RADIUS or WPA-Enterprise employs the use of a RADIUS server. RADIUS, which
    is often used to authenticate users to switches or systems for Internet Service
    provision, allows the access point to force client computers to authenticate to
    the RADIUS Server using a username and password or cryptographic certificate,
    before they are allowed to fully associate with the wireless access point. Utilization
    of a RADIUS server in this way is significantly more secure than WPA-PSK, both
    because the insecurity of the Pre-Shared Key is eliminated (each client has their
    own certificate or username/password, and these can be individually locked out
    or distributed) and also because a unique encrypted tunnel is created for each
    client, causing the wireless network to behave more, logically, like a switch
    than a hub (through the use of encryption).
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: WPA-RADIUS或WPA-Enterprise采用RADIUS服务器。RADIUS通常用于对交换机或系统进行用户认证，以提供互联网服务，允许接入点强制客户计算机使用用户名和密码或加密证书对RADIUS服务器进行认证，然后才允许它们完全与无线接入点关联。以这种方式利用RADIUS服务器比WPA-PSK更安全得多，因为消除了预共享密钥的不安全性（每个客户端都有自己的证书或用户名/密码，并且可以单独锁定或分发），并且因为为每个客户端创建了一个唯一的加密隧道，使得无线网络更像交换机而不是集线器（通过加密）。
- en: WPA2, which eliminates some of the cryptographic weaknesses of WPA and TKIP,
    is stronger still, and uses the AES encryption standard for maximum data security.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: WPA2，消除了WPA和TKIP的一些加密弱点，更加强大，并且使用AES加密标准来实现最大的数据安全。
- en: 'Microsoft TechNet has excellent guides on implementing WPA-RADIUS using its
    RADIUS server (IAS, the Internet Authentication Service) available online via
    Microsoft TechNet, at the following URLs: Securing Wireless LANs with Certificate
    Services: [http://www.microsoft.com/technet/security/prodtech/windowsserver2003/pkiwire/swlan.mspx?mfr=true](http://www.microsoft.com/technet/security/prodtech/windowsserver2003/pkiwire/swlan.mspx?mfr=true)'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: Microsoft TechNet在其RADIUS服务器（IAS，Internet Authentication Service）上有关于实施WPA-RADIUS的优秀指南，可在线通过以下网址获取：使用证书服务保护无线局域网：[http://www.microsoft.com/technet/security/prodtech/windowsserver2003/pkiwire/swlan.mspx?mfr=true](http://www.microsoft.com/technet/security/prodtech/windowsserver2003/pkiwire/swlan.mspx?mfr=true)
- en: 'Securing Wireless LANs with PEAP and passwords: [http://www.microsoft.com/technet/security/topics/cryptographyetc/peap_0.mspx](http://www.microsoft.com/technet/security/topics/cryptographyetc/peap_0.mspx)'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 使用PEAP和密码保护无线局域网：[http://www.microsoft.com/technet/security/topics/cryptographyetc/peap_0.mspx](http://www.microsoft.com/technet/security/topics/cryptographyetc/peap_0.mspx)
- en: WPA-PSK with solely an access point prevents access to the wireless segment
    and the Internet by unauthorized users, and is an adequate solution for most small
    and medium networks; use of a newer, WPA2-PSK-capable access point increases this
    security more for those without an access point or network infrastructure implementing
    RADIUS or Certificate Services.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 仅使用接入点的WPA-PSK可以防止未经授权的用户访问无线段和互联网，并且对于大多数中小型网络来说是一个足够的解决方案；使用支持WPA2-PSK的新型接入点可以增加这种安全性，对于没有接入点或实施RADIUS或证书服务的网络基础设施的用户来说更加安全。
- en: The firewalling policy and IPSec system ensures that visitors/vendors only have
    access to the Red zone (the Internet), and not to any of the resources on the
    network.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 防火墙策略和IPSec系统确保访客/供应商只能访问红色区域（互联网），而不能访问网络上的任何资源。
- en: On the Orange interface, our pinholes allow the DMZ servers to connect to a
    directory server and Kerberos domain controller in the Green segment in order
    to authenticate users logging onto them via the company directory system. This
    ensures that the policy and configuration for these Servers is managed centrally,
    and that there are logs stored centrally for them, but the damage that could be
    caused by a compromise of these externally-facing services is greatly minimized,
    ensuring business security and regulatory compliance.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 在橙色接口上，我们的针孔允许DMZ服务器连接到绿色区段中的目录服务器和Kerberos域控制器，以便通过公司目录系统登录到它们的用户进行身份验证。这确保了这些服务器的策略和配置是集中管理的，并且为它们存储了中央日志，但是外部服务的妥协可能造成的损害大大减少，确保了业务安全和合规性。
- en: On the Green interface, we allow connectivity to all interfaces, as workstations
    and Servers within the Green segment are managed service workstations on which
    users do not have the necessary level of access to cause damage to the resources
    to which they have access.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 在绿色接口上，我们允许连接到所有接口，因为绿色区段内的工作站和服务器是受管理的服务工作站，用户没有足够的访问级别来对其访问的资源造成损害。
- en: 'In such a situation, we are making use of the following IPCop features:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，我们正在使用以下IPCop功能：
- en: Red, Orange, Green, Blue zones
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 红色，橙色，绿色，蓝色区域
- en: DMZ Pinholes
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: DMZ针孔
- en: DHCP Server
  id: totrans-102
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: DHCP服务器
- en: DNS Server
  id: totrans-103
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: DNS服务器
- en: Port Forwarding to Orange segment
  id: totrans-104
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 端口转发到橙色区段
- en: IPSec for remote access to Green, Orange, Blue segments
  id: totrans-105
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: IPSec用于远程访问绿色、橙色、蓝色区段
- en: IPSec for access to internal resources by Blue users
  id: totrans-106
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: IPSec用于蓝色用户访问内部资源
- en: Intrusion Detection System
  id: totrans-107
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 入侵检测系统
- en: Port Forwarding to web server on the Mail server externally
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 端口转发到外部的邮件服务器上的Web服务器
- en: Proxy Server (for desktop Internet access)
  id: totrans-109
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 代理服务器（用于桌面互联网访问）
- en: In a larger organization, we may also choose to use IPSec in site-to-site mode
    in order to link this office with one or more branch or parent offices. In this
    role as in the role of a single network firewall, IPCop excels.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 在一个较大的组织中，我们还可以选择使用IPSec的站点到站点模式，以将这个办公室与一个或多个分支或总部连接起来。在这个角色中，就像在单个网络防火墙的角色中一样，IPCop表现出色。
- en: Planning Site-To-Site VPN Topologies
  id: totrans-111
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 规划站点到站点VPN拓扑
- en: In addition to *local* services such as those illustrated previously with our
    IPCop deployment, we may also be using the IPSec software in IPCop to configure
    a 'site-to-site' VPN to a branch or parent office, business partner, support company,
    or second site. In such situations, topology planning can become important as
    a network grows.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 除了*本地*服务，比如我们之前在IPCop部署中所示的服务，我们还可以使用IPCop中的IPSec软件来配置与分支或总部、商业伙伴、支持公司或第二站点的“站点到站点”VPN。在这种情况下，拓扑规划可能变得重要，因为网络规模增长。
- en: It is important, if we have more than one site, to consider exactly how we configure
    our VPN tunnels in order to provide a balance of service and stability to our
    clients. In a situation in which two branch offices attached to a main office
    both contain fileservers synchronizing content with each other, for instance,
    it would make little or no sense to setup two VPN tunnels from the branch offices
    to the main office in a 'spoke' topology. The extra hop would, during file transfers,
    slow down internet connectivity at the main site, and make for slow transfers.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们有多个站点，考虑如何配置VPN隧道以提供服务和稳定性对我们的客户非常重要。例如，在两个附属办公室连接到一个主办公室，并且彼此包含文件服务器同步内容的情况下，从附属办公室到主办公室设置两个VPN隧道在“辐射”拓扑中几乎没有意义。在文件传输过程中，额外的跳数会减慢主站点的互联网连接速度，并导致传输速度变慢。
- en: Conversely, if we have many smaller offices with minimal requirements for site-to-site
    traffic and a head office with a large internet connection, we may decide that
    the added control of having all network activity converging through a single spot
    is worthwhile for us. As a network increases, forming individual VPN tunnels from
    site to site in a 'mesh' configuration can become very complex and hard to manage—although
    unlikely as a deployment with IPCop, such a deployment of more than a dozen or
    so servers would be increasingly hard to flexibly administer without thinking
    about using a routing protocol such as RIP or OSPF to calculate our routing tables
    for us!
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 相反，如果我们有许多较小的办公室，对站点间流量的要求很少，而总部有一个大型的互联网连接，我们可能会决定通过一个单一的地点汇聚所有网络活动的增加控制对我们而言是值得的。随着网络规模的增加，从站点到站点形成个别VPN隧道在“网状”配置中可能变得非常复杂和难以管理——尽管作为IPCop的部署不太可能，但超过十几个服务器的这样的部署将越来越难以灵活地管理，除非考虑使用路由协议（如RIP或OSPF）来计算我们的路由表！
- en: When taking your VPN design into consideration, take a moment to ascertain your
    goals in terms of redundancy and speed (is the extra burden of setting up VPNs
    from remote offices to each other worth the redundancy in case your main site
    goes down, for instance?). Work it out on paper, think about what traffic will
    be going over your VPNs, and pick the best design for you that will scale.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 在考虑VPN设计时，花一点时间来确定你的冗余和速度目标（例如，设置从远程办公室到彼此的VPN是否值得冗余，以防主站点出现故障）。在纸上计算一下，考虑一下哪些流量将通过你的VPN，然后选择最适合你的、可扩展的最佳设计。
- en: Summary
  id: totrans-116
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter we have provided a high-level overview of three scenarios in
    which IPCop may be deployed in roles that suit it, along with an analysis of the
    benefits and pitfalls of IPCop usage in these situations.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们提供了IPCop可能被部署的三种情景的高层概述，以及在这些情况下使用IPCop的好处和缺点的分析。
- en: These three topologies will be used further on in the book as case studies for
    maintenance and deployment.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 这三种拓扑将在本书中进一步用作维护和部署的案例研究。
- en: 'Topology one: A dual-homed firewall performing Network Address Translation
    for a few clients. This is an excellent drop-in replacement for a small SOHO router
    or Microsoft''s Internet Connection firewall. It is more secure, more reliable,
    and more scalable than other solutions for similar situations.'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 拓扑一：双主机防火墙执行网络地址转换，为少数客户端提供服务。这是一个很好的替代方案，可以取代小型SOHO路由器或微软的互联网连接防火墙。它比其他类似情况的解决方案更安全、更可靠、更可扩展。
- en: This topology uses IPCop's NAT features, and can use Port Forwarding for external
    services access and the Intrusion Detection System for added network security.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 这种拓扑使用了IPCop的NAT功能，并可以使用端口转发来访问外部服务，入侵检测系统用于增加网络安全性。
- en: 'Topology two: A DMZ firewall with a separate segment for externally facing
    services such as incoming mail. Typically used by a small or medium business who
    have outgrown a single-subnet network, this is a common stepping stone between
    a small network with an embedded device and a larger network with a commercial
    or medium to high-end firewall.'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 拓扑二：一个带有用于外部服务的单独段的DMZ防火墙，比如传入邮件。通常由一个小型或中型企业使用，他们已经超出了单子网网络，这是一个常见的过渡阶段，从嵌入式设备的小型网络到具有商业或中高端防火墙的大型网络。
- en: This topology uses IPCop's NAT features, as well as DMZ pinholes in order to
    allow Servers in the DMZ segment to access resources and authenticate to Servers
    in the Green zone. The Intrusion Detection system may be used for added security,
    and Port Forwarding is used in order to allow external (Red zone) access to the
    services running on hosts in the DMZ.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 这种拓扑使用了IPCop的NAT功能，以及DMZ的针孔，以允许DMZ段中的服务器访问资源并对绿色区域中的服务器进行身份验证。入侵检测系统可以用于增加安全性，端口转发用于允许外部（红色区域）访问DMZ中主机上运行的服务。
- en: 'Topology three: A DMZ firewall with separate segments for externally facing
    services such as incoming mail and for wireless access. This is typically used
    by a small or medium business that has outgrown a single-subnet network. This
    is similar to the second topology with the addition of a third internal segment,
    the Blue zone, for wireless clients on a less trusted network.'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 拓扑结构三：一个带有独立段的DMZ防火墙，用于外部服务，如传入邮件和无线访问。这通常由一个已经超出单子网网络的中小型企业使用。这类似于第二个拓扑结构，但增加了第三个内部段，即蓝区，用于不太受信任的无线客户端。
- en: This might be a common extension of topology two or a way to segment a larger
    network with two workstation segments.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 这可能是拓扑结构二的常见扩展，或者是对具有两个工作站段的较大网络进行分割的一种方式。
- en: This topology uses IPCop's NAT features, as well as DMZ pinholes in order to
    allow Servers in the DMZ segment to access resources and authenticate to Servers
    in the Green zone. The Intrusion Detection system may be used for added security,
    and Port Forwarding is used in order to allow external (Red zone) access to the
    services running on hosts in the DMZ. The IPSec server is used in order to allow
    hosts in the Blue zone to access resources in the Green and Orange zones.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 该拓扑结构使用了IPCop的NAT功能，以及DMZ针孔，以允许DMZ段中的服务器访问资源并对绿区中的服务器进行身份验证。入侵检测系统可用于增加安全性，并且端口转发用于允许外部（红区）访问DMZ中主机上运行的服务。IPSec服务器用于允许蓝区中的主机访问绿区和橙区的资源。
- en: This topology may also be used in order to segment or provide better security
    to a network without the use of wireless technology.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 该拓扑结构也可以用于对网络进行分割或提供更好的安全性，而无需使用无线技术。
