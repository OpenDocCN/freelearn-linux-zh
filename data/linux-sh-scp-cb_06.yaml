- en: Chapter 6. The Backup Plan
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第6章。备份计划
- en: 'In this chapter, we will cover:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将涵盖：
- en: Archiving with tar
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用tar进行存档
- en: Archiving with cpio
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用cpio进行存档
- en: Compressing with gunzip (gzip)
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用gunzip（gzip）进行压缩
- en: Compressing with bunzip (bzip)
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用bunzip（bzip）进行压缩
- en: Compressing with lzma
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用lzma进行压缩
- en: Archiving and compressing with zip
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用zip进行存档和压缩
- en: Heavy compression squashfs fileystem
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 重压缩squashfs文件系统
- en: Encrypting files and folders (with standard algorithms)
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用标准算法对文件和文件夹进行加密
- en: Backup snapshots with rsync
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用rsync备份快照
- en: Version controlled backups with git
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用git进行版本控制备份
- en: Cloning disks with dd
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用dd进行克隆磁盘
- en: Introduction
  id: totrans-13
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 介绍
- en: Taking snapshots and backups of data are regular tasks we come across. When
    it comes to a server or large data storage systems, regular backups are important.
    It is possible to automate backups via shell scripting. Archiving and compression
    seems to find usage in the everyday life of a system admin or a regular user.
    There are various compression formats that can be used in various ways so that
    best results can be obtained. Encryption is another task that comes under frequent
    usage for protection of data. In order to reduce the size of encrypted data, usually
    files are archived and compressed before encrypting. Many standard encryption
    algorithms are available and it can be handled with shell utilities. This chapter
    walks through different recipes for creating and maintaining files or folder archives,
    compression formats, and encrypting techniques with shell. Let's go through the
    recipes.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 数据的快照和备份是我们经常遇到的常规任务。当涉及到服务器或大型数据存储系统时，定期备份非常重要。可以通过shell脚本自动化备份。存档和压缩似乎在系统管理员或普通用户的日常生活中找到了用途。有各种压缩格式可以以各种方式使用，以便获得最佳结果。加密是另一个经常使用的任务，用于保护数据。为了减小加密数据的大小，通常在加密之前对文件进行存档和压缩。有许多标准的加密算法可供使用，并且可以使用shell实用程序进行处理。本章将介绍使用shell创建和维护文件或文件夹存档、压缩格式和加密技术的不同方法。让我们来看看这些方法。
- en: Archiving with tar
  id: totrans-15
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用tar进行存档
- en: The `tar` command can be used to archive files. It was originally designed for
    storing data on tape archives (tar). It allows you to store multiple files and
    directories as a single file. It can retain all the file attributes, such as owner,
    permissions, and so on. The file created by the `tar` command is often referred
    to as a tarball.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: '`tar`命令可用于存档文件。它最初是为了在磁带存档上存储数据而设计的。它允许您将多个文件和目录存储为单个文件。它可以保留所有文件属性，如所有者、权限等。`tar`命令创建的文件通常被称为tarball。'
- en: Getting ready
  id: totrans-17
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备就绪
- en: The `tar` command comes by default with all UNIX like operating systems. It
    has a simple syntax and is a portable file format. Let's see how to do it.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: '`tar`命令默认随所有类UNIX操作系统一起提供。它具有简单的语法，并且是一种可移植的文件格式。让我们看看如何做到这一点。'
- en: '`tar` has got a list of arguments: `A`, `c`, `d`, `r`, `t`, `u`, `x`, `f`,
    and `v`. Each of these letters can be used independently for different purposes
    corresponding to it.'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: '`tar`有一系列参数：`A`、`c`、`d`、`r`、`t`、`u`、`x`、`f`和`v`。每个字母都可以独立使用，用于相应的不同目的。'
- en: How to do it...
  id: totrans-20
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做到…
- en: 'To archive files with tar, use the following syntax:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用tar存档文件，请使用以下语法：
- en: '[PRE0]'
  id: totrans-22
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'For example:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 例如：
- en: '[PRE1]'
  id: totrans-24
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: In this command, `-c` stands for "create file" and `–f` stands for "specify
    filename".
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个命令中，`-c`代表“创建文件”，`–f`代表“指定文件名”。
- en: We can specify folders and filenames as `SOURCES`. We can use a list of file
    names or wildcards such as `*.txt` to specify the sources.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以将文件夹和文件名指定为`SOURCES`。我们可以使用文件名列表或通配符，如`*.txt`来指定源。
- en: It will archive the source files into a file called `output.tar`.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 它将源文件存档到名为`output.tar`的文件中。
- en: The filename must appear immediately after the `–f` and should be the last option
    in the argument group (for example, `-cvvf filename.tar` and `-tvvf filename.tar`).
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 文件名必须立即出现在`–f`之后，并且应该是参数组中的最后一个选项（例如，`-cvvf filename.tar`和`-tvvf filename.tar`）。
- en: We cannot pass hundreds of files or folders as command-line arguments because
    there is a limit. So it is safer to use the append option if many files are to
    be archived.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 我们不能将数百个文件或文件夹作为命令行参数传递，因为有限制。因此，如果要存档许多文件，最好使用附加选项。
- en: There's more...
  id: totrans-30
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多…
- en: Let's go through additional features that are available with the `tar` command.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看`tar`命令提供的其他功能。
- en: Appending files to an archive
  id: totrans-32
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 将文件附加到存档中
- en: Sometimes we may need to add files to an archive that already exists (an example
    usage is when thousands of files are to be archived and when they cannot be specified
    in one line as command-line arguments).
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 有时我们可能需要将文件添加到已经存在的存档中（一个示例用法是当需要存档数千个文件时，无法将它们作为命令行参数在一行中指定）。
- en: 'Append option: `-r`'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 附加选项：`-r`
- en: 'In order to append a file into an already existing archive use:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 为了将文件附加到已经存在的存档中使用：
- en: '[PRE2]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'List the files in an archive as follows:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 按如下方式列出存档中的文件：
- en: '[PRE3]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: In order to print more details while archiving or listing, use the `-v` or the
    `–vv` flag. These flags are called verbose (`v`), which will enable to print more
    details on the terminal. For example, by using verbose you could print more details,
    such as the file permissions, owner group, modification date, and so on.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 为了在存档或列表时打印更多细节，使用`-v`或`–vv`标志。这些标志称为详细（`v`），它将在终端上打印更多细节。例如，通过使用详细，您可以打印更多细节，如文件权限、所有者组、修改日期等。
- en: 'For example:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 例如：
- en: '[PRE4]'
  id: totrans-41
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Extracting files and folders from an archive
  id: totrans-42
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 从存档中提取文件和文件夹
- en: 'The following command extracts the contents of the archive to the current directory:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 以下命令将存档的内容提取到当前目录：
- en: '[PRE5]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: The `-x` option stands for extract.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: '`-x`选项代表提取。'
- en: 'When `–x` is used, the `tar` command extracts the contents of the archive to
    the current directory. We can also specify the directory where the files need
    to be extracted by using the `–C` flag, as follows:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 当使用`–x`时，`tar`命令将存档的内容提取到当前目录。我们还可以使用`–C`标志指定需要提取文件的目录，如下所示：
- en: '[PRE6]'
  id: totrans-47
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'The command extracts the contents of an archive to insert image a specified
    directory. It extracts the entire contents of the archive. We can also extract
    only a few files by specifying them as command arguments:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 该命令将归档的内容提取到指定目录中。它提取归档的全部内容。我们也可以通过将它们指定为命令参数来仅提取一些文件：
- en: '[PRE7]'
  id: totrans-49
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: The command above extracts only `file1` and `file4`,and ignores other files
    in the archive.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 上面的命令仅提取`file1`和`file4`，并忽略归档中的其他文件。
- en: stdin and stdout with tar
  id: totrans-51
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用tar的stdin和stdout
- en: While archiving, we can specify `stdout` as the output file so that another
    command appearing through a pipe can read it as `stdin` and then do some process
    or extract the archive.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 在归档时，我们可以指定`stdout`作为输出文件，以便通过管道出现的另一个命令可以将其读取为`stdin`，然后执行一些处理或提取归档。
- en: 'This is helpful in order to transfer data through a Secure Shell (SSH) connection
    (while on a network). For example:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 这对于通过安全外壳（SSH）连接传输数据很有帮助（在网络上）。例如：
- en: '[PRE8]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'In the example above, `file1`, `file2`, and `file3` are combined into a tarball
    and then extracted to `~/destination`. In this command:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 在上面的例子中，`file1`，`file2`和`file3`被合并成一个tarball，然后提取到`~/destination`。在这个命令中：
- en: '`-f` specifies `stdout` as the file for archiving (when the `-c` option used)'
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-f`指定`stdout`作为归档文件（当使用`-c`选项时）'
- en: '`-f` specifies `stdin` as the file for extracting (when the `-x` option used)'
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-f`指定`stdin`作为提取文件（当使用`-x`选项时）'
- en: Concatenating two archives
  id: totrans-58
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 连接两个归档
- en: We can easily merge multiple tar files with the `-A` option.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用`-A`选项轻松合并多个tar文件。
- en: 'Let''s pretend we have two tarballs: `file1.tar` and `file2.tar`. We can merge
    the contents of `file2.tar` to `file1.tar` as follows:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 假设我们有两个tarballs：`file1.tar`和`file2.tar`。我们可以将`file2.tar`的内容合并到`file1.tar`中，如下所示：
- en: '[PRE9]'
  id: totrans-61
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Verify it by listing the contents:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 通过列出内容来验证它：
- en: '[PRE10]'
  id: totrans-63
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: Updating files in an archive with timestamp check
  id: totrans-64
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用时间戳检查更新归档中的文件
- en: The append option appends any given file to the archive. If the same file is
    inside the archive is given to append, it will append that file and the archive
    will contain duplicates. We can use the update option `-u` to specify only append
    files that are newer than the file inside the archive with the same name.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 追加选项将任何给定的文件追加到归档中。如果在归档中有相同的文件要追加，它将追加该文件，并且归档将包含重复文件。我们可以使用更新选项`-u`来指定仅追加比归档中具有相同名称的文件更新的文件。
- en: '[PRE11]'
  id: totrans-66
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: This command lists the files in the archive.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 该命令列出归档中的文件。
- en: 'In order to append `filea` only if `filea` has newer modification time than
    `filea` inside `archive.tar`, use:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 为了仅在`filea`的修改时间比`archive.tar`中的`filea`更新时追加`filea`，使用：
- en: '[PRE12]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Nothing happens if the version of `filea` outside the archive and the `filea`
    inside `archive.tar` have the same timestamp.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 如果归档外的`filea`的版本和`archive.tar`中的`filea`具有相同的时间戳，则不会发生任何事情。
- en: 'Use the `touch` command to modify the file timestamp and then try the `tar`
    command again:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`touch`命令修改文件时间戳，然后再次尝试`tar`命令：
- en: '[PRE13]'
  id: totrans-72
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: The file is appended since its timestamp is newer than the one inside the archive.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 由于其时间戳比归档中的时间戳更新，因此文件被追加。
- en: Comparing files in archive and file system
  id: totrans-74
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 比较归档和文件系统中的文件
- en: 'Sometimes it is useful to know whether a file in the archive and a file with
    the same filename in the filesystem are the same or contain any differences. The
    `–d` flag can be used to print the differences:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 有时候知道归档中的文件和文件系统中具有相同文件名的文件是否相同或包含任何差异是有用的。`–d`标志可用于打印差异：
- en: '[PRE14]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'For example:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 例如：
- en: '[PRE15]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: Deleting files from archive
  id: totrans-79
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 从归档中删除文件
- en: 'We can remove files from a given archive using the `–delete` option. For example:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用`–delete`选项从给定的归档中删除文件。例如：
- en: '[PRE16]'
  id: totrans-81
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Let''s see another example:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看另一个例子：
- en: '[PRE17]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'Or, we can also use the following syntax:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，我们也可以使用以下语法：
- en: '[PRE18]'
  id: totrans-85
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'For example:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 例如：
- en: '[PRE19]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: Compression with tar archive
  id: totrans-88
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用tar归档进行压缩
- en: 'The `tar` command only archives files, it does not compress them. For this
    reason, most people usually add some form of compression when working with tarballs.
    This significantly decreases the size of the files. Tarballs are often compressed
    into one of the following formats:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: '`tar`命令只对文件进行归档，不对其进行压缩。因此，大多数人在处理tarballs时通常会添加某种形式的压缩。这显着减小了文件的大小。Tarballs通常被压缩成以下格式之一：'
- en: '`file.tar.gz`'
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`file.tar.gz`'
- en: '`file.tar.bz2`'
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`file.tar.bz2`'
- en: '`file.tar.lzma`'
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`file.tar.lzma`'
- en: '`file.tar.lzo`'
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`file.tar.lzo`'
- en: Different `tar` flags are used to specify different compression formats.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 不同的`tar`标志用于指定不同的压缩格式。
- en: '`-j` for bunzip2'
  id: totrans-95
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-j`用于bunzip2'
- en: '`-z` for gzip'
  id: totrans-96
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-z`用于gzip'
- en: '`--lzma` for lzma'
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--lzma`用于lzma'
- en: They are explained in the following compression-specific recipes.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 它们在以下特定于压缩的配方中有解释。
- en: It is possible to use compression formats without explicitly specifying special
    options as above. `tar` can compress by looking at the given extension of the
    output or input file names. In order for `tar` to support compression automatically
    by looking at the extensions, use `-a` or `--auto-compress` with `tar`.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 可以使用压缩格式而不明确指定特殊选项。`tar`可以通过查看输出或输入文件名的给定扩展名来进行压缩。为了使`tar`通过查看扩展名自动支持压缩，请使用`-a`或`--auto-compress`与`tar`。
- en: Excluding a set of files from archiving
  id: totrans-100
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 从归档中排除一组文件
- en: It is possible to exclude a set of files from archiving by specifying patterns.
    Use `--exclude [PATTERN]` for excluding files matched by wildcard patterns.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 可以通过指定模式来排除一组文件不进行归档。使用`--exclude [PATTERN]`来排除与通配符模式匹配的文件。
- en: 'For example, to exclude all `.txt` files from archiving use:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，要排除所有`.txt`文件不进行归档，请使用：
- en: '[PRE20]'
  id: totrans-103
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: Tip
  id: totrans-104
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: Note that the pattern should be enclosed in double quotes.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，模式应该用双引号括起来。
- en: 'It is also possible to exclude a list of files provided in a list file with
    the `-X` flag as follows:'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 还可以使用`-X`标志排除列表文件中提供的文件列表，如下所示：
- en: '[PRE21]'
  id: totrans-107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: Now it excludes `filea` and `fileb` from archiving.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 现在排除了`filea`和`fileb`不进行归档。
- en: Excluding version control directories
  id: totrans-109
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 排除版本控制目录
- en: We usually use tarballs for distributing source code. Most of the source code
    is maintained using version control systems such as subversion, Git, mercurial,
    cvs, and so on. Code directories under version control will contain special directories
    used to manage versions like `.svn` or `.git`. However, these directories aren't
    needed by the code itself and so should be eliminated from the tarball of the
    source code.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 我们通常使用tarballs来分发源代码。大多数源代码是使用诸如subversion、Git、mercurial、cvs等版本控制系统进行维护的。版本控制下的代码目录将包含用于管理版本的特殊目录，如`.svn`或`.git`。但是，这些目录对代码本身并不需要，因此应该从源代码的tarball中删除。
- en: 'In order to exclude version control related files and directories while archiving
    use the `--exclude-vcs` option along with `tar`. For example:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 为了在归档时排除与版本控制相关的文件和目录，请使用`tar`的`--exclude-vcs`选项。例如：
- en: '[PRE22]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: Printing total bytes
  id: totrans-113
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 打印总字节数
- en: 'It is sometimes useful if we can print total bytes copied to the archive. Print
    the total bytes copied after archiving by using the --`totals` option as follows:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们可以打印复制到归档中的总字节数，有时会很有用。通过使用`--totals`选项在归档后打印复制的总字节数，如下所示：
- en: '[PRE23]'
  id: totrans-115
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: See also
  id: totrans-116
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另请参阅
- en: '*Compressing with gunzip (gzip)*, explains the gzip command'
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*使用gunzip（gzip）进行压缩*，解释了gzip命令'
- en: '*Compressing with bunzip (bzip2)*, explains the bzip2 command'
  id: totrans-118
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*使用bunzip（bzip2）进行压缩*，解释了bzip2命令'
- en: '*Compressing with lzma*, explains the lzma command'
  id: totrans-119
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*使用lzma进行压缩*，解释了lzma命令'
- en: Archiving with cpio
  id: totrans-120
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用cpio进行归档
- en: '**cpio** is another archiving format similar to `tar`. It is used to store
    files and directories in a file with attributes such as permissions, ownership,
    and so on. But it is not commonly used as much as `tar`. However, `cpio` seems
    to be used in RPM package archives, initramfs files for the Linux kernel, and
    so on. This recipe will give minimal usage examples of `cpio`.'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: '**cpio**是另一种类似于`tar`的归档格式。它用于将文件和目录存储在具有权限、所有权等属性的文件中。但是它并不像`tar`那样常用。然而，`cpio`似乎被用于RPM软件包归档、Linux内核的initramfs文件等。本文将提供`cpio`的最小使用示例。'
- en: How to do it...
  id: totrans-122
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做...
- en: '`cpio` takes input filenames through `stdin` and it writes the archive into
    `stdout`. We have to redirect `stdout` to a file to receive the output `cpio`
    file as follows:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: '`cpio`通过`stdin`接受输入文件名，并将归档写入`stdout`。我们必须将`stdout`重定向到文件以接收输出的`cpio`文件，如下所示：'
- en: 'Create test files:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 创建测试文件：
- en: '[PRE24]'
  id: totrans-125
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'We can archive the test files as follows:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以将测试文件归档如下：
- en: '[PRE25]'
  id: totrans-127
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'In this command:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 在此命令中：
- en: '`-o` specifies the output'
  id: totrans-129
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-o`指定输出'
- en: '`-v` is used for printing a list of files archived'
  id: totrans-130
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-v`用于打印已归档文件的列表'
- en: Note
  id: totrans-131
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: By using `cpio`, we can also archive using files as absolute paths. `/usr/somedir`
    is an absolute path as it contains the full path starting from root (`/`).
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 通过使用`cpio`，我们还可以使用文件的绝对路径进行归档。`/usr/somedir`是一个绝对路径，因为它包含了从根目录(`/`)开始的完整路径。
- en: A relative path will not start with `/` but it starts the path from the current
    directory. For example, `test/file` means that there is a directory `test` and
    the `file` is inside the `test` directory.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 相对路径不会以`/`开头，但它从当前目录开始。例如，`test/file`表示有一个名为`test`的目录，`file`在`test`目录内。
- en: While extracting, `cpio` extracts to the absolute path itself. But incase of
    `tar` it removes the `/` in the absolute path and converts it as relative path.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 在提取时，`cpio`提取到绝对路径本身。但是在`tar`中，它会删除绝对路径中的`/`，并将其转换为相对路径。
- en: 'In order to list files in a `cpio` archive use the following command:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 为了列出`cpio`归档中的文件，请使用以下命令：
- en: '[PRE26]'
  id: totrans-136
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'This command will list all the files in the given `cpio` archive. It reads
    the files from `stdin`. In this command:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 此命令将列出给定`cpio`归档中的所有文件。它从`stdin`读取文件。在此命令中：
- en: '`-i` is for specifying the input'
  id: totrans-138
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-i`用于指定输入'
- en: '`-t` is for listing'
  id: totrans-139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-t`用于列出'
- en: 'In order to extract files from the `cpio` archive use:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 为了从`cpio`归档中提取文件，请使用：
- en: '[PRE27]'
  id: totrans-141
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: Here, `-d` is used for extracting.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 这里，`-d`用于提取。
- en: It overwrites files without prompting. If the absolute path files are present
    in the archive, it will replace the files at that path. It will not extract files
    in the current directory like `tar`.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 它会在不提示的情况下覆盖文件。如果归档中存在绝对路径文件，它将替换该路径下的文件。它不会像`tar`那样在当前目录中提取文件。
- en: Compressing with gunzip (gzip)
  id: totrans-144
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用gunzip（gzip）进行压缩
- en: '**gzip** is a commonly used compression format in GNU/Linux platforms. Utilities
    such as `gzip`, `gunzip`, and `zcat` are available to handle gzip compression
    file types. `gzip` can be applied on a file only. It cannot archive directories
    and multiple files. Hence we use a `tar` archive and compress it with `gzip`.
    When multiple files are given as input it will produce several individually compressed
    (`.gz`) files. Let''s see how to operate with `gzip`.'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: '**gzip**是GNU/Linux平台上常用的压缩格式。可用的实用程序包括`gzip`、`gunzip`和`zcat`，用于处理gzip压缩文件类型。`gzip`只能应用于文件。它不能归档目录和多个文件。因此我们使用`tar`归档并用`gzip`压缩。当多个文件作为输入时，它将产生多个单独压缩（`.gz`）文件。让我们看看如何使用`gzip`。'
- en: How to do it...
  id: totrans-146
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做...
- en: 'In order to compress a file with `gzip` use the following command:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使用`gzip`压缩文件，请使用以下命令：
- en: '[PRE28]'
  id: totrans-148
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: Then it will remove the file and produce a compressed file called `filename.gz`.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 然后它将删除该文件并生成名为`filename.gz`的压缩文件。
- en: 'Extract a `gzip` compressed file as follows:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 提取`gzip`压缩文件如下：
- en: '[PRE29]'
  id: totrans-151
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: It will remove `filename.gz` and produce an uncompressed version of `filename.gz`.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 它将删除`filename.gz`并生成`filename.gz`的未压缩版本。
- en: 'In order to list out the properties of a compressed file use:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 为了列出压缩文件的属性，请使用：
- en: '[PRE30]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: The `gzip` command can read a file from `stdin` and also write a compressed
    file into `stdout`.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: '`gzip`命令可以从`stdin`读取文件，并将压缩文件写入`stdout`。'
- en: 'Read from `stdin` and out as `stdout` as follows:'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 从`stdin`读取并输出到`stdout`如下：
- en: '[PRE31]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: The `-c` option is used to specify output to `stdout`.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: '`-c`选项用于指定输出到`stdout`。'
- en: We can specify the compression level for `gzip`. Use `--fast` or the `--best`
    option to provide low and high compression ratios, respectively.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以为`gzip`指定压缩级别。使用`--fast`或`--best`选项分别提供低和高的压缩比。
- en: There's more...
  id: totrans-160
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: The `gzip` command is often used with other commands. It also has advanced options
    to specify the compression ratio. Let's see how to work with these features.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: '`gzip`命令通常与其他命令一起使用。它还有高级选项来指定压缩比。让我们看看如何使用这些功能。'
- en: Gzip with tarball
  id: totrans-162
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用tarball的gzip
- en: We usually use `gzip` with tarballs. A tarball can be compressed by using the
    `–z` option passed to the `tar` command while archiving and extracting.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 我们通常使用`gzip`与tarballs。可以通过在归档和提取时传递`-z`选项给`tar`命令来压缩tarball。
- en: 'You can create gzipped tarballs using the following methods:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用以下方法创建gzipped tarballs：
- en: '**Method - 1**'
  id: totrans-165
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**方法-1**'
- en: '[PRE32]'
  id: totrans-166
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'Or:'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 或：
- en: '[PRE33]'
  id: totrans-168
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: The `-a` option specifies that the compression format should automatically be
    detected from the extension.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: '`-a`选项指定应自动从扩展名检测压缩格式。'
- en: '**Method - 2**'
  id: totrans-170
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**方法-2**'
- en: 'First, create a tarball:'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，创建一个tarball：
- en: '[PRE34]'
  id: totrans-172
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'Compress it after tarballing as follows:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 在打包后进行压缩如下：
- en: '[PRE35]'
  id: totrans-174
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'If many files (a few hundreds) are to be archived in a tarball and need to
    be compressed, we use Method - 2 with few changes. The issue with giving many
    files as command arguments to `tar` is that it can accept only a limited number
    of files from the command line. In order to solve this issue, we can create a
    `tar` file by adding files one by one using a loop with an append option (`-r`)
    as follows:'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 如果有许多文件（几百个）需要在一个tarball中进行归档并进行压缩，我们使用方法-2并进行少量更改。使用`tar`将许多文件作为命令参数的问题是它只能从命令行接受有限数量的文件。为了解决这个问题，我们可以使用循环逐个添加文件并使用附加选项（`-r`）创建一个`tar`文件，如下所示：
- en: '[PRE36]'
  id: totrans-176
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'In order to extract a gzipped tarball, use the following:'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 为了提取一个gzipped tarball，使用以下命令：
- en: '`-x` for extraction'
  id: totrans-178
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: -x 用于提取
- en: '`-z` for gzip specification'
  id: totrans-179
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-z`用于gzip规范'
- en: 'Or:'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 或：
- en: '[PRE37]'
  id: totrans-181
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: In the above command, the `-a` option is used to detect the compression format
    automatically.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 在上述命令中，使用`-a`选项自动检测压缩格式。
- en: zcat – reading gzipped files without extracting
  id: totrans-183
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: zcat-读取gzipped文件而不解压
- en: '`zcat` is a command that can be used to dump an extracted file from a `.gz`
    file to `stdout` without manually extracting it. The `.gz` file remains as before
    but it will dump the extracted file into `stdout` as follows:'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: '`zcat`是一个命令，可用于从`.gz`文件中转储提取的文件到`stdout`，而无需手动提取它。`.gz`文件仍然与以前一样，但它将提取的文件转储到`stdout`，如下所示：'
- en: '[PRE38]'
  id: totrans-185
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: Compression ratio
  id: totrans-186
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 压缩比
- en: 'We can specify compression ratio, which is available in range 1 to 9, where:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以指定压缩比，可在1到9的范围内使用，其中：
- en: 1 is the lowest, but fastest
  id: totrans-188
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1是最低的，但速度最快
- en: 9 is the best, but slowest
  id: totrans-189
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 9是最好的，但速度最慢
- en: 'You can also specify the ratios in between as follows:'
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以在之间指定比率，如下所示：
- en: '[PRE39]'
  id: totrans-191
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: This will compress the file to the maximum.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 这将将文件压缩到最大。
- en: See also
  id: totrans-193
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另请参阅
- en: '*Archiving with tar*, explains the tar command'
  id: totrans-194
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*使用tar进行归档*，解释了tar命令'
- en: Compressing with bunzip (bzip)
  id: totrans-195
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用bunzip（bzip）进行压缩
- en: '**bunzip2** is another compression technique which is very similar to `gzip`.
    `bzip2` typically produces smaller (more compressed) files than `gzip`. It comes
    with all Linux distributions. Let''s see how to use `bzip2`.'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: '**bunzip2**是另一种与`gzip`非常相似的压缩技术。`bzip2`通常比`gzip`产生更小（更压缩）的文件。它随所有Linux发行版一起提供。让我们看看如何使用`bzip2`。'
- en: How to do it...
  id: totrans-197
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做...
- en: 'In order to compress with `bzip2` use:'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使用`bzip2`进行压缩，使用：
- en: '[PRE40]'
  id: totrans-199
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: Then it will remove the file and produce a compressed file called `filename.bzip2`.
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 然后它将删除文件并生成一个名为`filename.bzip2`的压缩文件。
- en: 'Extract a bzipped file as follows:'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 提取一个bzipped文件如下：
- en: '[PRE41]'
  id: totrans-202
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: It will remove `filename.bz2` and produce an uncompressed version of `filename`.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 它将删除`filename.bz2`并产生一个未压缩版本的`filename`。
- en: '`bzip2` can read a file from `stdin` and also write a compressed file into
    `stdout`.'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: '`bzip2`可以从`stdin`读取文件，并将压缩文件写入`stdout`。'
- en: 'In order to read from `stdin` and read out as `stdout` use:'
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 为了从`stdin`读取并作为`stdout`读取，请使用：
- en: '[PRE42]'
  id: totrans-206
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: '`-c` is used to specify output to `stdout`.'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: '`-c`用于指定输出到`stdout`。'
- en: We usually use `bzip2` with tarballs. A tarball can be compressed by using the
    `-j` option passed to the `tar` command while archiving and extracting.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 我们通常使用`bzip2`与tarballs。可以通过在归档和提取时传递`-j`选项给`tar`命令来压缩tarball。
- en: 'Creating a bzipped tarball can be done by using the following methods:'
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 可以通过以下方法创建一个bzipped tarball：
- en: '**Method - 1**'
  id: totrans-210
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**方法-1**'
- en: '[PRE43]'
  id: totrans-211
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: 'Or:'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 或：
- en: '[PRE44]'
  id: totrans-213
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: The `-a` option specifies to automatically detect compression format from the
    extension.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: '`-a`选项指定自动从扩展名检测压缩格式。'
- en: '**Method - 2**'
  id: totrans-215
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**方法-2**'
- en: 'First create the tarball:'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 首先创建tarball：
- en: '[PRE45]'
  id: totrans-217
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: 'Compress it after tarballing:'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 在tarball后进行压缩：
- en: '[PRE46]'
  id: totrans-219
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: If we need to add hundreds of files to the archive, the above commands may fail.
    To fix that issue, use a loop to append files to the archive one by one using
    the `–r` option. See the similar section from the recipe, *Compressing with gunzip
    (gzip)*.
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们需要将数百个文件添加到存档中，则上述命令可能会失败。要解决此问题，请使用循环逐个使用`-r`选项将文件附加到存档中。请参阅食谱中的类似部分，*使用gunzip（gzip）进行压缩*。
- en: 'Extract a bzipped tarball as follows:'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 提取一个bzipped tarball如下：
- en: '[PRE47]'
  id: totrans-222
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'In this command:'
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个命令中：
- en: '`-x` is used for extraction'
  id: totrans-224
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-x`用于提取'
- en: '`-j` is for `bzip2` specification'
  id: totrans-225
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-j`是用于`bzip2`规范'
- en: '`-C` is for specifying the directory to which the files are to be extracted'
  id: totrans-226
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-C`用于指定要提取文件的目录'
- en: 'Or, you can use the following command:'
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，您可以使用以下命令：
- en: '[PRE48]'
  id: totrans-228
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: '`-a` will automatically detect the compression format.'
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: '`-a`将自动检测压缩格式。'
- en: There's more...
  id: totrans-230
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: bunzip has several additional options to carry out different functions. Let's
    go through few of them.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: bunzip有几个附加选项来执行不同的功能。让我们浏览其中的一些。
- en: Keeping input files without removing them
  id: totrans-232
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 保留输入文件而不删除它们
- en: While using `bzip2` or `bunzip2`, it will remove the input file and produce
    a compressed output file. But we can prevent it from removing input files by using
    the `–k` option.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 在使用`bzip2`或`bunzip2`时，它将删除输入文件并生成一个压缩的输出文件。但是我们可以使用`-k`选项防止它删除输入文件。
- en: 'For example:'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 例如：
- en: '[PRE49]'
  id: totrans-235
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: Compression ratio
  id: totrans-236
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 压缩比
- en: We can specify the compression ratio, which is available in the range of 1 to
    9 (where 1 is the least compression, but fast, and 9 is the highest possible compression
    but much slower).
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以指定压缩比，可在1到9的范围内使用（其中1是最少压缩，但速度快，9是最高可能的压缩，但要慢得多）。
- en: 'For example:'
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 例如：
- en: '[PRE50]'
  id: totrans-239
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: This command provides maximum compression.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 此命令提供最大压缩。
- en: See also
  id: totrans-241
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另请参阅
- en: '*Archiving with tar*, explains the tar command'
  id: totrans-242
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*使用tar进行归档*，解释了tar命令'
- en: Compressing with lzma
  id: totrans-243
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用lzma进行压缩
- en: '**lzma** is comparatively new when compared to `gzip` or `bzip2`. `lzma` offers
    better compression rates than `gzip` or `bzip2`. As `lzma` is not preinstalled
    on most Linux distros, you may need to install it using the package manager.'
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: '**lzma**与`gzip`或`bzip2`相比相对较新。`lzma`的压缩率比`gzip`或`bzip2`更高。由于大多数Linux发行版上没有预安装`lzma`，您可能需要使用软件包管理器进行安装。'
- en: How to do it...
  id: totrans-245
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做到...
- en: 'In order to compress with `lzma` use the following command:'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使用`lzma`进行压缩，请使用以下命令：
- en: '[PRE51]'
  id: totrans-247
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: This will remove the file and produce a compressed file called `filename.lzma`.
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 这将删除文件并生成名为`filename.lzma`的压缩文件。
- en: 'To extract an `lzma` file use:'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 要提取`lzma`文件，请使用：
- en: '[PRE52]'
  id: totrans-250
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: This will remove `filename.lzma` and produce an uncompressed version of the
    file.
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 这将删除`filename.lzma`并生成文件的未压缩版本。
- en: The `lzma` command can also read a file from `stdin` and write the compressed
    file to `stdout`.
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: '`lzma`命令还可以从`stdin`读取文件并将压缩文件写入`stdout`。'
- en: 'In order to read from `stdin` and read out as `stdout` use:'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 为了从`stdin`读取并作为`stdout`读取，请使用：
- en: '[PRE53]'
  id: totrans-254
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: '`-c` is used to specify output to `stdout`.'
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: '`-c`用于指定输出到`stdout`。'
- en: We usually use `lzma` with tarballs. A tarball can be compressed by using the
    `--lzma` option passed to the `tar` command while archiving and extracting.
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 我们通常使用`lzma`与tarballs。可以通过在归档和提取时传递`--lzma`选项给`tar`命令来压缩tarball。
- en: 'There are two methods to create a `lzma` tarball:'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 有两种方法可以创建`lzma` tarball：
- en: '**Method - 1**'
  id: totrans-258
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**方法-1**'
- en: '[PRE54]'
  id: totrans-259
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: 'Or:'
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 或者：
- en: '[PRE55]'
  id: totrans-261
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: The `-a` option specifies to automatically detect the compression format from
    the extension.
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: '`-a`选项指定自动从扩展名中检测压缩格式。'
- en: '**Method - 2**'
  id: totrans-263
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**方法-2**'
- en: 'First, create the tarball:'
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，创建tarball：
- en: '[PRE56]'
  id: totrans-265
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: 'Compress it after tarballing:'
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 在tarball后进行压缩：
- en: '[PRE57]'
  id: totrans-267
  prefs: []
  type: TYPE_PRE
  zh: '[PRE57]'
- en: If we need to add hundreds of files to the archive, the above commands may fail.
    To fix that issue, use a loop to append files to the archive one by one using
    the `–r` option. See the similar section from the recipe, *Compressing with gunzip
    (gzip)*.
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们需要将数百个文件添加到存档中，则上述命令可能会失败。为了解决这个问题，使用循环使用`-r`选项逐个将文件附加到存档中。请参阅配方中的类似部分，*使用gunzip（gzip）进行压缩*。
- en: There's more...
  id: totrans-269
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: Let's go through additional options associated with `lzma` utilities
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看与`lzma`实用程序相关的其他选项
- en: Extracting an lzma tarball
  id: totrans-271
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提取lzma tarball
- en: 'In order to extract a tarball compressed with `lzma` compression to a specified
    directory, use:'
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 为了将使用`lzma`压缩的tarball提取到指定目录，请使用：
- en: '[PRE58]'
  id: totrans-273
  prefs: []
  type: TYPE_PRE
  zh: '[PRE58]'
- en: In this command, `-x` is used for extraction. `--lzma` specifies the use of
    `lzma` to decompress the resulting file.
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个命令中，`-x`用于提取。`--lzma`指定使用`lzma`来解压缩生成的文件。
- en: 'Or, we could also use:'
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，我们也可以使用：
- en: '[PRE59]'
  id: totrans-276
  prefs: []
  type: TYPE_PRE
  zh: '[PRE59]'
- en: The `-a` option specifies to automatically detect the compression format from
    the extension.
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: '`-a`选项指定自动从扩展名中检测压缩格式。'
- en: Keeping input files without removing them
  id: totrans-278
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 保留输入文件而不删除它们
- en: 'While using `lzma` or `unlzma`, it will remove the input file and produce an
    output file. But we can prevent from removing input files and keep them by using
    the `-k` option. For example:'
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 在使用`lzma`或`unlzma`时，它将删除输入文件并生成输出文件。但是我们可以使用`-k`选项防止删除输入文件并保留它们。例如：
- en: '[PRE60]'
  id: totrans-280
  prefs: []
  type: TYPE_PRE
  zh: '[PRE60]'
- en: Compression ratio
  id: totrans-281
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 压缩比
- en: We can specify the compression ratio, which is available in the range of 1 to
    9 (where 1 is the least compression, but fast, and 9 is the highest possible compression
    but much slower).
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以指定压缩比，可在1到9的范围内选择（1表示最小压缩，但速度快，9表示最大可能的压缩，但速度慢）。
- en: 'You can also specify ratios in between as follows:'
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以按照以下方式指定比率：
- en: '[PRE61]'
  id: totrans-284
  prefs: []
  type: TYPE_PRE
  zh: '[PRE61]'
- en: This command compresses the file to the maximum.
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 此命令将文件压缩到最大。
- en: See also
  id: totrans-286
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另请参阅
- en: '*Archiving with tar*, explains the tar command'
  id: totrans-287
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*使用tar进行归档*，解释了tar命令'
- en: Archiving and compressing with zip
  id: totrans-288
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用zip进行归档和压缩
- en: ZIP is a popular compression format used on many platforms. It isn't as commonly
    used as `gzip` or `bzip2` on Linux platforms, but files from the Internet are
    often saved in this format.
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: ZIP是许多平台上常用的压缩格式。在Linux平台上，它不像`gzip`或`bzip2`那样常用，但是互联网上的文件通常以这种格式保存。
- en: How to do it...
  id: totrans-290
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做到...
- en: 'In order to archive with ZIP, the following syntax is used:'
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使用ZIP进行归档，使用以下语法：
- en: '[PRE62]'
  id: totrans-292
  prefs: []
  type: TYPE_PRE
  zh: '[PRE62]'
- en: 'For example:'
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 例如：
- en: '[PRE63]'
  id: totrans-294
  prefs: []
  type: TYPE_PRE
  zh: '[PRE63]'
- en: Here, the `file.zip` file will be produced.
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，将生成`file.zip`文件。
- en: 'Archive directories and files recursively as follows:'
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 递归存档目录和文件如下：
- en: '[PRE64]'
  id: totrans-297
  prefs: []
  type: TYPE_PRE
  zh: '[PRE64]'
- en: In this command, `-r` is used for specifying recursive.
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个命令中，`-r`用于指定递归。
- en: Unlike `lzma`, `gzip`, or `bzip2`, `zip` won't remove the source file after
    archiving. `zip` is similar to `tar` in that respect, but `zip` can compress files
    where `tar` does not. However, `zip` adds compression too.
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: 与`lzma`，`gzip`或`bzip2`不同，`zip`在归档后不会删除源文件。`zip`在这方面类似于`tar`，但`zip`可以压缩`tar`无法压缩的文件。但是，`zip`也添加了压缩。
- en: 'In order to extract files and folders in a ZIP file, use:'
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: 为了提取ZIP文件中的文件和文件夹，请使用：
- en: '[PRE65]'
  id: totrans-301
  prefs: []
  type: TYPE_PRE
  zh: '[PRE65]'
- en: It will extract the files without removing `filename.zip` (unlike `unlzma` or
    `gunzip`).
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: 它将提取文件而不删除`filename.zip`（不像`unlzma`或`gunzip`）。
- en: 'In order to update files in the archive with newer files in the filesystem,
    use the `-u` flag:'
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使用文件系统中的新文件更新存档中的文件，请使用`-u`标志：
- en: '[PRE66]'
  id: totrans-304
  prefs: []
  type: TYPE_PRE
  zh: '[PRE66]'
- en: 'Delete a file from a zipped archive, by using `–d` as follows:'
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: 通过使用`-d`来从压缩存档中删除文件，如下所示：
- en: '[PRE67]'
  id: totrans-306
  prefs: []
  type: TYPE_PRE
  zh: '[PRE67]'
- en: 'In order to list the files in an archive use:'
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
  zh: 为了列出存档中的文件，请使用：
- en: '[PRE68]'
  id: totrans-308
  prefs: []
  type: TYPE_PRE
  zh: '[PRE68]'
- en: squashfs – the heavy compression filesystem
  id: totrans-309
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: squashfs-重压缩文件系统
- en: '**squashfs** is a heavy-compression based read-only filesystem that is capable
    of compressing 2 to 3GB of data onto a 700 MB file. Have you ever thought of how
    Linux Live CDs work? When a Live CD is booted it loads a complete Linux environment.
    Linux Live CDs make use of a read-only compressed filesystem called squashfs.
    It keeps the root filesystem on a compressed filesystem file. It can be loopback
    mounted and files can be accessed. Thus when some files are required by processes,
    they are decompressed and loaded onto the RAM and used. Knowledge of squashfs
    can be useful when building a custom live OS or when required to keep files heavily
    compressed and to access them without entirely extracting the files. For extracting
    a large compressed file, it will take a long time. However, if a file is loopback
    mounted, it will be very fast since the required portion of the compressed files
    are only decompressed when the request for files appear. In regular decompression,
    all the data is decompressed first. Let''s see how we can use squashfs.'
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: '**squashfs**是一种基于重压缩的只读文件系统，能够将2到3GB的数据压缩到700MB的文件中。您是否曾经想过Linux Live CD是如何工作的？当启动Live
    CD时，它加载完整的Linux环境。Linux Live CD使用名为squashfs的只读压缩文件系统。它将根文件系统保留在一个压缩的文件系统文件中。它可以进行回环挂载并访问文件。因此，当进程需要一些文件时，它们会被解压缩并加载到RAM中并被使用。当构建自定义的实时操作系统或需要保持文件高度压缩并且无需完全提取文件时，了解squashfs可能是有用的。对于提取大型压缩文件，需要很长时间。但是，如果文件进行回环挂载，它将非常快，因为只有在出现文件请求时才会解压缩压缩文件的所需部分。在常规解压缩中，首先解压缩所有数据。让我们看看如何使用squashfs。'
- en: Getting ready
  id: totrans-311
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: If you have an Ubuntu CD just locate a `.squashfs` file at `CDRom ROOT/casper/filesystem.squashfs`.
    `squashfs` internally uses compression algorithms such as `gzip` and `lzma`. `squashfs`
    support is available in all of the latest Linux distros. However, in order to
    create `squashfs` files, an additional package **squashfs-tools** needs to be
    installed from package manager.
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您有Ubuntu CD，只需在`CDRom ROOT/casper/filesystem.squashfs`中找到`.squashfs`文件。`squashfs`内部使用压缩算法，如`gzip`和`lzma`。`squashfs`支持在所有最新的Linux发行版中都可用。但是，为了创建`squashfs`文件，需要从软件包管理器安装额外的软件包**squashfs-tools**。
- en: How to do it...
  id: totrans-313
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做...
- en: 'In order to create a `squashfs` file by adding source directories and files,
    use:'
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: 为了通过添加源目录和文件创建`squashfs`文件，请使用：
- en: '[PRE69]'
  id: totrans-315
  prefs: []
  type: TYPE_PRE
  zh: '[PRE69]'
- en: Sources can be wildcards, or file, or folder paths.
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: 源可以是通配符、文件或文件夹路径。
- en: 'For example:'
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: 例如：
- en: '[PRE70]'
  id: totrans-318
  prefs: []
  type: TYPE_PRE
  zh: '[PRE70]'
- en: 'In order to mount the `squashfs` file to a mount point, use loopback mounting
    as follows:'
  id: totrans-319
  prefs: []
  type: TYPE_NORMAL
  zh: 为了将`squashfs`文件挂载到挂载点，使用回环挂载如下：
- en: '[PRE71]'
  id: totrans-320
  prefs: []
  type: TYPE_PRE
  zh: '[PRE71]'
- en: You can copy contents by accessing `/mnt/squashfs`.
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过访问`/mnt/squashfs`来复制内容。
- en: There's more...
  id: totrans-322
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: The `squashfs` file system can be created by specifying additional parameters.
    Let's go through the additional options.
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
  zh: 可以通过指定附加参数来创建`squashfs`文件系统。让我们看看附加选项。
- en: Excluding files while creating a squashfs file
  id: totrans-324
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在创建squashfs文件时排除文件
- en: While creating a `squashfs` file, we can exclude a list of files or a file pattern
    specified using wildcards.
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
  zh: 在创建`squashfs`文件时，可以使用通配符指定要排除的文件或文件模式的列表。
- en: 'Exclude a list of files specified as command-line arguments by using the `-e`
    option. For example:'
  id: totrans-326
  prefs: []
  type: TYPE_NORMAL
  zh: 通过使用`-e`选项，可以排除作为命令行参数指定的文件列表。例如：
- en: '[PRE72]'
  id: totrans-327
  prefs: []
  type: TYPE_PRE
  zh: '[PRE72]'
- en: The `–e` option is used to exclude `passwd` and `shadow` files.
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
  zh: '`-e`选项用于排除`passwd`和`shadow`文件。'
- en: 'It is also possible to specify a list of exclude files given in a file with
    `–ef` as follows:'
  id: totrans-329
  prefs: []
  type: TYPE_NORMAL
  zh: 也可以使用`-ef`指定要排除的文件列表。
- en: '[PRE73]'
  id: totrans-330
  prefs: []
  type: TYPE_PRE
  zh: '[PRE73]'
- en: If we want to support wildcards in excludes lists, use `-wildcard` as an argument.
  id: totrans-331
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们想在排除列表中支持通配符，请使用`-wildcard`作为参数。
- en: Cryptographic tools and hashes
  id: totrans-332
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 加密工具和哈希
- en: Encryption techniques are used mainly to protect data from unauthorized access.
    There are many algorithms available and we use a common set of standard algorithms.
    There are a few tools available in a Linux environment for performing encryption
    and decryption. Sometimes we use encryption algorithm hashes for verifying data
    integrity. This section will introduce a few commonly-used cryptographic tools
    and a general set of algorithms that these tools can handle.
  id: totrans-333
  prefs: []
  type: TYPE_NORMAL
  zh: 加密技术主要用于保护数据免受未经授权的访问。有许多可用的算法，我们使用一组常见的标准算法。在Linux环境中有一些可用的工具用于执行加密和解密。有时我们使用加密算法哈希来验证数据完整性。本节将介绍一些常用的加密工具和这些工具可以处理的一般算法。
- en: How to do it...
  id: totrans-334
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做...
- en: 'Let''s see how to use the tools such as crypt, gpg, base64, md5sum, sha1sum,
    and openssl:'
  id: totrans-335
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看如何使用诸如crypt、gpg、base64、md5sum、sha1sum和openssl等工具：
- en: '**crypt**'
  id: totrans-336
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**crypt**'
- en: The `crypt` command is a simple cryptographic utility, which takes a file from
    `stdin` and a passphrase as input and outputs encrypted data into `stdout`.
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
  zh: '`crypt`命令是一个简单的加密实用程序，它从`stdin`获取文件和密码作为输入，并将加密数据输出到`stdout`。'
- en: '[PRE74]'
  id: totrans-338
  prefs: []
  type: TYPE_PRE
  zh: '[PRE74]'
- en: It will interactively ask for a passphrase. We can also provide a passphrase
    through command-line arguments.
  id: totrans-339
  prefs: []
  type: TYPE_NORMAL
  zh: 它将交互式地要求输入密码。我们也可以通过命令行参数提供密码。
- en: '[PRE75]'
  id: totrans-340
  prefs: []
  type: TYPE_PRE
  zh: '[PRE75]'
- en: 'In order to decrypt the file use:'
  id: totrans-341
  prefs: []
  type: TYPE_NORMAL
  zh: 要解密文件，请使用：
- en: '[PRE76]'
  id: totrans-342
  prefs: []
  type: TYPE_PRE
  zh: '[PRE76]'
- en: '**gpg (GNU privacy guard)**'
  id: totrans-343
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**gpg（GNU隐私保护）**'
- en: gpg (GNU privacy guard) is a widely-used encryption scheme used for protecting
    files with key signing techniques that enables to access data by authentic destination
    only. gpg signatures are very famous. The details of gpg are outside the scope
    of this book. Here we can learn how to encrypt and decrypt a file.
  id: totrans-344
  prefs: []
  type: TYPE_NORMAL
  zh: gpg（GNU隐私保护）是一种广泛使用的加密方案，用于通过密钥签名技术保护文件，使得只有认证目标才能访问数据。gpg签名非常有名。gpg的详细信息超出了本书的范围。在这里，我们可以学习如何加密和解密文件。
- en: 'In order to encrypt a file with `gpg` use:'
  id: totrans-345
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用`gpg`加密文件，请使用：
- en: '[PRE77]'
  id: totrans-346
  prefs: []
  type: TYPE_PRE
  zh: '[PRE77]'
- en: This command reads the passphrase interactively and generates `filename.gpg`.
  id: totrans-347
  prefs: []
  type: TYPE_NORMAL
  zh: 此命令交互式地读取密码并生成`filename.gpg`。
- en: 'In order to decrypt a `gpg` file use:'
  id: totrans-348
  prefs: []
  type: TYPE_NORMAL
  zh: 要解密`gpg`文件，请使用：
- en: '[PRE78]'
  id: totrans-349
  prefs: []
  type: TYPE_PRE
  zh: '[PRE78]'
- en: This command reads a passphrase and decrypts the file.
  id: totrans-350
  prefs: []
  type: TYPE_NORMAL
  zh: 此命令读取密码并解密文件。
- en: '**Base64**'
  id: totrans-351
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Base64**'
- en: Base64 is a group of similar encoding schemes that represents binary data in
    an ASCII string format by translating it into a radix-64 representation. The `base64`
    command can be used to encode and decode the Base64 string.
  id: totrans-352
  prefs: []
  type: TYPE_NORMAL
  zh: Base64是一组类似的编码方案，通过将二进制数据转换为基64表示形式的ASCII字符串格式来表示二进制数据。`base64`命令可用于编码和解码Base64字符串。
- en: 'In order to encode a binary file into Base64 format, use:'
  id: totrans-353
  prefs: []
  type: TYPE_NORMAL
  zh: 为了将二进制文件编码为Base64格式，请使用：
- en: '[PRE79]'
  id: totrans-354
  prefs: []
  type: TYPE_PRE
  zh: '[PRE79]'
- en: 'Or:'
  id: totrans-355
  prefs: []
  type: TYPE_NORMAL
  zh: 或：
- en: '[PRE80]'
  id: totrans-356
  prefs: []
  type: TYPE_PRE
  zh: '[PRE80]'
- en: It can read from `stdin`.
  id: totrans-357
  prefs: []
  type: TYPE_NORMAL
  zh: 它可以从`stdin`读取。
- en: 'Decode Base64 data as follows:'
  id: totrans-358
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下方式解码Base64数据：
- en: '[PRE81]'
  id: totrans-359
  prefs: []
  type: TYPE_PRE
  zh: '[PRE81]'
- en: 'Or:'
  id: totrans-360
  prefs: []
  type: TYPE_NORMAL
  zh: 或：
- en: '[PRE82]'
  id: totrans-361
  prefs: []
  type: TYPE_PRE
  zh: '[PRE82]'
- en: '**md5sum** and **sha1sum**'
  id: totrans-362
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**md5sum** 和 **sha1sum**'
- en: '**md5sum** and **sha1sum** are unidirectional hash algorithms, which cannot
    be reversed to form the original data. These are usually used to verify the integrity
    of data or for generating a unique key from a given data. For every file it generates
    a unique key by analyzing its content.'
  id: totrans-363
  prefs: []
  type: TYPE_NORMAL
  zh: '**md5sum** 和 **sha1sum** 是单向哈希算法，无法逆转为原始数据。通常用于验证数据的完整性或从给定数据生成唯一密钥。对于每个文件，它通过分析其内容生成一个唯一密钥。'
- en: '[PRE83]'
  id: totrans-364
  prefs: []
  type: TYPE_PRE
  zh: '[PRE83]'
- en: These types of hashes are ideal for storing passwords. Passwords are stored
    as its hashes. When a user wants to authenticate, the password is read and converted
    to the hash. Then hash is compared to the one that is stored already. If they
    are same, the password is authenticated and access is provided, else it is denied.
    Storing original password strings is risky and poses a security risk of exposing
    the password.
  id: totrans-365
  prefs: []
  type: TYPE_NORMAL
  zh: 这些类型的哈希适合于存储密码。密码以其哈希形式存储。当用户要进行身份验证时，密码被读取并转换为哈希。然后将哈希与已存储的哈希进行比较。如果它们相同，密码得到验证并提供访问权限，否则拒绝。存储原始密码字符串是有风险的，并会暴露密码的安全风险。
- en: '**Shadowlike hash (salted hash)**'
  id: totrans-366
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**类似影子的哈希（盐哈希）**'
- en: Let's see how to generate shadow like salted hash for passwords.
  id: totrans-367
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看如何生成类似影子的盐哈希密码。
- en: 'The user passwords in Linux are stored as its hashes in the `/etc/shadow` file.
    A typical line in `/etc/shadow` will look like this:'
  id: totrans-368
  prefs: []
  type: TYPE_NORMAL
  zh: Linux中的用户密码以其哈希形式存储在`/etc/shadow`文件中。`/etc/shadow`中的典型行看起来像这样：
- en: '[PRE84]'
  id: totrans-369
  prefs: []
  type: TYPE_PRE
  zh: '[PRE84]'
- en: In this line `$6$fG4eWdUi$ohTKOlEUzNk77.4S8MrYe07NTRV4M3LrJnZP9p.qc1bR5c.EcOruzPXfEu1uloBFUa18ENRH7F70zhodas3cR`
    is the shadow hash corresponding to its password.
  id: totrans-370
  prefs: []
  type: TYPE_NORMAL
  zh: 在这行中`$6$fG4eWdUi$ohTKOlEUzNk77.4S8MrYe07NTRV4M3LrJnZP9p.qc1bR5c.EcOruzPXfEu1uloBFUa18ENRH7F70zhodas3cR`是与其密码对应的影子哈希。
- en: In some situations, we may need to write critical administration scripts that
    may need to edit passwords or add users manually using a shell script. In that
    case we have to generate a shadow password string and write a similar line as
    above to the shadow file. Let's see how to generate a shadow password using `openssl`.
  id: totrans-371
  prefs: []
  type: TYPE_NORMAL
  zh: 在某些情况下，我们可能需要编写关键的管理脚本，可能需要使用shell脚本手动编辑密码或添加用户。在这种情况下，我们必须生成一个影子密码字符串，并写一个类似上面的行到影子文件中。让我们看看如何使用`openssl`生成影子密码。
- en: Shadow passwords are usually salted passwords. `SALT` is an extra string used
    to obfuscate and make the encryption stronger. The salt consists of random bits
    that are used as one of the inputs to a key derivation function that generates
    the salted hash for the password.
  id: totrans-372
  prefs: []
  type: TYPE_NORMAL
  zh: 影子密码通常是盐密码。`SALT`是一个额外的字符串，用于混淆和加强加密。盐由随机位组成，用作生成密码的盐哈希的输入之一。
- en: For more details on salt, see the Wikipedia page [http://en.wikipedia.org/wiki/Salt_(cryptography)](http://en.wikipedia.org/wiki/Salt_(cryptography)).
  id: totrans-373
  prefs: []
  type: TYPE_NORMAL
  zh: 有关盐的更多细节，请参阅维基百科页面[http://en.wikipedia.org/wiki/Salt_(cryptography)](http://en.wikipedia.org/wiki/Salt_(cryptography))。
- en: '[PRE85]'
  id: totrans-374
  prefs: []
  type: TYPE_PRE
  zh: '[PRE85]'
- en: Replace `SALT_STRING` with a random string and `PASSWORD` with the password
    you want to use.
  id: totrans-375
  prefs: []
  type: TYPE_NORMAL
  zh: 用随机字符串替换`SALT_STRING`，用要使用的密码替换`PASSWORD`。
- en: Backup snapshots with rsync
  id: totrans-376
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用rsync备份快照
- en: Backing up data is something that most sysadmins need to do regularly. We may
    need to backup data in a web server or from remote locations. `rsync` is a command
    that can be used to synchronize files and directories from one location to another
    while minimizing data transfer using file difference calculations and compression.
    The advantage of `rsync` over the `cp` command is that `rsync` uses strong difference
    algorithms. Also, it supports data transfer across networks. While making copies,
    it compares the files in the original and destination locations and will only
    copy the files that are newer. It also supports compression, encryption, and a
    lot more. Let's see how we can work with `rsync`.
  id: totrans-377
  prefs: []
  type: TYPE_NORMAL
  zh: 备份数据是大多数系统管理员需要定期执行的操作。我们可能需要在Web服务器或远程位置备份数据。`rsync`是一个可以用于将文件和目录从一个位置同步到另一个位置的命令，同时最小化数据传输，使用文件差异计算和压缩。`rsync`相对于`cp`命令的优势在于`rsync`使用强大的差异算法。此外，它支持网络数据传输。在复制文件时，它会比较原始位置和目标位置的文件，并只复制更新的文件。它还支持压缩、加密等等。让我们看看如何使用`rsync`。
- en: How to do it...
  id: totrans-378
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做到...
- en: 'In order to copy a source directory to a destination (to create a mirror) use:'
  id: totrans-379
  prefs: []
  type: TYPE_NORMAL
  zh: 为了将源目录复制到目的地（创建镜像），使用以下命令：
- en: '[PRE86]'
  id: totrans-380
  prefs: []
  type: TYPE_PRE
  zh: '[PRE86]'
- en: 'In this command:'
  id: totrans-381
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个命令中：
- en: '`-a` stands for archiving'
  id: totrans-382
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-a`代表存档'
- en: '`-v` (verbose) prints the details or progress on `stdout`'
  id: totrans-383
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-v`（详细）在`stdout`上打印详细信息或进度'
- en: The above command will recursively copy all the files from the source path to
    the destination path. We can specify paths as remote or localhost paths.
  id: totrans-384
  prefs: []
  type: TYPE_NORMAL
  zh: 上述命令将递归地将所有文件从源路径复制到目标路径。我们可以指定远程或本地主机路径。
- en: It can be in the format `/home/slynux/data`, [slynux@192.168.0.6:/home/backups/data](http://slynux@192.168.0.6:/home/backups/data),
    and so on.
  id: totrans-385
  prefs: []
  type: TYPE_NORMAL
  zh: 它可以是格式为`/home/slynux/data`，[slynux@192.168.0.6:/home/backups/data](http://slynux@192.168.0.6:/home/backups/data)，等等。
- en: '`/home/slynux/data` specifies the absolute path in the machine in which the
    `rsync` command is executed. `slynux@192.168.0.6:/home/backups/data` specifies
    that the path is`/home/backups/data` in the machine with IP address `192.168.0.6`
    and is logged in as user `slynux`.'
  id: totrans-386
  prefs: []
  type: TYPE_NORMAL
  zh: '`/home/slynux/data`指定了在执行`rsync`命令的机器上的绝对路径。`slynux@192.168.0.6:/home/backups/data`指定了IP地址为`192.168.0.6`的机器上的路径为`/home/backups/data`，并以用户`slynux`登录。'
- en: 'In order to back up data to a remote server or host, use:'
  id: totrans-387
  prefs: []
  type: TYPE_NORMAL
  zh: 为了将数据备份到远程服务器或主机，请使用：
- en: '[PRE87]'
  id: totrans-388
  prefs: []
  type: TYPE_PRE
  zh: '[PRE87]'
- en: To keep a mirror at the destination, run the same `rsync` command scheduled
    at regular intervals. It will copy only changed files to the destination.
  id: totrans-389
  prefs: []
  type: TYPE_NORMAL
  zh: 为了在目的地保持镜像，以规律的间隔运行相同的`rsync`命令。它只会将更改的文件复制到目的地。
- en: 'Restore the data from remote host to `localhost` as follows:'
  id: totrans-390
  prefs: []
  type: TYPE_NORMAL
  zh: 从远程主机恢复数据到`localhost`如下：
- en: '[PRE88]'
  id: totrans-391
  prefs: []
  type: TYPE_PRE
  zh: '[PRE88]'
- en: The `rsync` command uses SSH to connect to another remote machine. Provide the
    remote machine address in the format [user@host](http://user@host), where user
    is the username and host is the IP address or domain name attached to the remote
    machine. `PATH` is the absolute path address where the data needs to be copied.
    `rsync` will ask for the user password as usual for SSH logic. This can be automated
    (avoid user password probing) by using SSH keys.
  id: totrans-392
  prefs: []
  type: TYPE_NORMAL
  zh: '`rsync`命令使用SSH连接到另一台远程计算机。在格式[user@host](http://user@host)中提供远程计算机地址，其中user是用户名，host是附加到远程计算机的IP地址或域名。`PATH`是需要复制数据的绝对路径地址。`rsync`将像往常一样要求用户密码以进行SSH逻辑。这可以通过使用SSH密钥来自动化（避免用户密码探测）。'
- en: Make sure that the OpenSSH is installed and running on the remote machine.
  id: totrans-393
  prefs: []
  type: TYPE_NORMAL
  zh: 确保远程计算机上安装并运行OpenSSH。
- en: 'Compressing data while transferring through the network can significantly optimize
    the speed of the transfer. We can use the `rsync` option `–z` to specify to compress
    data while transferring through a network. For example:'
  id: totrans-394
  prefs: []
  type: TYPE_NORMAL
  zh: 通过网络传输时压缩数据可以显著优化传输速度。我们可以使用`rsync`选项`-z`来指定在通过网络传输时压缩数据。例如：
- en: '[PRE89]'
  id: totrans-395
  prefs: []
  type: TYPE_PRE
  zh: '[PRE89]'
- en: Note
  id: totrans-396
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: For the PATH format, if we use `/` at the end of the source, `rsync` will copy
    contents of that end directory specified in the `source_path` to the destination.
  id: totrans-397
  prefs: []
  type: TYPE_NORMAL
  zh: 对于PATH格式，如果我们在源路径的末尾使用`/`，`rsync`将把指定在`source_path`中的末尾目录的内容复制到目的地。
- en: If `/` not at the end of the source, `rsync` will copy that end directory itself
    to the destination.
  id: totrans-398
  prefs: []
  type: TYPE_NORMAL
  zh: 如果源路径末尾没有`/`，`rsync`将复制该末尾目录本身到目的地。
- en: 'For example, the following command copies the content of the `test` directory:'
  id: totrans-399
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，以下命令复制了`test`目录的内容：
- en: '[PRE90]'
  id: totrans-400
  prefs: []
  type: TYPE_PRE
  zh: '[PRE90]'
- en: 'The following command copies the `test` directory to the destination:'
  id: totrans-401
  prefs: []
  type: TYPE_NORMAL
  zh: 以下命令将`test`目录复制到目的地：
- en: '[PRE91]'
  id: totrans-402
  prefs: []
  type: TYPE_PRE
  zh: '[PRE91]'
- en: Note
  id: totrans-403
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: If `/` is at the end of `destination_path`, `rsync` will copy the source to
    the destination directory.
  id: totrans-404
  prefs: []
  type: TYPE_NORMAL
  zh: 如果`destination_path`末尾有`/`，`rsync`将把源复制到目的地目录。
- en: If `/` is not used at the end of the destination path, `rsync` will create a
    folder, named similar to the source directory, at the end of the destination path
    and copy the source into that directory.
  id: totrans-405
  prefs: []
  type: TYPE_NORMAL
  zh: 如果目的地路径末尾没有使用`/`，`rsync`将在目的地路径的末尾创建一个文件夹，该文件夹的名称与源目录类似，并将源复制到该目录中。
- en: 'For example:'
  id: totrans-406
  prefs: []
  type: TYPE_NORMAL
  zh: 例如：
- en: '[PRE92]'
  id: totrans-407
  prefs: []
  type: TYPE_PRE
  zh: '[PRE92]'
- en: This command copies the source (`/home/test`) to an existing folder called `backups`.
  id: totrans-408
  prefs: []
  type: TYPE_NORMAL
  zh: 此命令将源（`/home/test`）复制到名为`backups`的现有文件夹。
- en: '[PRE93]'
  id: totrans-409
  prefs: []
  type: TYPE_PRE
  zh: '[PRE93]'
- en: This command copies the source (`/home/test`) to a directory named `backups`
    by creating that directory.
  id: totrans-410
  prefs: []
  type: TYPE_NORMAL
  zh: 此命令通过创建目录将源（`/home/test`）复制到名为`backups`的目录中。
- en: There's more...
  id: totrans-411
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: The `rsync` command has several additional functionalities that can be specified
    using its command-line options. Let's go through them.
  id: totrans-412
  prefs: []
  type: TYPE_NORMAL
  zh: '`rsync`命令具有几个额外的功能，可以使用其命令行选项来指定。让我们逐个了解。'
- en: Excluding files while archiving with rsync
  id: totrans-413
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在使用rsync进行归档时排除文件
- en: 'Some files need not be updated while archiving to a remote location. It is
    possible to tell `rsync` to exclude certain files from the current operation.
    Files can be excluded by two options:'
  id: totrans-414
  prefs: []
  type: TYPE_NORMAL
  zh: 有些文件在归档到远程位置时不需要更新。可以告诉`rsync`从当前操作中排除某些文件。文件可以通过两个选项来排除：
- en: '[PRE94]'
  id: totrans-415
  prefs: []
  type: TYPE_PRE
  zh: '[PRE94]'
- en: 'We can specify a wildcard pattern of files to be excluded. For example:'
  id: totrans-416
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以指定要排除的文件的通配符模式。例如：
- en: '[PRE95]'
  id: totrans-417
  prefs: []
  type: TYPE_PRE
  zh: '[PRE95]'
- en: This command excludes `.txt` files from backing up.
  id: totrans-418
  prefs: []
  type: TYPE_NORMAL
  zh: 此命令排除了`.txt`文件的备份。
- en: Or, we can specify a list of files to be excluded by providing a list file.
  id: totrans-419
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，我们可以通过提供一个文件列表来指定要排除的文件。
- en: Use `--exclude-from FILEPATH`.
  id: totrans-420
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`--exclude-from FILEPATH`。
- en: Deleting non-existent files while updating rsync backup
  id: totrans-421
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在更新rsync备份时删除不存在的文件
- en: 'We archive files as tarball and transfer the tarball to the remote backup location.
    When we need to update the backup data, we create a TAR file again and transfer
    the file to the backup location. By default, `rsync` does not remove files from
    the destination if they no longer exist at the source. In order to remove the
    files from the destination that do not exist at the source, use the `rsync --delete`
    option:'
  id: totrans-422
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将文件存档为tarball并将tarball传输到远程备份位置。当我们需要更新备份数据时，我们再次创建一个TAR文件并将文件传输到备份位置。默认情况下，如果目的地不存在源文件，`rsync`不会从目的地删除文件。为了从目的地删除在源文件中不存在的文件，请使用`rsync
    --delete`选项：
- en: '[PRE96]'
  id: totrans-423
  prefs: []
  type: TYPE_PRE
  zh: '[PRE96]'
- en: Scheduling backups at intervals
  id: totrans-424
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在间隔时间安排备份
- en: You can create a cron job to schedule backups at regular intervals.
  id: totrans-425
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以创建一个cron作业以规律的间隔安排备份。
- en: 'A sample is as follows:'
  id: totrans-426
  prefs: []
  type: TYPE_NORMAL
  zh: 示例如下：
- en: '[PRE97]'
  id: totrans-427
  prefs: []
  type: TYPE_PRE
  zh: '[PRE97]'
- en: 'Add the following line:'
  id: totrans-428
  prefs: []
  type: TYPE_NORMAL
  zh: 添加以下行：
- en: '[PRE98]'
  id: totrans-429
  prefs: []
  type: TYPE_PRE
  zh: '[PRE98]'
- en: The above `crontab` entry schedules the `rsync` to be executed every 10 hours.
  id: totrans-430
  prefs: []
  type: TYPE_NORMAL
  zh: 上述`crontab`条目安排每10小时执行一次`rsync`。
- en: '`*/10` is the hour position of the `crontab` syntax. `/10` specifies to execute
    the backup every 10 hours. If `*/10` is written in the minutes position, it will
    execute every 10 minutes.'
  id: totrans-431
  prefs: []
  type: TYPE_NORMAL
  zh: '`*/10`是`crontab`语法的小时位置。`/10`指定每10小时执行一次备份。如果`*/10`写在分钟位置，它将每10分钟执行一次。'
- en: Have a look at the *Scheduling with cron* recipe in [Chapter 9](ch09.html "Chapter 9. Administration
    Calls") to understand how to configure `crontab`.
  id: totrans-432
  prefs: []
  type: TYPE_NORMAL
  zh: 查看[第9章](ch09.html "第9章。管理调用")中的*Scheduling with cron*配方，了解如何配置`crontab`。
- en: Version control based backup with Git
  id: totrans-433
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 基于Git的版本控制备份
- en: People use different strategies in backing up data. Differential backups are
    more efficient than making copies of the entire source directory to a target the
    backup directory with the version number using date or time of a day. It causes
    wastage of space. We only need to copy the changes that occurred to files from
    the second time that the backups occur. This is called incremental backups. We
    can manually create incremental backups using tools like `rsync`. But restoring
    this sort of backup can be difficult. The best way to maintain and restore changes
    is to use version control systems. They are very much used in software development
    and maintenance of code, since coding frequently undergoes changes. Git (GNU it)
    is a very famous and is the most efficient version control systems available.
    Let's use Git for backup of regular files in non-programming context. Git can
    be installed by your distro's package manager. It was written by Linus Torvalds.
  id: totrans-434
  prefs: []
  type: TYPE_NORMAL
  zh: 人们在备份数据时使用不同的策略。差异备份比将整个源目录的副本复制到目标备份目录更有效，使用日期或当天时间的版本号。这会造成空间的浪费。我们只需要复制从第二次备份发生以来发生的文件更改。这称为增量备份。我们可以使用`rsync`等工具手动创建增量备份。但是恢复这种备份可能会很困难。保持和恢复更改的最佳方法是使用版本控制系统。它们在软件开发和代码维护中被广泛使用，因为编码经常发生变化。Git（GNU
    it）是一个非常著名且最有效的版本控制系统。让我们在非编程环境中使用Git备份常规文件。Git可以通过您的发行版软件包管理器安装。它是由Linus Torvalds编写的。
- en: Getting ready
  id: totrans-435
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'Here is the problem statement:'
  id: totrans-436
  prefs: []
  type: TYPE_NORMAL
  zh: 这是问题陈述：
- en: We have a directory that contains several files and subdirectories. We need
    to keep track of changes occurring to the directory contents and back them up.
    If data becomes corrupted or goes missing, we must be able to restore a previous
    copy of that data. We need to backup the data at regular intervals to a remote
    machine. We also need to take the backup at different locations in the same machine
    (localhost). Let's see how to implement it using Git.
  id: totrans-437
  prefs: []
  type: TYPE_NORMAL
  zh: 我们有一个包含多个文件和子目录的目录。我们需要跟踪目录内容发生的更改并对其进行备份。如果数据损坏或丢失，我们必须能够恢复该数据的以前副本。我们需要定期将数据备份到远程机器。我们还需要在同一台机器（本地主机）的不同位置进行备份。让我们看看如何使用Git来实现它。
- en: How to do it...
  id: totrans-438
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做…
- en: 'In the directory which is to be backed up use:'
  id: totrans-439
  prefs: []
  type: TYPE_NORMAL
  zh: 在要备份的目录中使用：
- en: '[PRE99]'
  id: totrans-440
  prefs: []
  type: TYPE_PRE
  zh: '[PRE99]'
- en: Let it be the directory source to be tracked.
  id: totrans-441
  prefs: []
  type: TYPE_NORMAL
  zh: 让源目录被跟踪。
- en: 'Set up and initiate the remote backup directory. In the remote machine, create
    the backup destination directory:'
  id: totrans-442
  prefs: []
  type: TYPE_NORMAL
  zh: 设置并初始化远程备份目录。在远程机器上，创建备份目标目录：
- en: '[PRE100]'
  id: totrans-443
  prefs: []
  type: TYPE_PRE
  zh: '[PRE100]'
- en: 'The following steps are to be performed in the source host machine:'
  id: totrans-444
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤需要在源主机机器上执行：
- en: 'Add user details to Git in the source host machine:'
  id: totrans-445
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在源主机机器上将用户详细信息添加到Git中：
- en: '[PRE101]'
  id: totrans-446
  prefs: []
  type: TYPE_PRE
  zh: '[PRE101]'
- en: 'Initiate the source directory to backup from the host machine. In the source
    directory in the host machine whose files are to be backed up, execute the following
    commands:'
  id: totrans-447
  prefs: []
  type: TYPE_NORMAL
  zh: 从主机机器初始化要备份的源目录。在要备份其文件的主机机器中的源目录中，执行以下命令：
- en: '[PRE102]'
  id: totrans-448
  prefs: []
  type: TYPE_PRE
  zh: '[PRE102]'
- en: 'In the source directory, execute the following command to add the remote git
    directory and synchronize backup:'
  id: totrans-449
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在源目录中，执行以下命令以添加远程git目录并同步备份：
- en: '[PRE103]'
  id: totrans-450
  prefs: []
  type: TYPE_PRE
  zh: '[PRE103]'
- en: Add or remove files for Git tracking.
  id: totrans-451
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加或删除Git跟踪的文件。
- en: 'The following command adds all files and folders in the current directory to
    the backup list:'
  id: totrans-452
  prefs: []
  type: TYPE_NORMAL
  zh: 以下命令将当前目录中的所有文件和文件夹添加到备份列表中：
- en: '[PRE104]'
  id: totrans-453
  prefs: []
  type: TYPE_PRE
  zh: '[PRE104]'
- en: 'We can conditionally add certain files only to the backup list as follows:'
  id: totrans-454
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以有条件地将某些文件添加到备份列表中，方法如下：
- en: '[PRE105]'
  id: totrans-455
  prefs: []
  type: TYPE_PRE
  zh: '[PRE105]'
- en: 'We can remove the files and folders not required to be tracked by using:'
  id: totrans-456
  prefs: []
  type: TYPE_NORMAL
  zh: 通过使用以下命令，我们可以删除不需要跟踪的文件和文件夹：
- en: '[PRE106]'
  id: totrans-457
  prefs: []
  type: TYPE_PRE
  zh: '[PRE106]'
- en: 'It can be a folder or even a wildcard as follows:'
  id: totrans-458
  prefs: []
  type: TYPE_NORMAL
  zh: 它可以是一个文件夹，甚至是一个通配符，如下所示：
- en: '[PRE107]'
  id: totrans-459
  prefs: []
  type: TYPE_PRE
  zh: '[PRE107]'
- en: Check-pointing or marking backup points.
  id: totrans-460
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检查点或标记备份点。
- en: 'We can mark checkpoints for the backup with a message using the following command:'
  id: totrans-461
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用以下命令为备份标记检查点并附上消息：
- en: '[PRE108]'
  id: totrans-462
  prefs: []
  type: TYPE_PRE
  zh: '[PRE108]'
- en: We need to update the backup at the remote location at regular intervals. Hence,
    set up a cron job (for example, backing up every five hours).
  id: totrans-463
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要定期更新远程位置的备份。因此，设置一个cron作业（例如，每五个小时备份一次）。
- en: 'Create a file crontab entry with lines:'
  id: totrans-464
  prefs: []
  type: TYPE_NORMAL
  zh: 创建包含以下行的crontab条目文件：
- en: '[PRE109]'
  id: totrans-465
  prefs: []
  type: TYPE_PRE
  zh: '[PRE109]'
- en: 'Create a script `/home/data/backup.sh` as follows:'
  id: totrans-466
  prefs: []
  type: TYPE_NORMAL
  zh: 创建脚本`/home/data/backup.sh`如下：
- en: '[PRE110]'
  id: totrans-467
  prefs: []
  type: TYPE_PRE
  zh: '[PRE110]'
- en: Now we have set up the backup system.
  id: totrans-468
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经设置好了备份系统。
- en: Restoring data with Git.
  id: totrans-469
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用Git恢复数据。
- en: 'In order to view all backup versions use:'
  id: totrans-470
  prefs: []
  type: TYPE_NORMAL
  zh: 为了查看所有备份版本，请使用：
- en: '[PRE111]'
  id: totrans-471
  prefs: []
  type: TYPE_PRE
  zh: '[PRE111]'
- en: Update the current directory to the last backup by ignoring any recent changes.
  id: totrans-472
  prefs: []
  type: TYPE_NORMAL
  zh: 通过忽略任何最近的更改，将当前目录更新到上次备份。
- en: To revert back to any previous state or version, look into the commit ID, which
    is a 32-character hex string. Use the commit ID with `git checkout`.
  id: totrans-473
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要恢复到任何以前的状态或版本，请查看提交ID，这是一个32个字符的十六进制字符串。使用提交ID和`git checkout`。
- en: 'For commit ID 3131f9661ec1739f72c213ec5769bc0abefa85a9 it will be:'
  id: totrans-474
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于提交ID 3131f9661ec1739f72c213ec5769bc0abefa85a9，它将是：
- en: '[PRE112]'
  id: totrans-475
  prefs: []
  type: TYPE_PRE
  zh: '[PRE112]'
- en: 'In order to view the details about versions again, use:'
  id: totrans-476
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为了再次查看版本的详细信息，请使用：
- en: '[PRE113]'
  id: totrans-477
  prefs: []
  type: TYPE_PRE
  zh: '[PRE113]'
- en: If the working directory is broken due to some issues, we need to fix the directory
    with the backup at the remote location.
  id: totrans-478
  prefs: []
  type: TYPE_NORMAL
  zh: 如果工作目录由于某些问题而损坏，我们需要使用远程位置的备份来修复目录。
- en: 'Then we can recreate the contents from the backup at the remote location as
    follows:'
  id: totrans-479
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们可以按以下方式从远程位置重新创建内容：
- en: '[PRE114]'
  id: totrans-480
  prefs: []
  type: TYPE_PRE
  zh: '[PRE114]'
- en: This will create a directory backup with all contents.
  id: totrans-481
  prefs: []
  type: TYPE_NORMAL
  zh: 这将创建一个包含所有内容的目录备份。
- en: Cloning hard drive and disks with dd
  id: totrans-482
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用dd克隆硬盘和磁盘
- en: While working with hard drives and partitions, we may need to create copies
    or make backups of full partitions rather than copying all contents (not only
    hard disk partitions but also copy an entire hard disk without missing any information,
    such as boot record, partition table, and so on). In this situation we can use
    the `dd` command. It can be used to clone any type of disks, such as hard disks,
    flash drives, CDs, DVDs, floppy disks, and so on.
  id: totrans-483
  prefs: []
  type: TYPE_NORMAL
  zh: 在处理硬盘和分区时，我们可能需要创建副本或备份完整分区，而不是复制所有内容（不仅是硬盘分区，还包括复制整个硬盘而不丢失任何信息，如引导记录、分区表等）。在这种情况下，我们可以使用`dd`命令。它可以用于克隆任何类型的磁盘，如硬盘、闪存驱动器、CD、DVD、软盘等。
- en: Getting ready
  id: totrans-484
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: The `dd` command expands to Data Definition. Since its improper usage leads
    to loss of data, it is nicknamed as "Data Destroyer". Be careful while using the
    order of arguments. Wrong arguments can lead to loss of entire data or can become
    useless. `dd` is basically a bitstream duplicator that writes the entire bit stream
    from a disk to a file or a file to a disk. Let's see how to use `dd`.
  id: totrans-485
  prefs: []
  type: TYPE_NORMAL
  zh: '`dd`命令扩展到数据定义。由于不正确的使用会导致数据丢失，因此它被昵称为“数据销毁者”。在使用参数顺序时要小心。错误的参数可能导致整个数据丢失或变得无用。`dd`基本上是一个比特流复制器，它将整个比特流从磁盘复制到文件或从文件复制到磁盘。让我们看看如何使用`dd`。'
- en: How to do it...
  id: totrans-486
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做...
- en: 'The syntax for `dd` is as follows:'
  id: totrans-487
  prefs: []
  type: TYPE_NORMAL
  zh: '`dd`的语法如下：'
- en: '[PRE115]'
  id: totrans-488
  prefs: []
  type: TYPE_PRE
  zh: '[PRE115]'
- en: 'In this command:'
  id: totrans-489
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个命令中：
- en: '`if` stands for input file or input device path'
  id: totrans-490
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`if`代表输入文件或输入设备路径'
- en: '`of` stands for target file or target device path'
  id: totrans-491
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`of`代表目标文件或目标设备路径'
- en: '`bs` stands for block size (usually, it is given in the power of 2, for example,
    512, 1024, 2048, and so on). `COUNT` is the number of blocks to be copied (an
    integer).'
  id: totrans-492
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`bs`代表块大小（通常以2的幂给出，例如512、1024、2048等）。`COUNT`是要复制的块数（一个整数）。'
- en: Total bytes copied = BLOCK_SIZE * COUNT
  id: totrans-493
  prefs: []
  type: TYPE_NORMAL
  zh: 总字节数=块大小*计数
- en: '`bs` and `count` are optional.'
  id: totrans-494
  prefs: []
  type: TYPE_NORMAL
  zh: '`bs`和`count`是可选的。'
- en: By specifying `COUNT` we can limit the number of bytes to be copied from input
    file to target. If `COUNT` is not specified, `dd` will copy from input file until
    it reaches the end of file (EOF) marker.
  id: totrans-495
  prefs: []
  type: TYPE_NORMAL
  zh: 通过指定`COUNT`，我们可以限制从输入文件复制到目标的字节数。如果未指定`COUNT`，`dd`将从输入文件复制，直到达到文件的结尾（EOF）标记。
- en: 'In order to copy a partition into a file use:'
  id: totrans-496
  prefs: []
  type: TYPE_NORMAL
  zh: 为了将分区复制到文件中使用：
- en: '[PRE116]'
  id: totrans-497
  prefs: []
  type: TYPE_PRE
  zh: '[PRE116]'
- en: Here `/dev/sda1` is the device path for the partition.
  id: totrans-498
  prefs: []
  type: TYPE_NORMAL
  zh: 这里`/dev/sda1`是分区的设备路径。
- en: 'Restore the partition using the backup as follows:'
  id: totrans-499
  prefs: []
  type: TYPE_NORMAL
  zh: 使用备份还原分区如下：
- en: '[PRE117]'
  id: totrans-500
  prefs: []
  type: TYPE_PRE
  zh: '[PRE117]'
- en: You should be careful about the argument `if` and `of`. Improper usage may lead
    to data loss.
  id: totrans-501
  prefs: []
  type: TYPE_NORMAL
  zh: 您应该小心处理参数`if`和`of`。不正确的使用可能会导致数据丢失。
- en: By changing the device path `/dev/sda1` to the appropriate device path, any
    disk can be copied or restored.
  id: totrans-502
  prefs: []
  type: TYPE_NORMAL
  zh: 通过将设备路径`/dev/sda1`更改为适当的设备路径，可以复制或还原任何磁盘。
- en: 'In order to permanently delete all of the data in a partition, we can make
    `dd` to write zeros into the partition by using the following command:'
  id: totrans-503
  prefs: []
  type: TYPE_NORMAL
  zh: 为了永久删除分区中的所有数据，我们可以使用以下命令使`dd`将零写入分区：
- en: '[PRE118]'
  id: totrans-504
  prefs: []
  type: TYPE_PRE
  zh: '[PRE118]'
- en: '`/dev/zero` is a character device. It always returns infinite zero ''\0'' characters.'
  id: totrans-505
  prefs: []
  type: TYPE_NORMAL
  zh: '`/dev/zero`是一个字符设备。它总是返回无限的零''\0''字符。'
- en: 'Clone one hard disk to another hard disk of the same size as follows:'
  id: totrans-506
  prefs: []
  type: TYPE_NORMAL
  zh: 将一个硬盘克隆到另一个相同大小的硬盘如下：
- en: '[PRE119]'
  id: totrans-507
  prefs: []
  type: TYPE_PRE
  zh: '[PRE119]'
- en: Here `/dev/sdb` is the second hard disk.
  id: totrans-508
  prefs: []
  type: TYPE_NORMAL
  zh: 这里`/dev/sdb`是第二个硬盘。
- en: 'In order to take the image of a CD ROM (ISO file) use:'
  id: totrans-509
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使用CD ROM（ISO文件）的映像文件使用：
- en: '[PRE120]'
  id: totrans-510
  prefs: []
  type: TYPE_PRE
  zh: '[PRE120]'
- en: There's more...
  id: totrans-511
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: When a file system is created in a file which is generated using `dd`, we can
    mount it to a mount point. Let's see how to work with it.
  id: totrans-512
  prefs: []
  type: TYPE_NORMAL
  zh: 当在使用`dd`生成的文件中创建文件系统时，我们可以将其挂载到挂载点。让我们看看如何处理它。
- en: Mounting image files
  id: totrans-513
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 挂载映像文件
- en: Any file image created using `dd` can be mounted using the loopback method.
    Use the `-o loop` with the `mount` command.
  id: totrans-514
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`dd`创建的任何文件映像都可以使用回环方法挂载。使用`mount`命令和`-o loop`。
- en: '[PRE121]'
  id: totrans-515
  prefs: []
  type: TYPE_PRE
  zh: '[PRE121]'
- en: Now we can access the contents of the image files through the location `/mnt/mount_point`.
  id: totrans-516
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们可以通过位置`/mnt/mount_point`访问映像文件的内容。
- en: See also
  id: totrans-517
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 参见
- en: '*Creating ISO files, Hybrid ISO* of [Chapter 3](ch03.html "Chapter 3. File
    In, File Out"), explains how to use dd to create an ISO file from a CD'
  id: totrans-518
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*创建ISO文件，混合ISO* [第3章](ch03.html "第3章。文件输入，文件输出")解释了如何使用dd从CD创建ISO文件'
