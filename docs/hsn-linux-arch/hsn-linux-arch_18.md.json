["```\ndsala@NixMachine: ~ $ mkdir terrafiles\n```", "```\ndsala@NixMachine: ~ $ az account show --query \"{subscriptionId:id}\"\n\ndsala@NixMachine: ~ $ SUB_ID=<subscription id>\n```", "```\ndsala@NixMachine: ~ $ az ad sp create-for-rbac \\\n--role=\"Contributor\" \\\n--scopes=\"/subscriptions/${SUB_ID}\"\n```", "```\nsubscription_id = \"azure-subscription-id\"\ntenant_id = \"tenant-from-service-principal\"\nclient_id = \"appId-from-service-principal\"\nclient_secret = \"password-from-service-principal\"\n```", "```\nvariable subscription_id {}\nvariable tenant_id {}\nvariable client_id {}\nvariable client_secret {}\n\nprovider \"azurerm\" {\n subscription_id = \"${var.subscription_id}\"\n tenant_id = \"${var.tenant_id}\"\n client_id = \"${var.client_id}\"\n client_secret = \"${var.client_secret}\"\n}\n```", "```\nresource \"azurerm_resource_group\" \"salt\" {\nname     = \"Salt\"\nlocation = \"East US\"\n}\n```", "```\nresource \"azurerm_virtual_network\" \"salt\" {\nname                = \"saltnet\"\naddress_space       = [\"10.0.0.0/16\"]\nlocation            = \"${azurerm_resource_group.salt.location}\"\nresource_group_name = \"${azurerm_resource_group.salt.name}\"\n}\n```", "```\n\"resource_type.local_name.value\".\n```", "```\nresource \"azurerm_subnet\" \"salt\" {\nname                 = \"saltsubnet\"\nresource_group_name  = \"${azurerm_resource_group.salt.name}\"\nvirtual_network_name = \"${azurerm_virtual_network.salt.name}\"\naddress_prefix       = \"10.0.0.0/24\"\n}\n```", "```\nresource \"azurerm_network_security_group\" \"saltlb\" {\n name                = \"lb-nsg\"\n location            = \"${azurerm_resource_group.salt.location}\"\n resource_group_name = \"${azurerm_resource_group.salt.name}\"\n}\n```", "```\nresource \"azurerm_network_security_rule\" \"httpslb\" {\n name = \"https\"\n priority = 100\n direction = \"inbound\"\n access = \"Allow\"\n protocol = \"Tcp\"\n source_port_range = \"*\"\n destination_port_range = \"8443\"\n source_address_prefix = \"*\"\n destination_address_prefix = \"*\"\n resource_group_name = \"${azurerm_resource_group.salt.name}\"\n network_security_group_name = \"${azurerm_network_security_group.saltlb.name}\"\n}\n```", "```\nresource \"azurerm_network_security_rule\" \"httplb\" {\n name                        = \"http\"\n priority                    = 101\n direction                   = \"inbound\"\n access                      = \"Allow\"\n protocol                    = \"Tcp\"\n source_port_range           = \"*\"\n destination_port_range      = \"8080\"\n source_address_prefix       = \"*\"\n destination_address_prefix  = \"*\"\n resource_group_name         = \"${azurerm_resource_group.salt.name}\"\n network_security_group_name = \"${azurerm_network_security_group.saltlb.name}\"\n}\n```", "```\nresource \"azurerm_network_security_rule\" \"sshlb\" {\n name                        = \"sshlb\"\n priority                    = 103 direction                   = \"inbound\"\n access                      = \"Allow\"\n protocol                    = \"Tcp\"\n source_port_range           = \"*\" destination_port_range = \"22\"\n source_address_prefix       = \"*\"\n destination_address_prefix  = \"*\"\n resource_group_name         = \"${azurerm_resource_group.salt.name}\"\n network_security_group_name = \"${azurerm_network_security_group.saltlb.name}\"\n}\n```", "```\nresource \"azurerm_network_security_group\" \"saltMaster\" {\n name                = \"masternsg\"\n location            = \"${azurerm_resource_group.salt.location}\"\n resource_group_name = \"${azurerm_resource_group.salt.name}\"\n}\n```", "```\nresource \"azurerm_network_security_rule\" \"publisher\" {\n name                        = \"publisher\"\n priority                    = 100\n direction                   = \"inbound\"\n access                      = \"Allow\"\n protocol                    = \"Tcp\"\n source_port_range           = \"*\"\n destination_port_range      = \"4505\"\n source_address_prefix       = \"*\"\n destination_address_prefix  = \"*\"\n resource_group_name         = \"${azurerm_resource_group.salt.name}\"\n network_security_group_name = \"${azurerm_network_security_group.saltMaster.name}\"\n}\n```", "```\nresource \"azurerm_network_security_rule\" \"requestsrv\" {\n name                        = \"requestsrv\"\n priority                    = 101\n direction                   = \"inbound\"\n access                      = \"Allow\"\n protocol                    = \"Tcp\"\n source_port_range           = \"*\"\n destination_port_range      = \"4506\"\n source_address_prefix       = \"*\"\n destination_address_prefix  = \"*\"\n resource_group_name         = \"${azurerm_resource_group.salt.name}\"\n network_security_group_name = \"${azurerm_network_security_group.saltMaster.name}\"\n}\n```", "```\nresource \"azurerm_network_security_rule\" \"sshmaster\" {\n name                        = \"ssh\"\n priority                    = 103\n direction                   = \"inbound\"\n access                      = \"Allow\"\n protocol                    = \"Tcp\"\n source_port_range           = \"*\"\n destination_port_range      = \"22\"\n source_address_prefix       = \"*\"\n destination_address_prefix  = \"*\"\n resource_group_name         = \"${azurerm_resource_group.salt.name}\"\n network_security_group_name = \"${azurerm_network_security_group.saltMaster.name}\"\n}\n```", "```\nresource \"azurerm_network_security_group\" \"saltMinions\" {\n name                = \"saltminions\"\n location            = \"${azurerm_resource_group.salt.location}\"\n resource_group_name = \"${azurerm_resource_group.salt.name}\"\n}\n```", "```\n\nresource \"azurerm_public_ip\" \"saltnginxpip\" {\n name                         = \"lbpip\"\n location                     = \"${azurerm_resource_group.salt.location}\"\n resource_group_name          = \"${azurerm_resource_group.salt.name}\"\n public_ip_address_allocation = \"static\"\n}\n```", "```\nresource \"azurerm_network_interface\" \"saltlb\" {\n name                = \"lbnic\"\n location            = \"${azurerm_resource_group.salt.location}\"\n resource_group_name = \"${azurerm_resource_group.salt.name}\"\n network_security_group_id  = \"${azurerm_network_security_group.saltlb.id}\"\n\n ip_configuration {\n name                          = \"lbip\"\n subnet_id                     = \"${azurerm_subnet.salt.id}\"\n private_ip_address_allocation = \"dynamic\"\n public_ip_address_id          = \"${azurerm_public_ip.saltnginxpip.id}\"\n }\n}\n```", "```\nresource \"azurerm_network_interface\" \"saltminions\" {\n count               = 2\n name                = \"webnic${count.index}\"\n location            = \"${azurerm_resource_group.salt.location}\"\n resource_group_name = \"${azurerm_resource_group.salt.name}\"\n network_security_group_id  = \"${azurerm_network_security_group.saltMinions.id}\"\n\n ip_configuration {\n name                          = \"web${count.index}\"\n subnet_id                     = \"${azurerm_subnet.salt.id}\"\n private_ip_address_allocation = \"dynamic\"\n }\n}\n```", "```\nresource \"azurerm_public_ip\" \"saltmasterpip\" {\n name                    = \"masterpip\"\n location                = \"${azurerm_resource_group.salt.location}\"\n resource_group_name     = \"${azurerm_resource_group.salt.name}\"\n allocation_method       = \"Dynamic\"\n}\n```", "```\nresource \"azurerm_network_interface\" \"saltmaster\" {\n name                = \"masternic\"\n location            = \"${azurerm_resource_group.salt.location}\"\n resource_group_name = \"${azurerm_resource_group.salt.name}\"\n network_security_group_id     = \"${azurerm_network_security_group.saltMaster.id}\"\n\n ip_configuration {\n name                          = \"masterip\"\n subnet_id                     = \"${azurerm_subnet.salt.id}\"\n private_ip_address_allocation = \"static\"\n private_ip_address            = \"10.0.0.10\"\n public_ip_address_id          = \"${azurerm_public_ip.saltmasterpip.id}\"\n }\n}\n```", "```\nresource \"azurerm_virtual_machine\" \"saltminions\" {\ncount                 = 2\nname                  = \"web-0${count.index}\"\nlocation              = \"${azurerm_resource_group.salt.location}\"\nresource_group_name   = \"${azurerm_resource_group.salt.name}\"\nnetwork_interface_ids = [\"${element(azurerm_network_interface.saltminions.*.id, count.index)}\"]\nvm_size               = \"Standard_B1s\"\nstorage_image_reference {\n publisher = \"Canonical\"\n offer     = \"UbuntuServer\"\n sku       = \"16.04-LTS\"\n version   = \"latest\"\n}\nstorage_os_disk {\n name              = \"webosdisk${count.index}\"\n caching           = \"ReadWrite\"\n create_option     = \"FromImage\"\n managed_disk_type = \"Standard_LRS\"\n}\nos_profile {\n computer_name  = \"web-0${count.index}\"\n admin_username = \"dsala\"\n}\nos_profile_linux_config {\n disable_password_authentication = true\n ssh_keys = {\n path   = \"/home/dsala/.ssh/authorized_keys\"\n key_data = \"${file(\"~/.ssh/id_rsa.pub\")}\"\n }\n }\n}\n```", "```\nresource \"azurerm_virtual_machine\" \"saltmaster\" {\nname                  = \"salt\"\nlocation              = \"${azurerm_resource_group.salt.location}\"\nresource_group_name   = \"${azurerm_resource_group.salt.name}\"\nnetwork_interface_ids = [\"${azurerm_network_interface.saltmaster.id}\"]\nvm_size               = \"Standard_B1ms\"\n\nstorage_image_reference {\n publisher = \"OpenLogic\"\n offer     = \"CentOS\"\n sku       = \"7.5\"\n version   = \"latest\"\n}\n\nstorage_os_disk {\n name              = \"saltos\"\n caching           = \"ReadWrite\"\n create_option     = \"FromImage\"\n managed_disk_type = \"Standard_LRS\"\n}\n\nos_profile {\n computer_name  = \"salt\"\n admin_username = \"dsala\"\n}\n\nos_profile_linux_config {\n disable_password_authentication = true\n ssh_keys = {\n path   = \"/home/dsala/.ssh/authorized_keys\"\n key_data = \"${file(\"~/.ssh/id_rsa.pub\")}\"\n }\n }\n}\n```", "```\nresource \"azurerm_virtual_machine\" \"saltlb\" {\nname                  = \"lb-vm\"\nlocation              = \"${azurerm_resource_group.salt.location}\"\nresource_group_name   = \"${azurerm_resource_group.salt.name}\"\nnetwork_interface_ids = [\"${azurerm_network_interface.saltlb.id}\"]\nvm_size               = \"Standard_B1ms\"\n\nstorage_image_reference {\n publisher = \"OpenLogic\"\n offer     = \"CentOS\"\n sku       = \"7.5\"\n version   = \"latest\"\n}\n\nstorage_os_disk {\n name              = \"lbos\"\n caching           = \"ReadWrite\"\n create_option     = \"FromImage\"\n managed_disk_type = \"Standard_LRS\"\n}\n\nos_profile {\n computer_name  = \"lb-vm\"\n admin_username = \"dsala\"\n}\n\nos_profile_linux_config {\n disable_password_authentication = true\n ssh_keys = {\n path   = \"/home/dsala/.ssh/authorized_keys\"\n key_data = \"${file(\"~/.ssh/id_rsa.pub\")}\"\n }\n }\n}\n```", "```\nApply complete! Resources: 18 added, 0 changed, 0 destroyed.\n Installing, Configuring and Managing Salt\n```", "```\n[dsala@salt ~]$ sudo yum install \\\nhttps://repo.saltstack.com/yum/redhat/salt-repo-latest.el7.noarch.rpm\n```", "```\n[dsala@salt ~]$ sudo yum install salt-master -y\n```", "```\n[dsala@salt ~]$ sudo systemctl enable salt-master --now\n```", "```\n[dsala@salt ~]$ ifconfig eth0 | grep inet | head -1 | awk '{print $2}'\n```", "```\n[dsala@lb-vm ~]$ sudo yum install salt-minion -y\n```", "```\n[dsala@lb-vm ~]$ sudo systemctl enable salt-minion --now\n```", "```\ndsala@web-00:~$ echo \"deb http://repo.saltstack.com/apt/ubuntu/16.04/amd64/latest xenial main\" \\\n| sudo tee /etc/apt/sources.list.d/saltstack.list\n```", "```\ndsala@web-00:~$ sudo apt install salt-minion -y\n```", "```\ndsala@web-00:~$ sudo systemctl enable salt-minion --now && systemctl status salt-minion\n```", "```\nuser@master:~$ curl -L https://bootstrap.saltstack.com -o install_salt.sh\n```", "```\nuser@master:~$ sudo sh install_salt.sh -P -M\n```", "```\nuser@master:~$ sudo sh install_salt.sh -P -A <salt master IP>\n```", "```\n[dsala@salt ~]$ sudo systemctl daemon-reload && sudo systemctl restart  salt-master\n```", "```\n[dsala@web-00 ~]$ sudo systemctl daemon-reload && sudo systemctl restart salt-master\n```", "```\n[dsala@web-00 ~]$ sudo salt-call --local key.finger\n```", "```\n[dsala@salt ~]$ sudo mkdir /srv/salt\n```", "```\nbase:\n    'web*':\n       - webserver.nodejs\n```", "```\n[dsala@salt ~]$ sudo mkdir /srv/salt/webserver\n```", "```\nnodejs:\n    pkg.installed\n\nnpm:\n    pkg.installed\n```", "```\n[dsala@salt ~]$ sudo salt 'web*' state.apply\n```", "```\nwebuser:\n  user.present:\n    - name: webuser\n    - uid: 4000\n    - home: /home/webuser\n```", "```\nbase:\n   'web*':\n     - webserver.nodejs\n     - webserver.webuser   \n```", "```\nbase:\n   'web*':\n     - webserver.nodejs\n     - webserver.webuser\n     - webserver.gitfetch\n```", "```\nnode-app:\n     git.latest:\n       - name: https://github.com/dsalamancaMS/SaltChap.git\n       - target: /home/webuser/app\n       - user: webuser\n\ndep-install:\n     cmd.wait:\n       - cwd: /home/webuser/app\n       - runas: webuser\n       - name: npm install\n       - watch:\n         - git: node-app\n```", "```\n- webserver.suppkg\n```", "```\n[program:node-app]\ncommand=nodejs .\ndirectory=/home/webuser/app\nuser=webuser\n```", "```\nsupervisor:\n  pkg.installed:\n    - only_upgrade: False\n  service.running:\n    - watch:\n       - file: /etc/supervisor/conf.d/node-app.conf\n\n/etc/supervisor/conf.d/node-app.conf:\n file.managed:\n  - source: salt://webserver/supervisor.conf\n```", "```\n[dsala@salt ~]$ sudo mkdir /srv/salt/nginxlb\n```", "```\nevents { }\nhttp {\n upstream webapp {\n   server web-00:8080;\n   server web-01:8080;\n }\n server {\n   listen 8080;\n   location / {\n     proxy_pass http://webapp;\n   }\n }\n}\n```", "```\nepel-release:\n pkg.installed\n\nnginx:\n pkg.installed:\n - only_upgrade: False\n service.running:\n - watch:\n    - file: /etc/nginx/nginx.conf\n\n/etc/nginx/nginx.conf:\n file.managed:\n  - source: salt://nginxlb/nginx.conf\n```"]